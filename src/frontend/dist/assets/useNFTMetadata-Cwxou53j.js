var Xe=Object.defineProperty;var ke=t=>{throw TypeError(t)};var Ye=(t,e,s)=>e in t?Xe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var U=(t,e,s)=>Ye(t,typeof e!="symbol"?e+"":e,s),he=(t,e,s)=>e.has(t)||ke("Cannot "+s);var n=(t,e,s)=>(he(t,e,"read from private field"),s?s.call(t):e.get(t)),b=(t,e,s)=>e.has(t)?ke("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),y=(t,e,s,r)=>(he(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),m=(t,e,s)=>(he(t,e,"access private method"),s);import{S as Ke,p as Me,e as F,s as se,f as X,n as re,i as pe,g as Ne,t as Ze,h as Ie,k as Le,l as qe,m as ae,o as Qe,q as De,r as v,v as Ve,b as _e,w as et,x as Je,A as Q,u as oe,P as tt}from"./index-5sOdJcVt.js";import{i as He}from"./index-CQEhYxiE.js";var A,f,Y,w,P,K,T,k,Z,V,J,B,$,M,H,g,z,ge,ye,me,be,ve,we,Re,We,$e,st=($e=class extends Ke{constructor(e,s){super();b(this,g);b(this,A);b(this,f);b(this,Y);b(this,w);b(this,P);b(this,K);b(this,T);b(this,k);b(this,Z);b(this,V);b(this,J);b(this,B);b(this,$);b(this,M);b(this,H,new Set);this.options=s,y(this,A,e),y(this,k,null),y(this,T,Me()),this.options.experimental_prefetchInRender||n(this,T).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(n(this,f).addObserver(this),Ue(n(this,f),this.options)?m(this,g,z).call(this):this.updateResult(),m(this,g,be).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Ae(n(this,f),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Ae(n(this,f),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,m(this,g,ve).call(this),m(this,g,we).call(this),n(this,f).removeObserver(this)}setOptions(e){const s=this.options,r=n(this,f);if(this.options=n(this,A).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof F(this.options.enabled,n(this,f))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");m(this,g,Re).call(this),n(this,f).setOptions(this.options),s._defaulted&&!se(this.options,s)&&n(this,A).getQueryCache().notify({type:"observerOptionsUpdated",query:n(this,f),observer:this});const i=this.hasListeners();i&&Pe(n(this,f),r,this.options,s)&&m(this,g,z).call(this),this.updateResult(),i&&(n(this,f)!==r||F(this.options.enabled,n(this,f))!==F(s.enabled,n(this,f))||X(this.options.staleTime,n(this,f))!==X(s.staleTime,n(this,f)))&&m(this,g,ge).call(this);const o=m(this,g,ye).call(this);i&&(n(this,f)!==r||F(this.options.enabled,n(this,f))!==F(s.enabled,n(this,f))||o!==n(this,M))&&m(this,g,me).call(this,o)}getOptimisticResult(e){const s=n(this,A).getQueryCache().build(n(this,A),e),r=this.createResult(s,e);return nt(this,r)&&(y(this,w,r),y(this,K,this.options),y(this,P,n(this,f).state)),r}getCurrentResult(){return n(this,w)}trackResult(e,s){return new Proxy(e,{get:(r,i)=>(this.trackProp(i),s==null||s(i),Reflect.get(r,i))})}trackProp(e){n(this,H).add(e)}getCurrentQuery(){return n(this,f)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=n(this,A).defaultQueryOptions(e),r=n(this,A).getQueryCache().build(n(this,A),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return m(this,g,z).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),n(this,w)))}createResult(e,s){var Te;const r=n(this,f),i=this.options,o=n(this,w),a=n(this,P),l=n(this,K),c=e!==r?e.state:n(this,Y),{state:p}=e;let h={...p},R=!1,d;if(s._optimisticResults){const S=this.hasListeners(),L=!S&&Ue(e,s),j=S&&Pe(e,r,s,i);(L||j)&&(h={...h,...Le(p.data,e.options)}),s._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:W,errorUpdatedAt:G,status:O}=h;d=h.data;let I=!1;if(s.placeholderData!==void 0&&d===void 0&&O==="pending"){let S;o!=null&&o.isPlaceholderData&&s.placeholderData===(l==null?void 0:l.placeholderData)?(S=o.data,I=!0):S=typeof s.placeholderData=="function"?s.placeholderData((Te=n(this,J))==null?void 0:Te.state.data,n(this,J)):s.placeholderData,S!==void 0&&(O="success",d=qe(o==null?void 0:o.data,S,s),R=!0)}if(s.select&&d!==void 0&&!I)if(o&&d===(a==null?void 0:a.data)&&s.select===n(this,Z))d=n(this,V);else try{y(this,Z,s.select),d=s.select(d),d=qe(o==null?void 0:o.data,d,s),y(this,V,d),y(this,k,null)}catch(S){y(this,k,S)}n(this,k)&&(W=n(this,k),d=n(this,V),G=Date.now(),O="error");const ce=h.fetchStatus==="fetching",ue=O==="pending",le=O==="error",Ce=ue&&ce,Ee=d!==void 0,_={status:O,fetchStatus:h.fetchStatus,isPending:ue,isSuccess:O==="success",isError:le,isInitialLoading:Ce,isLoading:Ce,data:d,dataUpdatedAt:h.dataUpdatedAt,error:W,errorUpdatedAt:G,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>c.dataUpdateCount||h.errorUpdateCount>c.errorUpdateCount,isFetching:ce,isRefetching:ce&&!ue,isLoadingError:le&&!Ee,isPaused:h.fetchStatus==="paused",isPlaceholderData:R,isRefetchError:le&&Ee,isStale:Fe(e,s),refetch:this.refetch,promise:n(this,T)};if(this.options.experimental_prefetchInRender){const S=D=>{_.status==="error"?D.reject(_.error):_.data!==void 0&&D.resolve(_.data)},L=()=>{const D=y(this,T,_.promise=Me());S(D)},j=n(this,T);switch(j.status){case"pending":e.queryHash===r.queryHash&&S(j);break;case"fulfilled":(_.status==="error"||_.data!==j.value)&&L();break;case"rejected":(_.status!=="error"||_.error!==j.reason)&&L();break}}return _}updateResult(){const e=n(this,w),s=this.createResult(n(this,f),this.options);if(y(this,P,n(this,f).state),y(this,K,this.options),n(this,P).data!==void 0&&y(this,J,n(this,f)),se(s,e))return;y(this,w,s);const r=()=>{if(!e)return!0;const{notifyOnChangeProps:i}=this.options,o=typeof i=="function"?i():i;if(o==="all"||!o&&!n(this,H).size)return!0;const a=new Set(o??n(this,H));return this.options.throwOnError&&a.add("error"),Object.keys(n(this,w)).some(l=>{const u=l;return n(this,w)[u]!==e[u]&&a.has(u)})};m(this,g,We).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&m(this,g,be).call(this)}},A=new WeakMap,f=new WeakMap,Y=new WeakMap,w=new WeakMap,P=new WeakMap,K=new WeakMap,T=new WeakMap,k=new WeakMap,Z=new WeakMap,V=new WeakMap,J=new WeakMap,B=new WeakMap,$=new WeakMap,M=new WeakMap,H=new WeakMap,g=new WeakSet,z=function(e){m(this,g,Re).call(this);let s=n(this,f).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(re)),s},ge=function(){m(this,g,ve).call(this);const e=X(this.options.staleTime,n(this,f));if(pe||n(this,w).isStale||!Ne(e))return;const r=Ze(n(this,w).dataUpdatedAt,e)+1;y(this,B,setTimeout(()=>{n(this,w).isStale||this.updateResult()},r))},ye=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(n(this,f)):this.options.refetchInterval)??!1},me=function(e){m(this,g,we).call(this),y(this,M,e),!(pe||F(this.options.enabled,n(this,f))===!1||!Ne(n(this,M))||n(this,M)===0)&&y(this,$,setInterval(()=>{(this.options.refetchIntervalInBackground||Ie.isFocused())&&m(this,g,z).call(this)},n(this,M)))},be=function(){m(this,g,ge).call(this),m(this,g,me).call(this,m(this,g,ye).call(this))},ve=function(){n(this,B)&&(clearTimeout(n(this,B)),y(this,B,void 0))},we=function(){n(this,$)&&(clearInterval(n(this,$)),y(this,$,void 0))},Re=function(){const e=n(this,A).getQueryCache().build(n(this,A),this.options);if(e===n(this,f))return;const s=n(this,f);y(this,f,e),y(this,Y,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},We=function(e){ae.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(n(this,w))}),n(this,A).getQueryCache().notify({query:n(this,f),type:"observerResultsUpdated"})})},$e);function rt(t,e){return F(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Ue(t,e){return rt(t,e)||t.state.data!==void 0&&Ae(t,e,e.refetchOnMount)}function Ae(t,e,s){if(F(e.enabled,t)!==!1&&X(e.staleTime,t)!=="static"){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&Fe(t,e)}return!1}function Pe(t,e,s,r){return(t!==e||F(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&Fe(t,s)}function Fe(t,e){return F(e.enabled,t)!==!1&&t.isStaleByTime(X(e.staleTime,t))}function nt(t,e){return!se(t.getCurrentResult(),e)}var N,q,x,C,E,te,xe,je,it=(je=class extends Ke{constructor(e,s){super();b(this,E);b(this,N);b(this,q);b(this,x);b(this,C);y(this,N,e),this.setOptions(s),this.bindMethods(),m(this,E,te).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var r;const s=this.options;this.options=n(this,N).defaultMutationOptions(e),se(this.options,s)||n(this,N).getMutationCache().notify({type:"observerOptionsUpdated",mutation:n(this,x),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&Qe(s.mutationKey)!==Qe(this.options.mutationKey)?this.reset():((r=n(this,x))==null?void 0:r.state.status)==="pending"&&n(this,x).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=n(this,x))==null||e.removeObserver(this)}onMutationUpdate(e){m(this,E,te).call(this),m(this,E,xe).call(this,e)}getCurrentResult(){return n(this,q)}reset(){var e;(e=n(this,x))==null||e.removeObserver(this),y(this,x,void 0),m(this,E,te).call(this),m(this,E,xe).call(this)}mutate(e,s){var r;return y(this,C,s),(r=n(this,x))==null||r.removeObserver(this),y(this,x,n(this,N).getMutationCache().build(n(this,N),this.options)),n(this,x).addObserver(this),n(this,x).execute(e)}},N=new WeakMap,q=new WeakMap,x=new WeakMap,C=new WeakMap,E=new WeakSet,te=function(){var s;const e=((s=n(this,x))==null?void 0:s.state)??De();y(this,q,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},xe=function(e){ae.batch(()=>{var s,r,i,o,a,l,u,c;if(n(this,C)&&this.hasListeners()){const p=n(this,q).variables,h=n(this,q).context;(e==null?void 0:e.type)==="success"?((r=(s=n(this,C)).onSuccess)==null||r.call(s,e.data,p,h),(o=(i=n(this,C)).onSettled)==null||o.call(i,e.data,null,p,h)):(e==null?void 0:e.type)==="error"&&((l=(a=n(this,C)).onError)==null||l.call(a,e.error,p,h),(c=(u=n(this,C)).onSettled)==null||c.call(u,void 0,e.error,p,h))}this.listeners.forEach(p=>{p(n(this,q))})})},je),Ge=v.createContext(!1),at=()=>v.useContext(Ge);Ge.Provider;function ot(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var ct=v.createContext(ot()),ut=()=>v.useContext(ct),lt=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},ht=t=>{v.useEffect(()=>{t.clearReset()},[t])},ft=({result:t,errorResetBoundary:e,throwOnError:s,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||Ve(s,[t.error,r])),dt=t=>{if(t.suspense){const e=r=>r==="static"?r:Math.max(r??1e3,1e3),s=t.staleTime;t.staleTime=typeof s=="function"?(...r)=>e(s(...r)):e(s),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},pt=(t,e)=>t.isLoading&&t.isFetching&&!e,gt=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,Be=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function yt(t,e,s){var h,R,d,W,G;const r=at(),i=ut(),o=_e(),a=o.defaultQueryOptions(t);(R=(h=o.getDefaultOptions().queries)==null?void 0:h._experimental_beforeQuery)==null||R.call(h,a),a._optimisticResults=r?"isRestoring":"optimistic",dt(a),lt(a,i),ht(i);const l=!o.getQueryCache().get(a.queryHash),[u]=v.useState(()=>new e(o,a)),c=u.getOptimisticResult(a),p=!r&&t.subscribed!==!1;if(v.useSyncExternalStore(v.useCallback(O=>{const I=p?u.subscribe(ae.batchCalls(O)):re;return u.updateResult(),I},[u,p]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),v.useEffect(()=>{u.setOptions(a)},[a,u]),gt(a,c))throw Be(a,u,i);if(ft({result:c,errorResetBoundary:i,throwOnError:a.throwOnError,query:o.getQueryCache().get(a.queryHash),suspense:a.suspense}))throw c.error;if((W=(d=o.getDefaultOptions().queries)==null?void 0:d._experimental_afterQuery)==null||W.call(d,a,c),a.experimental_prefetchInRender&&!pe&&pt(c,r)){const O=l?Be(a,u,i):(G=o.getQueryCache().get(a.queryHash))==null?void 0:G.promise;O==null||O.catch(re).finally(()=>{u.updateResult()})}return a.notifyOnChangeProps?c:u.trackResult(c)}function fe(t,e){return yt(t,st)}function mt(t,e){const s=_e(),[r]=v.useState(()=>new it(s,t));v.useEffect(()=>{r.setOptions(t)},[r,t]);const i=v.useSyncExternalStore(v.useCallback(a=>r.subscribe(ae.batchCalls(a)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=v.useCallback((a,l)=>{r.mutate(a,l).catch(re)},[r]);if(i.error&&Ve(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}function ze(){return et()}function Ft(){const{user:t}=ze();return!!t}function Ct(t,e){const s=oe();return Q.createActor(e,{agent:s,canisterId:t})}function Et(t,e){const s=Je();return Q.createActor(e,{agent:s,canisterId:t})}const ee=({IDL:t})=>{const e=t.Record({owner:t.Principal,subaccount:t.Opt(t.Vec(t.Nat8))}),s=t.Record({account:e,spender:e}),r=t.Record({allowance:t.Nat,expires_at:t.Opt(t.Nat64)}),i=t.Record({fee:t.Opt(t.Nat),memo:t.Opt(t.Vec(t.Nat8)),from_subaccount:t.Opt(t.Vec(t.Nat8)),created_at_time:t.Opt(t.Nat64),amount:t.Nat,expected_allowance:t.Opt(t.Nat),expires_at:t.Opt(t.Nat64),spender:e}),o=t.Variant({Ok:t.Nat,Err:t.Variant({BadFee:t.Record({expected_fee:t.Nat}),InsufficientFunds:t.Record({balance:t.Nat}),AllowanceChanged:t.Record({current_allowance:t.Nat}),Expired:t.Record({ledger_time:t.Nat64}),TooOld:t.Null,CreatedInFuture:t.Record({ledger_time:t.Nat64}),Duplicate:t.Record({duplicate_of:t.Nat}),TemporarilyUnavailable:t.Null,GenericError:t.Record({error_code:t.Nat,message:t.Text})})});return t.Service({icrc1_symbol:t.Func([],[t.Text],["query"]),icrc1_decimals:t.Func([],[t.Nat8],["query"]),icrc1_fee:t.Func([],[t.Nat],["query"]),icrc1_name:t.Func([],[t.Text],["query"]),icrc1_balance_of:t.Func([e],[t.Nat],["query"]),icrc2_allowance:t.Func([s],[r],["query"]),icrc2_approve:t.Func([i],[o],[])})},Tt=t=>{const{user:e}=ze(),s=oe(),r=_e(),i=typeof t=="string"?tt.fromText(t):t,o=fe({queryKey:["fungible-token",i.toString()],queryFn:async()=>{if(!s)throw new Error("Agent not available");const c=Q.createActor(ee,{agent:s,canisterId:i}),[p,h,R,d]=await Promise.all([c.icrc1_symbol(),c.icrc1_decimals(),c.icrc1_fee(),c.icrc1_name()]);return{symbol:p,decimals:Number(h),fee:R,name:d}},enabled:!!s}),a=c=>fe({queryKey:["fungible-token-balance",i.toString(),c==null?void 0:c.owner.toString(),c==null?void 0:c.subaccount],queryFn:async()=>!c||!s?BigInt(0):await Q.createActor(ee,{agent:s,canisterId:i}).icrc1_balance_of(c),enabled:!!c&&!!s}),l=c=>fe({queryKey:["fungible-token-allowance",i.toString(),c==null?void 0:c.account.owner.toString(),c==null?void 0:c.spender.owner.toString()],queryFn:async()=>{if(!c||!s)throw new Error("Allowance args and agent required");return await Q.createActor(ee,{agent:s,canisterId:i}).icrc2_allowance(c)},enabled:!!c&&!!s}),u=()=>{const c=Je();return mt({mutationFn:async p=>{if(!(e!=null&&e.principal))throw new Error("Must be authenticated to approve");const R=await Q.createActor(ee,{agent:c,canisterId:i}).icrc2_approve(p);if("Err"in R){const d=R.Err;throw"BadFee"in d?new Error(`Bad fee: expected ${d.BadFee.expected_fee}`):"InsufficientFunds"in d?new Error(`Insufficient funds: balance ${d.InsufficientFunds.balance}`):"AllowanceChanged"in d?new Error(`Allowance changed: current ${d.AllowanceChanged.current_allowance}`):"GenericError"in d?new Error(`Generic error: ${d.GenericError.message}`):new Error(`Approval failed: ${JSON.stringify(d)}`)}},onSuccess:()=>{r.invalidateQueries({queryKey:["fungible-token-allowance",i.toString()]}),r.invalidateQueries({queryKey:["fungible-token-balance",i.toString()]})}})};return{data:o.data,isLoading:o.isLoading,error:o.error,refetch:o.refetch,useBalance:a,useAllowance:l,useApprove:u}};v.createContext(null);function bt(t,e){const s=[];for(let r=0;r<t.length;r+=e)s.push(t.slice(r,r+e));return s}const ne=class ne{constructor(){U(this,"queues",new Map);U(this,"timer",null)}static get instance(){return this._instance||(this._instance=new ne),this._instance}request(e,s,r){let i=this.queues.get(e);i||(i={fetcher:s,tokenMap:new Map},this.queues.set(e,i));let o=i.tokenMap.get(r);if(!o){let a,l;o={promise:new Promise((c,p)=>{a=c,l=p}),resolve:a,reject:l},i.tokenMap.set(r,o)}return this.scheduleFlush(),o.promise}scheduleFlush(){this.timer||(this.timer=setTimeout(()=>{this.flush(),this.timer=null},10))}async flush(){for(const[e,{fetcher:s,tokenMap:r}]of this.queues.entries()){const i=Array.from(r.keys()),o=bt(i,25);try{for(const a of o)(await s(a)).forEach((u,c)=>{const p=a[c];r.get(p).resolve(u)})}catch(a){r.forEach(l=>l.reject(a))}this.queues.delete(e)}}};U(ne,"_instance");let Oe=ne;const vt=Oe.instance;function wt(t,e){const s=[];for(let r=0;r<t.length;r+=e)s.push(t.slice(r,r+e));return s}const ie=class ie{constructor(){U(this,"queues",new Map);U(this,"timer",null)}static get instance(){return this._instance||(this._instance=new ie),this._instance}request(e,s,r){let i=this.queues.get(e);i||(i={fetcher:s,tokenMap:new Map},this.queues.set(e,i));let o=i.tokenMap.get(r);if(!o){let a,l;o={promise:new Promise((c,p)=>{a=c,l=p}),resolve:a,reject:l},i.tokenMap.set(r,o)}return this.scheduleFlush(),o.promise}scheduleFlush(){this.timer||(this.timer=setTimeout(()=>{this.flush(),this.timer=null},10))}async flush(){for(const[e,{fetcher:s,tokenMap:r}]of this.queues.entries()){console.debug(`Flushing NFTOwnerBatcher for queue: ${e}`);const i=Array.from(r.keys()),o=wt(i,25);console.debug(`Processing ${o.length} batches for queue: ${e}`);try{for(const a of o){const l=await s(a);console.debug(`Fetched results for batch: ${a.join(", ")}`,l),l.forEach((u,c)=>{const p=a[c],h=r.get(p);console.log(`Resolving owner for tokenId ${p}:`,u),u&&u[0]&&u[0].owner?h.resolve({owner:typeof u[0].owner=="string"?u[0].owner:u[0].owner.toString(),subaccount:Array.isArray(u[0].subaccount)&&u[0].subaccount.length>0?new Uint8Array(u[0].subaccount[0]):void 0}):h.resolve(null)})}}catch(a){console.error(`Error flushing NFTOwnerBatcher for queue ${e}:`,a),r.forEach(l=>l.reject(a))}this.queues.delete(e)}}};U(ie,"_instance");let Se=ie;const Rt=Se.instance;function kt(t){const e=oe(),s=v.useCallback(i=>Q.createActor(He,{agent:e,canisterId:t}).icrc7_owner_of(i),[e,t]);return{request:v.useCallback(i=>Rt.request(t,s,i),[t,s])}}function de(t){console.log("parseJSON called with json:",t);try{const e=JSON.parse(t);return{icrc97raw:t,icrc97:{name:e.name||"",description:e.description||"",image:e.image||"",animation_url:e.animation_url||"",external_url:e.external_url||"",attributes:e.attributes||[]}}}catch(e){return console.error("Failed to parse JSON in parseJSON:",e),{icrc97raw:t,icrc97:{name:"",description:"",image:"",animation_url:"",external_url:"",attributes:[]}}}}async function At(t,e){console.log("parseNFTMetadata called with tokenId:",t,"metadata:",e);const s=e;let r={icrc97raw:"",icrc97:{name:"",description:"",image:"",animation_url:"",external_url:"",attributes:[]}};for(const i of s){console.log("Processing metadata entry:",i,"structure:",{isArray:Array.isArray(i),length:i==null?void 0:i.length,firstElement:i==null?void 0:i[0],secondElement:i==null?void 0:i[1],entryType:typeof(i==null?void 0:i[0]),entryValue:typeof(i==null?void 0:i[1])});const o=Array.isArray(i)&&i.length>0?i[0]:i,a=Array.isArray(i)&&i.length>1?i[1]:void 0;if(console.log("Extracted key:",o,"value:",a),o==="icrc97:metadata"||o==="icrc97:metadata_v1"||o==="icrc97:external_metadata")if(console.log("Parsing metadata for tokenId:",t,"key:",o,"value:",a),typeof a=="object"&&a!==null&&"Array"in a&&Array.isArray(a.Array)){console.log("Found Array in value:",a.Array);for(const l of a.Array)if("Text"in l){if(console.log("Found Text value in Array:",l.Text),l.Text.startsWith("data:text/json")){const u=JSON.parse(l.Text.substring(l.Text.indexOf(";")+1));r=de(u);break}if(l.Text.startsWith("https://")||l.Text.startsWith("http://")){let u=await fetch(l.Text);if(console.log("Fetched URL response:",u),u.ok){const c=await u.text();console.log("Fetched URL text:",c),r=de(c);break}else console.error("Failed to fetch URL:",l.Text),r={icrc97raw:l.Text,icrc97:{name:"",description:"",image:"",animation_url:"",external_url:"",attributes:[]}};r=de(l.Text);break}}}else typeof a=="string"?r.icrc97raw=a:r.icrc97raw=JSON.stringify(a)}return{allMetadata:s,parsedMetadata:r,tokenId:t}}function Mt(t,e,s){const[r,i]=v.useState(null),[o,a]=v.useState(!0),[l,u]=v.useState(null),c=oe(),p=v.useCallback(h=>Q.createActor(He,{agent:c,canisterId:t}).icrc7_token_metadata(h),[c,t]);return v.useEffect(()=>{!t||e==null||(a(!0),vt.request(t,p,e).then(async h=>{console.log("Fetched NFT metadata:",h);let R=await At(e,h)||null;console.log("Fetched NFT metadata after parsing:",R),i(R),u(null)}).catch(h=>u(h)).finally(()=>a(!1)))},[t,e,s==null?void 0:s.override,s==null?void 0:s.queryArgs,p]),{metadata:r,loading:o,error:l}}export{Et as a,mt as b,kt as c,ze as d,Tt as e,Mt as f,Ct as g,fe as h,Ft as u};
