const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BykKOlZ5.js","assets/index-CstboGu2.js","assets/index-Wl_QVj2i.css","assets/useNFTMetadata-BLxtY6Ku.js","assets/index-3JlJGJwM.js","assets/index-BTkhUH0V.js"])))=>i.map(i=>d[i]);
var yf=Object.defineProperty;var Jd=e=>{throw TypeError(e)};var Nf=(e,t,n)=>t in e?yf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ie=(e,t,n)=>Nf(e,typeof t!="symbol"?t+"":t,n),Qc=(e,t,n)=>t.has(e)||Jd("Cannot "+n);var y=(e,t,n)=>(Qc(e,t,"read from private field"),n?n.call(e):t.get(e)),me=(e,t,n)=>t.has(e)?Jd("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),I=(e,t,n,r)=>(Qc(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),Ce=(e,t,n)=>(Qc(e,t,"access private method"),n);var Oo=(e,t,n,r)=>({set _(a){I(e,t,a,n)},get _(){return y(e,t,r)}});import{r as x,X as be,Y as wf,j as s,e as vf,F as sd,f as qe,_ as Xe,H as nd,aX as jf,aY as Cf,aZ as kf,a_ as ws,P as Ve,u as rd,A as ea,g as B0,a$ as ss,b0 as P0,b1 as ad,T as wc,b2 as In,Z as Af,$ as Tf,a0 as Ef,a1 as Sf,a2 as Ff,a3 as Rf,a4 as Bf,a5 as Pf,a6 as Mf,a7 as Of,a8 as _f,a9 as If,aa as Uf,ab as $f,ac as Vf,ad as Gf,ae as Hf,af as zf,ag as qf,ah as Qf,ai as Wf,aj as Jf,ak as Kf,al as Yf,am as Zf,an as Xf,ao as Lf,ap as Df,aq as ep,ar as tp,as as sp,at as np,au as rp,av as ap,aw as op,ax as ip,ay as cp,az as lp,aA as dp,aB as up,aC as mp,aD as hp,aE as fp,aF as pp,aG as gp,aH as xp,aI as bp,aJ as yp,aK as Np,aL as wp,aM as vp,aN as jp,aO as Cp,aP as kp,aQ as Ap,aR as Tp,aS as Ep,aT as Sp,aU as Fp,aV as Rp,aW as Bp}from"./index-CstboGu2.js";import{u as Pp,d as ut,a as od,g as rn,e as js,b as Tt,h as id,f as Mp}from"./useNFTMetadata-BLxtY6Ku.js";import{i as Op}from"./index-3JlJGJwM.js";const Bt=Object.freeze(Object.defineProperty({__proto__:null,ACTOR_METHOD_WITH_CERTIFICATE:Rf,ACTOR_METHOD_WITH_HTTP_DETAILS:Ff,Actor:ea,ActorCallError:Tf,AgentCallError:qf,AgentHTTPResponseError:zf,AgentQueryError:Qf,AgentReadStateError:Wf,AnonymousIdentity:Zf,Certificate:Df,CertificateVerificationError:Xf,ED25519_OID:up,Ed25519PublicKey:gp,Expiry:Vf,HttpAgent:nd,IC_ROOT_KEY:_f,IdentityInvalidError:Uf,get LookupStatus(){return sp},MANAGEMENT_CANISTER_ID:If,get NodeType(){return Lf},Observable:fp,ObservableLog:pp,get ProxyMessageKind(){return Jf},QueryCallRejectedError:Ef,get ReplicaRejectCode(){return Mf},get RequestStatusResponseStatus(){return Of},SignIdentity:Yf,get SubmitRequestType(){return Kf},UpdateCallRejectedError:Sf,blsVerify:wp,bufEquals:Ap,bufFromBufLike:Ep,check_canister_ranges:op,compare:kp,concat:vp,decodeLen:dp,decodeLenBytes:lp,defaultStrategy:Bp,encodeLen:cp,encodeLenBytes:ip,find_label:ap,flatten_forks:rp,fromHex:Cp,getDefaultAgent:Pf,getManagementCanister:Bf,hash:xp,hashOfMap:Np,hashValue:bp,httpHeadersTransform:Hf,lookupResultToBuffer:ep,lookup_path:np,makeNonce:$f,makeNonceTransform:Gf,pollForResponse:Fp,polling:Af,randomNumber:Sp,reconstruct:tp,requestIdOf:yp,strategy:Rp,toHex:jp,uint8ToBuf:Tp,unwrapDER:hp,wrapDER:mp},Symbol.toStringTag,{value:"Module"}));/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _p=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ip=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase()),Kd=e=>{const t=Ip(e);return t.charAt(0).toUpperCase()+t.slice(1)},M0=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim(),Up=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var $p={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vp=x.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:o,iconNode:i,...c},l)=>x.createElement("svg",{ref:l,...$p,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:M0("lucide",a),...!o&&!Up(c)&&{"aria-hidden":"true"},...c},[...i.map(([u,d])=>x.createElement(u,d)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=(e,t)=>{const n=x.forwardRef(({className:r,...a},o)=>x.createElement(Vp,{ref:o,iconNode:t,className:M0(`lucide-${_p(Kd(e))}`,`lucide-${e}`,r),...a}));return n.displayName=Kd(e),n};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gp=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],Hp=ht("arrow-left-right",Gp);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zp=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],qp=ht("arrow-left",zp);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qp=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],O0=ht("arrow-right",Qp);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wp=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Jp=ht("chevron-down",Wp);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kp=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ta=ht("chevron-left",Kp);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yp=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Is=ht("chevron-right",Yp);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zp=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],lt=ht("circle-alert",Zp);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xp=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],gt=ht("circle-check-big",Xp);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lp=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Go=ht("circle-check",Lp);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dp=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],eg=ht("circle-x",Dp);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],sa=ht("clock",tg);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sg=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],Yd=ht("coins",sg);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ng=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],_0=ht("credit-card",ng);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rg=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Ds=ht("external-link",rg);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],on=ht("flame",ag);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const og=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Zo=ht("image",og);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],cg=ht("info",ig);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lg=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Qe=ht("loader-circle",lg);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dg=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],cd=ht("plus",dg);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ug=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],mg=ht("rotate-ccw",ug);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hg=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Li=ht("search",hg);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],_s=ht("triangle-alert",fg);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pg=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],na=ht("wallet",pg);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gg=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ra=ht("x",gg);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xg=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],ld=ht("zap",xg),bg=[{id:"connect-ic-wallet",title:"Connect IC Wallet",description:"Connect your Internet Computer wallet (Internet Identity, NFID, Plug, etc.)",estimatedDuration:15,retryable:!0,stage:"setup"},{id:"connect-evm-wallet",title:"Connect EVM Wallet",description:"Connect your Ethereum wallet (MetaMask, WalletConnect, etc.) and switch to correct network",estimatedDuration:20,retryable:!0,stage:"setup"},{id:"input-nft-details",title:"Specify NFT Details",description:"Enter the contract address, token ID, and select source chain",estimatedDuration:30,retryable:!1,stage:"setup"},{id:"verify-ownership",title:"Verify EVM Ownership",description:"Confirming you own the NFT on the source EVM chain",estimatedDuration:15,retryable:!0,stage:"setup"},{id:"check-cknft-canister",title:"Check ckNFT Canister",description:"Checking if a ckNFT canister exists for this contract",estimatedDuration:10,retryable:!0,stage:"canister"},{id:"estimate-canister-cost",title:"Calculate Canister Cost",description:"Estimating cycles needed to create new ckNFT canister (if needed)",estimatedDuration:5,retryable:!0,stage:"canister"},{id:"check-balances",title:"Check Balances",description:"Verifying ICP and cycles balances for canister creation and minting",estimatedDuration:10,retryable:!0,stage:"canister"},{id:"approve-cycles-orchestrator",title:"Approve Cycles (Orchestrator)",description:"Approve cycles ledger to spend cycles for orchestrator operations",estimatedDuration:30,retryable:!0,stage:"canister"},{id:"create-cknft-canister",title:"Create ckNFT Canister",description:"Deploying new ckNFT canister on Internet Computer (if needed)",estimatedDuration:90,retryable:!0,stage:"canister"},{id:"estimate-mint-cost",title:"Calculate Mint Cost",description:"Estimating cycles needed for minting process",estimatedDuration:5,retryable:!0,stage:"preparation"},{id:"approve-cycles-mint",title:"Approve Cycles (Mint)",description:"Approve cycles for the minting operation",estimatedDuration:30,retryable:!0,stage:"preparation"},{id:"get-approval-address",title:"Get Approval Address",description:"Getting the bridge contract address for NFT approval",estimatedDuration:10,retryable:!0,stage:"preparation"},{id:"approve-nft-transfer",title:"Approve NFT Transfer",description:"Approve the bridge to transfer your NFT (EVM transaction)",estimatedDuration:60,retryable:!0,stage:"preparation"},{id:"initiate-mint",title:"Initiate Mint",description:"Starting the cross-chain minting process",estimatedDuration:30,retryable:!0,stage:"execution"},{id:"verify-ownership-remotely",title:"Verify Remote Ownership",description:"Bridge verifying NFT ownership on source chain",estimatedDuration:45,retryable:!0,stage:"execution"},{id:"fetch-metadata",title:"Retrieve Metadata",description:"Fetching NFT metadata from source chain",estimatedDuration:30,retryable:!0,stage:"execution"},{id:"transfer-nft-to-bridge",title:"Transfer to Bridge",description:"Bridge contract receiving NFT from source chain",estimatedDuration:120,retryable:!1,stage:"execution"},{id:"mint-cknft",title:"Mint ckNFT",description:"Minting your NFT on the Internet Computer",estimatedDuration:60,retryable:!0,stage:"execution"},{id:"verify-mint-complete",title:"Verify Completion",description:"Confirming your ckNFT was successfully minted and is in your wallet",estimatedDuration:15,retryable:!0,stage:"execution"}],yg=[{id:"connect-ic-wallet",title:"Connect IC Wallet",description:"Connect your Internet Computer wallet containing the ckNFT",estimatedDuration:15,retryable:!0,stage:"setup"},{id:"select-cknft",title:"Select ckNFT",description:"Choose which ckNFT you want to bridge to EVM",estimatedDuration:20,retryable:!1,stage:"setup"},{id:"select-target-network",title:"Select Target Network",description:"Choose which EVM network to deploy your NFT contract to",estimatedDuration:15,retryable:!1,stage:"setup"},{id:"connect-evm-wallet",title:"Connect EVM Wallet",description:"Connect your target EVM wallet for receiving NFTs",estimatedDuration:20,retryable:!0,stage:"setup"},{id:"check-remote-contract",title:"Check Remote Contract",description:"Checking if NFT contract already exists on target EVM chain",estimatedDuration:10,retryable:!0,stage:"contract"},{id:"estimate-gas-costs",title:"Calculate Gas Costs",description:"Estimating gas fees for contract deployment and minting",estimatedDuration:15,retryable:!0,stage:"contract"},{id:"get-funding-address",title:"Get Funding Address",description:"Getting the bridge funding address for gas payments",estimatedDuration:10,retryable:!0,stage:"contract"},{id:"fund-gas-account",title:"Fund Gas Account",description:"Send ETH to bridge funding address for gas fees",estimatedDuration:90,retryable:!0,stage:"contract"},{id:"approve-cycles-remote",title:"Approve Cycles (Remote)",description:"Approve cycles for remote contract deployment",estimatedDuration:30,retryable:!0,stage:"contract"},{id:"deploy-evm-contract",title:"Deploy EVM Contract",description:"Deploying NFT contract on target EVM network",estimatedDuration:180,retryable:!0,stage:"contract"},{id:"verify-contract-deployment",title:"Verify Contract",description:"Confirming contract was successfully deployed",estimatedDuration:30,retryable:!0,stage:"contract"},{id:"estimate-cast-costs",title:"Calculate Cast Costs",description:"Estimating cycles and gas needed for casting operation",estimatedDuration:10,retryable:!0,stage:"preparation"},{id:"approve-cycles-cast",title:"Approve Cycles (Cast)",description:"Approve cycles for the casting operation",estimatedDuration:30,retryable:!0,stage:"preparation"},{id:"approve-cknft-transfer",title:"Approve ckNFT Transfer",description:"Approve the bridge to transfer your ckNFT",estimatedDuration:30,retryable:!0,stage:"preparation"},{id:"initiate-cast",title:"Initiate Cast",description:"Starting the cross-chain casting process",estimatedDuration:45,retryable:!0,stage:"execution"},{id:"burn-cknft",title:"Burn ckNFT",description:"Burning ckNFT on Internet Computer to release for EVM minting",estimatedDuration:60,retryable:!1,stage:"execution"},{id:"wait-for-consensus",title:"Wait for Consensus",description:"Waiting for cross-chain consensus and verification",estimatedDuration:300,retryable:!1,stage:"execution"},{id:"mint-on-evm",title:"Mint on EVM",description:"Minting your NFT on the target EVM chain",estimatedDuration:120,retryable:!0,stage:"execution"},{id:"verify-evm-ownership",title:"Verify EVM Ownership",description:"Confirming NFT was minted to your EVM wallet",estimatedDuration:30,retryable:!0,stage:"execution"},{id:"cast-complete",title:"Cast Complete",description:"Bridge operation completed successfully",estimatedDuration:5,retryable:!1,stage:"execution"}],Ng=[{id:"setup",title:"ðŸ”Œ Setup & Connection",description:"Connect wallets and verify NFT ownership"},{id:"canister",title:"ðŸ­ Canister Management",description:"Create or check ckNFT canister on IC"},{id:"preparation",title:"âš™ï¸ Preparation",description:"Approve cycles and NFT transfers"},{id:"execution",title:"ðŸš€ Bridge Execution",description:"Execute cross-chain bridging"}],wg=[{id:"setup",title:"ðŸ”Œ Setup & Connection",description:"Connect wallets and select ckNFT"},{id:"contract",title:"ðŸ“œ Contract Management",description:"Deploy or check EVM contract"},{id:"preparation",title:"âš™ï¸ Preparation",description:"Approve cycles and ckNFT transfers"},{id:"execution",title:"ðŸš€ Cast Execution",description:"Execute cross-chain casting"}];function vg(e,t){const n=e.stages.map(r=>r.id===t?{...r,isCollapsed:!r.isCollapsed}:r);return{...e,stages:n}}function jg(e){return e.stages.find(t=>t.status!=="completed")||null}function Cg(e){switch(e.status){case"failed":return"red";case"loading":return"yellow";case"completed":return"green";default:return"gray"}}function I0(e,t){return(t==="evm-to-ic"?Ng:wg).map(r=>{const a=e.filter(c=>c.stage===r.id),o=a.reduce((c,l)=>c+(l.estimatedDuration||0),0);let i="pending";if(a.length>0){const c=a.filter(d=>d.status==="completed").length,l=a.filter(d=>d.status==="failed").length,u=a.filter(d=>d.status==="loading").length;l>0?i="failed":c===a.length?i="completed":(u>0||c>0)&&(i="loading")}return{id:r.id,title:r.title,description:r.description,status:i,steps:a,estimatedDuration:o,isCollapsed:i==="completed"}})}function aa(e,t,n){const a=(t||(e==="evm-to-ic"?bg:yg)).map(i=>({...i,status:"pending"})),o=I0(a,e);return{id:`bridge-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,direction:e,steps:a,stages:o,currentStep:0,isComplete:!1,totalSteps:a.length,startTime:Date.now(),metadata:n}}function mt(e,t,n){const r=e.steps.findIndex(m=>m.id===t);if(r===-1)throw new Error(`Step with id "${t}" not found`);const a=[...e.steps],o=a[r],i=Date.now();let c={...n};n.status==="loading"&&o.status==="pending"?c={...c,startTime:i}:(n.status==="completed"||n.status==="failed")&&o.startTime&&(c={...c,endTime:i}),a[r]={...o,...c,metadata:{...o.metadata,...n.metadata}};let l=e.currentStep,u=e.isComplete;n.status==="completed"?(l=Math.min(r+1,e.totalSteps-1),u=a.every(m=>m.status==="completed"||m.status==="skipped")):n.status==="loading"&&(l=r);const d={...e,steps:a,currentStep:l,isComplete:u};return d.stages=I0(a,e.direction),u&&!e.endTime&&(d.endTime=i,d.totalDuration=i-e.startTime),d}function vc(e,t){const n=e.steps.findIndex(o=>o.id===t);if(n===-1)throw new Error(`Step with id "${t}" not found`);const r=e.steps[n];if(!(r!=null&&r.retryable))throw new Error(`Step "${t}" is not retryable`);const a=[...e.steps];return a[n]={...r,status:"pending",error:void 0,startTime:void 0,endTime:void 0},{...e,steps:a,currentStep:n}}const dd="-",kg=e=>{const t=Tg(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:i=>{const c=i.split(dd);return c[0]===""&&c.length!==1&&c.shift(),U0(c,t)||Ag(i)},getConflictingClassGroupIds:(i,c)=>{const l=n[i]||[];return c&&r[i]?[...l,...r[i]]:l}}},U0=(e,t)=>{var i;if(e.length===0)return t.classGroupId;const n=e[0],r=t.nextPart.get(n),a=r?U0(e.slice(1),r):void 0;if(a)return a;if(t.validators.length===0)return;const o=e.join(dd);return(i=t.validators.find(({validator:c})=>c(o)))==null?void 0:i.classGroupId},Zd=/^\[(.+)\]$/,Ag=e=>{if(Zd.test(e)){const t=Zd.exec(e)[1],n=t==null?void 0:t.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},Tg=e=>{const{theme:t,classGroups:n}=e,r={nextPart:new Map,validators:[]};for(const a in n)ml(n[a],r,a,t);return r},ml=(e,t,n,r)=>{e.forEach(a=>{if(typeof a=="string"){const o=a===""?t:Xd(t,a);o.classGroupId=n;return}if(typeof a=="function"){if(Eg(a)){ml(a(r),t,n,r);return}t.validators.push({validator:a,classGroupId:n});return}Object.entries(a).forEach(([o,i])=>{ml(i,Xd(t,o),n,r)})})},Xd=(e,t)=>{let n=e;return t.split(dd).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},Eg=e=>e.isThemeGetter,Sg=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,r=new Map;const a=(o,i)=>{n.set(o,i),t++,t>e&&(t=0,r=n,n=new Map)};return{get(o){let i=n.get(o);if(i!==void 0)return i;if((i=r.get(o))!==void 0)return a(o,i),i},set(o,i){n.has(o)?n.set(o,i):a(o,i)}}},hl="!",fl=":",Fg=fl.length,Rg=e=>{const{prefix:t,experimentalParseClassName:n}=e;let r=a=>{const o=[];let i=0,c=0,l=0,u;for(let N=0;N<a.length;N++){let h=a[N];if(i===0&&c===0){if(h===fl){o.push(a.slice(l,N)),l=N+Fg;continue}if(h==="/"){u=N;continue}}h==="["?i++:h==="]"?i--:h==="("?c++:h===")"&&c--}const d=o.length===0?a:a.substring(l),m=Bg(d),f=m!==d,g=u&&u>l?u-l:void 0;return{modifiers:o,hasImportantModifier:f,baseClassName:m,maybePostfixModifierPosition:g}};if(t){const a=t+fl,o=r;r=i=>i.startsWith(a)?o(i.substring(a.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:i,maybePostfixModifierPosition:void 0}}if(n){const a=r;r=o=>n({className:o,parseClassName:a})}return r},Bg=e=>e.endsWith(hl)?e.substring(0,e.length-1):e.startsWith(hl)?e.substring(1):e,Pg=e=>{const t=Object.fromEntries(e.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const a=[];let o=[];return r.forEach(i=>{i[0]==="["||t[i]?(a.push(...o.sort(),i),o=[]):o.push(i)}),a.push(...o.sort()),a}},Mg=e=>({cache:Sg(e.cacheSize),parseClassName:Rg(e),sortModifiers:Pg(e),...kg(e)}),Og=/\s+/,_g=(e,t)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:a,sortModifiers:o}=t,i=[],c=e.trim().split(Og);let l="";for(let u=c.length-1;u>=0;u-=1){const d=c[u],{isExternal:m,modifiers:f,hasImportantModifier:g,baseClassName:N,maybePostfixModifierPosition:h}=n(d);if(m){l=d+(l.length>0?" "+l:l);continue}let C=!!h,w=r(C?N.substring(0,h):N);if(!w){if(!C){l=d+(l.length>0?" "+l:l);continue}if(w=r(N),!w){l=d+(l.length>0?" "+l:l);continue}C=!1}const B=o(f).join(":"),j=g?B+hl:B,Q=j+w;if(i.includes(Q))continue;i.push(Q);const F=a(w,C);for(let _=0;_<F.length;++_){const M=F[_];i.push(j+M)}l=d+(l.length>0?" "+l:l)}return l};function Ig(){let e=0,t,n,r="";for(;e<arguments.length;)(t=arguments[e++])&&(n=$0(t))&&(r&&(r+=" "),r+=n);return r}const $0=e=>{if(typeof e=="string")return e;let t,n="";for(let r=0;r<e.length;r++)e[r]&&(t=$0(e[r]))&&(n&&(n+=" "),n+=t);return n};function Ug(e,...t){let n,r,a,o=i;function i(l){const u=t.reduce((d,m)=>m(d),e());return n=Mg(u),r=n.cache.get,a=n.cache.set,o=c,c(l)}function c(l){const u=r(l);if(u)return u;const d=_g(l,n);return a(l,d),d}return function(){return o(Ig.apply(null,arguments))}}const Et=e=>{const t=n=>n[e]||[];return t.isThemeGetter=!0,t},V0=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,G0=/^\((?:(\w[\w-]*):)?(.+)\)$/i,$g=/^\d+\/\d+$/,Vg=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Gg=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Hg=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,zg=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,qg=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,la=e=>$g.test(e),Ye=e=>!!e&&!Number.isNaN(Number(e)),Bn=e=>!!e&&Number.isInteger(Number(e)),Wc=e=>e.endsWith("%")&&Ye(e.slice(0,-1)),cn=e=>Vg.test(e),Qg=()=>!0,Wg=e=>Gg.test(e)&&!Hg.test(e),H0=()=>!1,Jg=e=>zg.test(e),Kg=e=>qg.test(e),Yg=e=>!Me(e)&&!Oe(e),Zg=e=>Fo(e,Q0,H0),Me=e=>V0.test(e),lr=e=>Fo(e,W0,Wg),Jc=e=>Fo(e,tx,Ye),Ld=e=>Fo(e,z0,H0),Xg=e=>Fo(e,q0,Kg),Ai=e=>Fo(e,J0,Jg),Oe=e=>G0.test(e),_o=e=>Ro(e,W0),Lg=e=>Ro(e,sx),Dd=e=>Ro(e,z0),Dg=e=>Ro(e,Q0),ex=e=>Ro(e,q0),Ti=e=>Ro(e,J0,!0),Fo=(e,t,n)=>{const r=V0.exec(e);return r?r[1]?t(r[1]):n(r[2]):!1},Ro=(e,t,n=!1)=>{const r=G0.exec(e);return r?r[1]?t(r[1]):n:!1},z0=e=>e==="position"||e==="percentage",q0=e=>e==="image"||e==="url",Q0=e=>e==="length"||e==="size"||e==="bg-size",W0=e=>e==="length",tx=e=>e==="number",sx=e=>e==="family-name",J0=e=>e==="shadow",nx=()=>{const e=Et("color"),t=Et("font"),n=Et("text"),r=Et("font-weight"),a=Et("tracking"),o=Et("leading"),i=Et("breakpoint"),c=Et("container"),l=Et("spacing"),u=Et("radius"),d=Et("shadow"),m=Et("inset-shadow"),f=Et("text-shadow"),g=Et("drop-shadow"),N=Et("blur"),h=Et("perspective"),C=Et("aspect"),w=Et("ease"),B=Et("animate"),j=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Q=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],F=()=>[...Q(),Oe,Me],_=()=>["auto","hidden","clip","visible","scroll"],M=()=>["auto","contain","none"],k=()=>[Oe,Me,l],K=()=>[la,"full","auto",...k()],V=()=>[Bn,"none","subgrid",Oe,Me],T=()=>["auto",{span:["full",Bn,Oe,Me]},Bn,Oe,Me],ee=()=>[Bn,"auto",Oe,Me],J=()=>["auto","min","max","fr",Oe,Me],pe=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],E=()=>["start","end","center","stretch","center-safe","end-safe"],b=()=>["auto",...k()],Y=()=>[la,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...k()],p=()=>[e,Oe,Me],O=()=>[...Q(),Dd,Ld,{position:[Oe,Me]}],R=()=>["no-repeat",{repeat:["","x","y","space","round"]}],q=()=>["auto","cover","contain",Dg,Zg,{size:[Oe,Me]}],v=()=>[Wc,_o,lr],U=()=>["","none","full",u,Oe,Me],S=()=>["",Ye,_o,lr],H=()=>["solid","dashed","dotted","double"],he=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],$=()=>[Ye,Wc,Dd,Ld],W=()=>["","none",N,Oe,Me],le=()=>["none",Ye,Oe,Me],ce=()=>["none",Ye,Oe,Me],L=()=>[Ye,Oe,Me],ue=()=>[la,"full",...k()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[cn],breakpoint:[cn],color:[Qg],container:[cn],"drop-shadow":[cn],ease:["in","out","in-out"],font:[Yg],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[cn],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[cn],shadow:[cn],spacing:["px",Ye],text:[cn],"text-shadow":[cn],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",la,Me,Oe,C]}],container:["container"],columns:[{columns:[Ye,Me,Oe,c]}],"break-after":[{"break-after":j()}],"break-before":[{"break-before":j()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:F()}],overflow:[{overflow:_()}],"overflow-x":[{"overflow-x":_()}],"overflow-y":[{"overflow-y":_()}],overscroll:[{overscroll:M()}],"overscroll-x":[{"overscroll-x":M()}],"overscroll-y":[{"overscroll-y":M()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:K()}],"inset-x":[{"inset-x":K()}],"inset-y":[{"inset-y":K()}],start:[{start:K()}],end:[{end:K()}],top:[{top:K()}],right:[{right:K()}],bottom:[{bottom:K()}],left:[{left:K()}],visibility:["visible","invisible","collapse"],z:[{z:[Bn,"auto",Oe,Me]}],basis:[{basis:[la,"full","auto",c,...k()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Ye,la,"auto","initial","none",Me]}],grow:[{grow:["",Ye,Oe,Me]}],shrink:[{shrink:["",Ye,Oe,Me]}],order:[{order:[Bn,"first","last","none",Oe,Me]}],"grid-cols":[{"grid-cols":V()}],"col-start-end":[{col:T()}],"col-start":[{"col-start":ee()}],"col-end":[{"col-end":ee()}],"grid-rows":[{"grid-rows":V()}],"row-start-end":[{row:T()}],"row-start":[{"row-start":ee()}],"row-end":[{"row-end":ee()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":J()}],"auto-rows":[{"auto-rows":J()}],gap:[{gap:k()}],"gap-x":[{"gap-x":k()}],"gap-y":[{"gap-y":k()}],"justify-content":[{justify:[...pe(),"normal"]}],"justify-items":[{"justify-items":[...E(),"normal"]}],"justify-self":[{"justify-self":["auto",...E()]}],"align-content":[{content:["normal",...pe()]}],"align-items":[{items:[...E(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...E(),{baseline:["","last"]}]}],"place-content":[{"place-content":pe()}],"place-items":[{"place-items":[...E(),"baseline"]}],"place-self":[{"place-self":["auto",...E()]}],p:[{p:k()}],px:[{px:k()}],py:[{py:k()}],ps:[{ps:k()}],pe:[{pe:k()}],pt:[{pt:k()}],pr:[{pr:k()}],pb:[{pb:k()}],pl:[{pl:k()}],m:[{m:b()}],mx:[{mx:b()}],my:[{my:b()}],ms:[{ms:b()}],me:[{me:b()}],mt:[{mt:b()}],mr:[{mr:b()}],mb:[{mb:b()}],ml:[{ml:b()}],"space-x":[{"space-x":k()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":k()}],"space-y-reverse":["space-y-reverse"],size:[{size:Y()}],w:[{w:[c,"screen",...Y()]}],"min-w":[{"min-w":[c,"screen","none",...Y()]}],"max-w":[{"max-w":[c,"screen","none","prose",{screen:[i]},...Y()]}],h:[{h:["screen","lh",...Y()]}],"min-h":[{"min-h":["screen","lh","none",...Y()]}],"max-h":[{"max-h":["screen","lh",...Y()]}],"font-size":[{text:["base",n,_o,lr]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,Oe,Jc]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Wc,Me]}],"font-family":[{font:[Lg,Me,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[a,Oe,Me]}],"line-clamp":[{"line-clamp":[Ye,"none",Oe,Jc]}],leading:[{leading:[o,...k()]}],"list-image":[{"list-image":["none",Oe,Me]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Oe,Me]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:p()}],"text-color":[{text:p()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...H(),"wavy"]}],"text-decoration-thickness":[{decoration:[Ye,"from-font","auto",Oe,lr]}],"text-decoration-color":[{decoration:p()}],"underline-offset":[{"underline-offset":[Ye,"auto",Oe,Me]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:k()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Oe,Me]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Oe,Me]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:O()}],"bg-repeat":[{bg:R()}],"bg-size":[{bg:q()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Bn,Oe,Me],radial:["",Oe,Me],conic:[Bn,Oe,Me]},ex,Xg]}],"bg-color":[{bg:p()}],"gradient-from-pos":[{from:v()}],"gradient-via-pos":[{via:v()}],"gradient-to-pos":[{to:v()}],"gradient-from":[{from:p()}],"gradient-via":[{via:p()}],"gradient-to":[{to:p()}],rounded:[{rounded:U()}],"rounded-s":[{"rounded-s":U()}],"rounded-e":[{"rounded-e":U()}],"rounded-t":[{"rounded-t":U()}],"rounded-r":[{"rounded-r":U()}],"rounded-b":[{"rounded-b":U()}],"rounded-l":[{"rounded-l":U()}],"rounded-ss":[{"rounded-ss":U()}],"rounded-se":[{"rounded-se":U()}],"rounded-ee":[{"rounded-ee":U()}],"rounded-es":[{"rounded-es":U()}],"rounded-tl":[{"rounded-tl":U()}],"rounded-tr":[{"rounded-tr":U()}],"rounded-br":[{"rounded-br":U()}],"rounded-bl":[{"rounded-bl":U()}],"border-w":[{border:S()}],"border-w-x":[{"border-x":S()}],"border-w-y":[{"border-y":S()}],"border-w-s":[{"border-s":S()}],"border-w-e":[{"border-e":S()}],"border-w-t":[{"border-t":S()}],"border-w-r":[{"border-r":S()}],"border-w-b":[{"border-b":S()}],"border-w-l":[{"border-l":S()}],"divide-x":[{"divide-x":S()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":S()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...H(),"hidden","none"]}],"divide-style":[{divide:[...H(),"hidden","none"]}],"border-color":[{border:p()}],"border-color-x":[{"border-x":p()}],"border-color-y":[{"border-y":p()}],"border-color-s":[{"border-s":p()}],"border-color-e":[{"border-e":p()}],"border-color-t":[{"border-t":p()}],"border-color-r":[{"border-r":p()}],"border-color-b":[{"border-b":p()}],"border-color-l":[{"border-l":p()}],"divide-color":[{divide:p()}],"outline-style":[{outline:[...H(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Ye,Oe,Me]}],"outline-w":[{outline:["",Ye,_o,lr]}],"outline-color":[{outline:p()}],shadow:[{shadow:["","none",d,Ti,Ai]}],"shadow-color":[{shadow:p()}],"inset-shadow":[{"inset-shadow":["none",m,Ti,Ai]}],"inset-shadow-color":[{"inset-shadow":p()}],"ring-w":[{ring:S()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:p()}],"ring-offset-w":[{"ring-offset":[Ye,lr]}],"ring-offset-color":[{"ring-offset":p()}],"inset-ring-w":[{"inset-ring":S()}],"inset-ring-color":[{"inset-ring":p()}],"text-shadow":[{"text-shadow":["none",f,Ti,Ai]}],"text-shadow-color":[{"text-shadow":p()}],opacity:[{opacity:[Ye,Oe,Me]}],"mix-blend":[{"mix-blend":[...he(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":he()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Ye]}],"mask-image-linear-from-pos":[{"mask-linear-from":$()}],"mask-image-linear-to-pos":[{"mask-linear-to":$()}],"mask-image-linear-from-color":[{"mask-linear-from":p()}],"mask-image-linear-to-color":[{"mask-linear-to":p()}],"mask-image-t-from-pos":[{"mask-t-from":$()}],"mask-image-t-to-pos":[{"mask-t-to":$()}],"mask-image-t-from-color":[{"mask-t-from":p()}],"mask-image-t-to-color":[{"mask-t-to":p()}],"mask-image-r-from-pos":[{"mask-r-from":$()}],"mask-image-r-to-pos":[{"mask-r-to":$()}],"mask-image-r-from-color":[{"mask-r-from":p()}],"mask-image-r-to-color":[{"mask-r-to":p()}],"mask-image-b-from-pos":[{"mask-b-from":$()}],"mask-image-b-to-pos":[{"mask-b-to":$()}],"mask-image-b-from-color":[{"mask-b-from":p()}],"mask-image-b-to-color":[{"mask-b-to":p()}],"mask-image-l-from-pos":[{"mask-l-from":$()}],"mask-image-l-to-pos":[{"mask-l-to":$()}],"mask-image-l-from-color":[{"mask-l-from":p()}],"mask-image-l-to-color":[{"mask-l-to":p()}],"mask-image-x-from-pos":[{"mask-x-from":$()}],"mask-image-x-to-pos":[{"mask-x-to":$()}],"mask-image-x-from-color":[{"mask-x-from":p()}],"mask-image-x-to-color":[{"mask-x-to":p()}],"mask-image-y-from-pos":[{"mask-y-from":$()}],"mask-image-y-to-pos":[{"mask-y-to":$()}],"mask-image-y-from-color":[{"mask-y-from":p()}],"mask-image-y-to-color":[{"mask-y-to":p()}],"mask-image-radial":[{"mask-radial":[Oe,Me]}],"mask-image-radial-from-pos":[{"mask-radial-from":$()}],"mask-image-radial-to-pos":[{"mask-radial-to":$()}],"mask-image-radial-from-color":[{"mask-radial-from":p()}],"mask-image-radial-to-color":[{"mask-radial-to":p()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":Q()}],"mask-image-conic-pos":[{"mask-conic":[Ye]}],"mask-image-conic-from-pos":[{"mask-conic-from":$()}],"mask-image-conic-to-pos":[{"mask-conic-to":$()}],"mask-image-conic-from-color":[{"mask-conic-from":p()}],"mask-image-conic-to-color":[{"mask-conic-to":p()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:O()}],"mask-repeat":[{mask:R()}],"mask-size":[{mask:q()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Oe,Me]}],filter:[{filter:["","none",Oe,Me]}],blur:[{blur:W()}],brightness:[{brightness:[Ye,Oe,Me]}],contrast:[{contrast:[Ye,Oe,Me]}],"drop-shadow":[{"drop-shadow":["","none",g,Ti,Ai]}],"drop-shadow-color":[{"drop-shadow":p()}],grayscale:[{grayscale:["",Ye,Oe,Me]}],"hue-rotate":[{"hue-rotate":[Ye,Oe,Me]}],invert:[{invert:["",Ye,Oe,Me]}],saturate:[{saturate:[Ye,Oe,Me]}],sepia:[{sepia:["",Ye,Oe,Me]}],"backdrop-filter":[{"backdrop-filter":["","none",Oe,Me]}],"backdrop-blur":[{"backdrop-blur":W()}],"backdrop-brightness":[{"backdrop-brightness":[Ye,Oe,Me]}],"backdrop-contrast":[{"backdrop-contrast":[Ye,Oe,Me]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Ye,Oe,Me]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Ye,Oe,Me]}],"backdrop-invert":[{"backdrop-invert":["",Ye,Oe,Me]}],"backdrop-opacity":[{"backdrop-opacity":[Ye,Oe,Me]}],"backdrop-saturate":[{"backdrop-saturate":[Ye,Oe,Me]}],"backdrop-sepia":[{"backdrop-sepia":["",Ye,Oe,Me]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":k()}],"border-spacing-x":[{"border-spacing-x":k()}],"border-spacing-y":[{"border-spacing-y":k()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Oe,Me]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Ye,"initial",Oe,Me]}],ease:[{ease:["linear","initial",w,Oe,Me]}],delay:[{delay:[Ye,Oe,Me]}],animate:[{animate:["none",B,Oe,Me]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[h,Oe,Me]}],"perspective-origin":[{"perspective-origin":F()}],rotate:[{rotate:le()}],"rotate-x":[{"rotate-x":le()}],"rotate-y":[{"rotate-y":le()}],"rotate-z":[{"rotate-z":le()}],scale:[{scale:ce()}],"scale-x":[{"scale-x":ce()}],"scale-y":[{"scale-y":ce()}],"scale-z":[{"scale-z":ce()}],"scale-3d":["scale-3d"],skew:[{skew:L()}],"skew-x":[{"skew-x":L()}],"skew-y":[{"skew-y":L()}],transform:[{transform:[Oe,Me,"","none","gpu","cpu"]}],"transform-origin":[{origin:F()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ue()}],"translate-x":[{"translate-x":ue()}],"translate-y":[{"translate-y":ue()}],"translate-z":[{"translate-z":ue()}],"translate-none":["translate-none"],accent:[{accent:p()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:p()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Oe,Me]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":k()}],"scroll-mx":[{"scroll-mx":k()}],"scroll-my":[{"scroll-my":k()}],"scroll-ms":[{"scroll-ms":k()}],"scroll-me":[{"scroll-me":k()}],"scroll-mt":[{"scroll-mt":k()}],"scroll-mr":[{"scroll-mr":k()}],"scroll-mb":[{"scroll-mb":k()}],"scroll-ml":[{"scroll-ml":k()}],"scroll-p":[{"scroll-p":k()}],"scroll-px":[{"scroll-px":k()}],"scroll-py":[{"scroll-py":k()}],"scroll-ps":[{"scroll-ps":k()}],"scroll-pe":[{"scroll-pe":k()}],"scroll-pt":[{"scroll-pt":k()}],"scroll-pr":[{"scroll-pr":k()}],"scroll-pb":[{"scroll-pb":k()}],"scroll-pl":[{"scroll-pl":k()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Oe,Me]}],fill:[{fill:["none",...p()]}],"stroke-w":[{stroke:[Ye,_o,lr,Jc]}],stroke:[{stroke:["none",...p()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},rx=Ug(nx);function bo(...e){return rx(be(e))}const ax=({status:e,size:t="md",isAnimated:n=!1})=>{const a=bo("rounded-full border-2 border-gray-300",{sm:"w-3 h-3",md:"w-4 h-4",lg:"w-6 h-6"}[t],n&&e==="yellow"&&"animate-pulse"),o={red:"bg-red-500 border-red-400 shadow-red-500/50",yellow:"bg-yellow-500 border-yellow-400 shadow-yellow-500/50",green:"bg-green-500 border-green-400 shadow-green-500/50",gray:"bg-gray-300 border-gray-400"};return s.jsx("div",{className:bo(a,o[e],e!=="gray"&&"shadow-lg")})},ox=({stage:e,progress:t,onRetryStep:n,onToggle:r})=>{var d;const a=Cg(e),o=((d=jg(t))==null?void 0:d.id)===e.id,i=e.steps.filter(m=>m.status==="completed").length,c=e.steps.length,l=e.steps.some(m=>m.status==="failed"),u=e.steps.find(m=>m.status==="loading");return s.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[s.jsxs("button",{onClick:()=>r(e.id),className:bo("w-full flex items-center justify-between p-4 text-left transition-colors","hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",o&&"bg-blue-50 border-blue-200"),children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(ax,{status:a,size:"lg",isAnimated:e.status==="loading"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:e.title}),s.jsx("p",{className:"text-sm text-gray-600",children:e.description}),s.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[s.jsxs("span",{className:"text-xs text-gray-500",children:[i,"/",c," steps"]}),e.status==="loading"&&u&&s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:u.title}),l&&s.jsx("span",{className:"text-xs text-red-600 font-medium",children:"Needs attention"})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[e.status==="loading"&&s.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:s.jsx(Qe,{className:"w-4 h-4 text-blue-500 animate-spin"})}),e.isCollapsed?s.jsx(Is,{className:"w-5 h-5 text-gray-400"}):s.jsx(Jp,{className:"w-5 h-5 text-gray-400"})]})]}),!e.isCollapsed&&s.jsx("div",{className:"border-t border-gray-200 bg-gray-50",children:s.jsx("div",{className:"p-4 space-y-3",children:e.steps.map(m=>s.jsxs("div",{className:bo("flex items-center justify-between p-3 bg-white rounded border",m.status==="loading"&&"border-blue-200 bg-blue-50",m.status==="failed"&&"border-red-200 bg-red-50",m.status==="completed"&&"border-green-200 bg-green-50"),children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"flex-shrink-0",children:[m.status==="completed"&&s.jsx(gt,{className:"w-5 h-5 text-green-600"}),m.status==="failed"&&s.jsx(eg,{className:"w-5 h-5 text-red-600"}),m.status==="loading"&&s.jsx(Qe,{className:"w-5 h-5 text-blue-600 animate-spin"}),m.status==="pending"&&s.jsx(sa,{className:"w-5 h-5 text-gray-400"}),m.status==="skipped"&&s.jsx(_s,{className:"w-5 h-5 text-yellow-600"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.title}),s.jsx("p",{className:"text-xs text-gray-600",children:m.description}),m.error&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:m.error}),m.txHash&&s.jsxs("p",{className:"text-xs text-gray-500 mt-1 font-mono",children:["Tx: ",m.txHash.slice(0,10),"...",m.txHash.slice(-8)]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[m.status==="failed"&&m.retryable&&n&&s.jsxs("button",{onClick:f=>{f.stopPropagation(),n(m.id)},className:"flex items-center space-x-1 px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-100 rounded transition-colors",children:[s.jsx(mg,{className:"w-3 h-3"}),s.jsx("span",{children:"Retry"})]}),m.estimatedDuration&&m.status==="pending"&&s.jsxs("span",{className:"text-xs text-gray-500",children:["~",m.estimatedDuration,"s"]})]})]},m.id))})})]})},jc=({progress:e,onRetryStep:t,onToggleStage:n,className:r})=>{const[a,o]=x.useState(e);wf.useEffect(()=>{o(e)},[e]);const i=m=>{n?n(m):o(f=>vg(f,m))},c=a.steps.length,l=a.steps.filter(m=>m.status==="completed").length,u=a.steps.filter(m=>m.status==="failed").length,d=Math.round(l/c*100);return s.jsxs("div",{className:bo("space-y-4",r),children:[s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:a.direction==="evm-to-ic"?"ðŸ”„ EVM â†’ IC Bridge":"ðŸ”„ IC â†’ EVM Cast"}),s.jsxs("div",{className:"text-sm text-gray-600",children:[l,"/",c," steps"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:s.jsx("div",{className:bo("h-2 rounded-full transition-all duration-300",u>0?"bg-red-500":"bg-blue-500"),style:{width:`${d}%`}})}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("span",{className:"text-gray-600",children:[d,"% complete"]}),u>0&&s.jsxs("span",{className:"text-red-600 font-medium",children:[u," failed step",u!==1?"s":""]})]})]}),s.jsx("div",{className:"space-y-2",children:a.stages.map(m=>s.jsx(ox,{stage:m,progress:a,onRetryStep:t,onToggle:i},m.id))})]})},vs=({IDL:e})=>{const t=e.Rec(),n=e.Variant({ok:e.Null,err:e.Text}),r=e.Variant({Alchemy:e.Null,BlockPi:e.Null,PublicNode:e.Null,Ankr:e.Null,Sepolia:e.Null}),a=e.Variant({Alchemy:e.Null,Llama:e.Null,BlockPi:e.Null,PublicNode:e.Null,Ankr:e.Null}),o=e.Nat64,i=e.Record({value:e.Text,name:e.Text}),c=e.Record({url:e.Text,headers:e.Opt(e.Vec(i))}),l=e.Variant({Alchemy:e.Null,Llama:e.Null,BlockPi:e.Null,Cloudflare:e.Null,PublicNode:e.Null,Ankr:e.Null}),u=e.Variant({EthSepolia:e.Opt(e.Vec(r)),BaseMainnet:e.Opt(e.Vec(a)),Custom:e.Record({chainId:o,services:e.Vec(c)}),OptimismMainnet:e.Opt(e.Vec(a)),ArbitrumOne:e.Opt(e.Vec(a)),EthMainnet:e.Opt(e.Vec(l))}),d=e.Record({owner:e.Principal,subaccount:e.Opt(e.Vec(e.Nat8))}),m=e.Variant({Mainnet:e.Null,Custom:e.Text,Testnet:e.Null,Devnet:e.Null}),f=e.Record({value:t,name:e.Text,immutable:e.Bool});t.fill(e.Variant({Int:e.Int,Map:e.Vec(e.Tuple(e.Text,t)),Nat:e.Nat,Set:e.Vec(t),Nat16:e.Nat16,Nat32:e.Nat32,Nat64:e.Nat64,Blob:e.Vec(e.Nat8),Bool:e.Bool,Int8:e.Int8,Ints:e.Vec(e.Int),Nat8:e.Nat8,Nats:e.Vec(e.Nat),Text:e.Text,Bytes:e.Vec(e.Nat8),Int16:e.Int16,Int32:e.Int32,Int64:e.Int64,Option:e.Opt(t),Floats:e.Vec(e.Float64),Float:e.Float64,Principal:e.Principal,Array:e.Vec(t),ValueMap:e.Vec(e.Tuple(t,t)),Class:e.Vec(f)}));const g=e.Vec(e.Tuple(e.Text,t)),N=e.Variant({IC:e.Opt(e.Text),Ethereum:e.Opt(e.Nat),Solana:e.Opt(m),Bitcoin:e.Opt(e.Text),Other:g}),h=e.Record({contract:e.Text,network:N}),C=e.Record({uri:e.Text,originalMinterAccount:e.Opt(d),tokenId:e.Nat,gasPrice:e.Opt(e.Nat),memo:e.Opt(e.Vec(e.Nat8)),remoteContract:h,nativeContract:h,maxPriorityFeePerGas:e.Opt(e.Nat),castId:e.Nat,created_at_time:e.Opt(e.Nat),gasLimit:e.Opt(e.Nat),targetOwner:e.Text,originalCaller:d}),w=e.Variant({GenericError:e.Text,NoCkNFTCanister:e.Null,NetworkError:e.Text,ExistingCast:e.Nat,InsufficientAllowance:e.Tuple(e.Nat,e.Nat),InvalidTransaction:e.Text,InsufficientBalance:e.Tuple(e.Nat,e.Nat),NotFound:e.Null,InsufficientCycles:e.Tuple(e.Nat,e.Nat),TransferNotVerified:e.Variant({TooManyRetries:e.Nat,NoConsensus:e.Null}),MintNotVerified:e.Variant({TooManyRetries:e.Nat,NoConsensus:e.Null}),Unauthorized:e.Null,ContractNotVerified:e.Variant({TooManyRetries:e.Nat,NoConsensus:e.Null}),InvalidContract:e.Null}),B=e.Variant({Ok:e.Nat,Err:w}),j=e.Variant({Generic:c}),Q=e.Nat64,F=e.Variant({EthSepolia:r,BaseMainnet:a,Custom:c,OptimismMainnet:a,ArbitrumOne:a,EthMainnet:l,Provider:Q}),_=e.Variant({Custom:e.Record({url:e.Text,headers:e.Opt(e.Vec(e.Tuple(e.Text,e.Text)))}),Provider:e.Nat}),M=e.Variant({Generic:c}),k=e.Variant({IC:e.Record({rpc:j,canisterId:e.Principal}),Ethereum:e.Record({rpc:F,canisterId:e.Principal}),Solana:e.Record({rpc:_,canisterId:e.Principal}),Bitcoin:e.Record({rpc:M,canisterId:e.Principal}),Other:e.Vec(e.Tuple(e.Text,t))}),K=e.Variant({SetEthTecdsaKeyName:e.Text,SetSolanaSchnorrKeyName:e.Text,MapNetwork:e.Record({service:k,action:e.Variant({Add:e.Null,Remove:e.Null}),network:N})}),V=e.Variant({GenericError:e.Text,Unauthorized:e.Null,MapNetwork:e.Variant({NotFound:e.Null,Exists:e.Null})}),T=e.Variant({Ok:e.Nat,Err:V}),ee=e.Record({logo:e.Opt(e.Text),name:e.Opt(e.Text),description:e.Opt(e.Text),symbol:e.Opt(e.Text)}),J=e.Record({code:e.Int64,message:e.Text}),pe=e.Variant({TooFewCycles:e.Record({expected:e.Nat,received:e.Nat}),InvalidRpcConfig:e.Text,MissingRequiredProvider:e.Null,ProviderNotFound:e.Null,NoPermission:e.Null}),E=e.Variant({Custom:e.Text,InvalidHex:e.Text}),b=e.Variant({NoError:e.Null,CanisterError:e.Null,SysTransient:e.Null,DestinationInvalid:e.Null,Unknown:e.Null,SysFatal:e.Null,CanisterReject:e.Null}),Y=e.Variant({IcError:e.Record({code:b,message:e.Text}),InvalidHttpJsonRpcResponse:e.Record({status:e.Nat16,body:e.Text,parsingError:e.Opt(e.Text)})}),p=e.Variant({JsonRpcError:J,ProviderError:pe,ValidationError:E,HttpOutcallError:Y}),O=e.Variant({Ok:e.Opt(e.Text),NonceTooLow:e.Null,NonceTooHigh:e.Null,InsufficientFunds:e.Null}),R=e.Variant({Ok:O,Err:p}),q=e.Variant({Consistent:R,Inconsistent:e.Vec(e.Tuple(F,R))}),v=e.Variant({RPC:e.Variant({Ethereum:p,Solana:e.Variant({NetworkError:e.Text,MetadataNotFound:e.Text,ParseError:e.Text,InvalidMint:e.Text,TokenAccountNotFound:e.Text}),EthereumMultiSend:q}),GenericError:e.Text,NoCkNFTCanister:e.Null,InsufficientAllowance:e.Tuple(e.Nat,e.Nat),InsufficientBalance:e.Tuple(e.Nat,e.Nat),InsufficientCycles:e.Tuple(e.Nat,e.Nat),Unauthorized:e.Null,NetworkRCPNotFound:e.Null,NotImplemented:e.Null}),U=e.Variant({Ok:e.Principal,Err:v}),S=e.Variant({RPC:e.Variant({Ethereum:p,Solana:e.Variant({NetworkError:e.Text,MetadataNotFound:e.Text,ParseError:e.Text,InvalidMint:e.Text,TokenAccountNotFound:e.Text}),EthereumMultiSend:q}),GenericError:e.Text,NoCkNFTCanister:e.Null,InsufficientAllowance:e.Tuple(e.Nat,e.Nat),InsufficientBalance:e.Tuple(e.Nat,e.Nat),InsufficientCycles:e.Tuple(e.Nat,e.Nat),Unauthorized:e.Null,NetworkRCPNotFound:e.Null,NotImplemented:e.Null}),H=e.Variant({Ok:e.Nat,Err:S}),he=e.Record({tokenId:e.Nat,contract:e.Text,network:N}),$=e.Variant({Error:w,WaitingOnContract:e.Record({transaction:e.Text}),RemoteFinalized:e.Text,SubmittedToOrchestrator:e.Record({localCastId:e.Nat,remoteCastId:e.Nat}),WaitingOnMint:e.Record({transaction:e.Text}),WaitingOnTransfer:e.Record({transaction:e.Text}),Created:e.Null,Completed:e.Nat,SubmittingToOrchestrator:e.Nat}),W=e.Variant({RPC:e.Variant({Ethereum:p,Solana:e.Variant({NetworkError:e.Text,MetadataNotFound:e.Text,ParseError:e.Text,InvalidMint:e.Text,TokenAccountNotFound:e.Text}),EthereumMultiSend:q}),GenericError:e.Text,NoCkNFTCanister:e.Null,InsufficientAllowance:e.Tuple(e.Nat,e.Nat),InsufficientBalance:e.Tuple(e.Nat,e.Nat),InsufficientCycles:e.Tuple(e.Nat,e.Nat),Unauthorized:e.Null,NetworkRCPNotFound:e.Null,NotImplemented:e.Null}),le=e.Variant({Ok:e.Text,Err:W}),ce=e.Variant({StartMetadataTransfer:e.Null,StartMint:e.Null,StartOwnershipVerification:e.Null}),L=e.Record({nft:he,resume:e.Opt(e.Tuple(e.Nat,ce)),mintToAccount:d,spender:e.Opt(d)}),ue=e.Variant({Err:e.Variant({GenericError:e.Text,MintError:e.Text,ApprovalError:e.Text,InvalidTransfer:e.Text,OwnershipNotVerified:e.Variant({RemoteError:W,InvalidOwner:e.Null,TooManyRetries:e.Nat}),MetadataError:e.Text,InvalidMetadata:e.Text}),Transferring:e.Null,Minting:e.Null,RetrievingMetadata:e.Record({nextQuery:e.Nat,retries:e.Nat}),Complete:e.Record({approvalTrx:e.Opt(e.Nat),mintTrx:e.Nat,approvalError:e.Opt(e.Text)}),CheckingOwner:e.Record({nextQuery:e.Nat,retries:e.Nat})}),re=e.Record({nextQuery:e.Opt(e.Nat),contractType:e.Variant({Remote:e.Null,Owned:h}),network:e.Opt(N),writingContractCanisterId:e.Opt(e.Text),ckNFTCanisterId:e.Opt(e.Nat),address:e.Opt(e.Text),confirmed:e.Bool,deploymentTrx:e.Opt(e.Text),contractId:e.Nat,retries:e.Opt(e.Nat)}),se=e.Record({remoteNFTPointer:he,account:d}),Ne=e.Nat,ge=e.Record({id:e.Nat,time:Ne}),ne=e.Record({aSync:e.Opt(e.Nat),actionType:e.Text,params:e.Vec(e.Nat8),retries:e.Nat}),ye=e.Tuple(ge,ne),G=e.Nat,P=e.Record({timers:e.Nat,maxExecutions:e.Nat,minAction:e.Opt(ye),cycles:e.Nat,nextActionId:e.Nat,nextTimer:e.Opt(G),expectedExecutionTime:e.Opt(Ne),lastExecutionTime:Ne}),z=e.Text,A=e.Record({principal:e.Principal,lastCycles:e.Nat,network:N,networkMap:e.Vec(e.Tuple(N,z)),lastCyclesTimestamp:e.Nat,ckNFTCanisterId:e.Nat,nativeContract:z}),Z=e.Record({tt:P,ckNFTCanisters:e.Vec(A),owner:e.Principal,networkMap:e.Vec(e.Tuple(N,e.Vec(k))),contracts:e.Vec(re)}),de=e.Nat,te=e.Variant({RPC:e.Variant({Ethereum:p,Solana:e.Variant({NetworkError:e.Text,MetadataNotFound:e.Text,ParseError:e.Text,InvalidMint:e.Text,TokenAccountNotFound:e.Text}),EthereumMultiSend:q}),InvalidAccount:e.Null,GenericError:e.Text,NoCkNFTCanister:e.Null,InvalidMintStatus:e.Null,InsufficientAllowance:e.Tuple(e.Nat,e.Nat),InvalidSpender:e.Null,InsufficientBalance:e.Tuple(e.Nat,e.Nat),InvalidMintRequest:e.Null,InsufficientCycles:e.Tuple(e.Nat,e.Nat),Unauthorized:e.Null,NetworkRCPNotFound:e.Null,NotImplemented:e.Null,InvalidMintRequestId:e.Null,InvalidRemoteNFTPointer:e.Null,InvalidResumeOption:e.Null}),fe=e.Variant({Ok:de,Err:te}),xe=e.Variant({ok:e.Text,err:W});return e.Service({add_approved_wasm_hash:e.Func([e.Vec(e.Nat8)],[n],[]),calc_eth_call_cycles:e.Func([u,e.Nat,e.Text],[e.Nat],["query"]),cast:e.Func([C],[B],[]),configure:e.Func([e.Vec(K)],[e.Vec(e.Opt(T))],[]),create_canister:e.Func([h,ee,e.Opt(d)],[U],[]),create_remote:e.Func([h,N,e.Nat,e.Nat,e.Nat,e.Opt(d)],[H],[]),forceCkNFTCaniser:e.Func([h,e.Principal],[],[]),forceNonceForApprovalHash:e.Func([e.Principal,he,d,e.Nat],[],[]),forceNonceForIcrc99Canister:e.Func([e.Principal,N,e.Nat],[],[]),get_approved_wasm_hashes:e.Func([],[e.Vec(e.Vec(e.Nat8))],[]),get_cast_status:e.Func([e.Vec(e.Nat)],[e.Vec(e.Opt($))],["query"]),get_ck_nft_canister:e.Func([e.Vec(h)],[e.Vec(e.Opt(e.Principal))],["query"]),get_collection_name:e.Func([e.Vec(he),e.Opt(d)],[e.Vec(e.Opt(le))],[]),get_collection_symbol:e.Func([e.Vec(he),e.Opt(d)],[e.Vec(e.Opt(le))],[]),get_creation_cost:e.Func([h],[e.Nat],[]),get_icrc99_address:e.Func([e.Principal,N],[e.Opt(e.Text)],[]),get_mint_cost:e.Func([e.Vec(L)],[e.Vec(e.Opt(e.Nat))],["query"]),get_mint_status:e.Func([e.Vec(e.Nat)],[e.Vec(e.Opt(ue))],["query"]),get_remote:e.Func([e.Vec(e.Tuple(e.Principal,N))],[e.Vec(e.Opt(re))],["query"]),get_remote_approval_address:e.Func([se,e.Opt(d)],[e.Opt(e.Text)],[]),get_remote_cost:e.Func([h,N],[e.Nat],["query"]),get_remote_meta:e.Func([e.Vec(he),e.Vec(e.Nat),e.Opt(d)],[e.Vec(e.Opt(le))],[]),get_remote_owner:e.Func([e.Vec(he),e.Opt(d)],[e.Vec(e.Opt(le))],[]),get_remote_status:e.Func([e.Vec(e.Nat)],[e.Vec(e.Opt(re))],["query"]),get_stats:e.Func([],[Z],["query"]),mint:e.Func([L,e.Opt(d)],[fe],[]),register_ic_native_canister:e.Func([e.Principal],[n],[]),remove_approved_wasm_hash:e.Func([e.Vec(e.Nat8)],[n],[]),send_balance:e.Func([e.Principal,e.Nat,e.Text,N,e.Nat,e.Nat,e.Nat],[xe],[]),system_upgrade:e.Func([],[],[]),test_schnorr:e.Func([],[e.Text],[]),upgrade_ckNFT_canister:e.Func([e.Principal],[],[])})},Ms=({IDL:e})=>{const t=e.Rec(),n=e.Rec(),r=e.Rec(),a=e.Rec(),o=e.Record({deployer:e.Principal,max_approvals:e.Opt(e.Nat),max_approvals_per_token_or_collection:e.Opt(e.Nat),settle_to_approvals:e.Opt(e.Nat),max_revoke_approvals:e.Opt(e.Nat),collection_approval_requires_token:e.Opt(e.Bool)});e.Opt(o);const i=e.Variant({Stable:e.Null,StableTyped:e.Null,Managed:e.Null}),c=e.Record({url:e.Text,block_type:e.Text});e.Record({maxRecordsToArchive:e.Nat,archiveIndexType:i,maxArchivePages:e.Nat,settleToRecords:e.Nat,archiveCycles:e.Nat,maxActiveRecords:e.Nat,maxRecordsInArchiveInstance:e.Nat,archiveControllers:e.Opt(e.Opt(e.Vec(e.Principal))),supportedBlocks:e.Vec(c)});const l=e.Vec(e.Nat8),u=e.Record({owner:e.Principal,subaccount:e.Opt(l)}),d=e.Vec(e.Record({url:e.Text,name:e.Text})),m=e.Record({deployer:e.Principal,allow_transfers:e.Opt(e.Bool),supply_cap:e.Opt(e.Nat),tx_window:e.Opt(e.Nat),burn_account:e.Opt(u),default_take_value:e.Opt(e.Nat),logo:e.Opt(e.Text),permitted_drift:e.Opt(e.Nat),name:e.Opt(e.Text),description:e.Opt(e.Text),max_take_value:e.Opt(e.Nat),max_update_batch_size:e.Opt(e.Nat),max_query_batch_size:e.Opt(e.Nat),max_memo_size:e.Opt(e.Nat),supported_standards:e.Opt(d),symbol:e.Opt(e.Text)});e.Opt(m);const f=e.Variant({Mainnet:e.Null,Custom:e.Text,Testnet:e.Null,Devnet:e.Null}),g=e.Record({value:t,name:e.Text,immutable:e.Bool});t.fill(e.Variant({Int:e.Int,Map:e.Vec(e.Tuple(e.Text,t)),Nat:e.Nat,Set:e.Vec(t),Nat16:e.Nat16,Nat32:e.Nat32,Nat64:e.Nat64,Blob:e.Vec(e.Nat8),Bool:e.Bool,Int8:e.Int8,Ints:e.Vec(e.Int),Nat8:e.Nat8,Nats:e.Vec(e.Nat),Text:e.Text,Bytes:e.Vec(e.Nat8),Int16:e.Int16,Int32:e.Int32,Int64:e.Int64,Option:e.Opt(t),Floats:e.Vec(e.Float64),Float:e.Float64,Principal:e.Principal,Array:e.Vec(t),ValueMap:e.Vec(e.Tuple(t,t)),Class:e.Vec(g)}));const N=e.Vec(e.Tuple(e.Text,t)),h=e.Variant({IC:e.Opt(e.Text),Ethereum:e.Opt(e.Nat),Solana:e.Opt(f),Bitcoin:e.Opt(e.Text),Other:N}),C=e.Record({contract:e.Text,network:h}),w=e.Record({service:e.Opt(e.Principal),nativeChain:C});e.Opt(w);const B=e.Record({owner:e.Principal,subaccount:e.Opt(e.Vec(e.Nat8))}),j=e.Variant({ok:e.Vec(e.Principal),err:e.Text}),Q=e.Record({altAddress:e.Opt(e.Text),contract:e.Text,network:h,atRestAccount:e.Opt(B),atRestDerivation:e.Opt(e.Vec(e.Nat8))}),F=e.Variant({remote:e.Record({contract:C,owner:e.Text,timestamp:e.Nat}),local:B}),_=e.Record({service:e.Opt(e.Principal),originalMinterMap:e.Vec(e.Tuple(e.Nat,B)),solanaMintAddressMap:e.Vec(e.Tuple(e.Nat,Q)),nextCastId:e.Nat,orchestrator:e.Principal,cycleSettings:e.Record({amountPerETHCast:e.Nat,cycleLedgerCanister:e.Principal,amountPerBitcoinOwnerRequest:e.Nat,amountPerSolanaCast:e.Nat,amountPerOtherOwnerRequest:e.Nat,amountPerICOwnerRequest:e.Nat,amountPerSolanaOwnerRequest:e.Nat,amountPerEthOwnerRequest:e.Nat,amountBasePerOwnerRequest:e.Nat}),nativeChain:C,remoteOwnerMap:e.Vec(e.Tuple(e.Nat,F))}),M=e.Record({allow_transfers:e.Bool,supply_cap:e.Opt(e.Nat),tx_window:e.Nat,burn_account:e.Opt(u),default_take_value:e.Nat,logo:e.Opt(e.Text),permitted_drift:e.Nat,name:e.Opt(e.Text),description:e.Opt(e.Text),max_take_value:e.Nat,max_update_batch_size:e.Nat,max_query_batch_size:e.Nat,max_memo_size:e.Nat,symbol:e.Opt(e.Text)}),k=e.Record({owner:e.Principal,nft_count:e.Nat,ledger_info:M,indexes:e.Record({owner_to_nfts_count:e.Nat,nft_to_owner_count:e.Nat,recent_transactions_count:e.Nat}),supported_standards:d,ledger_count:e.Nat}),K=e.Record({last_block_index:e.Vec(e.Nat8),hash_tree:e.Vec(e.Nat8),last_block_hash:e.Vec(e.Nat8)}),V=e.Record({memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(e.Nat64),expires_at:e.Opt(e.Nat64),spender:u}),T=e.Record({approval_info:V}),ee=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),Duplicate:e.Record({duplicate_of:e.Nat}),InvalidSpender:e.Null,CreatedInFuture:e.Record({ledger_time:e.Nat64}),GenericBatchError:e.Record({message:e.Text,error_code:e.Nat}),TooOld:e.Null}),J=e.Variant({Ok:e.Nat,Err:ee}),pe=e.Record({token_id:e.Nat,approval_info:V}),E=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),Duplicate:e.Record({duplicate_of:e.Nat}),InvalidSpender:e.Null,NonExistingTokenId:e.Null,Unauthorized:e.Null,CreatedInFuture:e.Record({ledger_time:e.Nat64}),GenericBatchError:e.Record({message:e.Text,error_code:e.Nat}),TooOld:e.Null}),b=e.Variant({Ok:e.Nat,Err:E}),Y=e.Record({memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(e.Nat64),expires_at:e.Opt(e.Nat64),spender:u}),p=e.Record({token_id:e.Nat,approval_info:V}),O=e.Record({token_id:e.Nat,from_subaccount:e.Opt(e.Vec(e.Nat8)),spender:u}),R=e.Record({memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(e.Nat64),spender:e.Opt(u)}),q=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),Duplicate:e.Record({duplicate_of:e.Nat}),Unauthorized:e.Null,CreatedInFuture:e.Record({ledger_time:e.Nat64}),ApprovalDoesNotExist:e.Null,GenericBatchError:e.Record({message:e.Text,error_code:e.Nat}),TooOld:e.Null}),v=e.Variant({Ok:e.Nat,Err:q}),U=e.Record({token_id:e.Nat,memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(e.Nat64),spender:e.Opt(u)}),S=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),Duplicate:e.Record({duplicate_of:e.Nat}),NonExistingTokenId:e.Null,Unauthorized:e.Null,CreatedInFuture:e.Record({ledger_time:e.Nat64}),ApprovalDoesNotExist:e.Null,GenericBatchError:e.Record({message:e.Text,error_code:e.Nat}),TooOld:e.Null}),H=e.Variant({Ok:e.Nat,Err:S}),he=e.Record({to:u,spender_subaccount:e.Opt(e.Vec(e.Nat8)),token_id:e.Nat,from:u,memo:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(e.Nat64)}),$=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),Duplicate:e.Record({duplicate_of:e.Nat}),NonExistingTokenId:e.Null,Unauthorized:e.Null,CreatedInFuture:e.Record({ledger_time:e.Nat64}),InvalidRecipient:e.Null,GenericBatchError:e.Record({message:e.Text,error_code:e.Nat}),TooOld:e.Null}),W=e.Variant({Ok:e.Nat,Err:$}),le=e.Record({from:e.Opt(e.Principal)}),ce=e.Record({end:e.Nat,canister_id:e.Principal,start:e.Nat}),L=e.Vec(ce),ue=e.Record({start:e.Nat,length:e.Nat});a.fill(e.Variant({Int:e.Int,Map:e.Vec(e.Tuple(e.Text,a)),Nat:e.Nat,Blob:e.Vec(e.Nat8),Text:e.Text,Array:e.Vec(a)}));const re=e.Func([e.Vec(ue)],[n],["query"]),se=e.Record({args:e.Vec(ue),callback:re});n.fill(e.Record({log_length:e.Nat,blocks:e.Vec(e.Record({id:e.Nat,block:a})),archived_blocks:e.Vec(se)}));const Ne=e.Record({certificate:e.Vec(e.Nat8),hash_tree:e.Vec(e.Nat8)}),ge=e.Vec(B),ne=e.Vec(e.Nat);r.fill(e.Variant({Int:e.Int,Map:e.Vec(e.Tuple(e.Text,r)),Nat:e.Nat,Blob:e.Vec(e.Nat8),Text:e.Text,Array:e.Vec(r)}));const ye=e.Vec(e.Nat),G=e.Vec(e.Opt(B)),P=e.Record({to:B,token_id:e.Nat,memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(e.Nat64)}),z=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),Duplicate:e.Record({duplicate_of:e.Nat}),NonExistingTokenId:e.Null,Unauthorized:e.Null,CreatedInFuture:e.Record({ledger_time:e.Nat64}),InvalidRecipient:e.Null,GenericBatchError:e.Record({message:e.Text,error_code:e.Nat}),TooOld:e.Null}),A=e.Variant({Ok:e.Nat,Err:z}),Z=e.Record({tokenId:e.Nat,gasPrice:e.Opt(e.Nat),memo:e.Opt(e.Vec(e.Nat8)),fromSubaccount:e.Opt(e.Vec(e.Nat8)),remoteContract:C,maxPriorityFeePerGas:e.Opt(e.Nat),created_at_time:e.Opt(e.Nat),gasLimit:e.Opt(e.Nat),targetOwner:e.Text}),de=e.Variant({GenericError:e.Text,NoCkNFTCanister:e.Null,NetworkError:e.Text,ExistingCast:e.Nat,InsufficientAllowance:e.Tuple(e.Nat,e.Nat),InvalidTransaction:e.Text,InsufficientBalance:e.Tuple(e.Nat,e.Nat),NotFound:e.Null,InsufficientCycles:e.Tuple(e.Nat,e.Nat),TransferNotVerified:e.Variant({TooManyRetries:e.Nat,NoConsensus:e.Null}),MintNotVerified:e.Variant({TooManyRetries:e.Nat,NoConsensus:e.Null}),Unauthorized:e.Null,ContractNotVerified:e.Variant({TooManyRetries:e.Nat,NoConsensus:e.Null}),InvalidContract:e.Null}),te=e.Variant({Ok:e.Nat,Err:de}),fe=e.Record({tokenId:e.Nat,contract:e.Text,network:h}),xe=e.Variant({Error:de,WaitingOnContract:e.Record({transaction:e.Text}),RemoteFinalized:e.Text,SubmittedToOrchestrator:e.Record({localCastId:e.Nat,remoteCastId:e.Nat}),WaitingOnMint:e.Record({transaction:e.Text}),WaitingOnTransfer:e.Record({transaction:e.Text}),Created:e.Null,Completed:e.Nat,SubmittingToOrchestrator:e.Nat}),oe=e.Record({startTime:e.Nat,status:xe,history:e.Vec(e.Tuple(xe,e.Nat)),castId:e.Nat,originalRequest:Z}),X=e.Record({tokenId:e.Nat,contract:e.Text,network:h}),ae=e.Record({memo:e.Opt(e.Vec(e.Nat8)),createdAtTime:e.Opt(e.Nat),remoteNFTPointer:X}),je=e.Variant({GenericError:e.Text,InsufficientAllowance:e.Tuple(e.Nat,e.Nat),InsufficientBalance:e.Tuple(e.Nat,e.Nat),NotFound:e.Null,InsufficientCycles:e.Tuple(e.Nat,e.Nat),Unauthorized:e.Null,FoundLocally:B,QueryError:e.Text}),Ae=e.Variant({Ok:F,Err:je}),Fe=e.Record({memo:e.Opt(e.Vec(e.Nat8)),tokens:e.Vec(e.Nat),created_at_time:e.Opt(e.Nat64)}),Pe=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),NonExistingTokenId:e.Null,InvalidBurn:e.Null}),_e=e.Variant({Ok:e.Nat,Err:Pe}),ke=e.Record({result:_e,token_id:e.Nat}),ve=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),Unauthorized:e.Null,CreatedInFuture:e.Record({ledger_time:e.Nat64}),TooOld:e.Null}),Te=e.Variant({Ok:e.Vec(ke),Err:ve}),Ie=e.Vec(e.Tuple(e.Text,r)),Ue=e.Record({token_id:e.Nat,owner:u,metadata:Ie,memo:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(e.Nat64),spender:e.Opt(u)}),He=e.Variant({GenericError:e.Record({message:e.Text,error_code:e.Nat}),TokenExists:e.Null,NonExistingTokenId:e.Null,CreatedInFuture:e.Record({ledger_time:e.Nat64}),TooOld:e.Null}),Ge=e.Variant({Ok:e.Opt(e.Nat),Err:He,GenericError:e.Record({message:e.Text,error_code:e.Nat})}),Ee=e.Variant({ok:e.Bool,err:e.Text}),De=e.Variant({ok:e.Null,err:e.Text});return e.Service({assign:e.Func([e.Nat,u,e.Opt(e.Text),e.Opt(h),e.Opt(e.Vec(e.Nat8)),e.Opt(B),e.Opt(e.Text)],[e.Nat],[]),get_minters:e.Func([],[j],["query"]),get_stats:e.Func([],[e.Record({icrc99:_,icrc7:k})],["query"]),get_tip:e.Func([],[K],["query"]),icrc10_supported_standards:e.Func([],[d],["query"]),icrc37_approve_collection:e.Func([e.Vec(T)],[e.Vec(e.Opt(J))],[]),icrc37_approve_tokens:e.Func([e.Vec(pe)],[e.Vec(e.Opt(b))],[]),icrc37_get_collection_approvals:e.Func([u,e.Opt(Y),e.Opt(e.Nat)],[e.Vec(Y)],["query"]),icrc37_get_token_approvals:e.Func([e.Vec(e.Nat),e.Opt(p),e.Opt(e.Nat)],[e.Vec(p)],["query"]),icrc37_is_approved:e.Func([e.Vec(O)],[e.Vec(e.Bool)],["query"]),icrc37_max_approvals_per_token_or_collection:e.Func([],[e.Opt(e.Nat)],["query"]),icrc37_max_revoke_approvals:e.Func([],[e.Opt(e.Nat)],["query"]),icrc37_revoke_collection_approvals:e.Func([e.Vec(R)],[e.Vec(e.Opt(v))],[]),icrc37_revoke_token_approvals:e.Func([e.Vec(U)],[e.Vec(e.Opt(H))],[]),icrc37_transfer_from:e.Func([e.Vec(he)],[e.Vec(e.Opt(W))],[]),icrc3_get_archives:e.Func([le],[L],["query"]),icrc3_get_blocks:e.Func([e.Vec(ue)],[n],["query"]),icrc3_get_tip_certificate:e.Func([],[e.Opt(Ne)],["query"]),icrc3_supported_block_types:e.Func([],[e.Vec(c)],["query"]),icrc7_atomic_batch_transfers:e.Func([],[e.Opt(e.Bool)],["query"]),icrc7_balance_of:e.Func([ge],[ne],["query"]),icrc7_collection_metadata:e.Func([],[e.Vec(e.Tuple(e.Text,r))],["query"]),icrc7_default_take_value:e.Func([],[e.Opt(e.Nat)],["query"]),icrc7_description:e.Func([],[e.Opt(e.Text)],["query"]),icrc7_logo:e.Func([],[e.Opt(e.Text)],["query"]),icrc7_max_memo_size:e.Func([],[e.Opt(e.Nat)],["query"]),icrc7_max_query_batch_size:e.Func([],[e.Opt(e.Nat)],["query"]),icrc7_max_take_value:e.Func([],[e.Opt(e.Nat)],["query"]),icrc7_max_update_batch_size:e.Func([],[e.Opt(e.Nat)],["query"]),icrc7_name:e.Func([],[e.Text],["query"]),icrc7_owner_of:e.Func([ye],[G],["query"]),icrc7_permitted_drift:e.Func([],[e.Opt(e.Nat)],["query"]),icrc7_supply_cap:e.Func([],[e.Opt(e.Nat)],["query"]),icrc7_symbol:e.Func([],[e.Text],["query"]),icrc7_token_metadata:e.Func([e.Vec(e.Nat)],[e.Vec(e.Opt(e.Vec(e.Tuple(e.Text,r))))],["query"]),icrc7_tokens:e.Func([e.Opt(e.Nat),e.Opt(e.Nat)],[e.Vec(e.Nat)],["query"]),icrc7_tokens_of:e.Func([u,e.Opt(e.Nat),e.Opt(e.Nat)],[e.Vec(e.Nat)],["query"]),icrc7_total_supply:e.Func([],[e.Nat],["query"]),icrc7_transfer:e.Func([e.Vec(P)],[e.Vec(e.Opt(A))],[]),icrc7_tx_window:e.Func([],[e.Opt(e.Nat)],["query"]),icrc99_burn_fund_address:e.Func([e.Nat],[e.Opt(e.Tuple(e.Text,h))],[]),icrc99_cast:e.Func([e.Vec(Z),e.Opt(u)],[e.Vec(e.Opt(te))],[]),icrc99_cast_cost:e.Func([fe],[e.Nat],[]),icrc99_cast_fund_address:e.Func([e.Nat],[e.Opt(e.Tuple(e.Text,h))],[]),icrc99_cast_status:e.Func([e.Vec(e.Nat),e.Opt(u)],[e.Vec(e.Opt(oe))],[]),icrc99_get_remote_addresses:e.Func([e.Vec(e.Nat)],[e.Vec(e.Opt(Q))],["query"]),icrc99_native_chain:e.Func([],[C],["query"]),icrc99_remote_owner_of:e.Func([e.Vec(e.Nat)],[e.Vec(e.Opt(F))],["query"]),icrc99_request_remote_owner_status:e.Func([e.Vec(ae),e.Opt(u)],[e.Vec(e.Opt(Ae))],[]),icrcX_burn:e.Func([Fe],[Te],[]),is_minter:e.Func([e.Principal],[e.Bool],["query"]),mint_ck_nft:e.Func([Ue],[Ge,e.Opt(b)],[]),set_minter:e.Func([e.Principal,e.Variant({Add:e.Null,Remove:e.Null})],[Ee],[]),update_cast_status:e.Func([e.Nat,xe],[De],[]),update_nft_remote_address:e.Func([e.Nat,e.Text,h,e.Vec(e.Nat8),e.Opt(B),e.Opt(e.Text)],[e.Variant({ok:e.Null,err:e.Text})],[])})},K0=Object.freeze(Object.defineProperty({__proto__:null,idlFactory:Ms},Symbol.toStringTag,{value:"Module"}));var pl={};const gl=pl.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai";function Vt(e){const t=vf(),n=Pp(),{user:r}=ut(),a=sd(),o=od(e,vs),i=rn(e,vs),c=o,l=js(gl),{useApprove:u}=l,d=u(),m=Tt({mutationFn:async b=>{if(!n||!c)throw new Error("User must be authenticated to mint NFTs");console.log("Minting NFT from EVM with params:",b);let Y=b.requiredCycles;if(!Y)try{console.log("Getting mint cost for NFT...");const v=(await i.get_mint_cost([b.request]))[0];Array.isArray(v)&&v.length>0?Y=v[0]:Y=void 0,console.log("Mint cost:",Y==null?void 0:Y.toString())}catch(q){console.warn("Failed to get mint cost, proceeding without cycles check:",q)}if(Y&&!b.skipApproval)try{const q=qe.fromText(e),v=r;if(v!=null&&v.principal){let U=!0;try{console.log("Making fresh allowance call to cycles ledger...");const S=qe.fromText(e),H={account:{owner:v.principal,subaccount:[]},spender:{owner:S,subaccount:[]}};console.log("Allowance check params:",H),await t.invalidateQueries({queryKey:["icrc2-allowance"]}),await t.invalidateQueries({queryKey:["orchestrator-allowance"]}),await new Promise($=>setTimeout($,100));const he=["icrc2-allowance",H];console.log("Refetching with query key:",he);try{const $=await t.fetchQuery({queryKey:he,queryFn:async()=>{console.log("Fetching fresh allowance from blockchain...");const{Actor:W,HttpAgent:le}=await Xe(async()=>{const{Actor:se,HttpAgent:Ne}=await Promise.resolve().then(()=>Bt);return{Actor:se,HttpAgent:Ne}},void 0),ce=new le({host:"https://icp0.io"}),L=({IDL:se})=>{const Ne=se.Record({owner:se.Principal,subaccount:se.Opt(se.Vec(se.Nat8))}),ge=se.Record({allowance:se.Nat,expires_at:se.Opt(se.Nat64)});return se.Service({icrc2_allowance:se.Func([se.Record({account:Ne,spender:Ne})],[ge],["query"])})},re=await W.createActor(L,{agent:ce,canisterId:gl}).icrc2_allowance(H);return console.log("Fresh allowance result from blockchain:",re),{allowance:re.allowance,expires_at:re.expires_at.length>0?[re.expires_at[0]]:[]}},staleTime:0});if(console.log("Fresh allowance data:",$),$!=null&&$.allowance)if(console.log("Found fresh allowance:",$.allowance.toString()),console.log("Required mint cost:",Y.toString()),console.log("Is sufficient?",$.allowance>=Y),$.allowance>=Y){const W=BigInt(Date.now()*1e6),le=$.expires_at.length>0&&$.expires_at[0]<W;console.log("Allowance expiry check - now:",W.toString()),console.log("Allowance expires_at:",$.expires_at),console.log("Is expired?",le),le?console.log("âŒ Fresh allowance is expired, will re-approve"):(U=!1,console.log("âœ… Sufficient fresh allowance exists for minting, skipping approval"))}else console.log("âŒ Fresh allowance insufficient, will approve more");else console.log("âŒ No fresh allowance found, will approve")}catch($){console.warn("Failed to fetch fresh allowance:",$),console.log("âŒ Fresh allowance fetch failed, will approve to be safe")}}catch(S){console.warn("Could not check current allowance, will approve:",S)}if(U){console.log("Auto-approving cycles for NFT minting...");const S=Y*BigInt(110)/BigInt(100);await d.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:S,expected_allowance:[],expires_at:[BigInt(Date.now()*1e6)+BigInt(1440*60*1e9)],spender:{owner:q,subaccount:[]}}),console.log("Cycles approved for minting")}}}catch(q){throw console.error("Failed to approve cycles for minting:",q),new Error(`Failed to approve cycles for minting: ${q instanceof Error?q.message:String(q)}`)}const p=b.spender?[b.spender]:[],O=r!=null&&r.principal?{owner:typeof r.principal=="string"?qe.fromText(r.principal):r.principal,subaccount:[]}:null,R=O?[O]:[];console.log("ðŸ” Mint function call parameters:",{request:{...b.request,nft:{...b.request.nft,tokenId:b.request.nft.tokenId.toString()},mintToAccount:{...b.request.mintToAccount,owner:b.request.mintToAccount.owner.toString()}},candidSpender:p.map(q=>({...q,owner:q.owner.toString()})),candidAccount:R.map(q=>({...q,owner:q.owner.toString()})),userPrincipal:r==null?void 0:r.principal,userPrincipalType:typeof(r==null?void 0:r.principal),userAccount:O});try{return console.log("ðŸ” Attempting mint with 3 parameters..."),c.mint(b.request,R)}catch(q){return console.warn("ðŸ” 3-parameter mint failed, trying 2-parameter version:",q),c.mint(b.request,p)}},onSuccess:()=>{t.invalidateQueries({queryKey:["nft"]}),t.invalidateQueries({queryKey:["mint-status"]}),t.invalidateQueries({queryKey:["orchestrator-allowance"]})}}),f=Tt({mutationFn:async b=>{if(!i)throw new Error("Anonymous actor not available");return(await i.get_mint_cost(b)).map(p=>Array.isArray(p)&&p.length?p[0]:null)}}),g=Tt({mutationFn:async b=>{if(!i)throw new Error("Anonymous actor not available to get mint status");return i.get_mint_status(b)}}),N=Tt({mutationFn:async b=>{if(!c)throw new Error("User must be authenticated to verify remote ownership");const Y=b.spender?[b.spender]:[],p=b.pointers.map(R=>({tokenId:R.tokenId,contract:R.contractPointer.contract,network:R.contractPointer.network}));return(await c.get_remote_owner(p,Y)).map(R=>Array.isArray(R)&&R.length?R[0]:null)}}),h=Tt({mutationFn:async b=>{if(!c)throw new Error("User must be authenticated to get remote metadata");const Y=b.spender?[b.spender]:[],p=b.pointers.map(R=>({tokenId:R.tokenId,contract:R.contractPointer.contract,network:R.contractPointer.network}));return(await c.get_remote_meta(p,b.fields,Y)).map(R=>Array.isArray(R)&&R.length?R[0]:null)}}),C=Tt({mutationFn:async b=>{if(!i)throw new Error("Anonymous actor not available for approval address query");const Y=b.spender?[b.spender]:[],p=await i.get_remote_approval_address(b.request,Y);return Array.isArray(p)?p.length===0?null:p[0]:p}}),w=Tt({mutationFn:async b=>{if(!n||!a)throw new Error("User must be authenticated to cast NFTs");const{Actor:Y}=await Xe(async()=>{const{Actor:S}=await Promise.resolve().then(()=>Bt);return{Actor:S}},void 0),p=Y.createActor(Ms,{agent:a,canisterId:b.ckNFTCanisterId});console.log("ðŸŽ¯ Casting NFTs via ckNFT canister:",{canisterId:b.ckNFTCanisterId.toString(),requestCount:b.castRequests.length,spender:b.spender});try{const S=new nd({host:pl.IC_HOST}),he=await Y.createActor(Ms,{agent:S,canisterId:b.ckNFTCanisterId}).icrc99_cast_cost({contract:b.castRequests[0].remoteContract.contract,network:b.castRequests[0].remoteContract.network,tokenId:b.castRequests[0].tokenId}),$=BigInt(he)*BigInt(b.castRequests.length);console.log("ðŸ”‹ Total cycles needed for casting:",$.toString());const W=$*BigInt(110)/BigInt(100),le=r;let ce=!0;if(le!=null&&le.principal)try{const L={account:{owner:le.principal,subaccount:[]},spender:{owner:b.ckNFTCanisterId,subaccount:[]}},ue=await t.fetchQuery({queryKey:["icrc2-allowance",L],queryFn:async()=>{const{Actor:re,HttpAgent:se}=await Xe(async()=>{const{Actor:P,HttpAgent:z}=await Promise.resolve().then(()=>Bt);return{Actor:P,HttpAgent:z}},void 0),Ne=new se({host:"https://icp0.io"}),ge=({IDL:P})=>{const z=P.Record({owner:P.Principal,subaccount:P.Opt(P.Vec(P.Nat8))}),A=P.Record({allowance:P.Nat,expires_at:P.Opt(P.Nat64)});return P.Service({icrc2_allowance:P.Func([P.Record({account:z,spender:z})],[A],["query"])})},ne=pl.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",G=await re.createActor(ge,{agent:Ne,canisterId:ne}).icrc2_allowance(L);return{allowance:G.allowance,expires_at:G.expires_at.length>0?[G.expires_at[0]]:[]}},staleTime:0});if(ue!=null&&ue.allowance)if(console.log("ðŸ” Current allowance for ckNFT canister:",ue.allowance.toString()),console.log("ðŸ” Required approval amount:",W.toString()),ue.allowance>=W){const re=BigInt(Date.now()*1e6);ue.expires_at.length>0&&ue.expires_at[0]<re?console.log("âŒ Cycles allowance expired, will re-approve"):(ce=!1,console.log("âœ… Sufficient cycles allowance already exists for casting, skipping approval"))}else console.log("âŒ Insufficient cycles allowance, will approve more")}catch(L){console.warn("Could not check current cycles allowance, will approve to be safe:",L)}ce&&(console.log("ðŸ”‹ Auto-approving cycles for ckNFT canister casting..."),await d.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:W,expected_allowance:[],expires_at:[BigInt(Date.now()*1e6)+BigInt(1440*60*1e9)],spender:{owner:b.ckNFTCanisterId,subaccount:[]}}),console.log("ðŸ”‹ Cycles approved for ckNFT canister casting"))}catch(S){console.warn("âš ï¸ Failed to approve cycles for casting, continuing anyway:",S)}const O=r!=null&&r.principal?typeof r.principal=="string"?qe.fromText(r.principal):r.principal:null;if(b.spender&&O){console.log("ðŸ” Approving ckNFT canister to spend NFTs for casting...");try{const S=b.castRequests.map(he=>({token_id:he.tokenId,approval_info:{spender:b.spender,memo:[],from_subaccount:he.fromSubaccount,created_at_time:[],expires_at:[BigInt(Date.now()*1e6)+BigInt(864e11)]}})),H=await p.icrc37_approve_tokens(S);console.log("ðŸ” NFT approval results:",H);for(let he=0;he<H.length;he++){const $=H[he];if(Array.isArray($)&&$.length>0&&$[0]&&"Err"in $[0]){const W=$[0].Err;if(console.error(`âŒ Failed to approve NFT ${b.castRequests[he].tokenId}:`,W),"InsufficientAllowance"in W){const le=W.InsufficientAllowance;throw new Error(`Insufficient allowance for NFT casting. Required: ${le.allowance}, Available: ${le.balance}. Please approve the NFT for transfer before casting.`)}else throw new Error(`Failed to approve NFT ${b.castRequests[he].tokenId}: ${JSON.stringify(W)}`)}}console.log("âœ… All NFTs approved successfully for ckNFT canister")}catch(S){throw console.error("âŒ Failed to approve NFTs for casting:",S),S}}else console.log("ðŸ” No spender specified or user not authenticated - skipping approval");const q=r!=null&&r.principal?{owner:typeof r.principal=="string"?qe.fromText(r.principal):r.principal,subaccount:[]}:null,v=q?[q]:[],U=await p.icrc99_cast(b.castRequests,v);return console.log("âœ… Cast results from ckNFT canister:",U),U.map(S=>Array.isArray(S)&&S.length>0&&S[0]!=null?S[0]:null)},onSuccess:()=>{t.invalidateQueries({queryKey:["nft"]}),t.invalidateQueries({queryKey:["cast-status"]})}}),B=Tt({mutationFn:async b=>{const{Actor:Y}=await Xe(async()=>{const{Actor:q}=await Promise.resolve().then(()=>Bt);return{Actor:q}},void 0);let p=i?i._agent||i.__agent:null;if(!p){const{HttpAgent:q}=await Xe(async()=>{const{HttpAgent:v}=await Promise.resolve().then(()=>Bt);return{HttpAgent:v}},void 0);p=new q({host:"https://icp0.io"})}return await Y.createActor(Ms,{agent:p,canisterId:b.ckNFTCanisterId}).icrc99_cast_status(b.castIds,b.account?[b.account]:[])}}),j=Tt({mutationFn:async b=>{var q,v;if(!c)throw new Error("User must be authenticated to create remote contracts");let Y,p,O;if((q=b.remoteFeeData)!=null&&q.maxFeePerGas&&((v=b.ethFeeData)!=null&&v.gasPrice)&&b.estimatedRemoteGas&&b.estimatedRemoteSize&&b.remoteFundingBalance){const U=b.remoteFeeData.l1DataFee&&b.remoteFeeData.l1DataFee>0n?b.ethFeeData.gasPrice*16n*(b.estimatedRemoteSize+300n)/(b.estimatedRemoteGas*120n/100n):0n;Y=b.remoteFeeData.maxFeePerGas+2000000n+U;const S=b.remoteFundingBalance*90n/100n/1800000n;p=b.estimatedRemoteGas,O=2000000n,console.log("ðŸ“Š Enhanced gas calculation:",{maxFeePerGas:b.remoteFeeData.maxFeePerGas.toString(),l1DataComponent:U.toString(),finalGasPrice:Y.toString(),estimatedGas:b.estimatedRemoteGas.toString(),gasAvailable:S.toString(),remoteFundingBalance:b.remoteFundingBalance.toString()})}else Y=b.gasPrice??50000000000n,p=b.gasLimit??2000000n,O=b.maxPriorityFeePerGas??2000000000n,console.log("âš ï¸ Using fallback gas parameters - enhanced calculation data not available");const R=b.spender?[b.spender]:[];return console.log("ðŸš€ Creating remote contract with final parameters:",{gasPrice:Y.toString(),gasLimit:p.toString(),maxPriorityFeePerGas:O.toString()}),c.create_remote(b.pointer,b.network,Y,p,O,R)},onSuccess:()=>{t.invalidateQueries({queryKey:["remote-contracts"]})}}),Q=Tt({mutationFn:async b=>{if(!i)throw new Error("Anonymous actor not available");return(await i.get_remote_status(b)).map(p=>{if(p&&p.length>0&&p[0]){const O=p[0];return{contractId:O.contractId,address:O.address&&O.address.length>0?O.address[0]:void 0,confirmed:O.confirmed,deploymentTrx:O.deploymentTrx&&O.deploymentTrx.length>0?O.deploymentTrx[0]:void 0,network:O.network&&O.network.length>0?O.network[0]:void 0}}return null})}}),F=Tt({mutationFn:async b=>{if(!i)throw new Error("Anonymous actor not available");return i.get_remote_cost(b.pointer,b.network)}}),_=Tt({mutationFn:async b=>{if(!i)throw new Error("Anonymous actor not available");const Y=await i.get_remote_approval_address({remoteNFTPointer:{contract:b.contract,network:b.network,tokenId:b.tokenId},account:b.account},[]);return Y&&Y.length>0&&Y[0]?Y[0]:null}}),M=Tt({mutationFn:async b=>{if(!n||!c)throw new Error("User must be authenticated to create canisters");console.log("Creating canister with params:",b);const Y={contract:b.pointer.contract,network:JSON.stringify(b.pointer.network,(q,v)=>typeof v=="bigint"?v.toString():v)};if(console.log("Pointer for logging:",Y),b.requiredCycles&&!b.skipApproval)try{console.log("Auto-approving cycles for canister creation...");const q=qe.fromText(e),v=b.requiredCycles*BigInt(110)/BigInt(100);await d.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:v,expected_allowance:[],expires_at:[BigInt(Date.now()*1e6)+BigInt(1440*60*1e9)],spender:{owner:q,subaccount:[]}}),console.log("Cycles approved successfully")}catch(q){throw console.error("Failed to approve cycles:",q),new Error(`Failed to approve cycles: ${q instanceof Error?q.message:String(q)}`)}const p={logo:b.defaults.logo?[b.defaults.logo]:[],name:b.defaults.name?[b.defaults.name]:[],description:b.defaults.description?[b.defaults.description]:[],symbol:b.defaults.symbol?[b.defaults.symbol]:[]},O=b.spender?[b.spender]:[],R=await c.create_canister(b.pointer,p,O);if("Err"in R)if(console.error("Canister creation error:",R.Err),console.log("Full error object:",JSON.stringify(R.Err,(q,v)=>typeof v=="bigint"?`BigInt(${v.toString()})`:v,2)),"InsufficientCycles"in R.Err){const q=R.Err.InsufficientCycles;if(console.log("InsufficientCycles error data:",q,"Type:",typeof q,"IsArray:",Array.isArray(q)),Array.isArray(q)&&q.length>=2){const[v,U]=q;throw new Error(`Insufficient cycles for canister creation. The orchestrator needs ${U.toString()} cycles but only has ${v.toString()} available. You need to approve cycles from your cycles ledger to the orchestrator canister (jio3a-xaaaa-aaaal-ab66q-cai).`)}else throw new Error(`Insufficient cycles for canister creation. Error data: ${JSON.stringify(q)}`)}else if("InsufficientBalance"in R.Err){const q=R.Err.InsufficientBalance;if(Array.isArray(q)&&q.length>=2){const[v,U]=q;throw new Error(`Insufficient balance or allowance. Available: ${v.toString()}, Required: ${U.toString()}. Please ensure you have sufficient cycles balance and have approved the orchestrator as a spender.`)}else throw new Error(`Insufficient balance. Error data: ${JSON.stringify(q)}`)}else if("InsufficientAllowance"in R.Err){const q=R.Err.InsufficientAllowance;if(Array.isArray(q)&&q.length>=2){const[v,U]=q;throw new Error(`Insufficient allowance. Required: ${v.toString()}, Available: ${U.toString()}`)}else throw new Error(`Insufficient allowance. Error data: ${JSON.stringify(q)}`)}else{const q=(()=>{try{return JSON.stringify(R.Err,(v,U)=>typeof U=="bigint"?U.toString():U)}catch{return String(R.Err)}})();throw new Error(`Canister creation failed: ${q}`)}return R},onSuccess:()=>{t.invalidateQueries({queryKey:["canisters"]}),t.invalidateQueries({queryKey:["existing-canister"]}),t.invalidateQueries({queryKey:["orchestrator-allowance"]})}}),k=Tt({mutationFn:async b=>{if(!c)throw new Error("User must be authenticated to get creation cost");return c.get_creation_cost(b)}}),K=Tt({mutationFn:async b=>{if(!i)throw new Error("Anonymous actor not available");return(await i.get_ck_nft_canister(b)).map(p=>Array.isArray(p)&&p.length?p[0]:null)}}),V=Tt({mutationFn:async b=>{if(!i)throw new Error("Anonymous actor not available");const Y=await i.get_icrc99_address(b.canister,b.network);return Array.isArray(Y)?Y.length===0?null:Y[0]:Y}}),T=Tt({mutationFn:async b=>{const{Actor:Y,HttpAgent:p}=await Xe(async()=>{const{Actor:U,HttpAgent:S}=await Promise.resolve().then(()=>Bt);return{Actor:U,HttpAgent:S}},void 0),{idlFactory:O}=await Xe(async()=>{const{idlFactory:U}=await import("./index-BykKOlZ5.js");return{idlFactory:U}},__vite__mapDeps([0,1,2,3,4]));let R=i?i._agent||i.__agent:null;R||(R=new p({host:"https://icp0.io"}));const v=await Y.createActor(O,{agent:R,canisterId:b.ckNFTCanisterId}).icrc99_cast_fund_address(b.tokenId);if(Array.isArray(v)&&v.length>0){const[U,S]=v[0];return{address:U,network:S}}return null}}),ee=Tt({mutationFn:async b=>{const{Actor:Y}=await Xe(async()=>{const{Actor:v}=await Promise.resolve().then(()=>Bt);return{Actor:v}},void 0);let p=i?i._agent||i.__agent:null;if(!p){const{HttpAgent:v}=await Xe(async()=>{const{HttpAgent:U}=await Promise.resolve().then(()=>Bt);return{HttpAgent:U}},void 0);p=new v({host:"https://icp0.io"})}const O=Y.createActor(Ms,{agent:p,canisterId:b.ckNFTCanisterId}),R={contract:b.contract,network:b.network,tokenId:b.tokenId};return await O.icrc99_cast_cost(R)}}),J=Tt({mutationFn:async b=>{const{Actor:Y}=await Xe(async()=>{const{Actor:q}=await Promise.resolve().then(()=>Bt);return{Actor:q}},void 0);let p=i?i._agent||i.__agent:null;if(!p){const{HttpAgent:q}=await Xe(async()=>{const{HttpAgent:v}=await Promise.resolve().then(()=>Bt);return{HttpAgent:v}},void 0);p=new q({host:"https://icp0.io"})}const R=await Y.createActor(Ms,{agent:p,canisterId:b.ckNFTCanisterId}).icrc99_burn_fund_address(b.tokenId);return Array.isArray(R)&&R.length>0&&Array.isArray(R[0])&&R[0].length>0?R[0][0]:null}}),pe=m.isPending||w.isPending||M.isPending||j.isPending||f.isPending||F.isPending||k.isPending||g.isPending||B.isPending||N.isPending||h.isPending||C.isPending||K.isPending||V.isPending||T.isPending||ee.isPending,E=m.error||w.error||M.error||j.error||f.error||F.error||k.error||g.error||B.error||N.error||h.error||C.error||K.error||V.error||T.error||ee.error;return{mintFromEVM:m,getMintCost:f,getMintStatus:g,getRemoteOwner:N,getRemoteMetadata:h,getApprovalAddress:C,castToEVM:w,getCastStatus:B,getCastCost:ee,getCastFundAddress:T,createRemoteContract:j,getRemoteCost:F,getRemoteStatus:Q,getRemoteApprovalAddress:_,getBurnFundingAddress:J,createCanister:M,getCreationCost:k,getCkNFTCanister:K,getICRC99Address:V,cyclesApprove:d,isLoading:pe,error:E,isLoadingMint:m.isPending,isLoadingCast:w.isPending,isLoadingCanisterCreation:M.isPending,isLoadingRemoteCreation:j.isPending,mintError:m.error,castError:w.error,canisterError:M.error,remoteError:j.error}}function Y0(e,t=!0){const r=rn("jio3a-xaaaa-aaaal-ab66q-cai",vs);return id({queryKey:["canister-creation-cost",e==null?void 0:e.contract,e!=null&&e.network?JSON.stringify(e.network,(a,o)=>typeof o=="bigint"?o.toString():o):null],queryFn:async()=>{if(!e)throw new Error("Contract pointer is required");if(!r)throw new Error("Actor not available");return r.get_creation_cost(e)},enabled:t&&!!e&&!!r&&!!e.contract,staleTime:300*1e3,refetchOnWindowFocus:!1})}function Z0(e,t=!0){const r=rn("jio3a-xaaaa-aaaal-ab66q-cai",vs);return id({queryKey:["existing-canister",e==null?void 0:e.contract,e!=null&&e.network?JSON.stringify(e.network,(a,o)=>typeof o=="bigint"?o.toString():o):null],queryFn:async()=>{if(!e)throw new Error("Contract pointer is required");if(!r)throw new Error("Actor not available");const o=(await r.get_ck_nft_canister([e]))[0];return Array.isArray(o)?o.length===0?null:o[0]:o||null},enabled:t&&!!e&&!!r&&!!e.contract,staleTime:300*1e3,refetchOnWindowFocus:!1})}function oa(e){const t="jio3a-xaaaa-aaaal-ab66q-cai",{user:n}=ut(),r=js(gl),{useAllowance:a}=r,o=x.useMemo(()=>{if(n!=null&&n.principal)return{account:{owner:n.principal,subaccount:[]},spender:{owner:qe.fromText(t),subaccount:[]}}},[n==null?void 0:n.principal,t]),i=a(o),c=x.useMemo(()=>{if(!i.data)return null;const l=BigInt(Date.now()*1e6),u=i.data.expires_at.length>0&&i.data.expires_at[0]?i.data.expires_at[0]<l:!1;return{allowance:i.data.allowance,expires_at:i.data.expires_at,isExpired:u,isSufficient:e?i.data.allowance>=e:!1}},[i.data,e]);return x.useMemo(()=>({data:c,isLoading:i.isLoading,error:i.error,refetch:i.refetch}),[c,i.isLoading,i.error,i.refetch])}function X0(e,t=!0){const n=x.useMemo(()=>{if(!e)return null;let a;return typeof e=="string"?a=e:e&&typeof e=="object"&&"toString"in e?a=e.toString():a=String(e),!a||a==="N/A"||a==="No canister found"||a==="Error displaying ID"||a.startsWith("Error ")||a.length<5?null:a},[e]),r=rn(n||"umunu-kh777-77774-qaaca-cai",({IDL:a})=>a.Service({icrc7_collection_metadata:a.Func([],[a.Vec(a.Tuple(a.Text,a.Reserved))],["query"])}));return id({queryKey:["collection-metadata",n],queryFn:async()=>{if(!n)throw new Error("Canister ID is required");if(!r)throw new Error("Actor not available");const a=await r.icrc7_collection_metadata();console.log("ðŸ” Raw collection metadata from canister:",a),console.log("ðŸ” Raw metadata structure:",JSON.stringify(a,(c,l)=>typeof l=="bigint"?`BigInt(${l.toString()})`:l,2));const o=c=>{if(console.log("ðŸ” Processing value:",c,"Type:",typeof c),!!c){if(typeof c=="string"||typeof c=="number"||typeof c=="bigint"||typeof c=="boolean")return c;if(typeof c=="object"&&c!==null){if("Text"in c)return console.log("ðŸ” Found Text variant:",c.Text),c.Text;if("Nat"in c)return console.log("ðŸ” Found Nat variant:",c.Nat),BigInt(c.Nat);if("Int"in c)return console.log("ðŸ” Found Int variant:",c.Int),BigInt(c.Int);if("Bool"in c)return console.log("ðŸ” Found Bool variant:",c.Bool),c.Bool;if("Blob"in c)return console.log("ðŸ” Found Blob variant:",c.Blob),c.Blob;if("Array"in c)return console.log("ðŸ” Found Array variant:",c.Array),c.Array;if("Map"in c)return console.log("ðŸ” Found Map variant:",c.Map),c.Map;const l=Object.keys(c);if(l.length===1){const u=l[0];return console.log(`ðŸ” Found single-key variant: ${u} =>`,c[u]),o(c[u])}return console.log("ðŸ” Complex object, returning as-is:",c),c}return console.log("ðŸ” Returning value as-is:",c),c}},i={};for(const[c,l]of a)console.log(`ðŸ” Processing metadata pair: "${c}" =>`,l),i[c]=o(l),console.log(`ðŸ” Parsed result for "${c}":`,i[c]);return console.log("ðŸŽ¯ Final parsed collection metadata:",i),{name:i["icrc7:name"]||i.name||null,symbol:i["icrc7:symbol"]||i.symbol||null,description:i["icrc7:description"]||i.description||null,logo:i["icrc7:logo"]||i.logo||null,totalSupply:i["icrc7:total_supply"]||i.total_supply||null,supplyCap:i["icrc7:supply_cap"]||i.supply_cap||null,maxQueryBatchSize:i["icrc7:max_query_batch_size"]||null,maxUpdateBatchSize:i["icrc7:max_update_batch_size"]||null,maxTakeValue:i["icrc7:max_take_value"]||null,maxMemoSize:i["icrc7:max_memo_size"]||null,defaultTakeValue:i["icrc7:default_take_value"]||null,royalties:i["icrc7:royalties"]||i.royalties||null,royaltyRecipient:i["icrc7:royalty_recipient"]||i.royalty_recipient||null,raw:a}},enabled:t&&!!n&&!!r&&n!=="aaaaa-aa",staleTime:600*1e3,refetchOnWindowFocus:!1})}const ix="6.15.0";function cx(e,t,n){const r=t.split("|").map(o=>o.trim());for(let o=0;o<r.length;o++)switch(t){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof e===t)return}const a=new Error(`invalid value for type ${t}`);throw a.code="INVALID_ARGUMENT",a.argument=`value.${n}`,a.value=e,a}async function Jt(e){const t=Object.keys(e);return(await Promise.all(t.map(r=>Promise.resolve(e[r])))).reduce((r,a,o)=>(r[t[o]]=a,r),{})}function $e(e,t,n){for(let r in t){let a=t[r];const o=n?n[r]:null;o&&cx(a,o,r),Object.defineProperty(e,r,{enumerable:!0,value:a,writable:!1})}}function xa(e,t){if(e==null)return"null";if(t==null&&(t=new Set),typeof e=="object"){if(t.has(e))return"[Circular]";t.add(e)}if(Array.isArray(e))return"[ "+e.map(n=>xa(n,t)).join(", ")+" ]";if(e instanceof Uint8Array){const n="0123456789abcdef";let r="0x";for(let a=0;a<e.length;a++)r+=n[e[a]>>4],r+=n[e[a]&15];return r}if(typeof e=="object"&&typeof e.toJSON=="function")return xa(e.toJSON(),t);switch(typeof e){case"boolean":case"number":case"symbol":return e.toString();case"bigint":return BigInt(e).toString();case"string":return JSON.stringify(e);case"object":{const n=Object.keys(e);return n.sort(),"{ "+n.map(r=>`${xa(r,t)}: ${xa(e[r],t)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function Ut(e,t){return e&&e.code===t}function ud(e){return Ut(e,"CALL_EXCEPTION")}function pt(e,t,n){let r=e;{const o=[];if(n){if("message"in n||"code"in n||"name"in n)throw new Error(`value will overwrite populated values: ${xa(n)}`);for(const i in n){if(i==="shortMessage")continue;const c=n[i];o.push(i+"="+xa(c))}}o.push(`code=${t}`),o.push(`version=${ix}`),o.length&&(e+=" ("+o.join(", ")+")")}let a;switch(t){case"INVALID_ARGUMENT":a=new TypeError(e);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":a=new RangeError(e);break;default:a=new Error(e)}return $e(a,{code:t}),n&&Object.assign(a,n),a.shortMessage==null&&$e(a,{shortMessage:r}),a}function we(e,t,n,r){if(!e)throw pt(t,n,r)}function D(e,t,n,r){we(e,t,"INVALID_ARGUMENT",{argument:n,value:r})}function L0(e,t,n){n==null&&(n=""),n&&(n=": "+n),we(e>=t,"missing argument"+n,"MISSING_ARGUMENT",{count:e,expectedCount:t}),we(e<=t,"too many arguments"+n,"UNEXPECTED_ARGUMENT",{count:e,expectedCount:t})}const lx=["NFD","NFC","NFKD","NFKC"].reduce((e,t)=>{try{if("test".normalize(t)!=="test")throw new Error("bad");if(t==="NFD"&&"Ã©".normalize("NFD")!=="eÌ")throw new Error("broken");e.push(t)}catch{}return e},[]);function dx(e){we(lx.indexOf(e)>=0,"platform missing String.prototype.normalize","UNSUPPORTED_OPERATION",{operation:"String.prototype.normalize",info:{form:e}})}function Ni(e,t,n){if(n==null&&(n=""),e!==t){let r=n,a="new";n&&(r+=".",a+=" "+n),we(!1,`private constructor; use ${r}from* methods`,"UNSUPPORTED_OPERATION",{operation:a})}}function D0(e,t,n){if(e instanceof Uint8Array)return n?new Uint8Array(e):e;if(typeof e=="string"&&e.match(/^0x(?:[0-9a-f][0-9a-f])*$/i)){const r=new Uint8Array((e.length-2)/2);let a=2;for(let o=0;o<r.length;o++)r[o]=parseInt(e.substring(a,a+2),16),a+=2;return r}D(!1,"invalid BytesLike value",t||"value",e)}function We(e,t){return D0(e,t,!1)}function Kt(e,t){return D0(e,t,!0)}function dt(e,t){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||typeof t=="number"&&e.length!==2+2*t||t===!0&&e.length%2!==0)}function md(e){return dt(e,!0)||e instanceof Uint8Array}const eu="0123456789abcdef";function Se(e){const t=We(e);let n="0x";for(let r=0;r<t.length;r++){const a=t[r];n+=eu[(a&240)>>4]+eu[a&15]}return n}function wt(e){return"0x"+e.map(t=>Se(t).substring(2)).join("")}function Ca(e){return dt(e,!0)?(e.length-2)/2:We(e).length}function yt(e,t,n){const r=We(e);return n!=null&&n>r.length&&we(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:r,length:r.length,offset:n}),Se(r.slice(t??0,n??r.length))}function f6(e){let t=Se(e).substring(2);for(;t.startsWith("00");)t=t.substring(2);return"0x"+t}function em(e,t,n){const r=We(e);we(t>=r.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(r),length:t,offset:t+1});const a=new Uint8Array(t);return a.fill(0),n?a.set(r,t-r.length):a.set(r,0),Se(a)}function En(e,t){return em(e,t,!0)}function ux(e,t){return em(e,t,!1)}const Cc=BigInt(0),Os=BigInt(1),ba=9007199254740991;function Di(e,t){const n=kc(e,"value"),r=BigInt(Je(t,"width"));if(we(n>>r===Cc,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:e}),n>>r-Os){const a=(Os<<r)-Os;return-((~n&a)+Os)}return n}function tm(e,t){let n=Be(e,"value");const r=BigInt(Je(t,"width")),a=Os<<r-Os;if(n<Cc){n=-n,we(n<=a,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:e});const o=(Os<<r)-Os;return(~n&o)+Os}else we(n<a,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:e});return n}function Nr(e,t){const n=kc(e,"value"),r=BigInt(Je(t,"bits"));return n&(Os<<r)-Os}function Be(e,t){switch(typeof e){case"bigint":return e;case"number":return D(Number.isInteger(e),"underflow",t||"value",e),D(e>=-ba&&e<=ba,"overflow",t||"value",e),BigInt(e);case"string":try{if(e==="")throw new Error("empty string");return e[0]==="-"&&e[1]!=="-"?-BigInt(e.substring(1)):BigInt(e)}catch(n){D(!1,`invalid BigNumberish string: ${n.message}`,t||"value",e)}}D(!1,"invalid BigNumberish value",t||"value",e)}function kc(e,t){const n=Be(e,t);return we(n>=Cc,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:e}),n}const tu="0123456789abcdef";function Ac(e){if(e instanceof Uint8Array){let t="0x0";for(const n of e)t+=tu[n>>4],t+=tu[n&15];return BigInt(t)}return Be(e)}function Je(e,t){switch(typeof e){case"bigint":return D(e>=-ba&&e<=ba,"overflow",t||"value",e),Number(e);case"number":return D(Number.isInteger(e),"underflow",t||"value",e),D(e>=-ba&&e<=ba,"overflow",t||"value",e),e;case"string":try{if(e==="")throw new Error("empty string");return Je(BigInt(e),t)}catch(n){D(!1,`invalid numeric string: ${n.message}`,t||"value",e)}}D(!1,"invalid numeric value",t||"value",e)}function mx(e){return Je(Ac(e))}function rr(e,t){let r=kc(e,"value").toString(16);if(t==null)r.length%2&&(r="0"+r);else{const a=Je(t,"width");for(we(a*2>=r.length,`value exceeds width (${a} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:e});r.length<a*2;)r="0"+r}return"0x"+r}function St(e){const t=kc(e,"value");if(t===Cc)return new Uint8Array([]);let n=t.toString(16);n.length%2&&(n="0"+n);const r=new Uint8Array(n.length/2);for(let a=0;a<r.length;a++){const o=a*2;r[a]=parseInt(n.substring(o,o+2),16)}return r}function Ps(e){let t=Se(md(e)?e:St(e)).substring(2);for(;t.startsWith("0");)t=t.substring(1);return t===""&&(t="0"),"0x"+t}const ec="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";let Ei=null;function hx(e){if(Ei==null){Ei={};for(let n=0;n<ec.length;n++)Ei[ec[n]]=BigInt(n)}const t=Ei[e];return D(t!=null,"invalid base58 value","letter",e),t}const fx=BigInt(0),xl=BigInt(58);function px(e){const t=We(e);let n=Ac(t),r="";for(;n;)r=ec[Number(n%xl)]+r,n/=xl;for(let a=0;a<t.length&&!t[a];a++)r=ec[0]+r;return r}function p6(e){let t=fx;for(let n=0;n<e.length;n++)t*=xl,t+=hx(e[n]);return t}function gx(e){e=atob(e);const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return We(t)}function xx(e){const t=We(e);let n="";for(let r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return btoa(n)}var Sa;class sm{constructor(t,n,r){ie(this,"filter");ie(this,"emitter");me(this,Sa);I(this,Sa,n),$e(this,{emitter:t,filter:r})}async removeListener(){y(this,Sa)!=null&&await this.emitter.off(this.filter,y(this,Sa))}}Sa=new WeakMap;function bx(e,t,n,r,a){D(!1,`invalid codepoint at offset ${t}; ${e}`,"bytes",n)}function nm(e,t,n,r,a){if(e==="BAD_PREFIX"||e==="UNEXPECTED_CONTINUE"){let o=0;for(let i=t+1;i<n.length&&n[i]>>6===2;i++)o++;return o}return e==="OVERRUN"?n.length-t-1:0}function yx(e,t,n,r,a){return e==="OVERLONG"?(D(typeof a=="number","invalid bad code point for replacement","badCodepoint",a),r.push(a),0):(r.push(65533),nm(e,t,n))}const Nx=Object.freeze({error:bx,ignore:nm,replace:yx});function rm(e,t){t==null&&(t=Nx.error);const n=We(e,"bytes"),r=[];let a=0;for(;a<n.length;){const o=n[a++];if(o>>7===0){r.push(o);continue}let i=null,c=null;if((o&224)===192)i=1,c=127;else if((o&240)===224)i=2,c=2047;else if((o&248)===240)i=3,c=65535;else{(o&192)===128?a+=t("UNEXPECTED_CONTINUE",a-1,n,r):a+=t("BAD_PREFIX",a-1,n,r);continue}if(a-1+i>=n.length){a+=t("OVERRUN",a-1,n,r);continue}let l=o&(1<<8-i-1)-1;for(let u=0;u<i;u++){let d=n[a];if((d&192)!=128){a+=t("MISSING_CONTINUE",a,n,r),l=null;break}l=l<<6|d&63,a++}if(l!==null){if(l>1114111){a+=t("OUT_OF_RANGE",a-1-i,n,r,l);continue}if(l>=55296&&l<=57343){a+=t("UTF16_SURROGATE",a-1-i,n,r,l);continue}if(l<=c){a+=t("OVERLONG",a-1-i,n,r,l);continue}r.push(l)}}return r}function tn(e,t){D(typeof e=="string","invalid string value","str",e),t!=null&&(dx(t),e=e.normalize(t));let n=[];for(let r=0;r<e.length;r++){const a=e.charCodeAt(r);if(a<128)n.push(a);else if(a<2048)n.push(a>>6|192),n.push(a&63|128);else if((a&64512)==55296){r++;const o=e.charCodeAt(r);D(r<e.length&&(o&64512)===56320,"invalid surrogate pair","str",e);const i=65536+((a&1023)<<10)+(o&1023);n.push(i>>18|240),n.push(i>>12&63|128),n.push(i>>6&63|128),n.push(i&63|128)}else n.push(a>>12|224),n.push(a>>6&63|128),n.push(a&63|128)}return new Uint8Array(n)}function wx(e){return e.map(t=>t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10&1023)+55296,(t&1023)+56320))).join("")}function tc(e,t){return wx(rm(e,t))}function g6(e,t){return rm(tn(e,t))}function am(e){async function t(n,r){we(r==null||!r.cancelled,"request cancelled before sending","CANCELLED");const a=n.url.split(":")[0].toLowerCase();we(a==="http"||a==="https",`unsupported protocol ${a}`,"UNSUPPORTED_OPERATION",{info:{protocol:a},operation:"request"}),we(a==="https"||!n.credentials||n.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let o=null;const i=new AbortController,c=setTimeout(()=>{o=pt("request timeout","TIMEOUT"),i.abort()},n.timeout);r&&r.addListener(()=>{o=pt("request cancelled","CANCELLED"),i.abort()});const l=Object.assign({},e,{method:n.method,headers:new Headers(Array.from(n)),body:n.body||void 0,signal:i.signal});let u;try{u=await fetch(n.url,l)}catch(g){throw clearTimeout(c),o||g}clearTimeout(c);const d={};u.headers.forEach((g,N)=>{d[N.toLowerCase()]=g});const m=await u.arrayBuffer(),f=m==null?null:new Uint8Array(m);return{statusCode:u.status,statusMessage:u.statusText,headers:d,body:f}}return t}const vx=12,jx=250;let su=am();const Cx=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),kx=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let Kc=!1;async function om(e,t){try{const n=e.match(Cx);if(!n)throw new Error("invalid data");return new nr(200,"OK",{"content-type":n[1]||"text/plain"},n[2]?gx(n[3]):Tx(n[3]))}catch{return new nr(599,"BAD REQUEST (invalid data: URI)",{},null,new Sn(e))}}function im(e){async function t(n,r){try{const a=n.match(kx);if(!a)throw new Error("invalid link");return new Sn(`${e}${a[2]}`)}catch{return new nr(599,"BAD REQUEST (invalid IPFS URI)",{},null,new Sn(n))}}return t}const Si={data:om,ipfs:im("https://gateway.ipfs.io/ipfs/")},cm=new WeakMap;var Cr,Vn;class Ax{constructor(t){me(this,Cr);me(this,Vn);I(this,Cr,[]),I(this,Vn,!1),cm.set(t,()=>{if(!y(this,Vn)){I(this,Vn,!0);for(const n of y(this,Cr))setTimeout(()=>{n()},0);I(this,Cr,[])}})}addListener(t){we(!y(this,Vn),"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),y(this,Cr).push(t)}get cancelled(){return y(this,Vn)}checkSignal(){we(!this.cancelled,"cancelled","CANCELLED",{})}}Cr=new WeakMap,Vn=new WeakMap;function Fi(e){if(e==null)throw new Error("missing signal; should not happen");return e.checkSignal(),e}var Fa,Ra,Ts,hn,Ba,Pa,Rt,ls,fn,kr,Ar,Tr,Hs,Es,Gn,Er,Ho;const fc=class fc{constructor(t){me(this,Er);me(this,Fa);me(this,Ra);me(this,Ts);me(this,hn);me(this,Ba);me(this,Pa);me(this,Rt);me(this,ls);me(this,fn);me(this,kr);me(this,Ar);me(this,Tr);me(this,Hs);me(this,Es);me(this,Gn);I(this,Pa,String(t)),I(this,Fa,!1),I(this,Ra,!0),I(this,Ts,{}),I(this,hn,""),I(this,Ba,3e5),I(this,Es,{slotInterval:jx,maxAttempts:vx}),I(this,Gn,null)}get url(){return y(this,Pa)}set url(t){I(this,Pa,String(t))}get body(){return y(this,Rt)==null?null:new Uint8Array(y(this,Rt))}set body(t){if(t==null)I(this,Rt,void 0),I(this,ls,void 0);else if(typeof t=="string")I(this,Rt,tn(t)),I(this,ls,"text/plain");else if(t instanceof Uint8Array)I(this,Rt,t),I(this,ls,"application/octet-stream");else if(typeof t=="object")I(this,Rt,tn(JSON.stringify(t))),I(this,ls,"application/json");else throw new Error("invalid body")}hasBody(){return y(this,Rt)!=null}get method(){return y(this,hn)?y(this,hn):this.hasBody()?"POST":"GET"}set method(t){t==null&&(t=""),I(this,hn,String(t).toUpperCase())}get headers(){const t=Object.assign({},y(this,Ts));return y(this,fn)&&(t.authorization=`Basic ${xx(tn(y(this,fn)))}`),this.allowGzip&&(t["accept-encoding"]="gzip"),t["content-type"]==null&&y(this,ls)&&(t["content-type"]=y(this,ls)),this.body&&(t["content-length"]=String(this.body.length)),t}getHeader(t){return this.headers[t.toLowerCase()]}setHeader(t,n){y(this,Ts)[String(t).toLowerCase()]=String(n)}clearHeaders(){I(this,Ts,{})}[Symbol.iterator](){const t=this.headers,n=Object.keys(t);let r=0;return{next:()=>{if(r<n.length){const a=n[r++];return{value:[a,t[a]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return y(this,fn)||null}setCredentials(t,n){D(!t.match(/:/),"invalid basic authentication username","username","[REDACTED]"),I(this,fn,`${t}:${n}`)}get allowGzip(){return y(this,Ra)}set allowGzip(t){I(this,Ra,!!t)}get allowInsecureAuthentication(){return!!y(this,Fa)}set allowInsecureAuthentication(t){I(this,Fa,!!t)}get timeout(){return y(this,Ba)}set timeout(t){D(t>=0,"timeout must be non-zero","timeout",t),I(this,Ba,t)}get preflightFunc(){return y(this,kr)||null}set preflightFunc(t){I(this,kr,t)}get processFunc(){return y(this,Ar)||null}set processFunc(t){I(this,Ar,t)}get retryFunc(){return y(this,Tr)||null}set retryFunc(t){I(this,Tr,t)}get getUrlFunc(){return y(this,Gn)||su}set getUrlFunc(t){I(this,Gn,t)}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${y(this,Rt)?Se(y(this,Rt)):"null"}>`}setThrottleParams(t){t.slotInterval!=null&&(y(this,Es).slotInterval=t.slotInterval),t.maxAttempts!=null&&(y(this,Es).maxAttempts=t.maxAttempts)}send(){return we(y(this,Hs)==null,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),I(this,Hs,new Ax(this)),Ce(this,Er,Ho).call(this,0,nu()+this.timeout,0,this,new nr(0,"",{},null,this))}cancel(){we(y(this,Hs)!=null,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const t=cm.get(this);if(!t)throw new Error("missing signal; should not happen");t()}redirect(t){const n=this.url.split(":")[0].toLowerCase(),r=t.split(":")[0].toLowerCase();we(this.method==="GET"&&(n!=="https"||r!=="http")&&t.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(t)})`});const a=new fc(t);return a.method="GET",a.allowGzip=this.allowGzip,a.timeout=this.timeout,I(a,Ts,Object.assign({},y(this,Ts))),y(this,Rt)&&I(a,Rt,new Uint8Array(y(this,Rt))),I(a,ls,y(this,ls)),a}clone(){const t=new fc(this.url);return I(t,hn,y(this,hn)),y(this,Rt)&&I(t,Rt,y(this,Rt)),I(t,ls,y(this,ls)),I(t,Ts,Object.assign({},y(this,Ts))),I(t,fn,y(this,fn)),this.allowGzip&&(t.allowGzip=!0),t.timeout=this.timeout,this.allowInsecureAuthentication&&(t.allowInsecureAuthentication=!0),I(t,kr,y(this,kr)),I(t,Ar,y(this,Ar)),I(t,Tr,y(this,Tr)),I(t,Es,Object.assign({},y(this,Es))),I(t,Gn,y(this,Gn)),t}static lockConfig(){Kc=!0}static getGateway(t){return Si[t.toLowerCase()]||null}static registerGateway(t,n){if(t=t.toLowerCase(),t==="http"||t==="https")throw new Error(`cannot intercept ${t}; use registerGetUrl`);if(Kc)throw new Error("gateways locked");Si[t]=n}static registerGetUrl(t){if(Kc)throw new Error("gateways locked");su=t}static createGetUrlFunc(t){return am(t)}static createDataGateway(){return om}static createIpfsGatewayFunc(t){return im(t)}};Fa=new WeakMap,Ra=new WeakMap,Ts=new WeakMap,hn=new WeakMap,Ba=new WeakMap,Pa=new WeakMap,Rt=new WeakMap,ls=new WeakMap,fn=new WeakMap,kr=new WeakMap,Ar=new WeakMap,Tr=new WeakMap,Hs=new WeakMap,Es=new WeakMap,Gn=new WeakMap,Er=new WeakSet,Ho=async function(t,n,r,a,o){var d,m,f;if(t>=y(this,Es).maxAttempts)return o.makeServerError("exceeded maximum retry limit");we(nu()<=n,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:a}),r>0&&await Ex(r);let i=this.clone();const c=(i.url.split(":")[0]||"").toLowerCase();if(c in Si){const g=await Si[c](i.url,Fi(y(a,Hs)));if(g instanceof nr){let N=g;if(this.processFunc){Fi(y(a,Hs));try{N=await this.processFunc(i,N)}catch(h){(h.throttle==null||typeof h.stall!="number")&&N.makeServerError("error in post-processing function",h).assertOk()}}return N}i=g}this.preflightFunc&&(i=await this.preflightFunc(i));const l=await this.getUrlFunc(i,Fi(y(a,Hs)));let u=new nr(l.statusCode,l.statusMessage,l.headers,l.body,a);if(u.statusCode===301||u.statusCode===302){try{const g=u.headers.location||"";return Ce(d=i.redirect(g),Er,Ho).call(d,t+1,n,0,a,u)}catch{}return u}else if(u.statusCode===429&&(this.retryFunc==null||await this.retryFunc(i,u,t))){const g=u.headers["retry-after"];let N=y(this,Es).slotInterval*Math.trunc(Math.random()*Math.pow(2,t));return typeof g=="string"&&g.match(/^[1-9][0-9]*$/)&&(N=parseInt(g)),Ce(m=i.clone(),Er,Ho).call(m,t+1,n,N,a,u)}if(this.processFunc){Fi(y(a,Hs));try{u=await this.processFunc(i,u)}catch(g){(g.throttle==null||typeof g.stall!="number")&&u.makeServerError("error in post-processing function",g).assertOk();let N=y(this,Es).slotInterval*Math.trunc(Math.random()*Math.pow(2,t));return g.stall>=0&&(N=g.stall),Ce(f=i.clone(),Er,Ho).call(f,t+1,n,N,a,u)}}return u};let Sn=fc;var ci,li,di,ds,Ma,Sr;const Hd=class Hd{constructor(t,n,r,a,o){me(this,ci);me(this,li);me(this,di);me(this,ds);me(this,Ma);me(this,Sr);I(this,ci,t),I(this,li,n),I(this,di,Object.keys(r).reduce((i,c)=>(i[c.toLowerCase()]=String(r[c]),i),{})),I(this,ds,a==null?null:new Uint8Array(a)),I(this,Ma,o||null),I(this,Sr,{message:""})}toString(){return`<FetchResponse status=${this.statusCode} body=${y(this,ds)?Se(y(this,ds)):"null"}>`}get statusCode(){return y(this,ci)}get statusMessage(){return y(this,li)}get headers(){return Object.assign({},y(this,di))}get body(){return y(this,ds)==null?null:new Uint8Array(y(this,ds))}get bodyText(){try{return y(this,ds)==null?"":tc(y(this,ds))}catch{we(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch{we(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const t=this.headers,n=Object.keys(t);let r=0;return{next:()=>{if(r<n.length){const a=n[r++];return{value:[a,t[a]],done:!1}}return{value:void 0,done:!0}}}}makeServerError(t,n){let r;t?r=`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${t})`:(t=`${this.statusCode} ${this.statusMessage}`,r=`CLIENT ESCALATED SERVER ERROR (${t})`);const a=new Hd(599,r,this.headers,this.body,y(this,Ma)||void 0);return I(a,Sr,{message:t,error:n}),a}throwThrottleError(t,n){n==null?n=-1:D(Number.isInteger(n)&&n>=0,"invalid stall timeout","stall",n);const r=new Error(t||"throttling requests");throw $e(r,{stall:n,throttle:!0}),r}getHeader(t){return this.headers[t.toLowerCase()]}hasBody(){return y(this,ds)!=null}get request(){return y(this,Ma)}ok(){return y(this,Sr).message===""&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:t,error:n}=y(this,Sr);t===""&&(t=`server response ${this.statusCode} ${this.statusMessage}`);let r=null;this.request&&(r=this.request.url);let a=null;try{y(this,ds)&&(a=tc(y(this,ds)))}catch{}we(!1,t,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:n,info:{requestUrl:r,responseBody:a,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}};ci=new WeakMap,li=new WeakMap,di=new WeakMap,ds=new WeakMap,Ma=new WeakMap,Sr=new WeakMap;let nr=Hd;function nu(){return new Date().getTime()}function Tx(e){return tn(e.replace(/%([0-9a-f][0-9a-f])/gi,(t,n)=>String.fromCharCode(parseInt(n,16))))}function Ex(e){return new Promise(t=>setTimeout(t,e))}const Sx=BigInt(-1),Cs=BigInt(0),ya=BigInt(1),Fx=BigInt(5),da={};let ka="0000";for(;ka.length<80;)ka+=ka;function dr(e){let t=ka;for(;t.length<e;)t+=t;return BigInt("1"+t.substring(0,e))}function Io(e,t,n){const r=BigInt(t.width);if(t.signed){const a=ya<<r-ya;we(n==null||e>=-a&&e<a,"overflow","NUMERIC_FAULT",{operation:n,fault:"overflow",value:e}),e>Cs?e=Di(Nr(e,r),r):e=-Di(Nr(-e,r),r)}else{const a=ya<<r;we(n==null||e>=0&&e<a,"overflow","NUMERIC_FAULT",{operation:n,fault:"overflow",value:e}),e=(e%a+a)%a&a-ya}return e}function Yc(e){typeof e=="number"&&(e=`fixed128x${e}`);let t=!0,n=128,r=18;if(typeof e=="string"){if(e!=="fixed")if(e==="ufixed")t=!1;else{const o=e.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);D(o,"invalid fixed format","format",e),t=o[1]!=="u",n=parseInt(o[2]),r=parseInt(o[3])}}else if(e){const o=e,i=(c,l,u)=>o[c]==null?u:(D(typeof o[c]===l,"invalid fixed format ("+c+" not "+l+")","format."+c,o[c]),o[c]);t=i("signed","boolean",t),n=i("width","number",n),r=i("decimals","number",r)}D(n%8===0,"invalid FixedNumber width (not byte aligned)","format.width",n),D(r<=80,"invalid FixedNumber decimals (too large)","format.decimals",r);const a=(t?"":"u")+"fixed"+String(n)+"x"+String(r);return{signed:t,width:n,decimals:r,name:a}}function Rx(e,t){let n="";e<Cs&&(n="-",e*=Sx);let r=e.toString();if(t===0)return n+r;for(;r.length<=t;)r=ka+r;const a=r.length-t;for(r=r.substring(0,a)+"."+r.substring(a);r[0]==="0"&&r[1]!==".";)r=r.substring(1);for(;r[r.length-1]==="0"&&r[r.length-2]!==".";)r=r.substring(0,r.length-1);return n+r}var Ss,it,Qt,ot,hr,ln,bl,yl,Nl,wl;const $n=class $n{constructor(t,n,r){me(this,ot);ie(this,"format");me(this,Ss);me(this,it);me(this,Qt);ie(this,"_value");Ni(t,da,"FixedNumber"),I(this,it,n),I(this,Ss,r);const a=Rx(n,r.decimals);$e(this,{format:r.name,_value:a}),I(this,Qt,dr(r.decimals))}get signed(){return y(this,Ss).signed}get width(){return y(this,Ss).width}get decimals(){return y(this,Ss).decimals}get value(){return y(this,it)}addUnsafe(t){return Ce(this,ot,bl).call(this,t)}add(t){return Ce(this,ot,bl).call(this,t,"add")}subUnsafe(t){return Ce(this,ot,yl).call(this,t)}sub(t){return Ce(this,ot,yl).call(this,t,"sub")}mulUnsafe(t){return Ce(this,ot,Nl).call(this,t)}mul(t){return Ce(this,ot,Nl).call(this,t,"mul")}mulSignal(t){Ce(this,ot,hr).call(this,t);const n=y(this,it)*y(t,it);return we(n%y(this,Qt)===Cs,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),Ce(this,ot,ln).call(this,n/y(this,Qt),"mulSignal")}divUnsafe(t){return Ce(this,ot,wl).call(this,t)}div(t){return Ce(this,ot,wl).call(this,t,"div")}divSignal(t){we(y(t,it)!==Cs,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),Ce(this,ot,hr).call(this,t);const n=y(this,it)*y(this,Qt);return we(n%y(t,it)===Cs,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),Ce(this,ot,ln).call(this,n/y(t,it),"divSignal")}cmp(t){let n=this.value,r=t.value;const a=this.decimals-t.decimals;return a>0?r*=dr(a):a<0&&(n*=dr(-a)),n<r?-1:n>r?1:0}eq(t){return this.cmp(t)===0}lt(t){return this.cmp(t)<0}lte(t){return this.cmp(t)<=0}gt(t){return this.cmp(t)>0}gte(t){return this.cmp(t)>=0}floor(){let t=y(this,it);return y(this,it)<Cs&&(t-=y(this,Qt)-ya),t=y(this,it)/y(this,Qt)*y(this,Qt),Ce(this,ot,ln).call(this,t,"floor")}ceiling(){let t=y(this,it);return y(this,it)>Cs&&(t+=y(this,Qt)-ya),t=y(this,it)/y(this,Qt)*y(this,Qt),Ce(this,ot,ln).call(this,t,"ceiling")}round(t){if(t==null&&(t=0),t>=this.decimals)return this;const n=this.decimals-t,r=Fx*dr(n-1);let a=this.value+r;const o=dr(n);return a=a/o*o,Io(a,y(this,Ss),"round"),new $n(da,a,y(this,Ss))}isZero(){return y(this,it)===Cs}isNegative(){return y(this,it)<Cs}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return $n.fromString(this.toString(),t)}static fromValue(t,n,r){const a=n==null?0:Je(n),o=Yc(r);let i=Be(t,"value");const c=a-o.decimals;if(c>0){const l=dr(c);we(i%l===Cs,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:t}),i/=l}else c<0&&(i*=dr(-c));return Io(i,o,"fromValue"),new $n(da,i,o)}static fromString(t,n){const r=t.match(/^(-?)([0-9]*)\.?([0-9]*)$/);D(r&&r[2].length+r[3].length>0,"invalid FixedNumber string value","value",t);const a=Yc(n);let o=r[2]||"0",i=r[3]||"";for(;i.length<a.decimals;)i+=ka;we(i.substring(a.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:t}),i=i.substring(0,a.decimals);const c=BigInt(r[1]+o+i);return Io(c,a,"fromString"),new $n(da,c,a)}static fromBytes(t,n){let r=Ac(We(t,"value"));const a=Yc(n);return a.signed&&(r=Di(r,a.width)),Io(r,a,"fromBytes"),new $n(da,r,a)}};Ss=new WeakMap,it=new WeakMap,Qt=new WeakMap,ot=new WeakSet,hr=function(t){D(this.format===t.format,"incompatible format; use fixedNumber.toFormat","other",t)},ln=function(t,n){return t=Io(t,y(this,Ss),n),new $n(da,t,y(this,Ss))},bl=function(t,n){return Ce(this,ot,hr).call(this,t),Ce(this,ot,ln).call(this,y(this,it)+y(t,it),n)},yl=function(t,n){return Ce(this,ot,hr).call(this,t),Ce(this,ot,ln).call(this,y(this,it)-y(t,it),n)},Nl=function(t,n){return Ce(this,ot,hr).call(this,t),Ce(this,ot,ln).call(this,y(this,it)*y(t,it)/y(this,Qt),n)},wl=function(t,n){return we(y(t,it)!==Cs,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),Ce(this,ot,hr).call(this,t),Ce(this,ot,ln).call(this,y(this,it)*y(this,Qt)/y(t,it),n)};let sc=$n;function Bx(e){let t=e.toString(16);for(;t.length<2;)t="0"+t;return"0x"+t}function ru(e,t,n){let r=0;for(let a=0;a<n;a++)r=r*256+e[t+a];return r}function au(e,t,n,r){const a=[];for(;n<t+1+r;){const o=lm(e,n);a.push(o.result),n+=o.consumed,we(n<=t+1+r,"child data too short","BUFFER_OVERRUN",{buffer:e,length:r,offset:t})}return{consumed:1+r,result:a}}function lm(e,t){we(e.length!==0,"data too short","BUFFER_OVERRUN",{buffer:e,length:0,offset:1});const n=r=>{we(r<=e.length,"data short segment too short","BUFFER_OVERRUN",{buffer:e,length:e.length,offset:r})};if(e[t]>=248){const r=e[t]-247;n(t+1+r);const a=ru(e,t+1,r);return n(t+1+r+a),au(e,t,t+1+r,r+a)}else if(e[t]>=192){const r=e[t]-192;return n(t+1+r),au(e,t,t+1,r)}else if(e[t]>=184){const r=e[t]-183;n(t+1+r);const a=ru(e,t+1,r);n(t+1+r+a);const o=Se(e.slice(t+1+r,t+1+r+a));return{consumed:1+r+a,result:o}}else if(e[t]>=128){const r=e[t]-128;n(t+1+r);const a=Se(e.slice(t+1,t+1+r));return{consumed:1+r,result:a}}return{consumed:1,result:Bx(e[t])}}function wi(e){const t=We(e,"data"),n=lm(t,0);return D(n.consumed===t.length,"unexpected junk after rlp payload","data",e),n.result}function ou(e){const t=[];for(;e;)t.unshift(e&255),e>>=8;return t}function dm(e){if(Array.isArray(e)){let r=[];if(e.forEach(function(o){r=r.concat(dm(o))}),r.length<=55)return r.unshift(192+r.length),r;const a=ou(r.length);return a.unshift(247+a.length),a.concat(r)}const t=Array.prototype.slice.call(We(e,"object"));if(t.length===1&&t[0]<=127)return t;if(t.length<=55)return t.unshift(128+t.length),t;const n=ou(t.length);return n.unshift(183+n.length),n.concat(t)}const iu="0123456789abcdef";function ar(e){let t="0x";for(const n of dm(e))t+=iu[n>>4],t+=iu[n&15];return t}const um=["wei","kwei","mwei","gwei","szabo","finney","ether"];function Px(e,t){let n=18;if(typeof t=="string"){const r=um.indexOf(t);D(r>=0,"invalid unit","unit",t),n=3*r}else t!=null&&(n=Je(t,"unit"));return sc.fromValue(e,n,{decimals:n,width:512}).toString()}function Mx(e,t){D(typeof e=="string","value must be a string","value",e);let n=18;if(typeof t=="string"){const r=um.indexOf(t);D(r>=0,"invalid unit","unit",t),n=3*r}else t!=null&&(n=Je(t,"unit"));return sc.fromString(e,{decimals:n,width:512}).value}function et(e){return Px(e,18)}function cu(e){return Mx(e,18)}const Yt=32,vl=new Uint8Array(Yt),Ox=["then"],Ri={},mm=new WeakMap;function pr(e){return mm.get(e)}function lu(e,t){mm.set(e,t)}function Uo(e,t){const n=new Error(`deferred error during ABI decoding triggered accessing ${e}`);throw n.error=t,n}function jl(e,t,n){return e.indexOf(null)>=0?t.map((r,a)=>r instanceof yo?jl(pr(r),r,n):r):e.reduce((r,a,o)=>{let i=t.getValue(a);return a in r||(n&&i instanceof yo&&(i=jl(pr(i),i,n)),r[a]=i),r},{})}var Oa;const wa=class wa extends Array{constructor(...n){const r=n[0];let a=n[1],o=(n[2]||[]).slice(),i=!0;r!==Ri&&(a=n,o=[],i=!1);super(a.length);me(this,Oa);a.forEach((u,d)=>{this[d]=u});const c=o.reduce((u,d)=>(typeof d=="string"&&u.set(d,(u.get(d)||0)+1),u),new Map);if(lu(this,Object.freeze(a.map((u,d)=>{const m=o[d];return m!=null&&c.get(m)===1?m:null}))),I(this,Oa,[]),y(this,Oa)==null&&y(this,Oa),!i)return;Object.freeze(this);const l=new Proxy(this,{get:(u,d,m)=>{if(typeof d=="string"){if(d.match(/^[0-9]+$/)){const g=Je(d,"%index");if(g<0||g>=this.length)throw new RangeError("out of result range");const N=u[g];return N instanceof Error&&Uo(`index ${g}`,N),N}if(Ox.indexOf(d)>=0)return Reflect.get(u,d,m);const f=u[d];if(f instanceof Function)return function(...g){return f.apply(this===m?u:this,g)};if(!(d in u))return u.getValue.apply(this===m?u:this,[d])}return Reflect.get(u,d,m)}});return lu(l,pr(this)),l}toArray(n){const r=[];return this.forEach((a,o)=>{a instanceof Error&&Uo(`index ${o}`,a),n&&a instanceof wa&&(a=a.toArray(n)),r.push(a)}),r}toObject(n){const r=pr(this);return r.reduce((a,o,i)=>(we(o!=null,`value at index ${i} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),jl(r,this,n)),{})}slice(n,r){n==null&&(n=0),n<0&&(n+=this.length,n<0&&(n=0)),r==null&&(r=this.length),r<0&&(r+=this.length,r<0&&(r=0)),r>this.length&&(r=this.length);const a=pr(this),o=[],i=[];for(let c=n;c<r;c++)o.push(this[c]),i.push(a[c]);return new wa(Ri,o,i)}filter(n,r){const a=pr(this),o=[],i=[];for(let c=0;c<this.length;c++){const l=this[c];l instanceof Error&&Uo(`index ${c}`,l),n.call(r,l,c,this)&&(o.push(l),i.push(a[c]))}return new wa(Ri,o,i)}map(n,r){const a=[];for(let o=0;o<this.length;o++){const i=this[o];i instanceof Error&&Uo(`index ${o}`,i),a.push(n.call(r,i,o,this))}return a}getValue(n){const r=pr(this).indexOf(n);if(r===-1)return;const a=this[r];return a instanceof Error&&Uo(`property ${JSON.stringify(n)}`,a.error),a}static fromItems(n,r){return new wa(Ri,n,r)}};Oa=new WeakMap;let yo=wa;function x6(e){const t=[],n=function(r,a){if(Array.isArray(a))for(let o in a){const i=r.slice();i.push(o);try{n(i,a[o])}catch(c){t.push({path:i,error:c})}}};return n([],e),t}function du(e){let t=St(e);return we(t.length<=Yt,"value out-of-bounds","BUFFER_OVERRUN",{buffer:t,length:Yt,offset:t.length}),t.length!==Yt&&(t=Kt(wt([vl.slice(t.length%Yt),t]))),t}class Rn{constructor(t,n,r,a){ie(this,"name");ie(this,"type");ie(this,"localName");ie(this,"dynamic");$e(this,{name:t,type:n,localName:r,dynamic:a},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(t,n){D(!1,t,this.localName,n)}}var pn,Fr,_a,Ui;class Cl{constructor(){me(this,_a);me(this,pn);me(this,Fr);I(this,pn,[]),I(this,Fr,0)}get data(){return wt(y(this,pn))}get length(){return y(this,Fr)}appendWriter(t){return Ce(this,_a,Ui).call(this,Kt(t.data))}writeBytes(t){let n=Kt(t);const r=n.length%Yt;return r&&(n=Kt(wt([n,vl.slice(r)]))),Ce(this,_a,Ui).call(this,n)}writeValue(t){return Ce(this,_a,Ui).call(this,du(t))}writeUpdatableValue(){const t=y(this,pn).length;return y(this,pn).push(vl),I(this,Fr,y(this,Fr)+Yt),n=>{y(this,pn)[t]=du(n)}}}pn=new WeakMap,Fr=new WeakMap,_a=new WeakSet,Ui=function(t){return y(this,pn).push(t),I(this,Fr,y(this,Fr)+t.length),t.length};var Lt,us,Rr,Br,Hn,Dr,Al,hm;const zd=class zd{constructor(t,n,r){me(this,Dr);ie(this,"allowLoose");me(this,Lt);me(this,us);me(this,Rr);me(this,Br);me(this,Hn);$e(this,{allowLoose:!!n}),I(this,Lt,Kt(t)),I(this,Rr,0),I(this,Br,null),I(this,Hn,r??1024),I(this,us,0)}get data(){return Se(y(this,Lt))}get dataLength(){return y(this,Lt).length}get consumed(){return y(this,us)}get bytes(){return new Uint8Array(y(this,Lt))}subReader(t){const n=new zd(y(this,Lt).slice(y(this,us)+t),this.allowLoose,y(this,Hn));return I(n,Br,this),n}readBytes(t,n){let r=Ce(this,Dr,hm).call(this,0,t,!!n);return Ce(this,Dr,Al).call(this,t),I(this,us,y(this,us)+r.length),r.slice(0,t)}readValue(){return Ac(this.readBytes(Yt))}readIndex(){return mx(this.readBytes(Yt))}};Lt=new WeakMap,us=new WeakMap,Rr=new WeakMap,Br=new WeakMap,Hn=new WeakMap,Dr=new WeakSet,Al=function(t){var n;if(y(this,Br))return Ce(n=y(this,Br),Dr,Al).call(n,t);I(this,Rr,y(this,Rr)+t),we(y(this,Hn)<1||y(this,Rr)<=y(this,Hn)*this.dataLength,`compressed ABI data exceeds inflation ratio of ${y(this,Hn)} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:Kt(y(this,Lt)),offset:y(this,us),length:t,info:{bytesRead:y(this,Rr),dataLength:this.dataLength}})},hm=function(t,n,r){let a=Math.ceil(n/Yt)*Yt;return y(this,us)+a>y(this,Lt).length&&(this.allowLoose&&r&&y(this,us)+n<=y(this,Lt).length?a=n:we(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:Kt(y(this,Lt)),length:y(this,Lt).length,offset:y(this,us)+a})),y(this,Lt).slice(y(this,us),y(this,us)+a)};let kl=zd;function Qr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function hd(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function fm(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Qr(e.outputLen),Qr(e.blockLen)}function No(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function pm(e,t){hd(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Zc=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const gm=e=>e instanceof Uint8Array,_x=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),$i=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Vs=(e,t)=>e<<32-t|e>>>t,Ix=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ix)throw new Error("Non little-endian hardware is not supported");const Ux=async()=>{};async function b6(e,t,n){let r=Date.now();for(let a=0;a<e;a++){n(a);const o=Date.now()-r;o>=0&&o<t||(await Ux(),r+=o)}}function $x(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function wo(e){if(typeof e=="string"&&(e=$x(e)),!gm(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Vx(...e){const t=new Uint8Array(e.reduce((r,a)=>r+a.length,0));let n=0;return e.forEach(r=>{if(!gm(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}class fd{clone(){return this._cloneInto()}}const Gx={}.toString;function Hx(e,t){if(t!==void 0&&Gx.call(t)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(e,t)}function pd(e){const t=r=>e().update(wo(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function zx(e=32){if(Zc&&typeof Zc.getRandomValues=="function")return Zc.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}class xm extends fd{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,fm(t);const r=wo(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const a=this.blockLen,o=new Uint8Array(a);o.set(r.length>a?t.create().update(r).digest():r);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=t.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),o.fill(0)}update(t){return No(this),this.iHash.update(t),this}digestInto(t){No(this),hd(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:a,destroyed:o,blockLen:i,outputLen:c}=this;return t=t,t.finished=a,t.destroyed=o,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Tc=(e,t,n)=>new xm(e,t).update(n).digest();Tc.create=(e,t)=>new xm(e,t);function qx(e,t,n,r){fm(e);const a=Hx({dkLen:32,asyncTick:10},r),{c:o,dkLen:i,asyncTick:c}=a;if(Qr(o),Qr(i),Qr(c),o<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const l=wo(t),u=wo(n),d=new Uint8Array(i),m=Tc.create(e,l),f=m._cloneInto().update(u);return{c:o,dkLen:i,asyncTick:c,DK:d,PRF:m,PRFSalt:f}}function Qx(e,t,n,r,a){return e.destroy(),t.destroy(),r&&r.destroy(),a.fill(0),n}function Wx(e,t,n,r){const{c:a,dkLen:o,DK:i,PRF:c,PRFSalt:l}=qx(e,t,n,r);let u;const d=new Uint8Array(4),m=$i(d),f=new Uint8Array(c.outputLen);for(let g=1,N=0;N<o;g++,N+=c.outputLen){const h=i.subarray(N,N+c.outputLen);m.setInt32(0,g,!1),(u=l._cloneInto(u)).update(d).digestInto(f),h.set(f.subarray(0,h.length));for(let C=1;C<a;C++){c._cloneInto(u).update(f).digestInto(f);for(let w=0;w<h.length;w++)h[w]^=f[w]}}return Qx(c,l,i,u,f)}function Jx(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const a=BigInt(32),o=BigInt(4294967295),i=Number(n>>a&o),c=Number(n&o),l=r?4:0,u=r?0:4;e.setUint32(t+l,i,r),e.setUint32(t+u,c,r)}class bm extends fd{constructor(t,n,r,a){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=$i(this.buffer)}update(t){No(this);const{view:n,buffer:r,blockLen:a}=this;t=wo(t);const o=t.length;for(let i=0;i<o;){const c=Math.min(a-this.pos,o-i);if(c===a){const l=$i(t);for(;a<=o-i;i+=a)this.process(l,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===a&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){No(this),pm(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:a,isLE:o}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>a-i&&(this.process(r,0),i=0);for(let m=i;m<a;m++)n[m]=0;Jx(r,a-8,BigInt(this.length*8),o),this.process(r,0);const c=$i(t),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=l/4,d=this.get();if(u>d.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<u;m++)c.setUint32(4*m,d[m],o)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:a,finished:o,destroyed:i,pos:c}=this;return t.length=a,t.pos=c,t.finished=o,t.destroyed=i,a%n&&t.buffer.set(r),t}}const Kx=(e,t,n)=>e&t^~e&n,Yx=(e,t,n)=>e&t^e&n^t&n,Zx=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Pn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Mn=new Uint32Array(64);class Xx extends bm{constructor(){super(64,32,8,!1),this.A=Pn[0]|0,this.B=Pn[1]|0,this.C=Pn[2]|0,this.D=Pn[3]|0,this.E=Pn[4]|0,this.F=Pn[5]|0,this.G=Pn[6]|0,this.H=Pn[7]|0}get(){const{A:t,B:n,C:r,D:a,E:o,F:i,G:c,H:l}=this;return[t,n,r,a,o,i,c,l]}set(t,n,r,a,o,i,c,l){this.A=t|0,this.B=n|0,this.C=r|0,this.D=a|0,this.E=o|0,this.F=i|0,this.G=c|0,this.H=l|0}process(t,n){for(let m=0;m<16;m++,n+=4)Mn[m]=t.getUint32(n,!1);for(let m=16;m<64;m++){const f=Mn[m-15],g=Mn[m-2],N=Vs(f,7)^Vs(f,18)^f>>>3,h=Vs(g,17)^Vs(g,19)^g>>>10;Mn[m]=h+Mn[m-7]+N+Mn[m-16]|0}let{A:r,B:a,C:o,D:i,E:c,F:l,G:u,H:d}=this;for(let m=0;m<64;m++){const f=Vs(c,6)^Vs(c,11)^Vs(c,25),g=d+f+Kx(c,l,u)+Zx[m]+Mn[m]|0,h=(Vs(r,2)^Vs(r,13)^Vs(r,22))+Yx(r,a,o)|0;d=u,u=l,l=c,c=i+g|0,i=o,o=a,a=r,r=g+h|0}r=r+this.A|0,a=a+this.B|0,o=o+this.C|0,i=i+this.D|0,c=c+this.E|0,l=l+this.F|0,u=u+this.G|0,d=d+this.H|0,this.set(r,a,o,i,c,l,u,d)}roundClean(){Mn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Ec=pd(()=>new Xx),Bi=BigInt(2**32-1),Tl=BigInt(32);function ym(e,t=!1){return t?{h:Number(e&Bi),l:Number(e>>Tl&Bi)}:{h:Number(e>>Tl&Bi)|0,l:Number(e&Bi)|0}}function Nm(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let a=0;a<e.length;a++){const{h:o,l:i}=ym(e[a],t);[n[a],r[a]]=[o,i]}return[n,r]}const Lx=(e,t)=>BigInt(e>>>0)<<Tl|BigInt(t>>>0),Dx=(e,t,n)=>e>>>n,eb=(e,t,n)=>e<<32-n|t>>>n,tb=(e,t,n)=>e>>>n|t<<32-n,sb=(e,t,n)=>e<<32-n|t>>>n,nb=(e,t,n)=>e<<64-n|t>>>n-32,rb=(e,t,n)=>e>>>n-32|t<<64-n,ab=(e,t)=>t,ob=(e,t)=>e,wm=(e,t,n)=>e<<n|t>>>32-n,vm=(e,t,n)=>t<<n|e>>>32-n,jm=(e,t,n)=>t<<n-32|e>>>64-n,Cm=(e,t,n)=>e<<n-32|t>>>64-n;function ib(e,t,n,r){const a=(t>>>0)+(r>>>0);return{h:e+n+(a/2**32|0)|0,l:a|0}}const cb=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),lb=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,db=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),ub=(e,t,n,r,a)=>t+n+r+a+(e/2**32|0)|0,mb=(e,t,n,r,a)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(a>>>0),hb=(e,t,n,r,a,o)=>t+n+r+a+o+(e/2**32|0)|0,Ke={fromBig:ym,split:Nm,toBig:Lx,shrSH:Dx,shrSL:eb,rotrSH:tb,rotrSL:sb,rotrBH:nb,rotrBL:rb,rotr32H:ab,rotr32L:ob,rotlSH:wm,rotlSL:vm,rotlBH:jm,rotlBL:Cm,add:ib,add3L:cb,add3H:lb,add4L:db,add4H:ub,add5H:hb,add5L:mb},[fb,pb]=Ke.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),On=new Uint32Array(80),_n=new Uint32Array(80);class gb extends bm{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:n,Bh:r,Bl:a,Ch:o,Cl:i,Dh:c,Dl:l,Eh:u,El:d,Fh:m,Fl:f,Gh:g,Gl:N,Hh:h,Hl:C}=this;return[t,n,r,a,o,i,c,l,u,d,m,f,g,N,h,C]}set(t,n,r,a,o,i,c,l,u,d,m,f,g,N,h,C){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=a|0,this.Ch=o|0,this.Cl=i|0,this.Dh=c|0,this.Dl=l|0,this.Eh=u|0,this.El=d|0,this.Fh=m|0,this.Fl=f|0,this.Gh=g|0,this.Gl=N|0,this.Hh=h|0,this.Hl=C|0}process(t,n){for(let j=0;j<16;j++,n+=4)On[j]=t.getUint32(n),_n[j]=t.getUint32(n+=4);for(let j=16;j<80;j++){const Q=On[j-15]|0,F=_n[j-15]|0,_=Ke.rotrSH(Q,F,1)^Ke.rotrSH(Q,F,8)^Ke.shrSH(Q,F,7),M=Ke.rotrSL(Q,F,1)^Ke.rotrSL(Q,F,8)^Ke.shrSL(Q,F,7),k=On[j-2]|0,K=_n[j-2]|0,V=Ke.rotrSH(k,K,19)^Ke.rotrBH(k,K,61)^Ke.shrSH(k,K,6),T=Ke.rotrSL(k,K,19)^Ke.rotrBL(k,K,61)^Ke.shrSL(k,K,6),ee=Ke.add4L(M,T,_n[j-7],_n[j-16]),J=Ke.add4H(ee,_,V,On[j-7],On[j-16]);On[j]=J|0,_n[j]=ee|0}let{Ah:r,Al:a,Bh:o,Bl:i,Ch:c,Cl:l,Dh:u,Dl:d,Eh:m,El:f,Fh:g,Fl:N,Gh:h,Gl:C,Hh:w,Hl:B}=this;for(let j=0;j<80;j++){const Q=Ke.rotrSH(m,f,14)^Ke.rotrSH(m,f,18)^Ke.rotrBH(m,f,41),F=Ke.rotrSL(m,f,14)^Ke.rotrSL(m,f,18)^Ke.rotrBL(m,f,41),_=m&g^~m&h,M=f&N^~f&C,k=Ke.add5L(B,F,M,pb[j],_n[j]),K=Ke.add5H(k,w,Q,_,fb[j],On[j]),V=k|0,T=Ke.rotrSH(r,a,28)^Ke.rotrBH(r,a,34)^Ke.rotrBH(r,a,39),ee=Ke.rotrSL(r,a,28)^Ke.rotrBL(r,a,34)^Ke.rotrBL(r,a,39),J=r&o^r&c^o&c,pe=a&i^a&l^i&l;w=h|0,B=C|0,h=g|0,C=N|0,g=m|0,N=f|0,{h:m,l:f}=Ke.add(u|0,d|0,K|0,V|0),u=c|0,d=l|0,c=o|0,l=i|0,o=r|0,i=a|0;const E=Ke.add3L(V,ee,pe);r=Ke.add3H(E,K,T,J),a=E|0}({h:r,l:a}=Ke.add(this.Ah|0,this.Al|0,r|0,a|0)),{h:o,l:i}=Ke.add(this.Bh|0,this.Bl|0,o|0,i|0),{h:c,l}=Ke.add(this.Ch|0,this.Cl|0,c|0,l|0),{h:u,l:d}=Ke.add(this.Dh|0,this.Dl|0,u|0,d|0),{h:m,l:f}=Ke.add(this.Eh|0,this.El|0,m|0,f|0),{h:g,l:N}=Ke.add(this.Fh|0,this.Fl|0,g|0,N|0),{h,l:C}=Ke.add(this.Gh|0,this.Gl|0,h|0,C|0),{h:w,l:B}=Ke.add(this.Hh|0,this.Hl|0,w|0,B|0),this.set(r,a,o,i,c,l,u,d,m,f,g,N,h,C,w,B)}roundClean(){On.fill(0),_n.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const gd=pd(()=>new gb);function xb(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("unable to locate global object")}const uu=xb(),mu=uu.crypto||uu.msCrypto;function km(e){switch(e){case"sha256":return Ec.create();case"sha512":return gd.create()}D(!1,"invalid hashing algorithm name","algorithm",e)}function y6(e,t){const n={sha256:Ec,sha512:gd}[e];return D(n!=null,"invalid hmac algorithm","algorithm",e),Tc.create(n,t)}function N6(e,t,n,r,a){const o={sha256:Ec,sha512:gd}[a];return D(o!=null,"invalid pbkdf2 algorithm","algorithm",a),Wx(o,e,t,{c:n,dkLen:r})}function w6(e){we(mu!=null,"platform does not support secure random numbers","UNSUPPORTED_OPERATION",{operation:"randomBytes"}),D(Number.isInteger(e)&&e>0&&e<=1024,"invalid length","length",e);const t=new Uint8Array(e);return mu.getRandomValues(t),t}const[Am,Tm,Em]=[[],[],[]],bb=BigInt(0),$o=BigInt(1),yb=BigInt(2),Nb=BigInt(7),wb=BigInt(256),vb=BigInt(113);for(let e=0,t=$o,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],Am.push(2*(5*r+n)),Tm.push((e+1)*(e+2)/2%64);let a=bb;for(let o=0;o<7;o++)t=(t<<$o^(t>>Nb)*vb)%wb,t&yb&&(a^=$o<<($o<<BigInt(o))-$o);Em.push(a)}const[jb,Cb]=Nm(Em,!0),hu=(e,t,n)=>n>32?jm(e,t,n):wm(e,t,n),fu=(e,t,n)=>n>32?Cm(e,t,n):vm(e,t,n);function kb(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let i=0;i<10;i++)n[i]=e[i]^e[i+10]^e[i+20]^e[i+30]^e[i+40];for(let i=0;i<10;i+=2){const c=(i+8)%10,l=(i+2)%10,u=n[l],d=n[l+1],m=hu(u,d,1)^n[c],f=fu(u,d,1)^n[c+1];for(let g=0;g<50;g+=10)e[i+g]^=m,e[i+g+1]^=f}let a=e[2],o=e[3];for(let i=0;i<24;i++){const c=Tm[i],l=hu(a,o,c),u=fu(a,o,c),d=Am[i];a=e[d],o=e[d+1],e[d]=l,e[d+1]=u}for(let i=0;i<50;i+=10){for(let c=0;c<10;c++)n[c]=e[i+c];for(let c=0;c<10;c++)e[i+c]^=~n[(c+2)%10]&n[(c+4)%10]}e[0]^=jb[r],e[1]^=Cb[r]}n.fill(0)}class xd extends fd{constructor(t,n,r,a=!1,o=24){if(super(),this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=a,this.rounds=o,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Qr(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=_x(this.state)}keccak(){kb(this.state32,this.rounds),this.posOut=0,this.pos=0}update(t){No(this);const{blockLen:n,state:r}=this;t=wo(t);const a=t.length;for(let o=0;o<a;){const i=Math.min(n-this.pos,a-o);for(let c=0;c<i;c++)r[this.pos++]^=t[o++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:a}=this;t[r]^=n,(n&128)!==0&&r===a-1&&this.keccak(),t[a-1]^=128,this.keccak()}writeInto(t){No(this,!1),hd(t),this.finish();const n=this.state,{blockLen:r}=this;for(let a=0,o=t.length;a<o;){this.posOut>=r&&this.keccak();const i=Math.min(r-this.posOut,o-a);t.set(n.subarray(this.posOut,this.posOut+i),a),this.posOut+=i,a+=i}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Qr(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(pm(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:a,rounds:o,enableXOF:i}=this;return t||(t=new xd(n,r,a,i,o)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=o,t.suffix=r,t.outputLen=a,t.enableXOF=i,t.destroyed=this.destroyed,t}}const Ab=(e,t,n)=>pd(()=>new xd(t,e,n)),Tb=Ab(1,136,256/8);let Sm=!1;const Fm=function(e){return Tb(e)};let Rm=Fm;function kt(e){const t=We(e,"data");return Se(Rm(t))}kt._=Fm;kt.lock=function(){Sm=!0};kt.register=function(e){if(Sm)throw new TypeError("keccak256 is locked");Rm=e};Object.freeze(kt);const Bm=function(e){return km("sha256").update(e).digest()},Pm=function(e){return km("sha512").update(e).digest()};let Mm=Bm,Om=Pm,_m=!1,Im=!1;function Bo(e){const t=We(e,"data");return Se(Mm(t))}Bo._=Bm;Bo.lock=function(){_m=!0};Bo.register=function(e){if(_m)throw new Error("sha256 is locked");Mm=e};Object.freeze(Bo);function bd(e){const t=We(e,"data");return Se(Om(t))}bd._=Pm;bd.lock=function(){Im=!0};bd.register=function(e){if(Im)throw new Error("sha512 is locked");Om=e};Object.freeze(Bo);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Um=BigInt(0),Sc=BigInt(1),Eb=BigInt(2),Fc=e=>e instanceof Uint8Array,Sb=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function vo(e){if(!Fc(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Sb[e[n]];return t}function $m(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function yd(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function jo(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const a=r*2,o=e.slice(a,a+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function Wr(e){return yd(vo(e))}function Nd(e){if(!Fc(e))throw new Error("Uint8Array expected");return yd(vo(Uint8Array.from(e).reverse()))}function Co(e,t){return jo(e.toString(16).padStart(t*2,"0"))}function wd(e,t){return Co(e,t).reverse()}function Fb(e){return jo($m(e))}function As(e,t,n){let r;if(typeof t=="string")try{r=jo(t)}catch(o){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${o}`)}else if(Fc(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const a=r.length;if(typeof n=="number"&&a!==n)throw new Error(`${e} expected ${n} bytes, got ${a}`);return r}function Xo(...e){const t=new Uint8Array(e.reduce((r,a)=>r+a.length,0));let n=0;return e.forEach(r=>{if(!Fc(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function Rb(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Bb(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Pb(e){let t;for(t=0;e>Um;e>>=Sc,t+=1);return t}function Mb(e,t){return e>>BigInt(t)&Sc}const Ob=(e,t,n)=>e|(n?Sc:Um)<<BigInt(t),vd=e=>(Eb<<BigInt(e-1))-Sc,Xc=e=>new Uint8Array(e),pu=e=>Uint8Array.from(e);function Vm(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Xc(e),a=Xc(e),o=0;const i=()=>{r.fill(1),a.fill(0),o=0},c=(...m)=>n(a,r,...m),l=(m=Xc())=>{a=c(pu([0]),m),r=c(),m.length!==0&&(a=c(pu([1]),m),r=c())},u=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let m=0;const f=[];for(;m<t;){r=c();const g=r.slice();f.push(g),m+=r.length}return Xo(...f)};return(m,f)=>{i(),l(m);let g;for(;!(g=f(u()));)l();return i(),g}}const _b={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function vi(e,t,n={}){const r=(a,o,i)=>{const c=_b[o];if(typeof c!="function")throw new Error(`Invalid validator "${o}", expected function`);const l=e[a];if(!(i&&l===void 0)&&!c(l,e))throw new Error(`Invalid param ${String(a)}=${l} (${typeof l}), expected ${o}`)};for(const[a,o]of Object.entries(t))r(a,o,!1);for(const[a,o]of Object.entries(n))r(a,o,!0);return e}const Ib=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Mb,bitLen:Pb,bitMask:vd,bitSet:Ob,bytesToHex:vo,bytesToNumberBE:Wr,bytesToNumberLE:Nd,concatBytes:Xo,createHmacDrbg:Vm,ensureBytes:As,equalBytes:Rb,hexToBytes:jo,hexToNumber:yd,numberToBytesBE:Co,numberToBytesLE:wd,numberToHexUnpadded:$m,numberToVarBytesBE:Fb,utf8ToBytes:Bb,validateObject:vi},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Mt=BigInt(0),Ct=BigInt(1),gr=BigInt(2),Ub=BigInt(3),El=BigInt(4),gu=BigInt(5),xu=BigInt(8);BigInt(9);BigInt(16);function es(e,t){const n=e%t;return n>=Mt?n:t+n}function $b(e,t,n){if(n<=Mt||t<Mt)throw new Error("Expected power/modulo > 0");if(n===Ct)return Mt;let r=Ct;for(;t>Mt;)t&Ct&&(r=r*e%n),e=e*e%n,t>>=Ct;return r}function hs(e,t,n){let r=e;for(;t-- >Mt;)r*=r,r%=n;return r}function Sl(e,t){if(e===Mt||t<=Mt)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=es(e,t),r=t,a=Mt,o=Ct;for(;n!==Mt;){const c=r/n,l=r%n,u=a-o*c;r=n,n=l,a=o,o=u}if(r!==Ct)throw new Error("invert: does not exist");return es(a,t)}function Vb(e){const t=(e-Ct)/gr;let n,r,a;for(n=e-Ct,r=0;n%gr===Mt;n/=gr,r++);for(a=gr;a<e&&$b(a,t,e)!==e-Ct;a++);if(r===1){const i=(e+Ct)/El;return function(l,u){const d=l.pow(u,i);if(!l.eql(l.sqr(d),u))throw new Error("Cannot find square root");return d}}const o=(n+Ct)/gr;return function(c,l){if(c.pow(l,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=r,d=c.pow(c.mul(c.ONE,a),n),m=c.pow(l,o),f=c.pow(l,n);for(;!c.eql(f,c.ONE);){if(c.eql(f,c.ZERO))return c.ZERO;let g=1;for(let h=c.sqr(f);g<u&&!c.eql(h,c.ONE);g++)h=c.sqr(h);const N=c.pow(d,Ct<<BigInt(u-g-1));d=c.sqr(N),m=c.mul(m,N),f=c.mul(f,d),u=g}return m}}function Gb(e){if(e%El===Ub){const t=(e+Ct)/El;return function(r,a){const o=r.pow(a,t);if(!r.eql(r.sqr(o),a))throw new Error("Cannot find square root");return o}}if(e%xu===gu){const t=(e-gu)/xu;return function(r,a){const o=r.mul(a,gr),i=r.pow(o,t),c=r.mul(a,i),l=r.mul(r.mul(c,gr),i),u=r.mul(c,r.sub(l,r.ONE));if(!r.eql(r.sqr(u),a))throw new Error("Cannot find square root");return u}}return Vb(e)}const Hb=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function zb(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Hb.reduce((r,a)=>(r[a]="function",r),t);return vi(e,n)}function qb(e,t,n){if(n<Mt)throw new Error("Expected power > 0");if(n===Mt)return e.ONE;if(n===Ct)return t;let r=e.ONE,a=t;for(;n>Mt;)n&Ct&&(r=e.mul(r,a)),a=e.sqr(a),n>>=Ct;return r}function Qb(e,t){const n=new Array(t.length),r=t.reduce((o,i,c)=>e.is0(i)?o:(n[c]=o,e.mul(o,i)),e.ONE),a=e.inv(r);return t.reduceRight((o,i,c)=>e.is0(i)?o:(n[c]=e.mul(o,n[c]),e.mul(o,i)),a),n}function Gm(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Wb(e,t,n=!1,r={}){if(e<=Mt)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:a,nByteLength:o}=Gm(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=Gb(e),c=Object.freeze({ORDER:e,BITS:a,BYTES:o,MASK:vd(a),ZERO:Mt,ONE:Ct,create:l=>es(l,e),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return Mt<=l&&l<e},is0:l=>l===Mt,isOdd:l=>(l&Ct)===Ct,neg:l=>es(-l,e),eql:(l,u)=>l===u,sqr:l=>es(l*l,e),add:(l,u)=>es(l+u,e),sub:(l,u)=>es(l-u,e),mul:(l,u)=>es(l*u,e),pow:(l,u)=>qb(c,l,u),div:(l,u)=>es(l*Sl(u,e),e),sqrN:l=>l*l,addN:(l,u)=>l+u,subN:(l,u)=>l-u,mulN:(l,u)=>l*u,inv:l=>Sl(l,e),sqrt:r.sqrt||(l=>i(c,l)),invertBatch:l=>Qb(c,l),cmov:(l,u,d)=>d?u:l,toBytes:l=>n?wd(l,o):Co(l,o),fromBytes:l=>{if(l.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${l.length}`);return n?Nd(l):Wr(l)}});return Object.freeze(c)}function Hm(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function zm(e){const t=Hm(e);return t+Math.ceil(t/2)}function Jb(e,t,n=!1){const r=e.length,a=Hm(t),o=zm(t);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const i=n?Wr(e):Nd(e),c=es(i,t-Ct)+Ct;return n?wd(c,a):Co(c,a)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Kb=BigInt(0),Lc=BigInt(1);function Yb(e,t){const n=(a,o)=>{const i=o.negate();return a?i:o},r=a=>{const o=Math.ceil(t/a)+1,i=2**(a-1);return{windows:o,windowSize:i}};return{constTimeNegate:n,unsafeLadder(a,o){let i=e.ZERO,c=a;for(;o>Kb;)o&Lc&&(i=i.add(c)),c=c.double(),o>>=Lc;return i},precomputeWindow(a,o){const{windows:i,windowSize:c}=r(o),l=[];let u=a,d=u;for(let m=0;m<i;m++){d=u,l.push(d);for(let f=1;f<c;f++)d=d.add(u),l.push(d);u=d.double()}return l},wNAF(a,o,i){const{windows:c,windowSize:l}=r(a);let u=e.ZERO,d=e.BASE;const m=BigInt(2**a-1),f=2**a,g=BigInt(a);for(let N=0;N<c;N++){const h=N*l;let C=Number(i&m);i>>=g,C>l&&(C-=f,i+=Lc);const w=h,B=h+Math.abs(C)-1,j=N%2!==0,Q=C<0;C===0?d=d.add(n(j,o[w])):u=u.add(n(Q,o[B]))}return{p:u,f:d}},wNAFCached(a,o,i,c){const l=a._WINDOW_SIZE||1;let u=o.get(a);return u||(u=this.precomputeWindow(a,l),l!==1&&o.set(a,c(u))),this.wNAF(l,u,i)}}}function qm(e){return zb(e.Fp),vi(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Gm(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Zb(e){const t=qm(e);vi(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a}=t;if(n){if(!r.eql(a,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:Xb,hexToBytes:Lb}=Ib,wr={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=wr;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Xb(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=wr,n=typeof e=="string"?Lb(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:a,l:o}=wr._parseInt(n.subarray(2)),{d:i,l:c}=wr._parseInt(o);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:a,s:i}},hexFromSig(e){const t=u=>Number.parseInt(u[0],16)&8?"00"+u:u,n=u=>{const d=u.toString(16);return d.length&1?`0${d}`:d},r=t(n(e.s)),a=t(n(e.r)),o=r.length/2,i=a.length/2,c=n(o),l=n(i);return`30${n(i+o+4)}02${l}${a}02${c}${r}`}},Cn=BigInt(0),Ns=BigInt(1);BigInt(2);const bu=BigInt(3);BigInt(4);function Db(e){const t=Zb(e),{Fp:n}=t,r=t.toBytes||((N,h,C)=>{const w=h.toAffine();return Xo(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),a=t.fromBytes||(N=>{const h=N.subarray(1),C=n.fromBytes(h.subarray(0,n.BYTES)),w=n.fromBytes(h.subarray(n.BYTES,2*n.BYTES));return{x:C,y:w}});function o(N){const{a:h,b:C}=t,w=n.sqr(N),B=n.mul(w,N);return n.add(n.add(B,n.mul(N,h)),C)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function i(N){return typeof N=="bigint"&&Cn<N&&N<t.n}function c(N){if(!i(N))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(N){const{allowedPrivateKeyLengths:h,nByteLength:C,wrapPrivateKey:w,n:B}=t;if(h&&typeof N!="bigint"){if(N instanceof Uint8Array&&(N=vo(N)),typeof N!="string"||!h.includes(N.length))throw new Error("Invalid key");N=N.padStart(C*2,"0")}let j;try{j=typeof N=="bigint"?N:Wr(As("private key",N,C))}catch{throw new Error(`private key must be ${C} bytes, hex or bigint, not ${typeof N}`)}return w&&(j=es(j,B)),c(j),j}const u=new Map;function d(N){if(!(N instanceof m))throw new Error("ProjectivePoint expected")}class m{constructor(h,C,w){if(this.px=h,this.py=C,this.pz=w,h==null||!n.isValid(h))throw new Error("x required");if(C==null||!n.isValid(C))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(h){const{x:C,y:w}=h||{};if(!h||!n.isValid(C)||!n.isValid(w))throw new Error("invalid affine point");if(h instanceof m)throw new Error("projective point not allowed");const B=j=>n.eql(j,n.ZERO);return B(C)&&B(w)?m.ZERO:new m(C,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){const C=n.invertBatch(h.map(w=>w.pz));return h.map((w,B)=>w.toAffine(C[B])).map(m.fromAffine)}static fromHex(h){const C=m.fromAffine(a(As("pointHex",h)));return C.assertValidity(),C}static fromPrivateKey(h){return m.BASE.multiply(l(h))}_setWindowSize(h){this._WINDOW_SIZE=h,u.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:h,y:C}=this.toAffine();if(!n.isValid(h)||!n.isValid(C))throw new Error("bad point: x or y not FE");const w=n.sqr(C),B=o(h);if(!n.eql(w,B))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:h}=this.toAffine();if(n.isOdd)return!n.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){d(h);const{px:C,py:w,pz:B}=this,{px:j,py:Q,pz:F}=h,_=n.eql(n.mul(C,F),n.mul(j,B)),M=n.eql(n.mul(w,F),n.mul(Q,B));return _&&M}negate(){return new m(this.px,n.neg(this.py),this.pz)}double(){const{a:h,b:C}=t,w=n.mul(C,bu),{px:B,py:j,pz:Q}=this;let F=n.ZERO,_=n.ZERO,M=n.ZERO,k=n.mul(B,B),K=n.mul(j,j),V=n.mul(Q,Q),T=n.mul(B,j);return T=n.add(T,T),M=n.mul(B,Q),M=n.add(M,M),F=n.mul(h,M),_=n.mul(w,V),_=n.add(F,_),F=n.sub(K,_),_=n.add(K,_),_=n.mul(F,_),F=n.mul(T,F),M=n.mul(w,M),V=n.mul(h,V),T=n.sub(k,V),T=n.mul(h,T),T=n.add(T,M),M=n.add(k,k),k=n.add(M,k),k=n.add(k,V),k=n.mul(k,T),_=n.add(_,k),V=n.mul(j,Q),V=n.add(V,V),k=n.mul(V,T),F=n.sub(F,k),M=n.mul(V,K),M=n.add(M,M),M=n.add(M,M),new m(F,_,M)}add(h){d(h);const{px:C,py:w,pz:B}=this,{px:j,py:Q,pz:F}=h;let _=n.ZERO,M=n.ZERO,k=n.ZERO;const K=t.a,V=n.mul(t.b,bu);let T=n.mul(C,j),ee=n.mul(w,Q),J=n.mul(B,F),pe=n.add(C,w),E=n.add(j,Q);pe=n.mul(pe,E),E=n.add(T,ee),pe=n.sub(pe,E),E=n.add(C,B);let b=n.add(j,F);return E=n.mul(E,b),b=n.add(T,J),E=n.sub(E,b),b=n.add(w,B),_=n.add(Q,F),b=n.mul(b,_),_=n.add(ee,J),b=n.sub(b,_),k=n.mul(K,E),_=n.mul(V,J),k=n.add(_,k),_=n.sub(ee,k),k=n.add(ee,k),M=n.mul(_,k),ee=n.add(T,T),ee=n.add(ee,T),J=n.mul(K,J),E=n.mul(V,E),ee=n.add(ee,J),J=n.sub(T,J),J=n.mul(K,J),E=n.add(E,J),T=n.mul(ee,E),M=n.add(M,T),T=n.mul(b,E),_=n.mul(pe,_),_=n.sub(_,T),T=n.mul(pe,ee),k=n.mul(b,k),k=n.add(k,T),new m(_,M,k)}subtract(h){return this.add(h.negate())}is0(){return this.equals(m.ZERO)}wNAF(h){return g.wNAFCached(this,u,h,C=>{const w=n.invertBatch(C.map(B=>B.pz));return C.map((B,j)=>B.toAffine(w[j])).map(m.fromAffine)})}multiplyUnsafe(h){const C=m.ZERO;if(h===Cn)return C;if(c(h),h===Ns)return this;const{endo:w}=t;if(!w)return g.unsafeLadder(this,h);let{k1neg:B,k1:j,k2neg:Q,k2:F}=w.splitScalar(h),_=C,M=C,k=this;for(;j>Cn||F>Cn;)j&Ns&&(_=_.add(k)),F&Ns&&(M=M.add(k)),k=k.double(),j>>=Ns,F>>=Ns;return B&&(_=_.negate()),Q&&(M=M.negate()),M=new m(n.mul(M.px,w.beta),M.py,M.pz),_.add(M)}multiply(h){c(h);let C=h,w,B;const{endo:j}=t;if(j){const{k1neg:Q,k1:F,k2neg:_,k2:M}=j.splitScalar(C);let{p:k,f:K}=this.wNAF(F),{p:V,f:T}=this.wNAF(M);k=g.constTimeNegate(Q,k),V=g.constTimeNegate(_,V),V=new m(n.mul(V.px,j.beta),V.py,V.pz),w=k.add(V),B=K.add(T)}else{const{p:Q,f:F}=this.wNAF(C);w=Q,B=F}return m.normalizeZ([w,B])[0]}multiplyAndAddUnsafe(h,C,w){const B=m.BASE,j=(F,_)=>_===Cn||_===Ns||!F.equals(B)?F.multiplyUnsafe(_):F.multiply(_),Q=j(this,C).add(j(h,w));return Q.is0()?void 0:Q}toAffine(h){const{px:C,py:w,pz:B}=this,j=this.is0();h==null&&(h=j?n.ONE:n.inv(B));const Q=n.mul(C,h),F=n.mul(w,h),_=n.mul(B,h);if(j)return{x:n.ZERO,y:n.ZERO};if(!n.eql(_,n.ONE))throw new Error("invZ was invalid");return{x:Q,y:F}}isTorsionFree(){const{h,isTorsionFree:C}=t;if(h===Ns)return!0;if(C)return C(m,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h,clearCofactor:C}=t;return h===Ns?this:C?C(m,this):this.multiplyUnsafe(t.h)}toRawBytes(h=!0){return this.assertValidity(),r(m,this,h)}toHex(h=!0){return vo(this.toRawBytes(h))}}m.BASE=new m(t.Gx,t.Gy,n.ONE),m.ZERO=new m(n.ZERO,n.ONE,n.ZERO);const f=t.nBitLength,g=Yb(m,t.endo?Math.ceil(f/2):f);return{CURVE:t,ProjectivePoint:m,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:i}}function ey(e){const t=qm(e);return vi(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function ty(e){const t=ey(e),{Fp:n,n:r}=t,a=n.BYTES+1,o=2*n.BYTES+1;function i(E){return Cn<E&&E<n.ORDER}function c(E){return es(E,r)}function l(E){return Sl(E,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:d,weierstrassEquation:m,isWithinCurveOrder:f}=Db({...t,toBytes(E,b,Y){const p=b.toAffine(),O=n.toBytes(p.x),R=Xo;return Y?R(Uint8Array.from([b.hasEvenY()?2:3]),O):R(Uint8Array.from([4]),O,n.toBytes(p.y))},fromBytes(E){const b=E.length,Y=E[0],p=E.subarray(1);if(b===a&&(Y===2||Y===3)){const O=Wr(p);if(!i(O))throw new Error("Point is not on curve");const R=m(O);let q=n.sqrt(R);const v=(q&Ns)===Ns;return(Y&1)===1!==v&&(q=n.neg(q)),{x:O,y:q}}else if(b===o&&Y===4){const O=n.fromBytes(p.subarray(0,n.BYTES)),R=n.fromBytes(p.subarray(n.BYTES,2*n.BYTES));return{x:O,y:R}}else throw new Error(`Point of length ${b} was invalid. Expected ${a} compressed bytes or ${o} uncompressed bytes`)}}),g=E=>vo(Co(E,t.nByteLength));function N(E){const b=r>>Ns;return E>b}function h(E){return N(E)?c(-E):E}const C=(E,b,Y)=>Wr(E.slice(b,Y));class w{constructor(b,Y,p){this.r=b,this.s=Y,this.recovery=p,this.assertValidity()}static fromCompact(b){const Y=t.nByteLength;return b=As("compactSignature",b,Y*2),new w(C(b,0,Y),C(b,Y,2*Y))}static fromDER(b){const{r:Y,s:p}=wr.toSig(As("DER",b));return new w(Y,p)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(b){return new w(this.r,this.s,b)}recoverPublicKey(b){const{r:Y,s:p,recovery:O}=this,R=M(As("msgHash",b));if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");const q=O===2||O===3?Y+t.n:Y;if(q>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const v=(O&1)===0?"02":"03",U=u.fromHex(v+g(q)),S=l(q),H=c(-R*S),he=c(p*S),$=u.BASE.multiplyAndAddUnsafe(U,H,he);if(!$)throw new Error("point at infinify");return $.assertValidity(),$}hasHighS(){return N(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return jo(this.toDERHex())}toDERHex(){return wr.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return jo(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}const B={isValidPrivateKey(E){try{return d(E),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const E=zm(t.n);return Jb(t.randomBytes(E),t.n)},precompute(E=8,b=u.BASE){return b._setWindowSize(E),b.multiply(BigInt(3)),b}};function j(E,b=!0){return u.fromPrivateKey(E).toRawBytes(b)}function Q(E){const b=E instanceof Uint8Array,Y=typeof E=="string",p=(b||Y)&&E.length;return b?p===a||p===o:Y?p===2*a||p===2*o:E instanceof u}function F(E,b,Y=!0){if(Q(E))throw new Error("first arg must be private key");if(!Q(b))throw new Error("second arg must be public key");return u.fromHex(b).multiply(d(E)).toRawBytes(Y)}const _=t.bits2int||function(E){const b=Wr(E),Y=E.length*8-t.nBitLength;return Y>0?b>>BigInt(Y):b},M=t.bits2int_modN||function(E){return c(_(E))},k=vd(t.nBitLength);function K(E){if(typeof E!="bigint")throw new Error("bigint expected");if(!(Cn<=E&&E<k))throw new Error(`bigint expected < 2^${t.nBitLength}`);return Co(E,t.nByteLength)}function V(E,b,Y=T){if(["recovered","canonical"].some(le=>le in Y))throw new Error("sign() legacy options not supported");const{hash:p,randomBytes:O}=t;let{lowS:R,prehash:q,extraEntropy:v}=Y;R==null&&(R=!0),E=As("msgHash",E),q&&(E=As("prehashed msgHash",p(E)));const U=M(E),S=d(b),H=[K(S),K(U)];if(v!=null){const le=v===!0?O(n.BYTES):v;H.push(As("extraEntropy",le))}const he=Xo(...H),$=U;function W(le){const ce=_(le);if(!f(ce))return;const L=l(ce),ue=u.BASE.multiply(ce).toAffine(),re=c(ue.x);if(re===Cn)return;const se=c(L*c($+re*S));if(se===Cn)return;let Ne=(ue.x===re?0:2)|Number(ue.y&Ns),ge=se;return R&&N(se)&&(ge=h(se),Ne^=1),new w(re,ge,Ne)}return{seed:he,k2sig:W}}const T={lowS:t.lowS,prehash:!1},ee={lowS:t.lowS,prehash:!1};function J(E,b,Y=T){const{seed:p,k2sig:O}=V(E,b,Y),R=t;return Vm(R.hash.outputLen,R.nByteLength,R.hmac)(p,O)}u.BASE._setWindowSize(8);function pe(E,b,Y,p=ee){var ue;const O=E;if(b=As("msgHash",b),Y=As("publicKey",Y),"strict"in p)throw new Error("options.strict was renamed to lowS");const{lowS:R,prehash:q}=p;let v,U;try{if(typeof O=="string"||O instanceof Uint8Array)try{v=w.fromDER(O)}catch(re){if(!(re instanceof wr.Err))throw re;v=w.fromCompact(O)}else if(typeof O=="object"&&typeof O.r=="bigint"&&typeof O.s=="bigint"){const{r:re,s:se}=O;v=new w(re,se)}else throw new Error("PARSE");U=u.fromHex(Y)}catch(re){if(re.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(R&&v.hasHighS())return!1;q&&(b=t.hash(b));const{r:S,s:H}=v,he=M(b),$=l(H),W=c(he*$),le=c(S*$),ce=(ue=u.BASE.multiplyAndAddUnsafe(U,W,le))==null?void 0:ue.toAffine();return ce?c(ce.x)===S:!1}return{CURVE:t,getPublicKey:j,getSharedSecret:F,sign:J,verify:pe,ProjectivePoint:u,Signature:w,utils:B}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function sy(e){return{hash:e,hmac:(t,...n)=>Tc(e,t,Vx(...n)),randomBytes:zx}}function ny(e,t){const n=r=>ty({...e,...sy(r)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Qm=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),yu=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),ry=BigInt(1),Fl=BigInt(2),Nu=(e,t)=>(e+t/Fl)/t;function ay(e){const t=Qm,n=BigInt(3),r=BigInt(6),a=BigInt(11),o=BigInt(22),i=BigInt(23),c=BigInt(44),l=BigInt(88),u=e*e*e%t,d=u*u*e%t,m=hs(d,n,t)*d%t,f=hs(m,n,t)*d%t,g=hs(f,Fl,t)*u%t,N=hs(g,a,t)*g%t,h=hs(N,o,t)*N%t,C=hs(h,c,t)*h%t,w=hs(C,l,t)*C%t,B=hs(w,c,t)*h%t,j=hs(B,n,t)*d%t,Q=hs(j,i,t)*N%t,F=hs(Q,r,t)*u%t,_=hs(F,Fl,t);if(!Rl.eql(Rl.sqr(_),e))throw new Error("Cannot find square root");return _}const Rl=Wb(Qm,void 0,void 0,{sqrt:ay}),Un=ny({a:BigInt(0),b:BigInt(7),Fp:Rl,n:yu,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=yu,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-ry*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,i=BigInt("0x100000000000000000000000000000000"),c=Nu(o*e,t),l=Nu(-r*e,t);let u=es(e-c*n-l*a,t),d=es(-c*r-l*o,t);const m=u>i,f=d>i;if(m&&(u=t-u),f&&(d=t-d),u>i||d>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:m,k1:u,k2neg:f,k2:d}}}},Ec);BigInt(0);Un.ProjectivePoint;const ko="0x0000000000000000000000000000000000000000",wu="0x0000000000000000000000000000000000000000000000000000000000000000",vu=BigInt(0),ju=BigInt(1),Cu=BigInt(2),ku=BigInt(27),Au=BigInt(28),Pi=BigInt(35),ua={};function Tu(e){return En(St(e),32)}var Ia,zs,Ua,Pr;const ks=class ks{constructor(t,n,r,a){me(this,Ia);me(this,zs);me(this,Ua);me(this,Pr);Ni(t,ua,"Signature"),I(this,Ia,n),I(this,zs,r),I(this,Ua,a),I(this,Pr,null)}get r(){return y(this,Ia)}set r(t){D(Ca(t)===32,"invalid r","value",t),I(this,Ia,Se(t))}get s(){return D(parseInt(y(this,zs).substring(0,3))<8,"non-canonical s; use ._s","s",y(this,zs)),y(this,zs)}set s(t){D(Ca(t)===32,"invalid s","value",t),I(this,zs,Se(t))}get _s(){return y(this,zs)}isValid(){return parseInt(y(this,zs).substring(0,3))<8}get v(){return y(this,Ua)}set v(t){const n=Je(t,"value");D(n===27||n===28,"invalid v","v",t),I(this,Ua,n)}get networkV(){return y(this,Pr)}get legacyChainId(){const t=this.networkV;return t==null?null:ks.getChainId(t)}get yParity(){return this.v===27?0:1}get yParityAndS(){const t=We(this.s);return this.yParity&&(t[0]|=128),Se(t)}get compactSerialized(){return wt([this.r,this.yParityAndS])}get serialized(){return wt([this.r,this.s,this.yParity?"0x1c":"0x1b"])}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this._s}"${this.isValid()?"":', valid: "false"'}, yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){const t=new ks(ua,this.r,this._s,this.v);return this.networkV&&I(t,Pr,this.networkV),t}toJSON(){const t=this.networkV;return{_type:"signature",networkV:t!=null?t.toString():null,r:this.r,s:this._s,v:this.v}}static getChainId(t){const n=Be(t,"v");return n==ku||n==Au?vu:(D(n>=Pi,"invalid EIP-155 v","v",t),(n-Pi)/Cu)}static getChainIdV(t,n){return Be(t)*Cu+BigInt(35+n-27)}static getNormalizedV(t){const n=Be(t);return n===vu||n===ku?27:n===ju||n===Au?28:(D(n>=Pi,"invalid v","v",t),n&ju?27:28)}static from(t){function n(u,d){D(u,d,"signature",t)}if(t==null)return new ks(ua,wu,wu,27);if(typeof t=="string"){const u=We(t,"signature");if(u.length===64){const d=Se(u.slice(0,32)),m=u.slice(32,64),f=m[0]&128?28:27;return m[0]&=127,new ks(ua,d,Se(m),f)}if(u.length===65){const d=Se(u.slice(0,32)),m=Se(u.slice(32,64)),f=ks.getNormalizedV(u[64]);return new ks(ua,d,m,f)}n(!1,"invalid raw signature length")}if(t instanceof ks)return t.clone();const r=t.r;n(r!=null,"missing r");const a=Tu(r),o=(function(u,d){if(u!=null)return Tu(u);if(d!=null){n(dt(d,32),"invalid yParityAndS");const m=We(d);return m[0]&=127,Se(m)}n(!1,"missing s")})(t.s,t.yParityAndS),{networkV:i,v:c}=(function(u,d,m){if(u!=null){const f=Be(u);return{networkV:f>=Pi?f:void 0,v:ks.getNormalizedV(f)}}if(d!=null)return n(dt(d,32),"invalid yParityAndS"),{v:We(d)[0]&128?28:27};if(m!=null){switch(Je(m,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}n(!1,"invalid yParity")}n(!1,"missing v")})(t.v,t.yParityAndS,t.yParity),l=new ks(ua,a,o,c);return i&&I(l,Pr,i),n(t.yParity==null||Je(t.yParity,"sig.yParity")===l.yParity,"yParity mismatch"),n(t.yParityAndS==null||t.yParityAndS===l.yParityAndS,"yParityAndS mismatch"),l}};Ia=new WeakMap,zs=new WeakMap,Ua=new WeakMap,Pr=new WeakMap;let rs=ks;var gn;const xr=class xr{constructor(t){me(this,gn);D(Ca(t)===32,"invalid private key","privateKey","[REDACTED]"),I(this,gn,Se(t))}get privateKey(){return y(this,gn)}get publicKey(){return xr.computePublicKey(y(this,gn))}get compressedPublicKey(){return xr.computePublicKey(y(this,gn),!0)}sign(t){D(Ca(t)===32,"invalid digest length","digest",t);const n=Un.sign(Kt(t),Kt(y(this,gn)),{lowS:!0});return rs.from({r:rr(n.r,32),s:rr(n.s,32),v:n.recovery?28:27})}computeSharedSecret(t){const n=xr.computePublicKey(t);return Se(Un.getSharedSecret(Kt(y(this,gn)),We(n),!1))}static computePublicKey(t,n){let r=We(t,"key");if(r.length===32){const o=Un.getPublicKey(r,!!n);return Se(o)}if(r.length===64){const o=new Uint8Array(65);o[0]=4,o.set(r,1),r=o}const a=Un.ProjectivePoint.fromHex(r);return Se(a.toRawBytes(n))}static recoverPublicKey(t,n){D(Ca(t)===32,"invalid digest length","digest",t);const r=rs.from(n);let a=Un.Signature.fromCompact(Kt(wt([r.r,r.s])));a=a.addRecoveryBit(r.yParity);const o=a.recoverPublicKey(Kt(t));return D(o!=null,"invalid signature for digest","signature",n),"0x"+o.toHex(!1)}static addPoints(t,n,r){const a=Un.ProjectivePoint.fromHex(xr.computePublicKey(t).substring(2)),o=Un.ProjectivePoint.fromHex(xr.computePublicKey(n).substring(2));return"0x"+a.add(o).toHex(!!r)}};gn=new WeakMap;let Lo=xr;const oy=BigInt(0),iy=BigInt(36);function Eu(e){e=e.toLowerCase();const t=e.substring(2).split(""),n=new Uint8Array(40);for(let a=0;a<40;a++)n[a]=t[a].charCodeAt(0);const r=We(kt(n));for(let a=0;a<40;a+=2)r[a>>1]>>4>=8&&(t[a]=t[a].toUpperCase()),(r[a>>1]&15)>=8&&(t[a+1]=t[a+1].toUpperCase());return"0x"+t.join("")}const jd={};for(let e=0;e<10;e++)jd[String(e)]=String(e);for(let e=0;e<26;e++)jd[String.fromCharCode(65+e)]=String(10+e);const Su=15;function Wm(e){e=e.toUpperCase(),e=e.substring(4)+e.substring(0,2)+"00";let t=e.split("").map(r=>jd[r]).join("");for(;t.length>=Su;){let r=t.substring(0,Su);t=parseInt(r,10)%97+t.substring(r.length)}let n=String(98-parseInt(t,10)%97);for(;n.length<2;)n="0"+n;return n}const cy=(function(){const e={};for(let t=0;t<36;t++){const n="0123456789abcdefghijklmnopqrstuvwxyz"[t];e[n]=BigInt(t)}return e})();function ly(e){e=e.toLowerCase();let t=oy;for(let n=0;n<e.length;n++)t=t*iy+cy[e[n]];return t}function nt(e){if(D(typeof e=="string","invalid address","address",e),e.match(/^(0x)?[0-9a-fA-F]{40}$/)){e.startsWith("0x")||(e="0x"+e);const t=Eu(e);return D(!e.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||t===e,"bad address checksum","address",e),t}if(e.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){D(e.substring(2,4)===Wm(e),"bad icap checksum","address",e);let t=ly(e.substring(4)).toString(16);for(;t.length<40;)t="0"+t;return Eu("0x"+t)}D(!1,"invalid address","address",e)}function j6(e){let t=BigInt(nt(e)).toString(36).toUpperCase();for(;t.length<30;)t="0"+t;return"XE"+Wm("XE00"+t)+t}function dy(e){const t=nt(e.from);let r=Be(e.nonce,"tx.nonce").toString(16);return r==="0"?r="0x":r.length%2?r="0x0"+r:r="0x"+r,nt(yt(kt(ar([t,r])),12))}function C6(e,t,n){const r=nt(e),a=We(t,"salt"),o=We(n,"initCodeHash");return D(a.length===32,"salt must be 32 bytes","salt",t),D(o.length===32,"initCodeHash must be 32 bytes","initCodeHash",n),nt(yt(kt(wt(["0xff",r,a,o])),12))}function Jm(e){return e&&typeof e.getAddress=="function"}function k6(e){try{return nt(e),!0}catch{}return!1}async function Dc(e,t){const n=await t;return(n==null||n==="0x0000000000000000000000000000000000000000")&&(we(typeof e!="string","unconfigured name","UNCONFIGURED_NAME",{value:e}),D(!1,"invalid AddressLike value; did not resolve to a value address","target",e)),nt(n)}function Zt(e,t){if(typeof e=="string")return e.match(/^0x[0-9a-f]{40}$/i)?nt(e):(we(t!=null,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),Dc(e,t.resolveName(e)));if(Jm(e))return Dc(e,e.getAddress());if(e&&typeof e.then=="function")return Dc(e,e);D(!1,"unsupported addressable value","target",e)}const dn={};function Re(e,t){let n=!1;return t<0&&(n=!0,t*=-1),new qt(dn,`${n?"":"u"}int${t}`,e,{signed:n,width:t})}function at(e,t){return new qt(dn,`bytes${t||""}`,e,{size:t})}const Fu=Symbol.for("_ethers_typed");var Mr;const un=class un{constructor(t,n,r,a){ie(this,"type");ie(this,"value");me(this,Mr);ie(this,"_typedSymbol");a==null&&(a=null),Ni(dn,t,"Typed"),$e(this,{_typedSymbol:Fu,type:n,value:r}),I(this,Mr,a),this.format()}format(){if(this.type==="array")throw new Error("");if(this.type==="dynamicArray")throw new Error("");return this.type==="tuple"?`tuple(${this.value.map(t=>t.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return this.type==="string"}get tupleName(){if(this.type!=="tuple")throw TypeError("not a tuple");return y(this,Mr)}get arrayLength(){if(this.type!=="array")throw TypeError("not an array");return y(this,Mr)===!0?-1:y(this,Mr)===!1?this.value.length:null}static from(t,n){return new un(dn,t,n)}static uint8(t){return Re(t,8)}static uint16(t){return Re(t,16)}static uint24(t){return Re(t,24)}static uint32(t){return Re(t,32)}static uint40(t){return Re(t,40)}static uint48(t){return Re(t,48)}static uint56(t){return Re(t,56)}static uint64(t){return Re(t,64)}static uint72(t){return Re(t,72)}static uint80(t){return Re(t,80)}static uint88(t){return Re(t,88)}static uint96(t){return Re(t,96)}static uint104(t){return Re(t,104)}static uint112(t){return Re(t,112)}static uint120(t){return Re(t,120)}static uint128(t){return Re(t,128)}static uint136(t){return Re(t,136)}static uint144(t){return Re(t,144)}static uint152(t){return Re(t,152)}static uint160(t){return Re(t,160)}static uint168(t){return Re(t,168)}static uint176(t){return Re(t,176)}static uint184(t){return Re(t,184)}static uint192(t){return Re(t,192)}static uint200(t){return Re(t,200)}static uint208(t){return Re(t,208)}static uint216(t){return Re(t,216)}static uint224(t){return Re(t,224)}static uint232(t){return Re(t,232)}static uint240(t){return Re(t,240)}static uint248(t){return Re(t,248)}static uint256(t){return Re(t,256)}static uint(t){return Re(t,256)}static int8(t){return Re(t,-8)}static int16(t){return Re(t,-16)}static int24(t){return Re(t,-24)}static int32(t){return Re(t,-32)}static int40(t){return Re(t,-40)}static int48(t){return Re(t,-48)}static int56(t){return Re(t,-56)}static int64(t){return Re(t,-64)}static int72(t){return Re(t,-72)}static int80(t){return Re(t,-80)}static int88(t){return Re(t,-88)}static int96(t){return Re(t,-96)}static int104(t){return Re(t,-104)}static int112(t){return Re(t,-112)}static int120(t){return Re(t,-120)}static int128(t){return Re(t,-128)}static int136(t){return Re(t,-136)}static int144(t){return Re(t,-144)}static int152(t){return Re(t,-152)}static int160(t){return Re(t,-160)}static int168(t){return Re(t,-168)}static int176(t){return Re(t,-176)}static int184(t){return Re(t,-184)}static int192(t){return Re(t,-192)}static int200(t){return Re(t,-200)}static int208(t){return Re(t,-208)}static int216(t){return Re(t,-216)}static int224(t){return Re(t,-224)}static int232(t){return Re(t,-232)}static int240(t){return Re(t,-240)}static int248(t){return Re(t,-248)}static int256(t){return Re(t,-256)}static int(t){return Re(t,-256)}static bytes1(t){return at(t,1)}static bytes2(t){return at(t,2)}static bytes3(t){return at(t,3)}static bytes4(t){return at(t,4)}static bytes5(t){return at(t,5)}static bytes6(t){return at(t,6)}static bytes7(t){return at(t,7)}static bytes8(t){return at(t,8)}static bytes9(t){return at(t,9)}static bytes10(t){return at(t,10)}static bytes11(t){return at(t,11)}static bytes12(t){return at(t,12)}static bytes13(t){return at(t,13)}static bytes14(t){return at(t,14)}static bytes15(t){return at(t,15)}static bytes16(t){return at(t,16)}static bytes17(t){return at(t,17)}static bytes18(t){return at(t,18)}static bytes19(t){return at(t,19)}static bytes20(t){return at(t,20)}static bytes21(t){return at(t,21)}static bytes22(t){return at(t,22)}static bytes23(t){return at(t,23)}static bytes24(t){return at(t,24)}static bytes25(t){return at(t,25)}static bytes26(t){return at(t,26)}static bytes27(t){return at(t,27)}static bytes28(t){return at(t,28)}static bytes29(t){return at(t,29)}static bytes30(t){return at(t,30)}static bytes31(t){return at(t,31)}static bytes32(t){return at(t,32)}static address(t){return new un(dn,"address",t)}static bool(t){return new un(dn,"bool",!!t)}static bytes(t){return new un(dn,"bytes",t)}static string(t){return new un(dn,"string",t)}static array(t,n){throw new Error("not implemented yet")}static tuple(t,n){throw new Error("not implemented yet")}static overrides(t){return new un(dn,"overrides",Object.assign({},t))}static isTyped(t){return t&&typeof t=="object"&&"_typedSymbol"in t&&t._typedSymbol===Fu}static dereference(t,n){if(un.isTyped(t)){if(t.type!==n)throw new Error(`invalid type: expecetd ${n}, got ${t.type}`);return t.value}return t}};Mr=new WeakMap;let qt=un;class uy extends Rn{constructor(t){super("address","address",t,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(t,n){let r=qt.dereference(n,"string");try{r=nt(r)}catch(a){return this._throwError(a.message,n)}return t.writeValue(r)}decode(t){return nt(rr(t.readValue(),20))}}class my extends Rn{constructor(n){super(n.name,n.type,"_",n.dynamic);ie(this,"coder");this.coder=n}defaultValue(){return this.coder.defaultValue()}encode(n,r){return this.coder.encode(n,r)}decode(n){return this.coder.decode(n)}}function Km(e,t,n){let r=[];if(Array.isArray(n))r=n;else if(n&&typeof n=="object"){let l={};r=t.map(u=>{const d=u.localName;return we(d,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:u},value:n}),we(!l[d],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:u},value:n}),l[d]=!0,n[d]})}else D(!1,"invalid tuple value","tuple",n);D(t.length===r.length,"types/value length mismatch","tuple",n);let a=new Cl,o=new Cl,i=[];t.forEach((l,u)=>{let d=r[u];if(l.dynamic){let m=o.length;l.encode(o,d);let f=a.writeUpdatableValue();i.push(g=>{f(g+m)})}else l.encode(a,d)}),i.forEach(l=>{l(a.length)});let c=e.appendWriter(a);return c+=e.appendWriter(o),c}function Ym(e,t){let n=[],r=[],a=e.subReader(0);return t.forEach(o=>{let i=null;if(o.dynamic){let c=e.readIndex(),l=a.subReader(c);try{i=o.decode(l)}catch(u){if(Ut(u,"BUFFER_OVERRUN"))throw u;i=u,i.baseType=o.name,i.name=o.localName,i.type=o.type}}else try{i=o.decode(e)}catch(c){if(Ut(c,"BUFFER_OVERRUN"))throw c;i=c,i.baseType=o.name,i.name=o.localName,i.type=o.type}if(i==null)throw new Error("investigate");n.push(i),r.push(o.localName||null)}),yo.fromItems(n,r)}class hy extends Rn{constructor(n,r,a){const o=n.type+"["+(r>=0?r:"")+"]",i=r===-1||n.dynamic;super("array",o,a,i);ie(this,"coder");ie(this,"length");$e(this,{coder:n,length:r})}defaultValue(){const n=this.coder.defaultValue(),r=[];for(let a=0;a<this.length;a++)r.push(n);return r}encode(n,r){const a=qt.dereference(r,"array");Array.isArray(a)||this._throwError("expected array value",a);let o=this.length;o===-1&&(o=a.length,n.writeValue(a.length)),L0(a.length,o,"coder array"+(this.localName?" "+this.localName:""));let i=[];for(let c=0;c<a.length;c++)i.push(this.coder);return Km(n,i,a)}decode(n){let r=this.length;r===-1&&(r=n.readIndex(),we(r*Yt<=n.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:n.bytes,offset:r*Yt,length:n.dataLength}));let a=[];for(let o=0;o<r;o++)a.push(new my(this.coder));return Ym(n,a)}}class fy extends Rn{constructor(t){super("bool","bool",t,!1)}defaultValue(){return!1}encode(t,n){const r=qt.dereference(n,"bool");return t.writeValue(r?1:0)}decode(t){return!!t.readValue()}}class Zm extends Rn{constructor(t,n){super(t,t,n,!0)}defaultValue(){return"0x"}encode(t,n){n=Kt(n);let r=t.writeValue(n.length);return r+=t.writeBytes(n),r}decode(t){return t.readBytes(t.readIndex(),!0)}}class py extends Zm{constructor(t){super("bytes",t)}decode(t){return Se(super.decode(t))}}class gy extends Rn{constructor(n,r){let a="bytes"+String(n);super(a,a,r,!1);ie(this,"size");$e(this,{size:n},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(n,r){let a=Kt(qt.dereference(r,this.type));return a.length!==this.size&&this._throwError("incorrect data length",r),n.writeBytes(a)}decode(n){return Se(n.readBytes(this.size))}}const xy=new Uint8Array([]);class by extends Rn{constructor(t){super("null","",t,!1)}defaultValue(){return null}encode(t,n){return n!=null&&this._throwError("not null",n),t.writeBytes(xy)}decode(t){return t.readBytes(0),null}}const yy=BigInt(0),Ny=BigInt(1),wy=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class vy extends Rn{constructor(n,r,a){const o=(r?"int":"uint")+n*8;super(o,o,a,!1);ie(this,"size");ie(this,"signed");$e(this,{size:n,signed:r},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(n,r){let a=Be(qt.dereference(r,this.type)),o=Nr(wy,Yt*8);if(this.signed){let i=Nr(o,this.size*8-1);(a>i||a<-(i+Ny))&&this._throwError("value out-of-bounds",r),a=tm(a,8*Yt)}else(a<yy||a>Nr(o,this.size*8))&&this._throwError("value out-of-bounds",r);return n.writeValue(a)}decode(n){let r=Nr(n.readValue(),this.size*8);return this.signed&&(r=Di(r,this.size*8)),r}}class jy extends Zm{constructor(t){super("string",t)}defaultValue(){return""}encode(t,n){return super.encode(t,tn(qt.dereference(n,"string")))}decode(t){return tc(super.decode(t))}}class Mi extends Rn{constructor(n,r){let a=!1;const o=[];n.forEach(c=>{c.dynamic&&(a=!0),o.push(c.type)});const i="tuple("+o.join(",")+")";super("tuple",i,r,a);ie(this,"coders");$e(this,{coders:Object.freeze(n.slice())})}defaultValue(){const n=[];this.coders.forEach(a=>{n.push(a.defaultValue())});const r=this.coders.reduce((a,o)=>{const i=o.localName;return i&&(a[i]||(a[i]=0),a[i]++),a},{});return this.coders.forEach((a,o)=>{let i=a.localName;!i||r[i]!==1||(i==="length"&&(i="_length"),n[i]==null&&(n[i]=n[o]))}),Object.freeze(n)}encode(n,r){const a=qt.dereference(r,"tuple");return Km(n,this.coders,a)}decode(n){return Ym(n,this.coders)}}function el(e,t){return{address:nt(e),storageKeys:t.map((n,r)=>(D(dt(n,32),"invalid slot",`storageKeys[${r}]`,n),n.toLowerCase()))}}function ia(e){if(Array.isArray(e))return e.map((n,r)=>Array.isArray(n)?(D(n.length===2,"invalid slot set",`value[${r}]`,n),el(n[0],n[1])):(D(n!=null&&typeof n=="object","invalid address-slot set","value",e),el(n.address,n.storageKeys)));D(e!=null&&typeof e=="object","invalid access list","value",e);const t=Object.keys(e).map(n=>{const r=e[n].reduce((a,o)=>(a[o]=!0,a),{});return el(n,Object.keys(r).sort())});return t.sort((n,r)=>n.address.localeCompare(r.address)),t}function Xm(e){return{address:nt(e.address),nonce:Be(e.nonce!=null?e.nonce:0),chainId:Be(e.chainId!=null?e.chainId:0),signature:rs.from(e.signature)}}function Cy(e){let t;return typeof e=="string"?t=Lo.computePublicKey(e,!1):t=e.publicKey,nt(kt("0x"+t.substring(4)).substring(26))}function Lm(e,t){return Cy(Lo.recoverPublicKey(e,t))}const Pt=BigInt(0),ky=BigInt(2),Ay=BigInt(27),Ty=BigInt(28),Ey=BigInt(35),Sy=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),tl=4096*32;function Fy(e){return{blobToKzgCommitment:r=>{if("computeBlobProof"in e){if("blobToKzgCommitment"in e&&typeof e.blobToKzgCommitment=="function")return We(e.blobToKzgCommitment(Se(r)))}else if("blobToKzgCommitment"in e&&typeof e.blobToKzgCommitment=="function")return We(e.blobToKzgCommitment(r));if("blobToKZGCommitment"in e&&typeof e.blobToKZGCommitment=="function")return We(e.blobToKZGCommitment(Se(r)));D(!1,"unsupported KZG library","kzg",e)},computeBlobKzgProof:(r,a)=>{if("computeBlobProof"in e&&typeof e.computeBlobProof=="function")return We(e.computeBlobProof(Se(r),Se(a)));if("computeBlobKzgProof"in e&&typeof e.computeBlobKzgProof=="function")return e.computeBlobKzgProof(r,a);if("computeBlobKZGProof"in e&&typeof e.computeBlobKZGProof=="function")return We(e.computeBlobKZGProof(Se(r),Se(a)));D(!1,"unsupported KZG library","kzg",e)}}}function Ru(e,t){let n=e.toString(16);for(;n.length<2;)n="0"+n;return n+=Bo(t).substring(4),"0x"+n}function Po(e){return e==="0x"?null:nt(e)}function Rc(e,t){try{return ia(e)}catch(n){D(!1,n.message,t,e)}}function Ry(e,t){try{if(!Array.isArray(e))throw new Error("authorizationList: invalid array");const n=[];for(let r=0;r<e.length;r++){const a=e[r];if(!Array.isArray(a))throw new Error(`authorization[${r}]: invalid array`);if(a.length!==6)throw new Error(`authorization[${r}]: wrong length`);if(!a[1])throw new Error(`authorization[${r}]: null address`);n.push({address:Po(a[1]),nonce:ct(a[2],"nonce"),chainId:ct(a[0],"chainId"),signature:rs.from({yParity:ca(a[3],"yParity"),r:En(a[4],32),s:En(a[5],32)})})}return n}catch(n){D(!1,n.message,t,e)}}function ca(e,t){return e==="0x"?0:Je(e,t)}function ct(e,t){if(e==="0x")return Pt;const n=Be(e,t);return D(n<=Sy,"value exceeds uint size",t,n),n}function st(e,t){const n=Be(e,"value"),r=St(n);return D(r.length<=32,"value too large",`tx.${t}`,n),r}function Bc(e){return ia(e).map(t=>[t.address,t.storageKeys])}function By(e){return e.map(t=>[st(t.chainId,"chainId"),t.address,st(t.nonce,"nonce"),st(t.signature.yParity,"yParity"),St(t.signature.r),St(t.signature.s)])}function Py(e,t){D(Array.isArray(e),`invalid ${t}`,"value",e);for(let n=0;n<e.length;n++)D(dt(e[n],32),"invalid ${ param } hash",`value[${n}]`,e[n]);return e}function My(e){const t=wi(e);D(Array.isArray(t)&&(t.length===9||t.length===6),"invalid field count for legacy transaction","data",e);const n={type:0,nonce:ca(t[0],"nonce"),gasPrice:ct(t[1],"gasPrice"),gasLimit:ct(t[2],"gasLimit"),to:Po(t[3]),value:ct(t[4],"value"),data:Se(t[5]),chainId:Pt};if(t.length===6)return n;const r=ct(t[6],"v"),a=ct(t[7],"r"),o=ct(t[8],"s");if(a===Pt&&o===Pt)n.chainId=r;else{let i=(r-Ey)/ky;i<Pt&&(i=Pt),n.chainId=i,D(i!==Pt||r===Ay||r===Ty,"non-canonical legacy v","v",t[6]),n.signature=rs.from({r:En(t[7],32),s:En(t[8],32),v:r})}return n}function Oy(e,t){const n=[st(e.nonce,"nonce"),st(e.gasPrice||0,"gasPrice"),st(e.gasLimit,"gasLimit"),e.to||"0x",st(e.value,"value"),e.data];let r=Pt;if(e.chainId!=Pt)r=Be(e.chainId,"tx.chainId"),D(!t||t.networkV==null||t.legacyChainId===r,"tx.chainId/sig.v mismatch","sig",t);else if(e.signature){const o=e.signature.legacyChainId;o!=null&&(r=o)}if(!t)return r!==Pt&&(n.push(St(r)),n.push("0x"),n.push("0x")),ar(n);let a=BigInt(27+t.yParity);return r!==Pt?a=rs.getChainIdV(r,t.v):BigInt(t.v)!==a&&D(!1,"tx.chainId/sig.v mismatch","sig",t),n.push(St(a)),n.push(St(t.r)),n.push(St(t.s)),ar(n)}function Pc(e,t){let n;try{if(n=ca(t[0],"yParity"),n!==0&&n!==1)throw new Error("bad yParity")}catch{D(!1,"invalid yParity","yParity",t[0])}const r=En(t[1],32),a=En(t[2],32),o=rs.from({r,s:a,yParity:n});e.signature=o}function _y(e){const t=wi(We(e).slice(1));D(Array.isArray(t)&&(t.length===9||t.length===12),"invalid field count for transaction type: 2","data",Se(e));const n={type:2,chainId:ct(t[0],"chainId"),nonce:ca(t[1],"nonce"),maxPriorityFeePerGas:ct(t[2],"maxPriorityFeePerGas"),maxFeePerGas:ct(t[3],"maxFeePerGas"),gasPrice:null,gasLimit:ct(t[4],"gasLimit"),to:Po(t[5]),value:ct(t[6],"value"),data:Se(t[7]),accessList:Rc(t[8],"accessList")};return t.length===9||Pc(n,t.slice(9)),n}function Iy(e,t){const n=[st(e.chainId,"chainId"),st(e.nonce,"nonce"),st(e.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),st(e.maxFeePerGas||0,"maxFeePerGas"),st(e.gasLimit,"gasLimit"),e.to||"0x",st(e.value,"value"),e.data,Bc(e.accessList||[])];return t&&(n.push(st(t.yParity,"yParity")),n.push(St(t.r)),n.push(St(t.s))),wt(["0x02",ar(n)])}function Uy(e){const t=wi(We(e).slice(1));D(Array.isArray(t)&&(t.length===8||t.length===11),"invalid field count for transaction type: 1","data",Se(e));const n={type:1,chainId:ct(t[0],"chainId"),nonce:ca(t[1],"nonce"),gasPrice:ct(t[2],"gasPrice"),gasLimit:ct(t[3],"gasLimit"),to:Po(t[4]),value:ct(t[5],"value"),data:Se(t[6]),accessList:Rc(t[7],"accessList")};return t.length===8||Pc(n,t.slice(8)),n}function $y(e,t){const n=[st(e.chainId,"chainId"),st(e.nonce,"nonce"),st(e.gasPrice||0,"gasPrice"),st(e.gasLimit,"gasLimit"),e.to||"0x",st(e.value,"value"),e.data,Bc(e.accessList||[])];return t&&(n.push(st(t.yParity,"recoveryParam")),n.push(St(t.r)),n.push(St(t.s))),wt(["0x01",ar(n)])}function Vy(e){let t=wi(We(e).slice(1)),n="3",r=null;if(t.length===4&&Array.isArray(t[0])){n="3 (network format)";const o=t[1],i=t[2],c=t[3];D(Array.isArray(o),"invalid network format: blobs not an array","fields[1]",o),D(Array.isArray(i),"invalid network format: commitments not an array","fields[2]",i),D(Array.isArray(c),"invalid network format: proofs not an array","fields[3]",c),D(o.length===i.length,"invalid network format: blobs/commitments length mismatch","fields",t),D(o.length===c.length,"invalid network format: blobs/proofs length mismatch","fields",t),r=[];for(let l=0;l<t[1].length;l++)r.push({data:o[l],commitment:i[l],proof:c[l]});t=t[0]}D(Array.isArray(t)&&(t.length===11||t.length===14),`invalid field count for transaction type: ${n}`,"data",Se(e));const a={type:3,chainId:ct(t[0],"chainId"),nonce:ca(t[1],"nonce"),maxPriorityFeePerGas:ct(t[2],"maxPriorityFeePerGas"),maxFeePerGas:ct(t[3],"maxFeePerGas"),gasPrice:null,gasLimit:ct(t[4],"gasLimit"),to:Po(t[5]),value:ct(t[6],"value"),data:Se(t[7]),accessList:Rc(t[8],"accessList"),maxFeePerBlobGas:ct(t[9],"maxFeePerBlobGas"),blobVersionedHashes:t[10]};r&&(a.blobs=r),D(a.to!=null,`invalid address for transaction type: ${n}`,"data",e),D(Array.isArray(a.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",e);for(let o=0;o<a.blobVersionedHashes.length;o++)D(dt(a.blobVersionedHashes[o],32),`invalid blobVersionedHash at index ${o}: must be length 32`,"data",e);return t.length===11||Pc(a,t.slice(11)),a}function Gy(e,t,n){const r=[st(e.chainId,"chainId"),st(e.nonce,"nonce"),st(e.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),st(e.maxFeePerGas||0,"maxFeePerGas"),st(e.gasLimit,"gasLimit"),e.to||ko,st(e.value,"value"),e.data,Bc(e.accessList||[]),st(e.maxFeePerBlobGas||0,"maxFeePerBlobGas"),Py(e.blobVersionedHashes||[],"blobVersionedHashes")];return t&&(r.push(st(t.yParity,"yParity")),r.push(St(t.r)),r.push(St(t.s)),n)?wt(["0x03",ar([r,n.map(a=>a.data),n.map(a=>a.commitment),n.map(a=>a.proof)])]):wt(["0x03",ar(r)])}function Hy(e){const t=wi(We(e).slice(1));D(Array.isArray(t)&&(t.length===10||t.length===13),"invalid field count for transaction type: 4","data",Se(e));const n={type:4,chainId:ct(t[0],"chainId"),nonce:ca(t[1],"nonce"),maxPriorityFeePerGas:ct(t[2],"maxPriorityFeePerGas"),maxFeePerGas:ct(t[3],"maxFeePerGas"),gasPrice:null,gasLimit:ct(t[4],"gasLimit"),to:Po(t[5]),value:ct(t[6],"value"),data:Se(t[7]),accessList:Rc(t[8],"accessList"),authorizationList:Ry(t[9],"authorizationList")};return t.length===10||Pc(n,t.slice(10)),n}function zy(e,t){const n=[st(e.chainId,"chainId"),st(e.nonce,"nonce"),st(e.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),st(e.maxFeePerGas||0,"maxFeePerGas"),st(e.gasLimit,"gasLimit"),e.to||"0x",st(e.value,"value"),e.data,Bc(e.accessList||[]),By(e.authorizationList||[])];return t&&(n.push(st(t.yParity,"yParity")),n.push(St(t.r)),n.push(St(t.s))),wt(["0x04",ar(n)])}var Fs,$a,Va,Ga,Ha,za,qa,Qa,Wa,Ja,Ka,Ya,Or,zn,qs,qn,Za,Xa,Vi;const Gs=class Gs{constructor(){me(this,Xa);me(this,Fs);me(this,$a);me(this,Va);me(this,Ga);me(this,Ha);me(this,za);me(this,qa);me(this,Qa);me(this,Wa);me(this,Ja);me(this,Ka);me(this,Ya);me(this,Or);me(this,zn);me(this,qs);me(this,qn);me(this,Za);I(this,Fs,null),I(this,$a,null),I(this,Ga,0),I(this,Ha,Pt),I(this,za,null),I(this,qa,null),I(this,Qa,null),I(this,Va,"0x"),I(this,Wa,Pt),I(this,Ja,Pt),I(this,Ka,null),I(this,Ya,null),I(this,Or,null),I(this,zn,null),I(this,qs,null),I(this,qn,null),I(this,Za,null)}get type(){return y(this,Fs)}set type(t){switch(t){case null:I(this,Fs,null);break;case 0:case"legacy":I(this,Fs,0);break;case 1:case"berlin":case"eip-2930":I(this,Fs,1);break;case 2:case"london":case"eip-1559":I(this,Fs,2);break;case 3:case"cancun":case"eip-4844":I(this,Fs,3);break;case 4:case"pectra":case"eip-7702":I(this,Fs,4);break;default:D(!1,"unsupported transaction type","type",t)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){const t=y(this,$a);return t==null&&this.type===3?ko:t}set to(t){I(this,$a,t==null?null:nt(t))}get nonce(){return y(this,Ga)}set nonce(t){I(this,Ga,Je(t,"value"))}get gasLimit(){return y(this,Ha)}set gasLimit(t){I(this,Ha,Be(t))}get gasPrice(){const t=y(this,za);return t==null&&(this.type===0||this.type===1)?Pt:t}set gasPrice(t){I(this,za,t==null?null:Be(t,"gasPrice"))}get maxPriorityFeePerGas(){const t=y(this,qa);return t??(this.type===2||this.type===3?Pt:null)}set maxPriorityFeePerGas(t){I(this,qa,t==null?null:Be(t,"maxPriorityFeePerGas"))}get maxFeePerGas(){const t=y(this,Qa);return t??(this.type===2||this.type===3?Pt:null)}set maxFeePerGas(t){I(this,Qa,t==null?null:Be(t,"maxFeePerGas"))}get data(){return y(this,Va)}set data(t){I(this,Va,Se(t))}get value(){return y(this,Wa)}set value(t){I(this,Wa,Be(t,"value"))}get chainId(){return y(this,Ja)}set chainId(t){I(this,Ja,Be(t))}get signature(){return y(this,Ka)||null}set signature(t){I(this,Ka,t==null?null:rs.from(t))}get accessList(){const t=y(this,Ya)||null;return t??(this.type===1||this.type===2||this.type===3?[]:null)}set accessList(t){I(this,Ya,t==null?null:ia(t))}get authorizationList(){const t=y(this,Za)||null;return t==null&&this.type===4?[]:t}set authorizationList(t){I(this,Za,t==null?null:t.map(n=>Xm(n)))}get maxFeePerBlobGas(){const t=y(this,Or);return t==null&&this.type===3?Pt:t}set maxFeePerBlobGas(t){I(this,Or,t==null?null:Be(t,"maxFeePerBlobGas"))}get blobVersionedHashes(){let t=y(this,zn);return t==null&&this.type===3?[]:t}set blobVersionedHashes(t){if(t!=null){D(Array.isArray(t),"blobVersionedHashes must be an Array","value",t),t=t.slice();for(let n=0;n<t.length;n++)D(dt(t[n],32),"invalid blobVersionedHash",`value[${n}]`,t[n])}I(this,zn,t)}get blobs(){return y(this,qn)==null?null:y(this,qn).map(t=>Object.assign({},t))}set blobs(t){if(t==null){I(this,qn,null);return}const n=[],r=[];for(let a=0;a<t.length;a++){const o=t[a];if(md(o)){we(y(this,qs),"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let i=We(o);if(D(i.length<=tl,"blob is too large",`blobs[${a}]`,o),i.length!==tl){const u=new Uint8Array(tl);u.set(i),i=u}const c=y(this,qs).blobToKzgCommitment(i),l=Se(y(this,qs).computeBlobKzgProof(i,c));n.push({data:Se(i),commitment:Se(c),proof:l}),r.push(Ru(1,c))}else{const i=Se(o.commitment);n.push({data:Se(o.data),commitment:i,proof:Se(o.proof)}),r.push(Ru(1,i))}}I(this,qn,n),I(this,zn,r)}get kzg(){return y(this,qs)}set kzg(t){t==null?I(this,qs,null):I(this,qs,Fy(t))}get hash(){return this.signature==null?null:kt(Ce(this,Xa,Vi).call(this,!0,!1))}get unsignedHash(){return kt(this.unsignedSerialized)}get from(){return this.signature==null?null:Lm(this.unsignedHash,this.signature)}get fromPublicKey(){return this.signature==null?null:Lo.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return this.signature!=null}get serialized(){return Ce(this,Xa,Vi).call(this,!0,!0)}get unsignedSerialized(){return Ce(this,Xa,Vi).call(this,!1,!1)}inferType(){const t=this.inferTypes();return t.indexOf(2)>=0?2:t.pop()}inferTypes(){const t=this.gasPrice!=null,n=this.maxFeePerGas!=null||this.maxPriorityFeePerGas!=null,r=this.accessList!=null,a=y(this,Or)!=null||y(this,zn);this.maxFeePerGas!=null&&this.maxPriorityFeePerGas!=null&&we(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),we(!n||this.type!==0&&this.type!==1,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),we(this.type!==0||!r,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const o=[];return this.type!=null?o.push(this.type):this.authorizationList&&this.authorizationList.length?o.push(4):n?o.push(2):t?(o.push(1),r||o.push(0)):r?(o.push(1),o.push(2)):(a&&this.to||(o.push(0),o.push(1),o.push(2)),o.push(3)),o.sort(),o}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}clone(){return Gs.from(this)}toJSON(){const t=n=>n==null?null:n.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:t(this.gasLimit),gasPrice:t(this.gasPrice),maxPriorityFeePerGas:t(this.maxPriorityFeePerGas),maxFeePerGas:t(this.maxFeePerGas),value:t(this.value),chainId:t(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(t){if(t==null)return new Gs;if(typeof t=="string"){const r=We(t);if(r[0]>=127)return Gs.from(My(r));switch(r[0]){case 1:return Gs.from(Uy(r));case 2:return Gs.from(_y(r));case 3:return Gs.from(Vy(r));case 4:return Gs.from(Hy(r))}we(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const n=new Gs;return t.type!=null&&(n.type=t.type),t.to!=null&&(n.to=t.to),t.nonce!=null&&(n.nonce=t.nonce),t.gasLimit!=null&&(n.gasLimit=t.gasLimit),t.gasPrice!=null&&(n.gasPrice=t.gasPrice),t.maxPriorityFeePerGas!=null&&(n.maxPriorityFeePerGas=t.maxPriorityFeePerGas),t.maxFeePerGas!=null&&(n.maxFeePerGas=t.maxFeePerGas),t.maxFeePerBlobGas!=null&&(n.maxFeePerBlobGas=t.maxFeePerBlobGas),t.data!=null&&(n.data=t.data),t.value!=null&&(n.value=t.value),t.chainId!=null&&(n.chainId=t.chainId),t.signature!=null&&(n.signature=rs.from(t.signature)),t.accessList!=null&&(n.accessList=t.accessList),t.authorizationList!=null&&(n.authorizationList=t.authorizationList),t.blobVersionedHashes!=null&&(n.blobVersionedHashes=t.blobVersionedHashes),t.kzg!=null&&(n.kzg=t.kzg),t.blobs!=null&&(n.blobs=t.blobs),t.hash!=null&&(D(n.isSigned(),"unsigned transaction cannot define '.hash'","tx",t),D(n.hash===t.hash,"hash mismatch","tx",t)),t.from!=null&&(D(n.isSigned(),"unsigned transaction cannot define '.from'","tx",t),D(n.from.toLowerCase()===(t.from||"").toLowerCase(),"from mismatch","tx",t)),n}};Fs=new WeakMap,$a=new WeakMap,Va=new WeakMap,Ga=new WeakMap,Ha=new WeakMap,za=new WeakMap,qa=new WeakMap,Qa=new WeakMap,Wa=new WeakMap,Ja=new WeakMap,Ka=new WeakMap,Ya=new WeakMap,Or=new WeakMap,zn=new WeakMap,qs=new WeakMap,qn=new WeakMap,Za=new WeakMap,Xa=new WeakSet,Vi=function(t,n){we(!t||this.signature!=null,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const r=t?this.signature:null;switch(this.inferType()){case 0:return Oy(this,r);case 1:return $y(this,r);case 2:return Iy(this,r);case 3:return Gy(this,r,n?this.blobs:null);case 4:return zy(this,r)}we(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})};let nc=Gs;function Kr(e){return kt(tn(e))}var qy="AEEUdwmgDS8BxQKKAP4BOgDjATAAngDUAIMAoABoAOAAagCOAEQAhABMAHIAOwA9ACsANgAmAGIAHgAuACgAJwAXAC0AGgAjAB8ALwAUACkAEgAeAAkAGwARABkAFgA5ACgALQArADcAFQApABAAHgAiABAAGgAeABMAGAUhBe8BFxREN8sF2wC5AK5HAW8ArQkDzQCuhzc3NzcBP68NEfMABQdHBuw5BV8FYAA9MzkI9r4ZBg7QyQAWA9CeOwLNCjcCjqkChuA/lm+RAsXTAoP6ASfnEQDytQFJAjWVCkeXAOsA6godAB/cwdAUE0WlBCN/AQUCQRjFD/MRBjHxDQSJbw0jBzUAswBxme+tnIcAYwabAysG8QAjAEMMmxcDqgPKQyDXCMMxA7kUQwD3NXOrAKmFIAAfBC0D3x4BJQDBGdUFAhEgVD8JnwmQJiNWYUzrg0oAGwAUAB0AFnNcACkAFgBP9h3gPfsDOWDKneY2ChglX1UDYD30ABsAFAAdABZzIGRAnwDD8wAjAEEMzRbDqgMB2sAFYwXqAtCnAsS4AwpUJKRtFHsadUz9AMMVbwLpABM1NJEX0ZkCgYMBEyMAxRVvAukAEzUBUFAtmUwSAy4DBTER33EftQHfSwB5MxJ/AjkWKQLzL8E/cwBB6QH9LQDPDtO9ASNriQC5DQANAwCK21EFI91zHwCoL9kBqQcHBwcHKzUDowBvAQohPvU3fAQgHwCyAc8CKQMA5zMSezr7ULgFmDp/LzVQBgEGAi8FYQVgt8AFcTtlQhpCWEmfe5tmZ6IAExsDzQ8t+X8rBKtTAltbAn0jsy8Bl6utPWMDTR8Ei2kRANkDBrNHNysDBzECQWUAcwFpJ3kAiyUhAJ0BUb8AL3EfAbfNAz81KUsFWwF3YQZtAm0A+VEfAzEJDQBRSQCzAQBlAHsAM70GD/v3IZWHBwARKQAxALsjTwHZAeMPEzmXgIHwABIAGQA8AEUAQDt3gdvIEGcQZAkGTRFMdEIVEwK0D64L7REdDNkq09PgADSxB/MDWwfzA1sDWwfzB/MDWwfzA1sDWwNbA1scEvAi28gQZw9QBHUFlgWTBN4IiyZREYkHMAjaVBV0JhxPA00BBCMtSSQ7mzMTJUpMFE0LCAQ2SmyvfUADTzGzVP2QqgPTMlc5dAkGHnkSqAAyD3skNb1OhnpPcagKU0+2tYdJak5vAsY6sEAACikJm2/Dd1YGRRAfJ6kQ+ww3AbkBPw3xS9wE9QY/BM0fgRkdD9GVoAipLeEM8SbnLqWAXiP5KocF8Uv4POELUVFsD10LaQnnOmeBUgMlAREijwrhDT0IcRD3Cs1vDekRSQc9A9lJngCpBwULFR05FbkmFGKwCw05ewb/GvoLkyazEy17AAXXGiUGUQEtGwMA0y7rhbRaNVwgT2MGBwspI8sUrFAkDSlAu3hMGh8HGSWtApVDdEqLUToelyH6PEENai4XUYAH+TwJGVMLhTyiRq9FEhHWPpE9TCJNTDAEOYMsMyePCdMPiQy9fHYBXQklCbUMdRM1ERs3yQg9Bx0xlygnGQglRplgngT7owP3E9UDDwVDCUUHFwO5HDETMhUtBRGBKNsC9zbZLrcCk1aEARsFzw8pH+MQVEfkDu0InwJpA4cl7wAxFSUAGyKfCEdnAGOP3FMJLs8Iy2pwI3gDaxTrZRF3B5UOWwerHDcVwxzlcMxeD4YMKKezCV8BeQmdAWME5wgNNV+MpCBFZ1eLXBifIGVBQ14AAjUMaRWjRMGHfAKPD28SHwE5AXcHPQ0FAnsR8RFvEJkI74YINbkz/DopBFMhhyAVCisDU2zSCysm/Qz8bQGnEmYDEDRBd/Jnr2C6KBgBBx0yyUFkIfULlk/RDKAaxRhGVDIZ6AfDA/ca9yfuQVsGAwOnBxc6UTPyBMELbQiPCUMATQ6nGwfbGG4KdYzUATWPAbudA1uVhwJzkwY7Bw8Aaw+LBX3pACECqwinAAkA0wNbAD0CsQehAB0AiUUBQQMrMwEl6QKTA5cINc8BmTMB9y0EH8cMGQD7O25OAsO1AoBuZqYF4VwCkgJNOQFRKQQJUktVA7N15QDfAE8GF+NLARmvTs8e50cB43MvAMsA/wAJOQcJRQHRAfdxALsBYws1Caa3uQFR7S0AhwAZbwHbAo0A4QA5AIP1AVcAUQVd/QXXAlNNARU1HC9bZQG/AyMBNwERAH0Gz5GpzQsjBHEH1wIQHxXlAu8yB7kFAyLjE9FCyQK94lkAMhoKPAqrCqpgX2Q3CjV2PVQAEh+sPss/UgVVO1c7XDtXO1w7VztcO1c7XDtXO1wDm8Pmw+YKcF9JYe8Mqg3YRMw6TRPfYFVgNhPMLbsUxRXSJVoZQRrAJwkl6FUNDwgt12Y0CDA0eRfAAEMpbINFY4oeNApPHOtTlVT8LR8AtUumM7MNsBsZREQFS3XxYi4WEgomAmSFAmJGX1GzAV83JAKh+wJonAJmDQKfiDgfDwJmPwJmKgRyBIMDfxcDfpY5Cjl7GzmGOicnAmwhAjI6OA4CbcsCbbLzjgM3a0kvAWsA4gDlAE4JB5wMkQECD8YAEbkCdzMCdqZDAnlPRwJ4viFg30WyRvcCfEMCeswCfQ0CfPRIBEiBZygALxlJXEpfGRtK0ALRBQLQ0EsrA4hTA4fqRMmRNgLypV0HAwOyS9JMMSkH001QTbMCi0MCitzFHwshR2sJuwKOOwKOYESbhQKO3QKOYHxRuFM5AQ5S2FSJApP/ApMQAO0AIFUiVbNV1AosHymZijLleGpFPz0Cl6MC77ZYJawAXSkClpMCloCgAK1ZsFoNhVEAPwKWuQKWUlxIXNUCmc8CmWhczl0LHQKcnznGOqECnBoCn58CnryOACETNS4TAp31Ap6WALlBYThh8wKe1wKgcgGtAp6jIwKeUqljzGQrKS8CJ7MCJoICoP8CoFDbAqYzAqXSAqgDAIECp/ZogGi1AAdNaiBq1QKs5wKssgKtawKtBgJXIQJV4AKx5dsDH1JsmwKywRECsuwbbORtZ21MYwMl0QK2YD9DbpQDKUkCuGICuUsZArkue3A6cOUCvR0DLbYDMhUCvoxyBgMzdQK+HnMmc1MCw88CwwhzhnRPOUl05AM8qwEDPJ4DPcMCxYACxksCxhSNAshtVQLISALJUwLJMgJkoQLd1nh9ZXiyeSlL1AMYp2cGAmH4GfeVKHsPXpZevxUCz28Cz3AzT1fW9xejAMqxAs93AS3uA04Wfk8JAtwrAtuOAtJTA1JgA1NjAQUDVZCAjUMEzxrxZEl5A4LSg5EC2ssC2eKEFIRNp0ADhqkAMwNkEoZ1Xf0AWQLfaQLevHd7AuIz7RgB8zQrAfSfAfLWiwLr9wLpdH0DAur9AuroAP1LAb0C7o0C66CWrpcHAu5DA4XkmH1w5HGlAvMHAG0DjhqZlwL3FwORcgOSiwL3nAL53QL4apogmq+/O5siA52HAv7+AR8APZ8gAZ+3AwWRA6ZuA6bdANXJAwZuoYyiCQ0DDE0BEwEjB3EGZb1rCQC/BG/DFY8etxEAG3k9ACcDNxJRA42DAWcrJQCM8wAlAOanC6OVCLsGI6fJBgCvBRnDBvElRUYFFoAFcD9GSDNCKUK8X3kZX8QAls0FOgCQVCGbwTsuYDoZutcONxjOGJHJ/gVfBWAFXwVgBWsFYAVfBWAFXwVgBV8FYAVfBWBOHQjfjW8KCgoKbF7xMwTRA7kGN8PDAMMEr8MA70gxFroFTj5xPnhCR0K+X30/X/AAWBkzswCNBsxzzASm70aCRS4rDDMeLz49fnXfcsH5GcoscQFz13Y4HwVnBXLJycnACNdRYwgICAqEXoWTxgA7P4kACxbZBu21Kw0AjMsTAwkVAOVtJUUsJ1JCuULESUArXy9gPi9AKwnJRQYKTD9LPoA+iT54PnkCkULEUUpDX9NWV3JVEjQAc1w3A3IBE3YnX+g7QiMJb6MKaiszRCUuQrNCxDPMCcwEX9EWJzYREBEEBwIHKn6l33JCNVIfybPJtAltydPUCmhBZw/tEKsZAJOVJU1CLRuxbUHOQAo7P0s+eEJHHA8SJVRPdGM0NVrpvBoKhfUlM0JHHGUQUhEWO1xLSj8MO0ucNAqJIzVCRxv9EFsqKyA4OQgNj2nwZgp5ZNFgE2A1K3YHS2AhQQojJmC7DgpzGG1WYFUZCQYHZO9gHWCdYIVgu2BTYJlwFh8GvRbcXbG8YgtDHrMBwzPVyQonHQgkCyYBgQJ0Ajc4nVqIAwGSCsBPIgDsK3SWEtIVBa5N8gGjAo+kVwVIZwD/AEUSCDweX4ITrRQsJ8K3TwBXFDwEAB0TvzVcAtoTS20RIwDgVgZ9BBImYgA5AL4Coi8LFnezOkCnIQFjAY4KBAPh9RcGsgZSBsEAJctdsWIRu2kTkQstRw7DAcMBKgpPBGIGMDAwKCYnKTQaLg4AKRSVAFwCdl+YUZ0JdicFD3lPAdt1F9ZZKCGxuE3yBxkFVGcA/wBFEgiCBwAOLHQSjxOtQDg1z7deFRMAZ8QTAGtKb1ApIiPHADkAvgKiLy1DFtYCmBiDAlDDWNB0eo7fpaMO/aEVRRv0ATEQZBIODyMEAc8JQhCbDRgzFD4TAEMAu9YBCgCsAOkAm5I3ABwAYxvONnR+MhXJAxgKQyxL2+kkJhMbhQKDBMkSsvF0AD9BNQ6uQC7WqSQHwxEAEEIu1hkhAH2z4iQPwyJPHNWpdyYBRSpnJALzoBAEVPPsH20MxA0CCEQKRgAFyAtFAlMNwwjEDUQJRArELtapMg7DDZgJIw+TGukEIwvDFkMAqAtDEMMMBhioe+QAO3MMRAACrgnEBSPY9Q0FDnbSBoMAB8MSYxkSxAEJAPIJAAB8FWMOFtMc/HcXwxhDAC7DAvOowwAewwJdKDKHAAHDAALrFUQVwwAbwyvzpWMWv8wA/ABpAy++bcYDUKPD0KhDCwKmJ1MAAmMA5+UZwxAagwipBRL/eADfw6fDGOMCGsOjk3l6BwOpo4sAEsMOGxMAA5sAbcMOAAvDp0MJGkMDwgipnNIPAwfIqUMGAOGDAAPzABXDAAcDAAnDAGmTABrDAA7DChjDjnEWAwABYwAOcwAuUyYABsMAF8MIKQANUgC6wy4AA8MADqMq8wCyYgAcIwAB8wqpAAXOCx0V4wAHowBCwwEKAGnDAAuDAB3DAAjDCakABdIAbqcZ3QCZCCkABdIAAAFDAAfjAB2jCCkABqIACYMAGzMAbSMA5sOIAAhjAAhDABTDBAkpAAbSAOOTAAlDC6kOzPtnAAdDAG6kQFAATwAKwwwAA0MACbUDPwAHIwAZgwACE6cDAAojAApDAAoDp/MGwwAJIwADEwAQQwgAFEMAEXMAD5MADfMADcMAGRMOFiMAFUMAbqMWuwHDAMIAE0MLAGkzEgDhUwACQwAEWgAXgwUjAAbYABjDBSYBgzBaAEFNALcQBxUMegAwMngBrA0IZgJ0KxQHBREPd1N0ZzKRJwaIHAZqNT4DqQq8BwngAB4DAwt2AX56T1ocKQNXAh1GATQGC3tOxYNagkgAMQA5CQADAQEAWxLjAIOYNAEzAH7tFRk6TglSAF8NAAlYAQ+S1ACAQwQorQBiAN4dAJ1wPyeTANVzuQDX3AIeEMp9eyMgXiUAEdkBkJizKltbVVAaRMqRAAEAhyQ/SDEz6BmfVwB6ATEsOClKIRcDOF0E/832AFNt5AByAnkCRxGCOs94NjXdAwINGBonDBwPALW2AwICAgAAAAAAAAYDBQMDARrUAwAtAAAAAgEGBgYGBgYFBQUFBQUEBQYHCAkEBQUFBQQAAAICAAAAIgCNAJAAlT0A6gC7ANwApEQAwgCyAK0AqADuAKYA2gCjAOcBCAEDAMcAgQBiANIA1AEDAN4A8gCQAKkBMQDqAN8A3AsBCQ8yO9ra2tq8xuLT1tRJOB0BUgFcNU0BWgFpAWgBWwFMUUlLbhMBUxsNEAs6PhMOACcUKy0vMj5AQENDQ0RFFEYGJFdXV1dZWVhZL1pbXVxcI2NnZ2ZoZypsbnZ1eHh4eHh4enp6enp6enp6enp8fH18e2IARPIASQCaAHgAMgBm+ACOAFcAVwA3AnbvAIsABfj4AGQAk/IAnwBPAGIAZP//sACFAIUAaQBWALEAJAC2AIMCQAJDAPwA5wD+AP4A6AD/AOkA6QDoAOYALwJ7AVEBQAE+AVQBPgE+AT4BOQE4ATgBOAEcAVgXADEQCAEAUx8SHgsdHhYAjgCWAKYAUQBqIAIxAHYAbwCXAxUDJzIDIUlGTzEAkQJPAMcCVwKkAMAClgKWApYClgKWApYCiwKWApYClgKWApYClgKVApUCmAKgApcClgKWApQClAKUApQCkgKVAnUB1AKXAp8ClgKWApUeAIETBQD+DQOfAmECOh8BVBg9AuIZEjMbAU4/G1WZAXusRAFpYQEFA0FPAQYAmTEeIJdyADFoAHEANgCRA5zMk/C2jGINwjMWygIZCaXdfDILBCs5dAE7YnQBugDlhoiHhoiGiYqKhouOjIaNkI6Ij4qQipGGkoaThpSSlYaWhpeKmIaZhpqGm4aci52QnoqfhuIC4XTpAt90AIp0LHSoAIsAdHQEQwRABEIERQRDBEkERgRBBEcESQRIBEQERgRJAJ5udACrA490ALxuAQ10ANFZdHQA13QCFHQA/mJ0AP4BIQD+APwA/AD9APwDhGZ03ASMK23HAP4A/AD8AP0A/CR0dACRYnQA/gCRASEA/gCRAvQA/gCRA4RmdNwEjCttxyR0AP9idAEhAP4A/gD8APwA/QD8AP8A/AD8AP0A/AOEZnTcBIwrbcckdHQAkWJ0ASEA/gCRAP4AkQL0AP4AkQOEZnTcBIwrbcckdAJLAT50AlIBQXQCU8l0dAJfdHQDpgL0A6YDpgOnA6cDpwOnA4RmdNwEjCttxyR0dACRYnQBIQOmAJEDpgCRAvQDpgCRA4RmdNwEjCttxyR0BDh0AJEEOQCRDpU5dSgCADR03gV2CwArdAEFAM5iCnR0AF1iAAYcOgp0dACRCnQAXAEIwWZ0CnRmdHQAkWZ0CnRmdEXgAFF03gp0dEY0tlT2u3SOAQTwscwhjZZKrhYcBSfFp9XNbKiVDOD2b+cpe4/Z17mQnbtzzhaeQtE2GGj0IDNTjRUSyTxxw/RPHW/+vS7d1NfRt9z9QPZg4X7QFfhCnkvgNPIItOsC2eV6hPannZNHlZ9xrwZXIMOlu3jSoQSq78WEjwLjw1ELSlF1aBvfzwk5ZX7AUvQzjPQKbDuQ+sm4wNOp4A6AdVuRS0t1y/DZpg4R6m7FNjM9HgvW7Bi88zaMjOo6lM8wtBBdj8LP4ylv3zCXPhebMKJc066o9sF71oFW/8JXu86HJbwDID5lzw5GWLR/LhT0Qqnp2JQxNZNfcbLIzPy+YypqRm/lBmGmex+82+PisxUumSeJkALIT6rJezxMH+CTJmQtt5uwTVbL3ptmjDUQzlSIvWi8Tl7ng1NpuRn1Ng4n14Qc+3Iil7OwkvNWogLSPkn3pihIFytyIGmMhOe3n1tWsuMy9BdKyqF4Z3v2SgggTL9KVvMXPnCbRe+oOuFFP3HejBG/w9gvmfNYvg6JuWia2lcSSN1uIjBktzoIazOHPJZ7kKHPz8mRWVdW3lA8WGF9dQF6Bm673boov3BUWDU2JNcahR23GtfHKLOz/viZ+rYnZFaIznXO67CYEJ1fXuTRpZhYZkKe54xeoagkNGLs+NTZHE0rX45/XvQ2RGADX6vcAvdxIUBV27wxGm2zjZo4X3ILgAlrOFheuZ6wtsvaIj4yLY7qqawlliaIcrz2G+c3vscAnCkCuMzMmZvMfu9lLwTvfX+3cVSyPdN9ZwgDZhfjRgNJcLiJ67b9xx8JHswprbiE3v9UphotAPIgnXVIN5KmMc0piXhc6cChPnN+MRhG9adtdttQTTwSIpl8I4/j//d3sz1326qTBTpPRM/Hgh3kzqEXs8ZAk4ErQhNO8hzrQ0DLkWMA/N+91tn2MdOJnWC2FCZehkQrwzwbKOjhvZsbM95QoeL9skYyMf4srVPVJSgg7pOLUtr/n9eT99oe9nLtFRpjA9okV2Kj8h9k5HaC0oivRD8VyXkJ81tcd4fHNXPCfloIQasxsuO18/46dR2jgul/UIet2G0kRvnyONMKhHs6J26FEoqSqd+rfYjeEGwHWVDpX1fh1jBBcKGMqRepju9Y00mDVHC+Xdij/j44rKfvfjGinNs1jO/0F3jB83XCDINN/HB84axlP+3E/klktRo+vl3U/aiyMJbIodE1XSsDn6UAzIoMtUObY2+k/4gY/l+AkZJ5Sj2vQrkyLm3FoxjhDX+31UXBFf9XrAH31fFqoBmDEZvhvvpnZ87N+oZEu7U9O/nnk+QWj3x8uyoRbEnf+O5UMr9i0nHP38IF5AvzrBW8YWBUR0mIAzIvndQq9N3v/Jto3aPjPXUPl8ASdPPyAp7jENf8bk7VMM9ol9XGmlBmeDMuGqt+WzuL6CXAxXjIhCPM5vACchgMJ/8XBGLO/D1isVvGhwwHHr1DLaI5mn2Jr/b1pUD90uciDaS8cXNDzCWvNmT/PhQe5e8nTnnnkt8Ds/SIjibcum/fqDhKopxAY8AkSrPn+IGDEKOO+U3XOP6djFs2H5N9+orhOahiQk5KnEUWa+CzkVzhp8bMHRbg81qhjjXuIKbHjSLSIBKWqockGtKinY+z4/RdBUF6pcc3JmnlxVcNgrI4SEzKUZSwcD2QCyxzKve+gAmg6ZuSRkpPFa6mfThu7LJNu3H5K42uCpNvPAsoedolKV/LHe/eJ+BbaG5MG0NaSGVPRUmNFMFFSSpXEcXwbVh7UETOZZtoVNRGOIbbkig3McEtR68cG0RZAoJevWYo7Dg/lZ1CQzblWeUvVHmr8fY4Nqd9JJiH/zEX24mJviH60fAyFr0A3c4bC1j3yZU60VgJxXn8JgJXLUIsiBnmKmMYz+7yBQFBvqb2eYnuW59joZBf56/wXvWIR4R8wTmV80i1mZy+S4+BUES+hzjk0uXpC///z/IlqHZ1monzlXp8aCfhGKMti73FI1KbL1q6IKO4fuBuZ59gagjn5xU79muMpHXg6S+e+gDM/U9BKLHbl9l6o8czQKl4RUkJJiqftQG2i3BMg/TQlUYFkJDYBOOvAugYuzYSDnZbDDd/aSd9x0Oe6F+bJcHfl9+gp6L5/TgA+BdFFovbfCrQ40s5vMPw8866pNX8zyFGeFWdxIpPVp9Rg1UPOVFbFZrvaFq/YAzHQgqMWpahMYfqHpmwXfHL1/kpYmGuHFwT55mQu0dylfNuq2Oq0hTMCPwqfxnuBIPLXfci4Y1ANy+1CUipQxld/izVh16WyG2Q0CQQ9NqtAnx1HCHwDj7sYxOSB0wopZSnOzxQOcExmxrVTF2BkOthVpGfuhaGECfCJpJKpjnihY+xOT2QJxN61+9K6QSqtv2Shr82I3jgJrqBg0wELFZPjvHpvzTtaJnLK6Vb97Yn933koO/saN7fsjwNKzp4l2lJVx2orjCGzC/4ZL4zCver6aQYtC5sdoychuFE6ufOiog+VWi5UDkbmvmtah/3aArEBIi39s5ILUnlFLgilcGuz9CQshEY7fw2ouoILAYPVT/gyAIq3TFAIwVsl+ktkRz/qGfnCDGrm5gsl/l9QdvCWGsjPz3dU7XuqKfdUrr/6XIgjp4rey6AJBmCmUJMjITHVdFb5m1p+dLMCL8t55zD42cmftmLEJC0Da04YiRCVUBLLa8D071/N5UBNBXDh0LFsmhV/5B5ExOB4j3WVG/S3lfK5o+V6ELHvy6RR9n4ac+VsK4VE4yphPvV+kG9FegTBH4ZRXL2HytUHCduJazB/KykjfetYxOXTLws267aGOd+I+JhKP//+VnXmS90OD/jvLcVu0asyqcuYN1mSb6XTlCkqv1vigZPIYwNF/zpWcT1GR/6aEIRjkh0yhg4LXJfaGobYJTY4JI58KiAKgmmgAKWdl5nYCeLqavRJGQNuYuZtZFGx+IkI4w4NS2xwbetNMunOjBu/hmKCI/w7tfiiyUd//4rbTeWt4izBY8YvGIN6vyKYmP/8X8wHKCeN+WRcKM70+tXKNGyevU9H2Dg5BsljnTf8YbsJ1TmMs74Ce2XlHisleguhyeg44rQOHZuw/6HTkhnnurK2d62q6yS7210SsAIaR+jXMQA+svkrLpsUY+F30Uw89uOdGAR6vo4FIME0EfVVeHTu6eKicfhSqOeXJhbftcd08sWEnNUL1C9fnprTgd83IMut8onVUF0hvqzZfHduPjbjwEXIcoYmy+P6tcJZHmeOv6VrvEdkHDJecjHuHeWANe79VG662qTjA/HCvumVv3qL+LrOcpqGps2ZGwQdFJ7PU4iuyRlBrwfO+xnPyr47s2cXVbWzAyznDiBGjCM3ksxjjqM62GE9C8f5U38kB3VjtabKp/nRdvMESPGDG90bWRLAt1Qk5DyLuazRR1YzdC1c+hZXvAWV8xA72S4A8B67vjVhbba3MMop293FeEXpe7zItMWrJG/LOH9ByOXmYnNJfjmfuX9KbrpgLOba4nZ+fl8Gbdv/ihv+6wFGKHCYrVwmhFC0J3V2bn2tIB1wCc1CST3d3X2OyxhguXcs4sm679UngzofuSeBewMFJboIQHbUh/m2JhW2hG9DIvG2t7yZIzKBTz9wBtnNC+2pCRYhSIuQ1j8xsz5VvqnyUIthvuoyyu7fNIrg/KQUVmGQaqkqZk/Vx5b33/gsEs8yX7SC1J+NV4icz6bvIE7C5G6McBaI8rVg56q5QBJWxn/87Q1sPK4+sQa8fLU5gXo4paaq4cOcQ4wR0VBHPGjKh+UlPCbA1nLXyEUX45qZ8J7/Ln4FPJE2TdzD0Z8MLSNQiykMMmSyOCiFfy84Rq60emYB2vD09KjYwsoIpeDcBDTElBbXxND72yhd9pC/1CMid/5HUMvAL27OtcIJDzNKpRPNqPOpyt2aPGz9QWIs9hQ9LiX5s8m9hjTUu/f7MyIatjjd+tSfQ3ufZxPpmJhTaBtZtKLUcfOCUqADuO+QoH8B9v6U+P0HV1GLQmtoNFTb3s74ivZgjES0qfK+8RdGgBbcCMSy8eBvh98+et1KIFqSe1KQPyXULBMTsIYnysIwiZBJYdI20vseV+wuJkcqGemehKjaAb9L57xZm3g2zX0bZ2xk/fU+bCo7TlnbW7JuF1YdURo/2Gw7VclDG1W7LOtas2LX4upifZ/23rzpsnY/ALfRgrcWP5hYmV9VxVOQA1fZvp9F2UNU+7d7xRyVm5wiLp3/0dlV7vdw1PMiZrbDAYzIVqEjRY2YU03sJhPnlwIPcZUG5ltL6S8XCxU1eYS5cjr34veBmXAvy7yN4ZjArIG0dfD/5UpBNlX1ZPoxJOwyqRi3wQWtOzd4oNKh0LkoTm8cwqgIfKhqqGOhwo71I+zXnMemTv2B2AUzABWyFztGgGULjDDzWYwJUVBTjKCn5K2QGMK1CQT7SzziOjo+BhAmqBjzuc3xYym2eedGeOIRJVyTwDw37iCMe4g5Vbnsb5ZBdxOAnMT7HU4DHpxWGuQ7GeiY30Cpbvzss55+5Km1YsbD5ea3NI9QNYIXol5apgSu9dZ8f8xS5dtHpido5BclDuLWY4lhik0tbJa07yJhH0BOyEut/GRbYTS6RfiTYWGMCkNpfSHi7HvdiTglEVHKZXaVhezH4kkXiIvKopYAlPusftpE4a5IZwvw1x/eLvoDIh/zpo9FiQInsTb2SAkKHV42XYBjpJDg4374XiVb3ws4qM0s9eSQ5HzsMU4OZJKuopFjBM+dAZEl8RUMx5uU2N486Kr141tVsGQfGjORYMCJAMsxELeNT4RmWjRcpdTGBwcx6XN9drWqPmJzcrGrH4+DRc7+n1w3kPZwu0BkNr6hQrqgo7JTB9A5kdJ/H7P4cWBMwsmuixAzJB3yrQpnGIq90lxAXLzDCdn1LPibsRt7rHNjgQBklRgPZ8vTbjXdgXrTWQsK5MdrXXQVPp0Rinq3frzZKJ0qD6Qhc40VzAraUXlob1gvkhK3vpmHgI6FRlQZNx6eRqkp0zy4AQlX813fAPtL3jMRaitGFFjo0zmErloC+h+YYdVQ6k4F/epxAoF0BmqEoKNTt6j4vQZNQ2BoqF9Vj53TOIoNmDiu9Xp15RkIgQIGcoLpfoIbenzpGUAtqFJp5W+LLnx38jHeECTJ/navKY1NWfN0sY1T8/pB8kIH3DU3DX+u6W3YwpypBMYOhbSxGjq84RZ84fWJow8pyHqn4S/9J15EcCMsXqrfwyd9mhiu3+rEo9pPpoJkdZqHjra4NvzFwuThNKy6hao/SlLw3ZADUcUp3w3SRVfW2rhl80zOgTYnKE0Hs2qp1J6H3xqPqIkvUDRMFDYyRbsFI3M9MEyovPk8rlw7/0a81cDVLmBsR2ze2pBuKb23fbeZC0uXoIvDppfTwIDxk1Oq2dGesGc+oJXWJLGkOha3CX+DUnzgAp9HGH9RsPZN63Hn4RMA5eSVhPHO+9RcRb/IOgtW31V1Q5IPGtoxPjC+MEJbVlIMYADd9aHYWUIQKopuPOHmoqSkubnAKnzgKHqgIOfW5RdAgotN6BN+O2ZYHkuemLnvQ8U9THVrS1RtLmKbcC7PeeDsYznvqzeg6VCNwmr0Yyx1wnLjyT84BZz3EJyCptD3yeueAyDWIs0L2qs/VQ3HUyqfrja0V1LdDzqAikeWuV4sc7RLIB69jEIBjCkyZedoUHqCrOvShVzyd73OdrJW0hPOuQv2qOoHDc9xVb6Yu6uq3Xqp2ZaH46A7lzevbxQEmfrzvAYSJuZ4WDk1Hz3QX1LVdiUK0EvlAGAYlG3Md30r7dcPN63yqBCIj25prpvZP0nI4+EgWoFG95V596CurXpKRBGRjQlHCvy5Ib/iW8nZJWwrET3mgd6mEhfP4KCuaLjopWs7h+MdXFdIv8dHQJgg1xi1eYqB0uDYjxwVmri0Sv5XKut/onqapC+FQiC2C1lvYJ9MVco6yDYsS3AANUfMtvtbYI2hfwZatiSsnoUeMZd34GVjkMMKA+XnjJpXgRW2SHTZplVowPmJsvXy6w3cfO1AK2dvtZEKTkC/TY9LFiKHCG0DnrMQdGm2lzlBHM9iEYynH2UcVMhUEjsc0oDBTgo2ZSQ1gzkAHeWeBXYFjYLuuf8yzTCy7/RFR81WDjXMbq2BOH5dURnxo6oivmxL3cKzKInlZkD31nvpHB9Kk7GfcfE1t+1V64b9LtgeJGlpRFxQCAqWJ5DoY77ski8gsOEOr2uywZaoO/NGa0X0y1pNQHBi3b2SUGNpcZxDT7rLbBf1FSnQ8guxGW3W+36BW0gBje4DOz6Ba6SVk0xiKgt+q2JOFyr4SYfnu+Ic1QZYIuwHBrgzr6UvOcSCzPTOo7D6IC4ISeS7zkl4h+2VoeHpnG/uWR3+ysNgPcOIXQbv0n4mr3BwQcdKJxgPSeyuP/z1Jjg4e9nUvoXegqQVIE30EHx5GHv+FAVUNTowYDJgyFhf5IvlYmEqRif6+WN1MkEJmDcQITx9FX23a4mxy1AQRsOHO/+eImX9l8EMJI3oPWzVXxSOeHU1dUWYr2uAA7AMb+vAEZSbU3qob9ibCyXeypEMpZ6863o6QPqlqGHZkuWABSTVNd4cOh9hv3qEpSx2Zy/DJMP6cItEmiBJ5PFqQnDEIt3NrA3COlOSgz43D7gpNFNJ5MBh4oFzhDPiglC2ypsNU4ISywY2erkyb1NC3Qh/IfWj0eDgZI4/ln8WPfBsT3meTjq1Uqt1E7Zl/qftqkx6aM9KueMCekSnMrcHj1CqTWWzEzPsZGcDe3Ue4Ws+XFYVxNbOFF8ezkvQGR6ZOtOLU2lQEnMBStx47vE6Pb7AYMBRj2OOfZXfisjJnpTfSNjo6sZ6qSvNxZNmDeS7Gk3yYyCk1HtKN2UnhMIjOXUzAqDv90lx9O/q/AT1ZMnit5XQe9wmQxnE/WSH0CqZ9/2Hy+Sfmpeg8RwsHI5Z8kC8H293m/LHVVM/BA7HaTJYg5Enk7M/xWpq0192ACfBai2LA/qrCjCr6Dh1BIMzMXINBmX96MJ5Hn2nxln/RXPFhwHxUmSV0EV2V0jm86/dxxuYSU1W7sVkEbN9EzkG0QFwPhyHKyb3t+Fj5WoUUTErcazE/N6EW6Lvp0d//SDPj7EV9UdJN+Amnf3Wwk3A0SlJ9Z00yvXZ7n3z70G47Hfsow8Wq1JXcfwnA+Yxa5mFsgV464KKP4T31wqIgzFPd3eCe3j5ory5fBF2hgCFyVFrLzI9eetNXvM7oQqyFgDo4CTp/hDV9NMX9JDHQ/nyHTLvZLNLF6ftn2OxjGm8+PqOwhxnPHWipkE/8wbtyri80Sr7pMNkQGMfo4ZYK9OcCC4ESVFFbLMIvlxSoRqWie0wxqnLfcLSXMSpMMQEJYDVObYsXIQNv4TGNwjq1kvT1UOkicTrG3IaBZ3XdScS3u8sgeZPVpOLkbiF940FjbCeNRINNvDbd01EPBrTCPpm12m43ze1bBB59Ia6Ovhnur/Nvx3IxwSWol+3H2qfCJR8df6aQf4v6WiONxkK+IqT4pKQrZK/LplgDI/PJZbOep8dtbV7oCr6CgfpWa8NczOkPx81iSHbsNhVSJBOtrLIMrL31LK9TqHqAbAHe0RLmmV806kRLDLNEhUEJfm9u0sxpkL93Zgd6rw+tqBfTMi59xqXHLXSHwSbSBl0EK0+loECOPtrl+/nsaFe197di4yUgoe4jKoAJDXc6DGDjrQOoFDWZJ9HXwt8xDrQP+7aRwWKWI1GF8s8O4KzxWBBcwnl3vnl1Oez3oh6Ea1vjR7/z7DDTrFtqU2W/KAEzAuXDNZ7MY73MF216dzdSbWmUp4lcm7keJfWaMHgut9x5C9mj66Z0lJ+yhsjVvyiWrfk1lzPOTdhG15Y7gQlXtacvI7qv/XNSscDwqkgwHT/gUsD5yB7LdRRvJxQGYINn9hTpodKFVSTPrtGvyQw+HlRFXIkodErAGu9Iy1YpfSPc3jkFh5CX3lPxv7aqjE/JAfTIpEjGb/H7MO0e2vsViSW1qa/Lmi4/n4DEI3g7lYrcanspDfEpKkdV1OjSLOy0BCUqVoECaB55vs06rXl4jqmLsPsFM/7vYJ0vrBhDCm/00A/H81l1uekJ/6Lml3Hb9+NKiLqATJmDpyzfYZFHumEjC662L0Bwkxi7E9U4cQA0XMVDuMYAIeLMPgQaMVOd8fmt5SflFIfuBoszeAw7ow5gXPE2Y/yBc/7jExARUf/BxIHQBF5Sn3i61w4z5xJdCyO1F1X3+3ax+JSvMeZ7S6QSKp1Fp/sjYz6Z+VgCZzibGeEoujryfMulH7Rai5kAft9ebcW50DyJr2uo2z97mTWIu45YsSnNSMrrNUuG1XsYBtD9TDYzQffKB87vWbkM4EbPAFgoBV4GQS+vtFDUqOFAoi1nTtmIOvg38N4hT2Sn8r8clmBCXspBlMBYTnrqFJGBT3wZOzAyJDre9dHH7+x7qaaKDOB4UQALD5ecS0DE4obubQEiuJZ0EpBVpLuYcce8Aa4PYd/V4DLDAJBYKQPCWTcrEaZ5HYbJi11Gd6hjGom1ii18VHYnG28NKpkz2UKVPxlhYSp8uZr367iOmoy7zsxehW9wzcy2zG0a80PBMCRQMb32hnaHeOR8fnNDzZhaNYhkOdDsBUZ3loDMa1YP0uS0cjUP3b/6DBlqmZOeNABDsLl5BI5QJups8uxAuWJdkUB/pO6Zax6tsg7fN5mjjDgMGngO+DPcKqiHIDbFIGudxtPTIyDi9SFMKBDcfdGQRv41q1AqmxgkVfJMnP8w/Bc7N9/TR6C7mGObFqFkIEom8sKi2xYqJLTCHK7cxzaZvqODo22c3wisBCP4HeAgcRbNPAsBkNRhSmD48dHupdBRw4mIvtS5oeF6zeT1KMCyhMnmhpkFAGWnGscoNkwvQ8ZM5lE/vgTHFYL99OuNxdFBxTEDd5v2qLR8y9WkXsWgG6kZNndFG+pO/UAkOCipqIhL3hq7cRSdrCq7YhUsTocEcnaFa6nVkhnSeRYUA1YO0z5itF9Sly3VlxYDw239TJJH6f3EUfYO5lb7bcFcz8Bp7Oo8QmnsUHOz/fagVUBtKEw1iT88j+aKkv8cscKNkMxjYr8344D1kFoZ7/td1W6LCNYN594301tUGRmFjAzeRg5vyoM1F6+bJZ/Q54jN/k8SFd3DxPTYaAUsivsBfgTn7Mx8H2SpPt4GOdYRnEJOH6jHM2p6SgB0gzIRq6fHxGMmSmqaPCmlfwxiuloaVIitLGN8wie2CDWhkzLoCJcODh7KIOAqbHEvXdUxaS4TTTs07Clzj/6GmVs9kiZDerMxEnhUB6QQPlcfqkG9882RqHoLiHGBoHfQuXIsAG8GTAtao2KVwRnvvam8jo1e312GQAKWEa4sUVEAMG4G6ckcONDwRcg1e2D3+ohXgY4UAWF8wHKQMrSnzCgfFpsxh+aHXMGtPQroQasRY4U6UdG0rz1Vjbka0MekOGRZQEvqQFlxseFor8zWFgHek3v29+WqN6gaK5gZOTOMZzpQIC1201LkMCXild3vWXSc5UX9xcFYfbRPzGFa1FDcPfPB/jUEq/FeGt419CI3YmBlVoHsa4KdcwQP5ZSwHHhFJ7/Ph/Rap/4vmG91eDwPP0lDfCDRCLszTqfzM71xpmiKi2HwS4WlqvGNwtvwF5Dqpn6KTq8ax00UMPkxDcZrEEEsIvHiUXXEphdb4GB4FymlPwBz4Gperqq5pW7TQ6/yNRhW8VT5NhuP0udlxo4gILq5ZxAZk8ZGh3g4CqxJlPKY7AQxupfUcVpWT5VItp1+30UqoyP4wWsRo3olRRgkWZZ2ZN6VC3OZFeXB8NbnUrSdikNptD1QiGuKkr8EmSR/AK9Rw+FF3s5uwuPbvHGiPeFOViltMK7AUaOsq9+x9cndk3iJEE5LKZRlWJbKOZweROzmPNVPkjE3K/TyA57Rs68TkZ3MR8akKpm7cFjnjPd/DdkWjgYoKHSr5Wu5ssoBYU4acRs5g2DHxUmdq8VXOXRbunD8QN0LhgkssgahcdoYsNvuXGUK/KXD/7oFb+VGdhqIn02veuM5bLudJOc2Ky0GMaG4W/xWBxIJcL7yliJOXOpx0AkBqUgzlDczmLT4iILXDxxtRR1oZa2JWFgiAb43obrJnG/TZC2KSK2wqOzRZTXavZZFMb1f3bXvVaNaK828w9TO610gk8JNf3gMfETzXXsbcvRGCG9JWQZ6+cDPqc4466Yo2RcKH+PILeKOqtnlbInR3MmBeGG3FH10yzkybuqEC2HSQwpA0An7d9+73BkDUTm30bZmoP/RGbgFN+GrCOfADgqr0WbI1a1okpFms8iHYw9hm0zUvlEMivBRxModrbJJ+9/p3jUdQQ9BCtQdxnOGrT5dzRUmw0593/mbRSdBg0nRvRZM5/E16m7ZHmDEtWhwvfdZCZ8J8M12W0yRMszXamWfQTwIZ4ayYktrnscQuWr8idp3PjT2eF/jmtdhIfcpMnb+IfZY2FebW6UY/AK3jP4u3Tu4zE4qlnQgLFbM19EBIsNf7KhjdbqQ/D6yiDb+NlEi2SKD+ivXVUK8ib0oBo366gXkR8ZxGjpJIDcEgZPa9TcYe0TIbiPl/rPUQDu3XBJ9X/GNq3FAUsKsll57DzaGMrjcT+gctp+9MLYXCq+sqP81eVQ0r9lt+gcQfZbACRbEjvlMskztZG8gbC8Qn9tt26Q7y7nDrbZq/LEz7kR6Jc6pg3N9rVX8Y5MJrGlML9p9lU4jbTkKqCveeZUJjHB03m2KRKR2TytoFkTXOLg7keU1s1lrPMQJpoOKLuAAC+y1HlJucU6ysB5hsXhvSPPLq5J7JtnqHKZ4vYjC4Vy8153QY+6780xDuGARsGbOs1WqzH0QS765rnSKEbbKlkO8oI/VDwUd0is13tKpqILu1mDJFNy/iJAWcvDgjxvusIT+PGz3ST/J9r9Mtfd0jpaGeiLYIqXc7DiHSS8TcjFVksi66PEkxW1z6ujbLLUGNNYnzOWpH8BZGK4bCK7iR+MbIv8ncDAz1u4StN3vTTzewr9IQjk9wxFxn+6N1ddKs0vffJiS08N3a4G1SVrlZ97Q/M+8G9fe5AP6d9/Qq4WRnORVhofPIKEdCr3llspUfE0oKIIYoByBRPh+bX1HLS3JWGJRhIvE1aW4NTd8ePi4Z+kXb+Z8snYfSNcqijhAgVsx4RCM54cXUiYkjeBmmC4ajOHrChoELscJJC7+9jjMjw5BagZKlgRMiSNYz7h7vvZIoQqbtQmspc0cUk1G/73iXtSpROl5wtLgQi0mW2Ex8i3WULhcggx6E1LMVHUsdc9GHI1PH3U2Ko0PyGdn9KdVOLm7FPBui0i9a0HpA60MsewVE4z8CAt5d401Gv6zXlIT5Ybit1VIA0FCs7wtvYreru1fUyW3oLAZ/+aTnZrOcYRNVA8spoRtlRoWflsRClFcgzkqiHOrf0/SVw+EpVaFlJ0g4Kxq1MMOmiQdpMNpte8lMMQqm6cIFXlnGbfJllysKDi+0JJMotkqgIxOSQgU9dn/lWkeVf8nUm3iwX2Nl3WDw9i6AUK3vBAbZZrcJpDQ/N64AVwjT07Jef30GSSmtNu2WlW7YoyW2FlWfZFQUwk867EdLYKk9VG6JgEnBiBxkY7LMo4YLQJJlAo9l/oTvJkSARDF/XtyAzM8O2t3eT/iXa6wDN3WewNmQHdPfsxChU/KtLG2Mn8i4ZqKdSlIaBZadxJmRzVS/o4yA65RTSViq60oa395Lqw0pzY4SipwE0SXXsKV+GZraGSkr/RW08wPRvqvSUkYBMA9lPx4m24az+IHmCbXA+0faxTRE9wuGeO06DIXa6QlKJ3puIyiuAVfPr736vzo2pBirS+Vxel3TMm3JKhz9o2ZoRvaFVpIkykb0Hcm4oHFBMcNSNj7/4GJt43ogonY2Vg4nsDQIWxAcorpXACzgBqQPjYsE/VUpXpwNManEru4NwMCFPkXvMoqvoeLN3qyu/N1eWEHttMD65v19l/0kH2mR35iv/FI+yjoHJ9gPMz67af3Mq/BoWXqu3rphiWMXVkmnPSEkpGpUI2h1MThideGFEOK6YZHPwYzMBvpNC7+ZHxPb7epfefGyIB4JzO9DTNEYnDLVVHdQyvOEVefrk6Uv5kTQYVYWWdqrdcIl7yljwwIWdfQ/y+2QB3eR/qxYObuYyB4gTbo2in4PzarU1sO9nETkmj9/AoxDA+JM3GMqQtJR4jtduHtnoCLxd1gQUscHRB/MoRYIEsP2pDZ9KvHgtlk1iTbWWbHhohwFEYX7y51fUV2nuUmnoUcqnWIQAAgl9LTVX+Bc0QGNEhChxHR4YjfE51PUdGfsSFE6ck7BL3/hTf9jLq4G1IafINxOLKeAtO7quulYvH5YOBc+zX7CrMgWnW47/jfRsWnJjYYoE7xMfWV2HN2iyIqLI";const Bu=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),Pu=4;function Qy(e){let t=0;function n(){return e[t++]<<8|e[t++]}let r=n(),a=1,o=[0,1];for(let F=1;F<r;F++)o.push(a+=n());let i=n(),c=t;t+=i;let l=0,u=0;function d(){return l==0&&(u=u<<8|e[t++],l=8),u>>--l&1}const m=31,f=2**m,g=f>>>1,N=g>>1,h=f-1;let C=0;for(let F=0;F<m;F++)C=C<<1|d();let w=[],B=0,j=f;for(;;){let F=Math.floor(((C-B+1)*a-1)/j),_=0,M=r;for(;M-_>1;){let V=_+M>>>1;F<o[V]?M=V:_=V}if(_==0)break;w.push(_);let k=B+Math.floor(j*o[_]/a),K=B+Math.floor(j*o[_+1]/a)-1;for(;((k^K)&g)==0;)C=C<<1&h|d(),k=k<<1&h,K=K<<1&h|1;for(;k&~K&N;)C=C&g|C<<1&h>>>1|d(),k=k<<1^g,K=(K^g)<<1|g|1;B=k,j=1+K-k}let Q=r-4;return w.map(F=>{switch(F-Q){case 3:return Q+65792+(e[c++]<<16|e[c++]<<8|e[c++]);case 2:return Q+256+(e[c++]<<8|e[c++]);case 1:return Q+e[c++];default:return F-1}})}function Wy(e){let t=0;return()=>e[t++]}function Dm(e){return Wy(Qy(Jy(e)))}function Jy(e){let t=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((a,o)=>t[a.charCodeAt(0)]=o);let n=e.length,r=new Uint8Array(6*n>>3);for(let a=0,o=0,i=0,c=0;a<n;a++)c=c<<6|t[e.charCodeAt(a)],i+=6,i>=8&&(r[o++]=c>>(i-=8));return r}function Ky(e){return e&1?~e>>1:e>>1}function Yy(e,t){let n=Array(e);for(let r=0,a=0;r<e;r++)n[r]=a+=Ky(t());return n}function Do(e,t=0){let n=[];for(;;){let r=e(),a=e();if(!a)break;t+=r;for(let o=0;o<a;o++)n.push(t+o);t+=a+1}return n}function eh(e){return ei(()=>{let t=Do(e);if(t.length)return t})}function th(e){let t=[];for(;;){let n=e();if(n==0)break;t.push(Zy(n,e))}for(;;){let n=e()-1;if(n<0)break;t.push(Xy(n,e))}return t.flat()}function ei(e){let t=[];for(;;){let n=e(t.length);if(!n)break;t.push(n)}return t}function sh(e,t,n){let r=Array(e).fill().map(()=>[]);for(let a=0;a<t;a++)Yy(e,n).forEach((o,i)=>r[i].push(o));return r}function Zy(e,t){let n=1+t(),r=t(),a=ei(t);return sh(a.length,1+e,t).flatMap((i,c)=>{let[l,...u]=i;return Array(a[c]).fill().map((d,m)=>{let f=m*r;return[l+m*n,u.map(g=>g+f)]})})}function Xy(e,t){let n=1+t();return sh(n,1+e,t).map(a=>[a[0],a.slice(1)])}function Ly(e){let t=[],n=Do(e);return a(r([]),[]),t;function r(o){let i=e(),c=ei(()=>{let l=Do(e).map(u=>n[u]);if(l.length)return r(l)});return{S:i,B:c,Q:o}}function a({S:o,B:i},c,l){if(!(o&4&&l===c[c.length-1])){o&2&&(l=c[c.length-1]),o&1&&t.push(c);for(let u of i)for(let d of u.Q)a(u,[...c,d],l)}}}function Dy(e){return e.toString(16).toUpperCase().padStart(2,"0")}function nh(e){return`{${Dy(e)}}`}function e1(e){let t=[];for(let n=0,r=e.length;n<r;){let a=e.codePointAt(n);n+=a<65536?1:2,t.push(a)}return t}function Ao(e){let n=e.length;if(n<4096)return String.fromCodePoint(...e);let r=[];for(let a=0;a<n;)r.push(String.fromCodePoint(...e.slice(a,a+=4096)));return r.join("")}function t1(e,t){let n=e.length,r=n-t.length;for(let a=0;r==0&&a<n;a++)r=e[a]-t[a];return r}var s1="AEUDTAHBCFQATQDRADAAcgAgADQAFAAsABQAHwAOACQADQARAAoAFwAHABIACAAPAAUACwAFAAwABAAQAAMABwAEAAoABQAIAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACgANAA0AAwAKAAkABAAdAAYAZwDSAdsDJgC0CkMB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgsj26PTQyy8FfEQ8AY8IPAGcEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiACnwRZEkkVsS7tANAsBG0RuAQLEPABv9HICTUBXigPZwRBApMDOwAamhtaABqEAY8KvKx3LQ4ArAB8UhwEBAVSagD8AEFZADkBIadVj2UMUgx5Il4ANQC9AxIB1BlbEPMAs30CGxlXAhwZKQIECBc6EbsCoxngzv7UzRQA8M0BawL6ZwkN7wABAD33OQRcsgLJCjMCjqUChtw/km+NAsXPAoP2BT84PwURAK0RAvptb6cApQS/OMMey5HJS84UdxpxTPkCogVFITaTOwERAK5pAvkNBOVyA7q3BKlOJSALAgUIBRcEdASpBXqzABXFSWZOawLCOqw//AolCZdvv3dSBkEQGyelEPcMMwG1ATsN7UvYBPEGOwTJH30ZGQ/NlZwIpS3dDO0m4y6hgFoj9SqDBe1L9DzdC01RaA9ZC2UJ4zpjgU4DIQENIosK3Q05CG0Q8wrJaw3lEUUHOQPVSZoApQcBCxEdNRW1JhBirAsJOXcG+xr2C48mrxMpevwF0xohBk0BKRr/AM8u54WwWjFcHE9fBgMLJSPHFKhQIA0lQLd4SBobBxUlqQKRQ3BKh1E2HpMh9jw9DWYuE1F8B/U8BRlPC4E8nkarRQ4R0j6NPUgiSUwsBDV/LC8niwnPD4UMuXxyAVkJIQmxDHETMREXN8UIOQcZLZckJxUIIUaVYJoE958D8xPRAwsFPwlBBxMDtRwtEy4VKQUNgSTXAvM21S6zAo9WgAEXBcsPJR/fEFBH4A7pCJsCZQODJesALRUhABcimwhDYwBfj9hTBS7LCMdqbCN0A2cU52ERcweRDlcHpxwzFb8c4XDIXguGCCijrwlbAXUJmQFfBOMICTVbjKAgQWdTi1gYmyBhQT9d/AIxDGUVn0S9h3gCiw9rEhsBNQFzBzkNAQJ3Ee0RaxCVCOuGBDW1M/g6JQRPIYMgEQonA09szgsnJvkM+GkBoxJiAww0PXfuZ6tgtiQX/QcZMsVBYCHxC5JPzQycGsEYQlQuGeQHvwPzGvMn6kFXBf8DowMTOk0z7gS9C2kIiwk/AEkOoxcH1xhqCnGM0AExiwG3mQNXkYMCb48GNwcLAGcLhwV55QAdAqcIowAFAM8DVwA5Aq0HnQAZAIVBAT0DJy8BIeUCjwOTCDHLAZUvAfMpBBvDDBUA9zduSgLDsQKAamaiBd1YAo4CSTUBTSUEBU5HUQOvceEA2wBLBhPfRwEVq0rLGuNDAd9vKwDHAPsABTUHBUEBzQHzbQC3AV8LMQmis7UBTekpAIMAFWsB1wKJAN0ANQB/8QFTAE0FWfkF0wJPSQERMRgrV2EBuwMfATMBDQB5BsuNpckHHwRtB9MCEBsV4QLvLge1AQMi3xPNQsUCvd5VoWACZIECYkJbTa9bNyACofcCaJgCZgkCn4Q4GwsCZjsCZiYEbgR/A38TA36SOQY5dxc5gjojIwJsHQIyNjgKAm3HAm2u74ozZ0UrAWcA3gDhAEoFB5gMjQD+C8IADbUCdy8CdqI/AnlLQwJ4uh1c20WuRtcCfD8CesgCfQkCfPAFWQUgSABIfWMkAoFtAoAAAoAFAn+uSVhKWxUXSswC0QEC0MxLJwOITwOH5kTFkTIC8qFdAwMDrkvOTC0lA89NTE2vAos/AorYwRsHHUNnBbcCjjcCjlxAl4ECjtkCjlx4UbRTNQpS1FSFApP7ApMMAOkAHFUeVa9V0AYsGymVhjLheGZFOzkCl58C77JYIagAWSUClo8ClnycAKlZrFoJgU0AOwKWtQKWTlxEXNECmcsCmWRcyl0HGQKcmznCOp0CnBYCn5sCnriKAB0PMSoPAp3xAp6SALU9YTRh7wKe0wKgbgGpAp6fHwKeTqVjyGQnJSsCJ68CJn4CoPsCoEwCot0CocQCpi8Cpc4Cp/8AfQKn8mh8aLEAA0lqHGrRAqzjAqyuAq1nAq0CAlcdAlXcArHh1wMfTmyXArK9DQKy6Bds4G1jbUhfAyXNArZcOz9ukAMpRQK4XgK5RxUCuSp3cDZw4QK9GQK72nCWAzIRAr6IcgIDM3ECvhpzInNPAsPLAsMEc4J0SzVFdOADPKcDPJoDPb8CxXwCxkcCxhCJAshpUQLIRALJTwLJLgJknQLd0nh5YXiueSVL0AMYo2cCAmH0GfOVJHsLXpJeuxECz2sCz2wvS1PS8xOfAMatAs9zASnqA04SfksFAtwnAtuKAtJPA1JcA1NfAQEDVYyAiT8AyxbtYEWCHILTgs6DjQLaxwLZ3oQQhEmnPAOGpQAvA2QOhnFZ+QBVAt9lAt64c3cC4i/tFAHzMCcB9JsB8tKHAuvzAulweQLq+QLq5AD5RwG5Au6JAuuclqqXAwLuPwOF4Jh5cOBxoQLzAwBpA44WmZMC9xMDkW4DkocC95gC+dkC+GaaHJqruzebHgOdgwL++gEbADmfHJ+zAwWNA6ZqA6bZANHFAwZqoYiiBQkDDEkCwAA/AwDhQRdTARHzA2sHl2cFAJMtK7evvdsBiZkUfxEEOQH7KQUhDp0JnwCS/SlXxQL3AZ0AtwW5AG8LbUEuFCaNLgFDAYD8AbUmAHUDDgRtACwCFgyhAAAKAj0CagPdA34EkQEgRQUhfAoABQBEABMANhICdwEABdUDa+8KxQIA9wqfJ7+xt+UBkSFBQgHpFH8RNMCJAAQAGwBaAkUChIsABjpTOpSNbQC4Oo860ACNOME63AClAOgAywE6gTo7Ofw5+Tt2iTpbO56JOm85GAFWATMBbAUvNV01njWtNWY1dTW2NcU1gjWRNdI14TWeNa017jX9NbI1wTYCNhE1xjXVNhY2JzXeNe02LjY9Ni41LSE2OjY9Njw2yTcIBJA8VzY4Nt03IDcPNsogN4k3MAoEsDxnNiQ3GTdsOo03IULUQwdC4EMLHA8PCZsobShRVQYA6X8A6bABFCnXAukBowC9BbcAbwNzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgBFLWZAu0BhQCjBcEAbykBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUABavAj626xQAJP0A3etzuf4NNRA7efy2Z9NQrCnC0OSyANz5BBIbJ5IFDR6miIavYS6tprjjmuKebxm5C74Q225X1pkaYYPb6f1DK4k3xMEBb9S2WMjEibTNWhsRJIA+vwNVEiXTE5iXs/wezV66oFLfp9NZGYW+Gk19J2+bCT6Ye2w6LDYdgzKMUabk595eLBCXANz9HUpWbATq9vqXVx9XDg+Pc9Xp4+bsS005SVM/BJBM4687WUuf+Uj9dEi8aDNaPxtpbDxcG1THTImUMZq4UCaaNYpsVqraNyKLJXDYsFZ/5jl7bLRtO88t7P3xZaAxhb5OdPMXqsSkp1WCieG8jXm1U99+blvLlXzPCS+M93VnJCiK+09LfaSaBAVBomyDgJua8dfUzR7ga34IvR2Nvj+A9heJ6lsl1KG4NkI1032Cnff1m1wof2B9oHJK4bi6JkEdSqeNeiuo6QoZZincoc73/TH9SXF8sCE7XyuYyW8WSgbGFCjPV0ihLKhdPs08Tx82fYAkLLc4I2wdl4apY7GU5lHRFzRWJep7Ww3wbeA3qmd59/86P4xuNaqDpygXt6M85glSBHOCGgJDnt+pN9bK7HApMguX6+06RZNjzVmcZJ+wcUrJ9//bpRNxNuKpNl9uFds+S9tdx7LaM5ZkIrPj6nIU9mnbFtVbs9s/uLgl8MVczAwet+iOEzzBlYW7RCMgE6gyNLeq6+1tIx4dpgZnd0DksJS5f+JNDpwwcPNXaaVspq1fbQajOrJgK0ofKtJ1Ne90L6VO4MOl5S886p7u6xo7OLjG8TGL+HU1JXGJgppg4nNbNJ5nlzSpuPYy21JUEcUA94PoFiZfjZue+QnyQ80ekOuZVkxx4g+cvhJfHgNl4hy1/a6+RKcKlar/J29y//EztlbVPHVUeQ1zX86eQVAjR/M3dA9w4W8LfaXp4EgM85wOWasli837PzVMOnsLzR+k3o75/lRPAJSE1xAKQzEi5v10ke+VBvRt1cwQRMd+U5mLCTGVd6XiZtgBG5cDi0w22GKcVNvHiu5LQbZEDVtz0onn7k5+heuKXVsZtSzilkLRAUmjMXEMB3J9YC50XBxPiz53SC+EhnPl9WsKCv92SM/OFFIMJZYfl0WW8tIO3UxYcwdMAj7FSmgrsZ2aAZO03BOhP1bNNZItyXYQFTpC3SG1VuPDqH9GkiCDmE+JwxyIVSO5siDErAOpEXFgjy6PQtOVDj+s6e1r8heWVvmZnTciuf4EiNZzCAd7SOMhXERIOlsHIMG399i9aLTy3m2hRLZjJVDNLS53iGIK11dPqQt0zBDyg6qc7YqkDm2M5Ve6dCWCaCbTXX2rToaIgz6+zh4lYUi/+6nqcFMAkQJKHYLK0wYk5N9szV6xihDbDDFr45lN1K4aCXBq/FitPSud9gLt5ZVn+ZqGX7cwm2z5EGMgfFpIFyhGGuDPmso6TItTMwny+7uPnLCf4W6goFQFV0oQSsc9VfMmVLcLr6ZetDZbaSFTLqnSO/bIPjA3/zAUoqgGFAEQS4IhuMzEp2I3jJzbzkk/IEmyax+rhZTwd6f+CGtwPixu8IvzACquPWPREu9ZvGkUzpRwvRRuaNN6cr0W1wWits9ICdYJ7ltbgMiSL3sTPeufgNcVqMVWFkCPDH4jG2jA0XcVgQj62Cb29v9f/z/+2KbYvIv/zzjpQAPkliaVDzNrW57TZ/ZOyZD0nlfMmAIBIAGAI0D3k/mdN4xr9v85ZbZbbqfH2jGd5hUqNZWwl5SPfoGmfElmazUIeNL1j/mkF7VNAzTq4jNt8JoQ11NQOcmhprXoxSxfRGJ9LDEOAQ+dmxAQH90iti9e2u/MoeuaGcDTHoC+xsmEeWmxEKefQuIzHbpw5Tc5cEocboAD09oipWQhtTO1wivf/O+DRe2rpl/E9wlrzBorjJsOeG1B/XPW4EaJEFdNlECEZga5ZoGRHXgYouGRuVkm8tDESiEyFNo+3s5M5puSdTyUL2llnINVHEt91XUNW4ewdMgJ4boJfEyt/iY5WXqbA+A2Fkt5Z0lutiWhe9nZIyIUjyXDC3UsaG1t+eNx6z4W/OYoTB7A6x+dNSTOi9AInctbESqm5gvOLww7OWXPrmHwVZasrl4eD113pm+JtT7JVOvnCXqdzzdTRHgJ0PiGTFYW5Gvt9R9LD6Lzfs0v/TZZHSmyVNq7viIHE6DBK7Qp07Iz55EM8SYtQvZf/obBniTWi5C2/ovHfw4VndkE5XYdjOhCMRjDeOEfXeN/CwfGduiUIfsoFeUxXeQXba7c7972XNv8w+dTjjUM0QeNAReW+J014dKAD/McQYXT7c0GQPIkn3Ll6R7gGjuiQoZD0TEeEqQpKoZ15g/0OPQI17QiSv9AUROa/V/TQN3dvLArec3RrsYlvBm1b8LWzltdugsC50lNKYLEp2a+ZZYqPejULRlOJh5zj/LVMyTDvwKhMxxwuDkxJ1QpoNI0OTWLom4Z71SNzI9TV1iXJrIu9Wcnd+MCaAw8o1jSXd94YU/1gnkrC9BUEOtQvEIQ7g0i6h+KL2JKk8Ydl7HruvgWMSAmNe+LshGhV4qnWHhO9/RIPQzY1tHRj2VqOyNsDpK0cww+56AdDC4gsWwY0XxoucIWIqs/GcwnWqlaT0KPr8mbK5U94/301i1WLt4YINTVvCFBrFZbIbY8eycOdeJ2teD5IfPLCRg7jjcFTwlMFNl9zdh/o3E/hHPwj7BWg0MU09pPrBLbrCgm54A6H+I6v27+jL5gkjWg/iYdks9jbfVP5y/n0dlgWEMlKasl7JvFZd56LfybW1eeaVO0gxTfXZwD8G4SI116yx7UKVRgui6Ya1YpixqXeNLc8IxtAwCU5IhwQgn+NqHnRaDv61CxKhOq4pOX7M6pkA+Pmpd4j1vn6ACUALoLLc4vpXci8VidLxzm7qFBe7s+quuJs6ETYmnpgS3LwSZxPIltgBDXz8M1k/W2ySNv2f9/NPhxLGK2D21dkHeSGmenRT3Yqcdl0m/h3OYr8V+lXNYGf8aCCpd4bWjE4QIPj7vUKN4Nrfs7ML6Y2OyS830JCnofg/k7lpFpt4SqZc5HGg1HCOrHvOdC8bP6FGDbE/VV0mX4IakzbdS/op+Kt3G24/8QbBV7y86sGSQ/vZzU8FXs7u6jIvwchsEP2BpIhW3G8uWNwa3HmjfH/ZjhhCWvluAcF+nMf14ClKg5hGgtPLJ98ueNAkc5Hs2WZlk2QHvfreCK1CCGO6nMZVSb99VM/ajr8WHTte9JSmkXq/i/U943HEbdzW6Re/S88dKgg8pGOLlAeNiqrcLkUR3/aClFpMXcOUP3rmETcWSfMXZE3TUOi8i+fqRnTYLflVx/Vb/6GJ7eIRZUA6k3RYR3iFSK9c4iDdNwJuZL2FKz/IK5VimcNWEqdXjSoxSgmF0UPlDoUlNrPcM7ftmA8Y9gKiqKEHuWN+AZRIwtVSxye2Kf8rM3lhJ5XcBXU9n4v0Oy1RU2M+4qM8AQPVwse8ErNSob5oFPWxuqZnVzo1qB/IBxkM3EVUKFUUlO3e51259GgNcJbCmlvrdjtoTW7rChm1wyCKzpCTwozUUEOIcWLneRLgMXh+SjGSFkAllzbGS5HK7LlfCMRNRDSvbQPjcXaenNYxCvu2Qyznz6StuxVj66SgI0T8B6/sfHAJYZaZ78thjOSIFumNWLQbeZixDCCC+v0YBtkxiBB3jefHqZ/dFHU+crbj6OvS1x/JDD7vlm7zOVPwpUC01nhxZuY/63E7g";const ti=44032,rc=4352,ac=4449,oc=4519,rh=19,ah=21,To=28,ic=ah*To,n1=rh*ic,r1=ti+n1,a1=rc+rh,o1=ac+ah,i1=oc+To;function zo(e){return e>>24&255}function oh(e){return e&16777215}let Bl,Mu,Pl,Gi;function c1(){let e=Dm(s1);Bl=new Map(eh(e).flatMap((t,n)=>t.map(r=>[r,n+1<<24]))),Mu=new Set(Do(e)),Pl=new Map,Gi=new Map;for(let[t,n]of th(e)){if(!Mu.has(t)&&n.length==2){let[r,a]=n,o=Gi.get(r);o||(o=new Map,Gi.set(r,o)),o.set(a,t)}Pl.set(t,n.reverse())}}function ih(e){return e>=ti&&e<r1}function l1(e,t){if(e>=rc&&e<a1&&t>=ac&&t<o1)return ti+(e-rc)*ic+(t-ac)*To;if(ih(e)&&t>oc&&t<i1&&(e-ti)%To==0)return e+(t-oc);{let n=Gi.get(e);return n&&(n=n.get(t),n)?n:-1}}function ch(e){Bl||c1();let t=[],n=[],r=!1;function a(o){let i=Bl.get(o);i&&(r=!0,o|=i),t.push(o)}for(let o of e)for(;;){if(o<128)t.push(o);else if(ih(o)){let i=o-ti,c=i/ic|0,l=i%ic/To|0,u=i%To;a(rc+c),a(ac+l),u>0&&a(oc+u)}else{let i=Pl.get(o);i?n.push(...i):a(o)}if(!n.length)break;o=n.pop()}if(r&&t.length>1){let o=zo(t[0]);for(let i=1;i<t.length;i++){let c=zo(t[i]);if(c==0||o<=c){o=c;continue}let l=i-1;for(;;){let u=t[l+1];if(t[l+1]=t[l],t[l]=u,!l||(o=zo(t[--l]),o<=c))break}o=zo(t[i])}}return t}function d1(e){let t=[],n=[],r=-1,a=0;for(let o of e){let i=zo(o),c=oh(o);if(r==-1)i==0?r=c:t.push(c);else if(a>0&&a>=i)i==0?(t.push(r,...n),n.length=0,r=c):n.push(c),a=i;else{let l=l1(r,c);l>=0?r=l:a==0&&i==0?(t.push(r),r=c):(n.push(c),a=i)}}return r>=0&&t.push(r,...n),t}function lh(e){return ch(e).map(oh)}function u1(e){return d1(ch(e))}const Ou=45,dh=".",uh=65039,mh=1,cc=e=>Array.from(e);function si(e,t){return e.P.has(t)||e.Q.has(t)}class m1 extends Array{get is_emoji(){return!0}}let Ml,hh,vr,Ol,fh,Aa,sl,fa,fr,_u,_l;function Cd(){if(Ml)return;let e=Dm(qy);const t=()=>Do(e),n=()=>new Set(t()),r=(d,m)=>m.forEach(f=>d.add(f));Ml=new Map(th(e)),hh=n(),vr=t(),Ol=new Set(t().map(d=>vr[d])),vr=new Set(vr),fh=n(),n();let a=eh(e),o=e();const i=()=>{let d=new Set;return t().forEach(m=>r(d,a[m])),r(d,t()),d};Aa=ei(d=>{let m=ei(e).map(f=>f+96);if(m.length){let f=d>=o;m[0]-=32,m=Ao(m),f&&(m=`Restricted[${m}]`);let g=i(),N=i(),h=!e();return{N:m,P:g,Q:N,M:h,R:f}}}),sl=n(),fa=new Map;let c=t().concat(cc(sl)).sort((d,m)=>d-m);c.forEach((d,m)=>{let f=e(),g=c[m]=f?c[m-f]:{V:[],M:new Map};g.V.push(d),sl.has(d)||fa.set(d,g)});for(let{V:d,M:m}of new Set(fa.values())){let f=[];for(let N of d){let h=Aa.filter(w=>si(w,N)),C=f.find(({G:w})=>h.some(B=>w.has(B)));C||(C={G:new Set,V:[]},f.push(C)),C.V.push(N),r(C.G,h)}let g=f.flatMap(N=>cc(N.G));for(let{G:N,V:h}of f){let C=new Set(g.filter(w=>!N.has(w)));for(let w of h)m.set(w,C)}}fr=new Set;let l=new Set;const u=d=>fr.has(d)?l.add(d):fr.add(d);for(let d of Aa){for(let m of d.P)u(m);for(let m of d.Q)u(m)}for(let d of fr)!fa.has(d)&&!l.has(d)&&fa.set(d,mh);r(fr,lh(fr)),_u=Ly(e).map(d=>m1.from(d)).sort(t1),_l=new Map;for(let d of _u){let m=[_l];for(let f of d){let g=m.map(N=>{let h=N.get(f);return h||(h=new Map,N.set(f,h)),h});f===uh?m.push(...g):m=g}for(let f of m)f.V=d}}function kd(e){return(ph(e)?"":`${Ad(Mc([e]))} `)+nh(e)}function Ad(e){return`"${e}"â€Ž`}function h1(e){if(e.length>=4&&e[2]==Ou&&e[3]==Ou)throw new Error(`invalid label extension: "${Ao(e.slice(0,4))}"`)}function f1(e){for(let n=e.lastIndexOf(95);n>0;)if(e[--n]!==95)throw new Error("underscore allowed only at start")}function p1(e){let t=e[0],n=Bu.get(t);if(n)throw Jo(`leading ${n}`);let r=e.length,a=-1;for(let o=1;o<r;o++){t=e[o];let i=Bu.get(t);if(i){if(a==o)throw Jo(`${n} + ${i}`);a=o+1,n=i}}if(a==r)throw Jo(`trailing ${n}`)}function Mc(e,t=1/0,n=nh){let r=[];g1(e[0])&&r.push("â—Œ"),e.length>t&&(t>>=1,e=[...e.slice(0,t),8230,...e.slice(-t)]);let a=0,o=e.length;for(let i=0;i<o;i++){let c=e[i];ph(c)&&(r.push(Ao(e.slice(a,i))),r.push(n(c)),a=i+1)}return r.push(Ao(e.slice(a,o))),r.join("")}function g1(e){return Cd(),vr.has(e)}function ph(e){return Cd(),fh.has(e)}function x1(e){return w1(b1(e,u1,C1))}function b1(e,t,n){if(!e)return[];Cd();let r=0;return e.split(dh).map(a=>{let o=e1(a),i={input:o,offset:r};r+=o.length+1;try{let c=i.tokens=j1(o,t,n),l=c.length,u;if(!l)throw new Error("empty label");let d=i.output=c.flat();if(f1(d),!(i.emoji=l>1||c[0].is_emoji)&&d.every(f=>f<128))h1(d),u="ASCII";else{let f=c.flatMap(g=>g.is_emoji?[]:g);if(!f.length)u="Emoji";else{if(vr.has(d[0]))throw Jo("leading combining mark");for(let h=1;h<l;h++){let C=c[h];if(!C.is_emoji&&vr.has(C[0]))throw Jo(`emoji + combining mark: "${Ao(c[h-1])} + ${Mc([C[0]])}"`)}p1(d);let g=cc(new Set(f)),[N]=N1(g);v1(N,f),y1(N,g),u=N.N}}i.type=u}catch(c){i.error=c}return i})}function y1(e,t){let n,r=[];for(let a of t){let o=fa.get(a);if(o===mh)return;if(o){let i=o.M.get(a);if(n=n?n.filter(c=>i.has(c)):cc(i),!n.length)return}else r.push(a)}if(n){for(let a of n)if(r.every(o=>si(a,o)))throw new Error(`whole-script confusable: ${e.N}/${a.N}`)}}function N1(e){let t=Aa;for(let n of e){let r=t.filter(a=>si(a,n));if(!r.length)throw Aa.some(a=>si(a,n))?xh(t[0],n):gh(n);if(t=r,r.length==1)break}return t}function w1(e){return e.map(({input:t,error:n,output:r})=>{if(n){let a=n.message;throw new Error(e.length==1?a:`Invalid label ${Ad(Mc(t,63))}: ${a}`)}return Ao(r)}).join(dh)}function gh(e){return new Error(`disallowed character: ${kd(e)}`)}function xh(e,t){let n=kd(t),r=Aa.find(a=>a.P.has(t));return r&&(n=`${r.N} ${n}`),new Error(`illegal mixture: ${e.N} + ${n}`)}function Jo(e){return new Error(`illegal placement: ${e}`)}function v1(e,t){for(let n of t)if(!si(e,n))throw xh(e,n);if(e.M){let n=lh(t);for(let r=1,a=n.length;r<a;r++)if(Ol.has(n[r])){let o=r+1;for(let i;o<a&&Ol.has(i=n[o]);o++)for(let c=r;c<o;c++)if(n[c]==i)throw new Error(`duplicate non-spacing marks: ${kd(i)}`);if(o-r>Pu)throw new Error(`excessive non-spacing marks: ${Ad(Mc(n.slice(r-1,o)))} (${o-r}/${Pu})`);r=o}}}function j1(e,t,n){let r=[],a=[];for(e=e.slice().reverse();e.length;){let o=k1(e);if(o)a.length&&(r.push(t(a)),a=[]),r.push(n(o));else{let i=e.pop();if(fr.has(i))a.push(i);else{let c=Ml.get(i);if(c)a.push(...c);else if(!hh.has(i))throw gh(i)}}}return a.length&&r.push(t(a)),r}function C1(e){return e.filter(t=>t!=uh)}function k1(e,t){let n=_l,r,a=e.length;for(;a&&(n=n.get(e[--a]),!!n);){let{V:o}=n;o&&(r=o,e.length=a)}return r}const bh=new Uint8Array(32);bh.fill(0);function Iu(e){return D(e.length!==0,"invalid ENS name; empty component","comp",e),e}function Td(e){const t=tn(A1(e)),n=[];if(e.length===0)return n;let r=0;for(let a=0;a<t.length;a++)t[a]===46&&(n.push(Iu(t.slice(r,a))),r=a+1);return D(r<t.length,"invalid ENS name; empty component","name",e),n.push(Iu(t.slice(r))),n}function A1(e){try{if(e.length===0)throw new Error("empty label");return x1(e)}catch(t){D(!1,`invalid ENS name (${t.message})`,"name",e)}}function A6(e){try{return Td(e).length!==0}catch{}return!1}function Il(e){D(typeof e=="string","invalid ENS name; not a string","name",e),D(e.length,"invalid ENS name (empty label)","name",e);let t=bh;const n=Td(e);for(;n.length;)t=kt(wt([t,kt(n.pop())]));return Se(t)}function T1(e,t){const n=t??63;return D(n<=255,"DNS encoded label cannot exceed 255","length",n),Se(wt(Td(e).map(r=>{D(r.length<=n,`label ${JSON.stringify(e)} exceeds ${n} bytes`,"name",e);const a=new Uint8Array(r.length+1);return a.set(r,1),a[0]=a.length-1,a})))+"00"}const yh=new Uint8Array(32);yh.fill(0);const E1=BigInt(-1),Nh=BigInt(0),wh=BigInt(1),S1=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function F1(e){const t=We(e),n=t.length%32;return n?wt([t,yh.slice(n)]):Se(t)}const R1=rr(wh,32),B1=rr(Nh,32),Uu={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},nl=["name","version","chainId","verifyingContract","salt"];function $u(e){return function(t){return D(typeof t=="string",`invalid domain value for ${JSON.stringify(e)}`,`domain.${e}`,t),t}}const P1={name:$u("name"),version:$u("version"),chainId:function(e){const t=Be(e,"domain.chainId");return D(t>=0,"invalid chain ID","domain.chainId",e),Number.isSafeInteger(t)?Number(t):Ps(t)},verifyingContract:function(e){try{return nt(e).toLowerCase()}catch{}D(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",e)},salt:function(e){const t=We(e,"domain.salt");return D(t.length===32,'invalid domain value "salt"',"domain.salt",e),Se(t)}};function rl(e){{const t=e.match(/^(u?)int(\d+)$/);if(t){const n=t[1]==="",r=parseInt(t[2]);D(r%8===0&&r!==0&&r<=256&&t[2]===String(r),"invalid numeric width","type",e);const a=Nr(S1,n?r-1:r),o=n?(a+wh)*E1:Nh;return function(i){const c=Be(i,"value");return D(c>=o&&c<=a,`value out-of-bounds for ${e}`,"value",c),rr(n?tm(c,256):c,32)}}}{const t=e.match(/^bytes(\d+)$/);if(t){const n=parseInt(t[1]);return D(n!==0&&n<=32&&t[1]===String(n),"invalid bytes width","type",e),function(r){const a=We(r);return D(a.length===n,`invalid length for ${e}`,"value",r),F1(r)}}}switch(e){case"address":return function(t){return En(nt(t),32)};case"bool":return function(t){return t?R1:B1};case"bytes":return function(t){return kt(t)};case"string":return function(t){return Kr(t)}}return null}function Vu(e,t){return`${e}(${t.map(({name:n,type:r})=>r+" "+n).join(",")})`}function Oi(e){const t=e.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return t?{base:t[1],index:t[2]+t[4],array:{base:t[1],prefix:t[1]+t[2],count:t[5]?parseInt(t[5]):-1}}:{base:e}}var ui,xn,La,pc,vh;const fs=class fs{constructor(t){me(this,pc);ie(this,"primaryType");me(this,ui);me(this,xn);me(this,La);I(this,xn,new Map),I(this,La,new Map);const n=new Map,r=new Map,a=new Map,o={};Object.keys(t).forEach(l=>{o[l]=t[l].map(({name:u,type:d})=>{let{base:m,index:f}=Oi(d);return m==="int"&&!t.int&&(m="int256"),m==="uint"&&!t.uint&&(m="uint256"),{name:u,type:m+(f||"")}}),n.set(l,new Set),r.set(l,[]),a.set(l,new Set)}),I(this,ui,JSON.stringify(o));for(const l in o){const u=new Set;for(const d of o[l]){D(!u.has(d.name),`duplicate variable name ${JSON.stringify(d.name)} in ${JSON.stringify(l)}`,"types",t),u.add(d.name);const m=Oi(d.type).base;D(m!==l,`circular type reference to ${JSON.stringify(m)}`,"types",t),!rl(m)&&(D(r.has(m),`unknown type ${JSON.stringify(m)}`,"types",t),r.get(m).push(l),n.get(l).add(m))}}const i=Array.from(r.keys()).filter(l=>r.get(l).length===0);D(i.length!==0,"missing primary type","types",t),D(i.length===1,`ambiguous primary types or unused types: ${i.map(l=>JSON.stringify(l)).join(", ")}`,"types",t),$e(this,{primaryType:i[0]});function c(l,u){D(!u.has(l),`circular type reference to ${JSON.stringify(l)}`,"types",t),u.add(l);for(const d of n.get(l))if(r.has(d)){c(d,u);for(const m of u)a.get(m).add(d)}u.delete(l)}c(this.primaryType,new Set);for(const[l,u]of a){const d=Array.from(u);d.sort(),y(this,xn).set(l,Vu(l,o[l])+d.map(m=>Vu(m,o[m])).join(""))}}get types(){return JSON.parse(y(this,ui))}getEncoder(t){let n=y(this,La).get(t);return n||(n=Ce(this,pc,vh).call(this,t),y(this,La).set(t,n)),n}encodeType(t){const n=y(this,xn).get(t);return D(n,`unknown type: ${JSON.stringify(t)}`,"name",t),n}encodeData(t,n){return this.getEncoder(t)(n)}hashStruct(t,n){return kt(this.encodeData(t,n))}encode(t){return this.encodeData(this.primaryType,t)}hash(t){return this.hashStruct(this.primaryType,t)}_visit(t,n,r){if(rl(t))return r(t,n);const a=Oi(t).array;if(a)return D(a.count===-1||a.count===n.length,`array length mismatch; expected length ${a.count}`,"value",n),n.map(i=>this._visit(a.prefix,i,r));const o=this.types[t];if(o)return o.reduce((i,{name:c,type:l})=>(i[c]=this._visit(l,n[c],r),i),{});D(!1,`unknown type: ${t}`,"type",t)}visit(t,n){return this._visit(this.primaryType,t,n)}static from(t){return new fs(t)}static getPrimaryType(t){return fs.from(t).primaryType}static hashStruct(t,n,r){return fs.from(n).hashStruct(t,r)}static hashDomain(t){const n=[];for(const r in t){if(t[r]==null)continue;const a=Uu[r];D(a,`invalid typed-data domain key: ${JSON.stringify(r)}`,"domain",t),n.push({name:r,type:a})}return n.sort((r,a)=>nl.indexOf(r.name)-nl.indexOf(a.name)),fs.hashStruct("EIP712Domain",{EIP712Domain:n},t)}static encode(t,n,r){return wt(["0x1901",fs.hashDomain(t),fs.from(n).hash(r)])}static hash(t,n,r){return kt(fs.encode(t,n,r))}static async resolveNames(t,n,r,a){t=Object.assign({},t);for(const c in t)t[c]==null&&delete t[c];const o={};t.verifyingContract&&!dt(t.verifyingContract,20)&&(o[t.verifyingContract]="0x");const i=fs.from(n);i.visit(r,(c,l)=>(c==="address"&&!dt(l,20)&&(o[l]="0x"),l));for(const c in o)o[c]=await a(c);return t.verifyingContract&&o[t.verifyingContract]&&(t.verifyingContract=o[t.verifyingContract]),r=i.visit(r,(c,l)=>c==="address"&&o[l]?o[l]:l),{domain:t,value:r}}static getPayload(t,n,r){fs.hashDomain(t);const a={},o=[];nl.forEach(l=>{const u=t[l];u!=null&&(a[l]=P1[l](u),o.push({name:l,type:Uu[l]}))});const i=fs.from(n);n=i.types;const c=Object.assign({},n);return D(c.EIP712Domain==null,"types must not contain EIP712Domain type","types.EIP712Domain",n),c.EIP712Domain=o,i.encode(r),{types:c,domain:a,primaryType:i.primaryType,message:i.visit(r,(l,u)=>{if(l.match(/^bytes(\d*)/))return Se(We(u));if(l.match(/^u?int/))return Be(u).toString();switch(l){case"address":return u.toLowerCase();case"bool":return!!u;case"string":return D(typeof u=="string","invalid string","value",u),u}D(!1,"unsupported type","type",l)})}}};ui=new WeakMap,xn=new WeakMap,La=new WeakMap,pc=new WeakSet,vh=function(t){{const a=rl(t);if(a)return a}const n=Oi(t).array;if(n){const a=n.prefix,o=this.getEncoder(a);return i=>{D(n.count===-1||n.count===i.length,`array length mismatch; expected length ${n.count}`,"value",i);let c=i.map(o);return y(this,xn).has(a)&&(c=c.map(kt)),kt(wt(c))}}const r=this.types[t];if(r){const a=Kr(y(this,xn).get(t));return o=>{const i=r.map(({name:c,type:l})=>{const u=this.getEncoder(l)(o[c]);return y(this,xn).has(l)?kt(u):u});return i.unshift(a),wt(i)}}D(!1,`unknown type: ${t}`,"type",t)};let ni=fs;function T6(e,t,n,r){return Lm(ni.hash(e,t,n),r)}function Xt(e){const t=new Set;return e.forEach(n=>t.add(n)),Object.freeze(t)}const M1="external public payable override",O1=Xt(M1.split(" ")),jh="constant external internal payable private public pure view override",_1=Xt(jh.split(" ")),Ch="constructor error event fallback function receive struct",kh=Xt(Ch.split(" ")),Ah="calldata memory storage payable indexed",I1=Xt(Ah.split(" ")),U1="tuple returns",$1=[Ch,Ah,U1,jh].join(" "),V1=Xt($1.split(" ")),G1={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},H1=new RegExp("^(\\s*)"),z1=new RegExp("^([0-9]+)"),q1=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),Th=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),Eh=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");var _t,Rs,mi,Ul;const gc=class gc{constructor(t){me(this,mi);me(this,_t);me(this,Rs);I(this,_t,0),I(this,Rs,t.slice())}get offset(){return y(this,_t)}get length(){return y(this,Rs).length-y(this,_t)}clone(){return new gc(y(this,Rs))}reset(){I(this,_t,0)}popKeyword(t){const n=this.peek();if(n.type!=="KEYWORD"||!t.has(n.text))throw new Error(`expected keyword ${n.text}`);return this.pop().text}popType(t){if(this.peek().type!==t){const n=this.peek();throw new Error(`expected ${t}; got ${n.type} ${JSON.stringify(n.text)}`)}return this.pop().text}popParen(){const t=this.peek();if(t.type!=="OPEN_PAREN")throw new Error("bad start");const n=Ce(this,mi,Ul).call(this,y(this,_t)+1,t.match+1);return I(this,_t,t.match+1),n}popParams(){const t=this.peek();if(t.type!=="OPEN_PAREN")throw new Error("bad start");const n=[];for(;y(this,_t)<t.match-1;){const r=this.peek().linkNext;n.push(Ce(this,mi,Ul).call(this,y(this,_t)+1,r)),I(this,_t,r)}return I(this,_t,t.match+1),n}peek(){if(y(this,_t)>=y(this,Rs).length)throw new Error("out-of-bounds");return y(this,Rs)[y(this,_t)]}peekKeyword(t){const n=this.peekType("KEYWORD");return n!=null&&t.has(n)?n:null}peekType(t){if(this.length===0)return null;const n=this.peek();return n.type===t?n.text:null}pop(){const t=this.peek();return Oo(this,_t)._++,t}toString(){const t=[];for(let n=y(this,_t);n<y(this,Rs).length;n++){const r=y(this,Rs)[n];t.push(`${r.type}:${r.text}`)}return`<TokenString ${t.join(" ")}>`}};_t=new WeakMap,Rs=new WeakMap,mi=new WeakSet,Ul=function(t=0,n=0){return new gc(y(this,Rs).slice(t,n).map(r=>Object.freeze(Object.assign({},r,{match:r.match-t,linkBack:r.linkBack-t,linkNext:r.linkNext-t}))))};let Us=gc;function ir(e){const t=[],n=i=>{const c=o<e.length?JSON.stringify(e[o]):"$EOI";throw new Error(`invalid token ${c} at ${o}: ${i}`)};let r=[],a=[],o=0;for(;o<e.length;){let i=e.substring(o),c=i.match(H1);c&&(o+=c[1].length,i=e.substring(o));const l={depth:r.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:o,value:-1};t.push(l);let u=G1[i[0]]||"";if(u){if(l.type=u,l.text=i[0],o++,u==="OPEN_PAREN")r.push(t.length-1),a.push(t.length-1);else if(u=="CLOSE_PAREN")r.length===0&&n("no matching open bracket"),l.match=r.pop(),t[l.match].match=t.length-1,l.depth--,l.linkBack=a.pop(),t[l.linkBack].linkNext=t.length-1;else if(u==="COMMA")l.linkBack=a.pop(),t[l.linkBack].linkNext=t.length-1,a.push(t.length-1);else if(u==="OPEN_BRACKET")l.type="BRACKET";else if(u==="CLOSE_BRACKET"){let d=t.pop().text;if(t.length>0&&t[t.length-1].type==="NUMBER"){const m=t.pop().text;d=m+d,t[t.length-1].value=Je(m)}if(t.length===0||t[t.length-1].type!=="BRACKET")throw new Error("missing opening bracket");t[t.length-1].text+=d}continue}if(c=i.match(q1),c){if(l.text=c[1],o+=l.text.length,V1.has(l.text)){l.type="KEYWORD";continue}if(l.text.match(Eh)){l.type="TYPE";continue}l.type="ID";continue}if(c=i.match(z1),c){l.text=c[1],l.type="NUMBER",o+=l.text.length;continue}throw new Error(`unexpected token ${JSON.stringify(i[0])} at position ${o}`)}return new Us(t.map(i=>Object.freeze(i)))}function Gu(e,t){let n=[];for(const r in t.keys())e.has(r)&&n.push(r);if(n.length>1)throw new Error(`conflicting types: ${n.join(", ")}`)}function Oc(e,t){if(t.peekKeyword(kh)){const n=t.pop().text;if(n!==e)throw new Error(`expected ${e}, got ${n}`)}return t.popType("ID")}function Fn(e,t){const n=new Set;for(;;){const r=e.peekType("KEYWORD");if(r==null||t&&!t.has(r))break;if(e.pop(),n.has(r))throw new Error(`duplicate keywords: ${JSON.stringify(r)}`);n.add(r)}return Object.freeze(n)}function Sh(e){let t=Fn(e,_1);return Gu(t,Xt("constant payable nonpayable".split(" "))),Gu(t,Xt("pure view payable nonpayable".split(" "))),t.has("view")?"view":t.has("pure")?"pure":t.has("payable")?"payable":t.has("nonpayable")?"nonpayable":t.has("constant")?"view":"nonpayable"}function An(e,t){return e.popParams().map(n=>$t.from(n,t))}function Fh(e){if(e.peekType("AT")){if(e.pop(),e.peekType("NUMBER"))return Be(e.pop().text);throw new Error("invalid gas")}return null}function Yr(e){if(e.length)throw new Error(`unexpected tokens at offset ${e.offset}: ${e.toString()}`)}const Q1=new RegExp(/^(.*)\[([0-9]*)\]$/);function Hu(e){const t=e.match(Eh);if(D(t,"invalid type","type",e),e==="uint")return"uint256";if(e==="int")return"int256";if(t[2]){const n=parseInt(t[2]);D(n!==0&&n<=32,"invalid bytes length","type",e)}else if(t[3]){const n=parseInt(t[3]);D(n!==0&&n<=256&&n%8===0,"invalid numeric width","type",e)}return e}const Nt={},as=Symbol.for("_ethers_internal"),zu="_ParamTypeInternal",qu="_ErrorInternal",Qu="_EventInternal",Wu="_ConstructorInternal",Ju="_FallbackInternal",Ku="_FunctionInternal",Yu="_StructInternal";var Da,Hi;const ps=class ps{constructor(t,n,r,a,o,i,c,l){me(this,Da);ie(this,"name");ie(this,"type");ie(this,"baseType");ie(this,"indexed");ie(this,"components");ie(this,"arrayLength");ie(this,"arrayChildren");if(Ni(t,Nt,"ParamType"),Object.defineProperty(this,as,{value:zu}),i&&(i=Object.freeze(i.slice())),a==="array"){if(c==null||l==null)throw new Error("")}else if(c!=null||l!=null)throw new Error("");if(a==="tuple"){if(i==null)throw new Error("")}else if(i!=null)throw new Error("");$e(this,{name:n,type:r,baseType:a,indexed:o,components:i,arrayLength:c,arrayChildren:l})}format(t){if(t==null&&(t="sighash"),t==="json"){const r=this.name||"";if(this.isArray()){const o=JSON.parse(this.arrayChildren.format("json"));return o.name=r,o.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(o)}const a={type:this.baseType==="tuple"?"tuple":this.type,name:r};return typeof this.indexed=="boolean"&&(a.indexed=this.indexed),this.isTuple()&&(a.components=this.components.map(o=>JSON.parse(o.format(t)))),JSON.stringify(a)}let n="";return this.isArray()?(n+=this.arrayChildren.format(t),n+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?n+="("+this.components.map(r=>r.format(t)).join(t==="full"?", ":",")+")":n+=this.type,t!=="sighash"&&(this.indexed===!0&&(n+=" indexed"),t==="full"&&this.name&&(n+=" "+this.name)),n}isArray(){return this.baseType==="array"}isTuple(){return this.baseType==="tuple"}isIndexable(){return this.indexed!=null}walk(t,n){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(this.arrayLength!==-1&&t.length!==this.arrayLength)throw new Error("array is wrong length");const r=this;return t.map(a=>r.arrayChildren.walk(a,n))}if(this.isTuple()){if(!Array.isArray(t))throw new Error("invalid tuple value");if(t.length!==this.components.length)throw new Error("array is wrong length");const r=this;return t.map((a,o)=>r.components[o].walk(a,n))}return n(this.type,t)}async walkAsync(t,n){const r=[],a=[t];return Ce(this,Da,Hi).call(this,r,t,n,o=>{a[0]=o}),r.length&&await Promise.all(r),a[0]}static from(t,n){if(ps.isParamType(t))return t;if(typeof t=="string")try{return ps.from(ir(t),n)}catch{D(!1,"invalid param type","obj",t)}else if(t instanceof Us){let c="",l="",u=null;Fn(t,Xt(["tuple"])).has("tuple")||t.peekType("OPEN_PAREN")?(l="tuple",u=t.popParams().map(h=>ps.from(h)),c=`tuple(${u.map(h=>h.format()).join(",")})`):(c=Hu(t.popType("TYPE")),l=c);let d=null,m=null;for(;t.length&&t.peekType("BRACKET");){const h=t.pop();d=new ps(Nt,"",c,l,null,u,m,d),m=h.value,c+=h.text,l="array",u=null}let f=null;if(Fn(t,I1).has("indexed")){if(!n)throw new Error("");f=!0}const N=t.peekType("ID")?t.pop().text:"";if(t.length)throw new Error("leftover tokens");return new ps(Nt,N,c,l,f,u,m,d)}const r=t.name;D(!r||typeof r=="string"&&r.match(Th),"invalid name","obj.name",r);let a=t.indexed;a!=null&&(D(n,"parameter cannot be indexed","obj.indexed",t.indexed),a=!!a);let o=t.type,i=o.match(Q1);if(i){const c=parseInt(i[2]||"-1"),l=ps.from({type:i[1],components:t.components});return new ps(Nt,r||"",o,"array",a,null,c,l)}if(o==="tuple"||o.startsWith("tuple(")||o.startsWith("(")){const c=t.components!=null?t.components.map(u=>ps.from(u)):null;return new ps(Nt,r||"",o,"tuple",a,c,null,null)}return o=Hu(t.type),new ps(Nt,r||"",o,o,a,null,null,null)}static isParamType(t){return t&&t[as]===zu}};Da=new WeakSet,Hi=function(t,n,r,a){if(this.isArray()){if(!Array.isArray(n))throw new Error("invalid array value");if(this.arrayLength!==-1&&n.length!==this.arrayLength)throw new Error("array is wrong length");const i=this.arrayChildren,c=n.slice();c.forEach((l,u)=>{var d;Ce(d=i,Da,Hi).call(d,t,l,r,m=>{c[u]=m})}),a(c);return}if(this.isTuple()){const i=this.components;let c;if(Array.isArray(n))c=n.slice();else{if(n==null||typeof n!="object")throw new Error("invalid tuple value");c=i.map(l=>{if(!l.name)throw new Error("cannot use object value with unnamed components");if(!(l.name in n))throw new Error(`missing value for component ${l.name}`);return n[l.name]})}if(c.length!==this.components.length)throw new Error("array is wrong length");c.forEach((l,u)=>{var d;Ce(d=i[u],Da,Hi).call(d,t,l,r,m=>{c[u]=m})}),a(c);return}const o=r(this.type,n);o.then?t.push((async function(){a(await o)})()):a(o)};let $t=ps;class Zr{constructor(t,n,r){ie(this,"type");ie(this,"inputs");Ni(t,Nt,"Fragment"),r=Object.freeze(r.slice()),$e(this,{type:n,inputs:r})}static from(t){if(typeof t=="string"){try{Zr.from(JSON.parse(t))}catch{}return Zr.from(ir(t))}if(t instanceof Us)switch(t.peekKeyword(kh)){case"constructor":return kn.from(t);case"error":return ts.from(t);case"event":return Xs.from(t);case"fallback":case"receive":return mn.from(t);case"function":return Ls.from(t);case"struct":return Jr.from(t)}else if(typeof t=="object"){switch(t.type){case"constructor":return kn.from(t);case"error":return ts.from(t);case"event":return Xs.from(t);case"fallback":case"receive":return mn.from(t);case"function":return Ls.from(t);case"struct":return Jr.from(t)}we(!1,`unsupported type: ${t.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}D(!1,"unsupported frgament object","obj",t)}static isConstructor(t){return kn.isFragment(t)}static isError(t){return ts.isFragment(t)}static isEvent(t){return Xs.isFragment(t)}static isFunction(t){return Ls.isFragment(t)}static isStruct(t){return Jr.isFragment(t)}}class _c extends Zr{constructor(n,r,a,o){super(n,r,o);ie(this,"name");D(typeof a=="string"&&a.match(Th),"invalid identifier","name",a),o=Object.freeze(o.slice()),$e(this,{name:a})}}function ri(e,t){return"("+t.map(n=>n.format(e)).join(e==="full"?", ":",")+")"}class ts extends _c{constructor(t,n,r){super(t,"error",n,r),Object.defineProperty(this,as,{value:qu})}get selector(){return Kr(this.format("sighash")).substring(0,10)}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(r=>JSON.parse(r.format(t)))});const n=[];return t!=="sighash"&&n.push("error"),n.push(this.name+ri(t,this.inputs)),n.join(" ")}static from(t){if(ts.isFragment(t))return t;if(typeof t=="string")return ts.from(ir(t));if(t instanceof Us){const n=Oc("error",t),r=An(t);return Yr(t),new ts(Nt,n,r)}return new ts(Nt,t.name,t.inputs?t.inputs.map($t.from):[])}static isFragment(t){return t&&t[as]===qu}}class Xs extends _c{constructor(n,r,a,o){super(n,"event",r,a);ie(this,"anonymous");Object.defineProperty(this,as,{value:Qu}),$e(this,{anonymous:o})}get topicHash(){return Kr(this.format("sighash"))}format(n){if(n==null&&(n="sighash"),n==="json")return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(a=>JSON.parse(a.format(n)))});const r=[];return n!=="sighash"&&r.push("event"),r.push(this.name+ri(n,this.inputs)),n!=="sighash"&&this.anonymous&&r.push("anonymous"),r.join(" ")}static getTopicHash(n,r){return r=(r||[]).map(o=>$t.from(o)),new Xs(Nt,n,r,!1).topicHash}static from(n){if(Xs.isFragment(n))return n;if(typeof n=="string")try{return Xs.from(ir(n))}catch{D(!1,"invalid event fragment","obj",n)}else if(n instanceof Us){const r=Oc("event",n),a=An(n,!0),o=!!Fn(n,Xt(["anonymous"])).has("anonymous");return Yr(n),new Xs(Nt,r,a,o)}return new Xs(Nt,n.name,n.inputs?n.inputs.map(r=>$t.from(r,!0)):[],!!n.anonymous)}static isFragment(n){return n&&n[as]===Qu}}class kn extends Zr{constructor(n,r,a,o,i){super(n,r,a);ie(this,"payable");ie(this,"gas");Object.defineProperty(this,as,{value:Wu}),$e(this,{payable:o,gas:i})}format(n){if(we(n!=null&&n!=="sighash","cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),n==="json")return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(a=>JSON.parse(a.format(n)))});const r=[`constructor${ri(n,this.inputs)}`];return this.payable&&r.push("payable"),this.gas!=null&&r.push(`@${this.gas.toString()}`),r.join(" ")}static from(n){if(kn.isFragment(n))return n;if(typeof n=="string")try{return kn.from(ir(n))}catch{D(!1,"invalid constuctor fragment","obj",n)}else if(n instanceof Us){Fn(n,Xt(["constructor"]));const r=An(n),a=!!Fn(n,O1).has("payable"),o=Fh(n);return Yr(n),new kn(Nt,"constructor",r,a,o)}return new kn(Nt,"constructor",n.inputs?n.inputs.map($t.from):[],!!n.payable,n.gas!=null?n.gas:null)}static isFragment(n){return n&&n[as]===Wu}}class mn extends Zr{constructor(n,r,a){super(n,"fallback",r);ie(this,"payable");Object.defineProperty(this,as,{value:Ju}),$e(this,{payable:a})}format(n){const r=this.inputs.length===0?"receive":"fallback";if(n==="json"){const a=this.payable?"payable":"nonpayable";return JSON.stringify({type:r,stateMutability:a})}return`${r}()${this.payable?" payable":""}`}static from(n){if(mn.isFragment(n))return n;if(typeof n=="string")try{return mn.from(ir(n))}catch{D(!1,"invalid fallback fragment","obj",n)}else if(n instanceof Us){const r=n.toString(),a=n.peekKeyword(Xt(["fallback","receive"]));if(D(a,"type must be fallback or receive","obj",r),n.popKeyword(Xt(["fallback","receive"]))==="receive"){const l=An(n);return D(l.length===0,"receive cannot have arguments","obj.inputs",l),Fn(n,Xt(["payable"])),Yr(n),new mn(Nt,[],!0)}let i=An(n);i.length?D(i.length===1&&i[0].type==="bytes","invalid fallback inputs","obj.inputs",i.map(l=>l.format("minimal")).join(", ")):i=[$t.from("bytes")];const c=Sh(n);if(D(c==="nonpayable"||c==="payable","fallback cannot be constants","obj.stateMutability",c),Fn(n,Xt(["returns"])).has("returns")){const l=An(n);D(l.length===1&&l[0].type==="bytes","invalid fallback outputs","obj.outputs",l.map(u=>u.format("minimal")).join(", "))}return Yr(n),new mn(Nt,i,c==="payable")}if(n.type==="receive")return new mn(Nt,[],!0);if(n.type==="fallback"){const r=[$t.from("bytes")],a=n.stateMutability==="payable";return new mn(Nt,r,a)}D(!1,"invalid fallback description","obj",n)}static isFragment(n){return n&&n[as]===Ju}}class Ls extends _c{constructor(n,r,a,o,i,c){super(n,"function",r,o);ie(this,"constant");ie(this,"outputs");ie(this,"stateMutability");ie(this,"payable");ie(this,"gas");Object.defineProperty(this,as,{value:Ku}),i=Object.freeze(i.slice()),$e(this,{constant:a==="view"||a==="pure",gas:c,outputs:i,payable:a==="payable",stateMutability:a})}get selector(){return Kr(this.format("sighash")).substring(0,10)}format(n){if(n==null&&(n="sighash"),n==="json")return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(a=>JSON.parse(a.format(n))),outputs:this.outputs.map(a=>JSON.parse(a.format(n)))});const r=[];return n!=="sighash"&&r.push("function"),r.push(this.name+ri(n,this.inputs)),n!=="sighash"&&(this.stateMutability!=="nonpayable"&&r.push(this.stateMutability),this.outputs&&this.outputs.length&&(r.push("returns"),r.push(ri(n,this.outputs))),this.gas!=null&&r.push(`@${this.gas.toString()}`)),r.join(" ")}static getSelector(n,r){return r=(r||[]).map(o=>$t.from(o)),new Ls(Nt,n,"view",r,[],null).selector}static from(n){if(Ls.isFragment(n))return n;if(typeof n=="string")try{return Ls.from(ir(n))}catch{D(!1,"invalid function fragment","obj",n)}else if(n instanceof Us){const a=Oc("function",n),o=An(n),i=Sh(n);let c=[];Fn(n,Xt(["returns"])).has("returns")&&(c=An(n));const l=Fh(n);return Yr(n),new Ls(Nt,a,i,o,c,l)}let r=n.stateMutability;return r==null&&(r="payable",typeof n.constant=="boolean"?(r="view",n.constant||(r="payable",typeof n.payable=="boolean"&&!n.payable&&(r="nonpayable"))):typeof n.payable=="boolean"&&!n.payable&&(r="nonpayable")),new Ls(Nt,n.name,r,n.inputs?n.inputs.map($t.from):[],n.outputs?n.outputs.map($t.from):[],n.gas!=null?n.gas:null)}static isFragment(n){return n&&n[as]===Ku}}class Jr extends _c{constructor(t,n,r){super(t,"struct",n,r),Object.defineProperty(this,as,{value:Yu})}format(){throw new Error("@TODO")}static from(t){if(typeof t=="string")try{return Jr.from(ir(t))}catch{D(!1,"invalid struct fragment","obj",t)}else if(t instanceof Us){const n=Oc("struct",t),r=An(t);return Yr(t),new Jr(Nt,n,r)}return new Jr(Nt,t.name,t.inputs?t.inputs.map($t.from):[])}static isFragment(t){return t&&t[as]===Yu}}const $s=new Map;$s.set(0,"GENERIC_PANIC");$s.set(1,"ASSERT_FALSE");$s.set(17,"OVERFLOW");$s.set(18,"DIVIDE_BY_ZERO");$s.set(33,"ENUM_RANGE_ERROR");$s.set(34,"BAD_STORAGE_DATA");$s.set(49,"STACK_UNDERFLOW");$s.set(50,"ARRAY_RANGE_ERROR");$s.set(65,"OUT_OF_MEMORY");$s.set(81,"UNINITIALIZED_FUNCTION_CALL");const W1=new RegExp(/^bytes([0-9]*)$/),J1=new RegExp(/^(u?int)([0-9]*)$/);let al=null,Zu=1024;function K1(e,t,n,r){let a="missing revert data",o=null;const i=null;let c=null;if(n){a="execution reverted";const u=We(n);if(n=Se(n),u.length===0)a+=" (no data present; likely require(false) occurred",o="require(false)";else if(u.length%32!==4)a+=" (could not decode reason; invalid data length)";else if(Se(u.slice(0,4))==="0x08c379a0")try{o=r.decode(["string"],u.slice(4))[0],c={signature:"Error(string)",name:"Error",args:[o]},a+=`: ${JSON.stringify(o)}`}catch{a+=" (could not decode reason; invalid string data)"}else if(Se(u.slice(0,4))==="0x4e487b71")try{const d=Number(r.decode(["uint256"],u.slice(4))[0]);c={signature:"Panic(uint256)",name:"Panic",args:[d]},o=`Panic due to ${$s.get(d)||"UNKNOWN"}(${d})`,a+=`: ${o}`}catch{a+=" (could not decode panic code)"}else a+=" (unknown custom error)"}const l={to:t.to?nt(t.to):null,data:t.data||"0x"};return t.from&&(l.from=nt(t.from)),pt(a,"CALL_EXCEPTION",{action:e,data:n,reason:o,transaction:l,invocation:i,revert:c})}var Qn,pa;const xc=class xc{constructor(){me(this,Qn)}getDefaultValue(t){const n=t.map(a=>Ce(this,Qn,pa).call(this,$t.from(a)));return new Mi(n,"_").defaultValue()}encode(t,n){L0(n.length,t.length,"types/values length mismatch");const r=t.map(i=>Ce(this,Qn,pa).call(this,$t.from(i))),a=new Mi(r,"_"),o=new Cl;return a.encode(o,n),o.data}decode(t,n,r){const a=t.map(i=>Ce(this,Qn,pa).call(this,$t.from(i)));return new Mi(a,"_").decode(new kl(n,r,Zu))}static _setDefaultMaxInflation(t){D(typeof t=="number"&&Number.isInteger(t),"invalid defaultMaxInflation factor","value",t),Zu=t}static defaultAbiCoder(){return al==null&&(al=new xc),al}static getBuiltinCallException(t,n,r){return K1(t,n,r,xc.defaultAbiCoder())}};Qn=new WeakSet,pa=function(t){if(t.isArray())return new hy(Ce(this,Qn,pa).call(this,t.arrayChildren),t.arrayLength,t.name);if(t.isTuple())return new Mi(t.components.map(r=>Ce(this,Qn,pa).call(this,r)),t.name);switch(t.baseType){case"address":return new uy(t.name);case"bool":return new fy(t.name);case"string":return new jy(t.name);case"bytes":return new py(t.name);case"":return new by(t.name)}let n=t.type.match(J1);if(n){let r=parseInt(n[2]||"256");return D(r!==0&&r<=256&&r%8===0,"invalid "+n[1]+" bit length","param",t),new vy(r/8,n[1]==="int",t.name)}if(n=t.type.match(W1),n){let r=parseInt(n[1]);return D(r!==0&&r<=32,"invalid bytes length","param",t),new gy(r,t.name)}D(!1,"invalid type","type",t.type)};let ai=xc;class Y1{constructor(t,n,r){ie(this,"fragment");ie(this,"name");ie(this,"signature");ie(this,"topic");ie(this,"args");const a=t.name,o=t.format();$e(this,{fragment:t,name:a,signature:o,topic:n,args:r})}}class Z1{constructor(t,n,r,a){ie(this,"fragment");ie(this,"name");ie(this,"args");ie(this,"signature");ie(this,"selector");ie(this,"value");const o=t.name,i=t.format();$e(this,{fragment:t,name:o,args:r,signature:i,selector:n,value:a})}}class X1{constructor(t,n,r){ie(this,"fragment");ie(this,"name");ie(this,"args");ie(this,"signature");ie(this,"selector");const a=t.name,o=t.format();$e(this,{fragment:t,name:a,args:r,signature:o,selector:n})}}class Xu{constructor(t){ie(this,"hash");ie(this,"_isIndexed");$e(this,{hash:t,_isIndexed:!0})}static isIndexed(t){return!!(t&&t._isIndexed)}}const Lu={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},Du={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:e=>`reverted with reason string ${JSON.stringify(e)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:e=>{let t="unknown panic code";return e>=0&&e<=255&&Lu[e.toString()]&&(t=Lu[e.toString()]),`reverted with panic code 0x${e.toString(16)} (${t})`}}};var Qs,Ws,Js,Gt,nn,zi,qi;const br=class br{constructor(t){me(this,nn);ie(this,"fragments");ie(this,"deploy");ie(this,"fallback");ie(this,"receive");me(this,Qs);me(this,Ws);me(this,Js);me(this,Gt);let n=[];typeof t=="string"?n=JSON.parse(t):n=t,I(this,Js,new Map),I(this,Qs,new Map),I(this,Ws,new Map);const r=[];for(const i of n)try{r.push(Zr.from(i))}catch(c){console.log(`[Warning] Invalid Fragment ${JSON.stringify(i)}:`,c.message)}$e(this,{fragments:Object.freeze(r)});let a=null,o=!1;I(this,Gt,this.getAbiCoder()),this.fragments.forEach((i,c)=>{let l;switch(i.type){case"constructor":if(this.deploy){console.log("duplicate definition - constructor");return}$e(this,{deploy:i});return;case"fallback":i.inputs.length===0?o=!0:(D(!a||i.payable!==a.payable,"conflicting fallback fragments",`fragments[${c}]`,i),a=i,o=a.payable);return;case"function":l=y(this,Js);break;case"event":l=y(this,Ws);break;case"error":l=y(this,Qs);break;default:return}const u=i.format();l.has(u)||l.set(u,i)}),this.deploy||$e(this,{deploy:kn.from("constructor()")}),$e(this,{fallback:a,receive:o})}format(t){const n=t?"minimal":"full";return this.fragments.map(a=>a.format(n))}formatJson(){const t=this.fragments.map(n=>n.format("json"));return JSON.stringify(t.map(n=>JSON.parse(n)))}getAbiCoder(){return ai.defaultAbiCoder()}getFunctionName(t){const n=Ce(this,nn,zi).call(this,t,null,!1);return D(n,"no matching function","key",t),n.name}hasFunction(t){return!!Ce(this,nn,zi).call(this,t,null,!1)}getFunction(t,n){return Ce(this,nn,zi).call(this,t,n||null,!0)}forEachFunction(t){const n=Array.from(y(this,Js).keys());n.sort((r,a)=>r.localeCompare(a));for(let r=0;r<n.length;r++){const a=n[r];t(y(this,Js).get(a),r)}}getEventName(t){const n=Ce(this,nn,qi).call(this,t,null,!1);return D(n,"no matching event","key",t),n.name}hasEvent(t){return!!Ce(this,nn,qi).call(this,t,null,!1)}getEvent(t,n){return Ce(this,nn,qi).call(this,t,n||null,!0)}forEachEvent(t){const n=Array.from(y(this,Ws).keys());n.sort((r,a)=>r.localeCompare(a));for(let r=0;r<n.length;r++){const a=n[r];t(y(this,Ws).get(a),r)}}getError(t,n){if(dt(t)){const a=t.toLowerCase();if(Du[a])return ts.from(Du[a].signature);for(const o of y(this,Qs).values())if(a===o.selector)return o;return null}if(t.indexOf("(")===-1){const a=[];for(const[o,i]of y(this,Qs))o.split("(")[0]===t&&a.push(i);if(a.length===0)return t==="Error"?ts.from("error Error(string)"):t==="Panic"?ts.from("error Panic(uint256)"):null;if(a.length>1){const o=a.map(i=>JSON.stringify(i.format())).join(", ");D(!1,`ambiguous error description (i.e. ${o})`,"name",t)}return a[0]}if(t=ts.from(t).format(),t==="Error(string)")return ts.from("error Error(string)");if(t==="Panic(uint256)")return ts.from("error Panic(uint256)");const r=y(this,Qs).get(t);return r||null}forEachError(t){const n=Array.from(y(this,Qs).keys());n.sort((r,a)=>r.localeCompare(a));for(let r=0;r<n.length;r++){const a=n[r];t(y(this,Qs).get(a),r)}}_decodeParams(t,n){return y(this,Gt).decode(t,n)}_encodeParams(t,n){return y(this,Gt).encode(t,n)}encodeDeploy(t){return this._encodeParams(this.deploy.inputs,t||[])}decodeErrorResult(t,n){if(typeof t=="string"){const r=this.getError(t);D(r,"unknown error","fragment",t),t=r}return D(yt(n,0,4)===t.selector,`data signature does not match error ${t.name}.`,"data",n),this._decodeParams(t.inputs,yt(n,4))}encodeErrorResult(t,n){if(typeof t=="string"){const r=this.getError(t);D(r,"unknown error","fragment",t),t=r}return wt([t.selector,this._encodeParams(t.inputs,n||[])])}decodeFunctionData(t,n){if(typeof t=="string"){const r=this.getFunction(t);D(r,"unknown function","fragment",t),t=r}return D(yt(n,0,4)===t.selector,`data signature does not match function ${t.name}.`,"data",n),this._decodeParams(t.inputs,yt(n,4))}encodeFunctionData(t,n){if(typeof t=="string"){const r=this.getFunction(t);D(r,"unknown function","fragment",t),t=r}return wt([t.selector,this._encodeParams(t.inputs,n||[])])}decodeFunctionResult(t,n){if(typeof t=="string"){const o=this.getFunction(t);D(o,"unknown function","fragment",t),t=o}let r="invalid length for result data";const a=Kt(n);if(a.length%32===0)try{return y(this,Gt).decode(t.outputs,a)}catch{r="could not decode result data"}we(!1,r,"BAD_DATA",{value:Se(a),info:{method:t.name,signature:t.format()}})}makeError(t,n){const r=We(t,"data"),a=ai.getBuiltinCallException("call",n,r);if(a.message.startsWith("execution reverted (unknown custom error)")){const c=Se(r.slice(0,4)),l=this.getError(c);if(l)try{const u=y(this,Gt).decode(l.inputs,r.slice(4));a.revert={name:l.name,signature:l.format(),args:u},a.reason=a.revert.signature,a.message=`execution reverted: ${a.reason}`}catch{a.message="execution reverted (coult not decode custom error)"}}const i=this.parseTransaction(n);return i&&(a.invocation={method:i.name,signature:i.signature,args:i.args}),a}encodeFunctionResult(t,n){if(typeof t=="string"){const r=this.getFunction(t);D(r,"unknown function","fragment",t),t=r}return Se(y(this,Gt).encode(t.outputs,n||[]))}encodeFilterTopics(t,n){if(typeof t=="string"){const o=this.getEvent(t);D(o,"unknown event","eventFragment",t),t=o}we(n.length<=t.inputs.length,`too many arguments for ${t.format()}`,"UNEXPECTED_ARGUMENT",{count:n.length,expectedCount:t.inputs.length});const r=[];t.anonymous||r.push(t.topicHash);const a=(o,i)=>o.type==="string"?Kr(i):o.type==="bytes"?kt(Se(i)):(o.type==="bool"&&typeof i=="boolean"?i=i?"0x01":"0x00":o.type.match(/^u?int/)?i=rr(i):o.type.match(/^bytes/)?i=ux(i,32):o.type==="address"&&y(this,Gt).encode(["address"],[i]),En(Se(i),32));for(n.forEach((o,i)=>{const c=t.inputs[i];if(!c.indexed){D(o==null,"cannot filter non-indexed parameters; must be null","contract."+c.name,o);return}o==null?r.push(null):c.baseType==="array"||c.baseType==="tuple"?D(!1,"filtering with tuples or arrays not supported","contract."+c.name,o):Array.isArray(o)?r.push(o.map(l=>a(c,l))):r.push(a(c,o))});r.length&&r[r.length-1]===null;)r.pop();return r}encodeEventLog(t,n){if(typeof t=="string"){const i=this.getEvent(t);D(i,"unknown event","eventFragment",t),t=i}const r=[],a=[],o=[];return t.anonymous||r.push(t.topicHash),D(n.length===t.inputs.length,"event arguments/values mismatch","values",n),t.inputs.forEach((i,c)=>{const l=n[c];if(i.indexed)if(i.type==="string")r.push(Kr(l));else if(i.type==="bytes")r.push(kt(l));else{if(i.baseType==="tuple"||i.baseType==="array")throw new Error("not implemented");r.push(y(this,Gt).encode([i.type],[l]))}else a.push(i),o.push(l)}),{data:y(this,Gt).encode(a,o),topics:r}}decodeEventLog(t,n,r){if(typeof t=="string"){const g=this.getEvent(t);D(g,"unknown event","eventFragment",t),t=g}if(r!=null&&!t.anonymous){const g=t.topicHash;D(dt(r[0],32)&&r[0].toLowerCase()===g,"fragment/topic mismatch","topics[0]",r[0]),r=r.slice(1)}const a=[],o=[],i=[];t.inputs.forEach((g,N)=>{g.indexed?g.type==="string"||g.type==="bytes"||g.baseType==="tuple"||g.baseType==="array"?(a.push($t.from({type:"bytes32",name:g.name})),i.push(!0)):(a.push(g),i.push(!1)):(o.push(g),i.push(!1))});const c=r!=null?y(this,Gt).decode(a,wt(r)):null,l=y(this,Gt).decode(o,n,!0),u=[],d=[];let m=0,f=0;return t.inputs.forEach((g,N)=>{let h=null;if(g.indexed)if(c==null)h=new Xu(null);else if(i[N])h=new Xu(c[f++]);else try{h=c[f++]}catch(C){h=C}else try{h=l[m++]}catch(C){h=C}u.push(h),d.push(g.name||null)}),yo.fromItems(u,d)}parseTransaction(t){const n=We(t.data,"tx.data"),r=Be(t.value!=null?t.value:0,"tx.value"),a=this.getFunction(Se(n.slice(0,4)));if(!a)return null;const o=y(this,Gt).decode(a.inputs,n.slice(4));return new Z1(a,a.selector,o,r)}parseCallResult(t){throw new Error("@TODO")}parseLog(t){const n=this.getEvent(t.topics[0]);return!n||n.anonymous?null:new Y1(n,n.topicHash,this.decodeEventLog(n,t.data,t.topics))}parseError(t){const n=Se(t),r=this.getError(yt(n,0,4));if(!r)return null;const a=y(this,Gt).decode(r.inputs,yt(n,4));return new X1(r,r.selector,a)}static from(t){return t instanceof br?t:typeof t=="string"?new br(JSON.parse(t)):typeof t.formatJson=="function"?new br(t.formatJson()):typeof t.format=="function"?new br(t.format("json")):new br(t)}};Qs=new WeakMap,Ws=new WeakMap,Js=new WeakMap,Gt=new WeakMap,nn=new WeakSet,zi=function(t,n,r){if(dt(t)){const o=t.toLowerCase();for(const i of y(this,Js).values())if(o===i.selector)return i;return null}if(t.indexOf("(")===-1){const o=[];for(const[i,c]of y(this,Js))i.split("(")[0]===t&&o.push(c);if(n){const i=n.length>0?n[n.length-1]:null;let c=n.length,l=!0;qt.isTyped(i)&&i.type==="overrides"&&(l=!1,c--);for(let u=o.length-1;u>=0;u--){const d=o[u].inputs.length;d!==c&&(!l||d!==c-1)&&o.splice(u,1)}for(let u=o.length-1;u>=0;u--){const d=o[u].inputs;for(let m=0;m<n.length;m++)if(qt.isTyped(n[m])){if(m>=d.length){if(n[m].type==="overrides")continue;o.splice(u,1);break}if(n[m].type!==d[m].baseType){o.splice(u,1);break}}}}if(o.length===1&&n&&n.length!==o[0].inputs.length){const i=n[n.length-1];(i==null||Array.isArray(i)||typeof i!="object")&&o.splice(0,1)}if(o.length===0)return null;if(o.length>1&&r){const i=o.map(c=>JSON.stringify(c.format())).join(", ");D(!1,`ambiguous function description (i.e. matches ${i})`,"key",t)}return o[0]}const a=y(this,Js).get(Ls.from(t).format());return a||null},qi=function(t,n,r){if(dt(t)){const o=t.toLowerCase();for(const i of y(this,Ws).values())if(o===i.topicHash)return i;return null}if(t.indexOf("(")===-1){const o=[];for(const[i,c]of y(this,Ws))i.split("(")[0]===t&&o.push(c);if(n){for(let i=o.length-1;i>=0;i--)o[i].inputs.length<n.length&&o.splice(i,1);for(let i=o.length-1;i>=0;i--){const c=o[i].inputs;for(let l=0;l<n.length;l++)if(qt.isTyped(n[l])&&n[l].type!==c[l].baseType){o.splice(i,1);break}}}if(o.length===0)return null;if(o.length>1&&r){const i=o.map(c=>JSON.stringify(c.format())).join(", ");D(!1,`ambiguous event description (i.e. matches ${i})`,"key",t)}return o[0]}const a=y(this,Ws).get(Xs.from(t).format());return a||null};let lc=br;const Rh=BigInt(0);function Ta(e){return e??null}function jt(e){return e==null?null:e.toString()}class e0{constructor(t,n,r){ie(this,"gasPrice");ie(this,"maxFeePerGas");ie(this,"maxPriorityFeePerGas");$e(this,{gasPrice:Ta(t),maxFeePerGas:Ta(n),maxPriorityFeePerGas:Ta(r)})}toJSON(){const{gasPrice:t,maxFeePerGas:n,maxPriorityFeePerGas:r}=this;return{_type:"FeeData",gasPrice:jt(t),maxFeePerGas:jt(n),maxPriorityFeePerGas:jt(r)}}}function dc(e){const t={};e.to&&(t.to=e.to),e.from&&(t.from=e.from),e.data&&(t.data=Se(e.data));const n="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const a of n)!(a in e)||e[a]==null||(t[a]=Be(e[a],`request.${a}`));const r="type,nonce".split(/,/);for(const a of r)!(a in e)||e[a]==null||(t[a]=Je(e[a],`request.${a}`));return e.accessList&&(t.accessList=ia(e.accessList)),e.authorizationList&&(t.authorizationList=e.authorizationList.slice()),"blockTag"in e&&(t.blockTag=e.blockTag),"enableCcipRead"in e&&(t.enableCcipRead=!!e.enableCcipRead),"customData"in e&&(t.customData=e.customData),"blobVersionedHashes"in e&&e.blobVersionedHashes&&(t.blobVersionedHashes=e.blobVersionedHashes.slice()),"kzg"in e&&(t.kzg=e.kzg),"blobs"in e&&e.blobs&&(t.blobs=e.blobs.map(a=>md(a)?Se(a):Object.assign({},a))),t}var bn;class L1{constructor(t,n){ie(this,"provider");ie(this,"number");ie(this,"hash");ie(this,"timestamp");ie(this,"parentHash");ie(this,"parentBeaconBlockRoot");ie(this,"nonce");ie(this,"difficulty");ie(this,"gasLimit");ie(this,"gasUsed");ie(this,"stateRoot");ie(this,"receiptsRoot");ie(this,"blobGasUsed");ie(this,"excessBlobGas");ie(this,"miner");ie(this,"prevRandao");ie(this,"extraData");ie(this,"baseFeePerGas");me(this,bn);I(this,bn,t.transactions.map(r=>typeof r!="string"?new oi(r,n):r)),$e(this,{provider:n,hash:Ta(t.hash),number:t.number,timestamp:t.timestamp,parentHash:t.parentHash,parentBeaconBlockRoot:t.parentBeaconBlockRoot,nonce:t.nonce,difficulty:t.difficulty,gasLimit:t.gasLimit,gasUsed:t.gasUsed,blobGasUsed:t.blobGasUsed,excessBlobGas:t.excessBlobGas,miner:t.miner,prevRandao:Ta(t.prevRandao),extraData:t.extraData,baseFeePerGas:Ta(t.baseFeePerGas),stateRoot:t.stateRoot,receiptsRoot:t.receiptsRoot})}get transactions(){return y(this,bn).map(t=>typeof t=="string"?t:t.hash)}get prefetchedTransactions(){const t=y(this,bn).slice();return t.length===0?[]:(we(typeof t[0]=="object","transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),t)}toJSON(){const{baseFeePerGas:t,difficulty:n,extraData:r,gasLimit:a,gasUsed:o,hash:i,miner:c,prevRandao:l,nonce:u,number:d,parentHash:m,parentBeaconBlockRoot:f,stateRoot:g,receiptsRoot:N,timestamp:h,transactions:C}=this;return{_type:"Block",baseFeePerGas:jt(t),difficulty:jt(n),extraData:r,gasLimit:jt(a),gasUsed:jt(o),blobGasUsed:jt(this.blobGasUsed),excessBlobGas:jt(this.excessBlobGas),hash:i,miner:c,prevRandao:l,nonce:u,number:d,parentHash:m,timestamp:h,parentBeaconBlockRoot:f,stateRoot:g,receiptsRoot:N,transactions:C}}[Symbol.iterator](){let t=0;const n=this.transactions;return{next:()=>t<this.length?{value:n[t++],done:!1}:{value:void 0,done:!0}}}get length(){return y(this,bn).length}get date(){return this.timestamp==null?null:new Date(this.timestamp*1e3)}async getTransaction(t){let n;if(typeof t=="number")n=y(this,bn)[t];else{const r=t.toLowerCase();for(const a of y(this,bn))if(typeof a=="string"){if(a!==r)continue;n=a;break}else{if(a.hash!==r)continue;n=a;break}}if(n==null)throw new Error("no such tx");return typeof n=="string"?await this.provider.getTransaction(n):n}getPrefetchedTransaction(t){const n=this.prefetchedTransactions;if(typeof t=="number")return n[t];t=t.toLowerCase();for(const r of n)if(r.hash===t)return r;D(!1,"no matching transaction","indexOrHash",t)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return D1(this)}}bn=new WeakMap;class ji{constructor(t,n){ie(this,"provider");ie(this,"transactionHash");ie(this,"blockHash");ie(this,"blockNumber");ie(this,"removed");ie(this,"address");ie(this,"data");ie(this,"topics");ie(this,"index");ie(this,"transactionIndex");this.provider=n;const r=Object.freeze(t.topics.slice());$e(this,{transactionHash:t.transactionHash,blockHash:t.blockHash,blockNumber:t.blockNumber,removed:t.removed,address:t.address,data:t.data,topics:r,index:t.index,transactionIndex:t.transactionIndex})}toJSON(){const{address:t,blockHash:n,blockNumber:r,data:a,index:o,removed:i,topics:c,transactionHash:l,transactionIndex:u}=this;return{_type:"log",address:t,blockHash:n,blockNumber:r,data:a,index:o,removed:i,topics:c,transactionHash:l,transactionIndex:u}}async getBlock(){const t=await this.provider.getBlock(this.blockHash);return we(!!t,"failed to find transaction","UNKNOWN_ERROR",{}),t}async getTransaction(){const t=await this.provider.getTransaction(this.transactionHash);return we(!!t,"failed to find transaction","UNKNOWN_ERROR",{}),t}async getTransactionReceipt(){const t=await this.provider.getTransactionReceipt(this.transactionHash);return we(!!t,"failed to find transaction receipt","UNKNOWN_ERROR",{}),t}removedEvent(){return eN(this)}}var hi;class Bh{constructor(t,n){ie(this,"provider");ie(this,"to");ie(this,"from");ie(this,"contractAddress");ie(this,"hash");ie(this,"index");ie(this,"blockHash");ie(this,"blockNumber");ie(this,"logsBloom");ie(this,"gasUsed");ie(this,"blobGasUsed");ie(this,"cumulativeGasUsed");ie(this,"gasPrice");ie(this,"blobGasPrice");ie(this,"type");ie(this,"status");ie(this,"root");me(this,hi);I(this,hi,Object.freeze(t.logs.map(a=>new ji(a,n))));let r=Rh;t.effectiveGasPrice!=null?r=t.effectiveGasPrice:t.gasPrice!=null&&(r=t.gasPrice),$e(this,{provider:n,to:t.to,from:t.from,contractAddress:t.contractAddress,hash:t.hash,index:t.index,blockHash:t.blockHash,blockNumber:t.blockNumber,logsBloom:t.logsBloom,gasUsed:t.gasUsed,cumulativeGasUsed:t.cumulativeGasUsed,blobGasUsed:t.blobGasUsed,gasPrice:r,blobGasPrice:t.blobGasPrice,type:t.type,status:t.status,root:t.root})}get logs(){return y(this,hi)}toJSON(){const{to:t,from:n,contractAddress:r,hash:a,index:o,blockHash:i,blockNumber:c,logsBloom:l,logs:u,status:d,root:m}=this;return{_type:"TransactionReceipt",blockHash:i,blockNumber:c,contractAddress:r,cumulativeGasUsed:jt(this.cumulativeGasUsed),from:n,gasPrice:jt(this.gasPrice),blobGasUsed:jt(this.blobGasUsed),blobGasPrice:jt(this.blobGasPrice),gasUsed:jt(this.gasUsed),hash:a,index:o,logs:u,logsBloom:l,root:m,status:d,to:t}}get length(){return this.logs.length}[Symbol.iterator](){let t=0;return{next:()=>t<this.length?{value:this.logs[t++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const t=await this.provider.getBlock(this.blockHash);if(t==null)throw new Error("TODO");return t}async getTransaction(){const t=await this.provider.getTransaction(this.hash);if(t==null)throw new Error("TODO");return t}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return Mh(this)}reorderedEvent(t){return we(!t||t.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),Ph(this,t)}}hi=new WeakMap;var Wn;const qd=class qd{constructor(t,n){ie(this,"provider");ie(this,"blockNumber");ie(this,"blockHash");ie(this,"index");ie(this,"hash");ie(this,"type");ie(this,"to");ie(this,"from");ie(this,"nonce");ie(this,"gasLimit");ie(this,"gasPrice");ie(this,"maxPriorityFeePerGas");ie(this,"maxFeePerGas");ie(this,"maxFeePerBlobGas");ie(this,"data");ie(this,"value");ie(this,"chainId");ie(this,"signature");ie(this,"accessList");ie(this,"blobVersionedHashes");ie(this,"authorizationList");me(this,Wn);this.provider=n,this.blockNumber=t.blockNumber!=null?t.blockNumber:null,this.blockHash=t.blockHash!=null?t.blockHash:null,this.hash=t.hash,this.index=t.index,this.type=t.type,this.from=t.from,this.to=t.to||null,this.gasLimit=t.gasLimit,this.nonce=t.nonce,this.data=t.data,this.value=t.value,this.gasPrice=t.gasPrice,this.maxPriorityFeePerGas=t.maxPriorityFeePerGas!=null?t.maxPriorityFeePerGas:null,this.maxFeePerGas=t.maxFeePerGas!=null?t.maxFeePerGas:null,this.maxFeePerBlobGas=t.maxFeePerBlobGas!=null?t.maxFeePerBlobGas:null,this.chainId=t.chainId,this.signature=t.signature,this.accessList=t.accessList!=null?t.accessList:null,this.blobVersionedHashes=t.blobVersionedHashes!=null?t.blobVersionedHashes:null,this.authorizationList=t.authorizationList!=null?t.authorizationList:null,I(this,Wn,-1)}toJSON(){const{blockNumber:t,blockHash:n,index:r,hash:a,type:o,to:i,from:c,nonce:l,data:u,signature:d,accessList:m,blobVersionedHashes:f}=this;return{_type:"TransactionResponse",accessList:m,blockNumber:t,blockHash:n,blobVersionedHashes:f,chainId:jt(this.chainId),data:u,from:c,gasLimit:jt(this.gasLimit),gasPrice:jt(this.gasPrice),hash:a,maxFeePerGas:jt(this.maxFeePerGas),maxPriorityFeePerGas:jt(this.maxPriorityFeePerGas),maxFeePerBlobGas:jt(this.maxFeePerBlobGas),nonce:l,signature:d,to:i,index:r,type:o,value:jt(this.value)}}async getBlock(){let t=this.blockNumber;if(t==null){const r=await this.getTransaction();r&&(t=r.blockNumber)}if(t==null)return null;const n=this.provider.getBlock(t);if(n==null)throw new Error("TODO");return n}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(this.blockNumber==null){const{tx:n,blockNumber:r}=await Jt({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return n==null||n.blockNumber==null?0:r-n.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(t,n){const r=t??1,a=n??0;let o=y(this,Wn),i=-1,c=o===-1;const l=async()=>{if(c)return null;const{blockNumber:f,nonce:g}=await Jt({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(g<this.nonce){o=f;return}if(c)return null;const N=await this.getTransaction();if(!(N&&N.blockNumber!=null))for(i===-1&&(i=o-3,i<y(this,Wn)&&(i=y(this,Wn)));i<=f;){if(c)return null;const h=await this.provider.getBlock(i,!0);if(h==null)return;for(const C of h)if(C===this.hash)return;for(let C=0;C<h.length;C++){const w=await h.getTransaction(C);if(w.from===this.from&&w.nonce===this.nonce){if(c)return null;const B=await this.provider.getTransactionReceipt(w.hash);if(B==null||f-B.blockNumber+1<r)return;let j="replaced";w.data===this.data&&w.to===this.to&&w.value===this.value?j="repriced":w.data==="0x"&&w.from===w.to&&w.value===Rh&&(j="cancelled"),we(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:j==="replaced"||j==="cancelled",reason:j,replacement:w.replaceableTransaction(o),hash:w.hash,receipt:B})}}i++}},u=f=>{if(f==null||f.status!==0)return f;we(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:f.to,from:f.from,data:""},receipt:f})},d=await this.provider.getTransactionReceipt(this.hash);if(r===0)return u(d);if(d){if(r===1||await d.confirmations()>=r)return u(d)}else if(await l(),r===0)return null;return await new Promise((f,g)=>{const N=[],h=()=>{N.forEach(w=>w())};if(N.push(()=>{c=!0}),a>0){const w=setTimeout(()=>{h(),g(pt("wait for transaction timeout","TIMEOUT"))},a);N.push(()=>{clearTimeout(w)})}const C=async w=>{if(await w.confirmations()>=r){h();try{f(u(w))}catch(B){g(B)}}};if(N.push(()=>{this.provider.off(this.hash,C)}),this.provider.on(this.hash,C),o>=0){const w=async()=>{try{await l()}catch(B){if(Ut(B,"TRANSACTION_REPLACED")){h(),g(B);return}}c||this.provider.once("block",w)};N.push(()=>{this.provider.off("block",w)}),this.provider.once("block",w)}})}isMined(){return this.blockHash!=null}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}removedEvent(){return we(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Mh(this)}reorderedEvent(t){return we(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),we(!t||t.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Ph(this,t)}replaceableTransaction(t){D(Number.isInteger(t)&&t>=0,"invalid startBlock","startBlock",t);const n=new qd(this,this.provider);return I(n,Wn,t),n}};Wn=new WeakMap;let oi=qd;function D1(e){return{orphan:"drop-block",hash:e.hash,number:e.number}}function Ph(e,t){return{orphan:"reorder-transaction",tx:e,other:t}}function Mh(e){return{orphan:"drop-transaction",tx:e}}function eN(e){return{orphan:"drop-log",log:{transactionHash:e.transactionHash,blockHash:e.blockHash,blockNumber:e.blockNumber,address:e.address,data:e.data,topics:Object.freeze(e.topics.slice()),index:e.index}}}class Ed extends ji{constructor(n,r,a){super(n,n.provider);ie(this,"interface");ie(this,"fragment");ie(this,"args");const o=r.decodeEventLog(a,n.data,n.topics);$e(this,{args:o,fragment:a,interface:r})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class Oh extends ji{constructor(n,r){super(n,n.provider);ie(this,"error");$e(this,{error:r})}}var eo;class tN extends Bh{constructor(n,r,a){super(a,r);me(this,eo);I(this,eo,n)}get logs(){return super.logs.map(n=>{const r=n.topics.length?y(this,eo).getEvent(n.topics[0]):null;if(r)try{return new Ed(n,y(this,eo),r)}catch(a){return new Oh(n,a)}return n})}}eo=new WeakMap;var fi;class Sd extends oi{constructor(n,r,a){super(a,r);me(this,fi);I(this,fi,n)}async wait(n,r){const a=await super.wait(n,r);return a==null?null:new tN(y(this,fi),this.provider,a)}}fi=new WeakMap;class _h extends sm{constructor(n,r,a,o){super(n,r,a);ie(this,"log");$e(this,{log:o})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class sN extends _h{constructor(t,n,r,a,o){super(t,n,r,new Ed(o,t.interface,a));const i=t.interface.decodeEventLog(a,this.log.data,this.log.topics);$e(this,{args:i,fragment:a})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const t0=BigInt(0);function Ih(e){return e&&typeof e.call=="function"}function Uh(e){return e&&typeof e.estimateGas=="function"}function Ic(e){return e&&typeof e.resolveName=="function"}function $h(e){return e&&typeof e.sendTransaction=="function"}function Vh(e){if(e!=null){if(Ic(e))return e;if(e.provider)return e.provider}}var pi;class nN{constructor(t,n,r){me(this,pi);ie(this,"fragment");if($e(this,{fragment:n}),n.inputs.length<r.length)throw new Error("too many arguments");const a=Xr(t.runner,"resolveName"),o=Ic(a)?a:null;I(this,pi,(async function(){const i=await Promise.all(n.inputs.map((c,l)=>r[l]==null?null:c.walkAsync(r[l],(d,m)=>d==="address"?Array.isArray(m)?Promise.all(m.map(f=>Zt(f,o))):Zt(m,o):m)));return t.interface.encodeFilterTopics(n,i)})())}getTopicFilter(){return y(this,pi)}}pi=new WeakMap;function Xr(e,t){return e==null?null:typeof e[t]=="function"?e:e.provider&&typeof e.provider[t]=="function"?e.provider:null}function jr(e){return e==null?null:e.provider||null}async function Gh(e,t){const n=qt.dereference(e,"overrides");D(typeof n=="object","invalid overrides parameter","overrides",e);const r=dc(n);return D(r.to==null||(t||[]).indexOf("to")>=0,"cannot override to","overrides.to",r.to),D(r.data==null||(t||[]).indexOf("data")>=0,"cannot override data","overrides.data",r.data),r.from&&(r.from=r.from),r}async function rN(e,t,n){const r=Xr(e,"resolveName"),a=Ic(r)?r:null;return await Promise.all(t.map((o,i)=>o.walkAsync(n[i],(c,l)=>(l=qt.dereference(l,c),c==="address"?Zt(l,a):l))))}function aN(e){const t=async function(i){const c=await Gh(i,["data"]);c.to=await e.getAddress(),c.from&&(c.from=await Zt(c.from,Vh(e.runner)));const l=e.interface,u=Be(c.value||t0,"overrides.value")===t0,d=(c.data||"0x")==="0x";l.fallback&&!l.fallback.payable&&l.receive&&!d&&!u&&D(!1,"cannot send data to receive or send value to non-payable fallback","overrides",i),D(l.fallback||d,"cannot send data to receive-only contract","overrides.data",c.data);const m=l.receive||l.fallback&&l.fallback.payable;return D(m||u,"cannot send value to non-payable fallback","overrides.value",c.value),D(l.fallback||d,"cannot send data to receive-only contract","overrides.data",c.data),c},n=async function(i){const c=Xr(e.runner,"call");we(Ih(c),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const l=await t(i);try{return await c.call(l)}catch(u){throw ud(u)&&u.data?e.interface.makeError(u.data,l):u}},r=async function(i){const c=e.runner;we($h(c),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const l=await c.sendTransaction(await t(i)),u=jr(e.runner);return new Sd(e.interface,u,l)},a=async function(i){const c=Xr(e.runner,"estimateGas");return we(Uh(c),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await c.estimateGas(await t(i))},o=async i=>await r(i);return $e(o,{_contract:e,estimateGas:a,populateTransaction:t,send:r,staticCall:n}),o}function oN(e,t){const n=function(...u){const d=e.interface.getFunction(t,u);return we(d,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t,args:u}}),d},r=async function(...u){const d=n(...u);let m={};if(d.inputs.length+1===u.length&&(m=await Gh(u.pop()),m.from&&(m.from=await Zt(m.from,Vh(e.runner)))),d.inputs.length!==u.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const f=await rN(e.runner,d.inputs,u);return Object.assign({},m,await Jt({to:e.getAddress(),data:e.interface.encodeFunctionData(d,f)}))},a=async function(...u){const d=await c(...u);return d.length===1?d[0]:d},o=async function(...u){const d=e.runner;we($h(d),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const m=await d.sendTransaction(await r(...u)),f=jr(e.runner);return new Sd(e.interface,f,m)},i=async function(...u){const d=Xr(e.runner,"estimateGas");return we(Uh(d),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await d.estimateGas(await r(...u))},c=async function(...u){const d=Xr(e.runner,"call");we(Ih(d),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const m=await r(...u);let f="0x";try{f=await d.call(m)}catch(N){throw ud(N)&&N.data?e.interface.makeError(N.data,m):N}const g=n(...u);return e.interface.decodeFunctionResult(g,f)},l=async(...u)=>n(...u).constant?await a(...u):await o(...u);return $e(l,{name:e.interface.getFunctionName(t),_contract:e,_key:t,getFragment:n,estimateGas:i,populateTransaction:r,send:o,staticCall:a,staticCallResult:c}),Object.defineProperty(l,"fragment",{configurable:!1,enumerable:!0,get:()=>{const u=e.interface.getFunction(t);return we(u,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t}}),u}}),l}function iN(e,t){const n=function(...a){const o=e.interface.getEvent(t,a);return we(o,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t,args:a}}),o},r=function(...a){return new nN(e,n(...a),a)};return $e(r,{name:e.interface.getEventName(t),_contract:e,_key:t,getFragment:n}),Object.defineProperty(r,"fragment",{configurable:!1,enumerable:!0,get:()=>{const a=e.interface.getEvent(t);return we(a,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t}}),a}}),r}const uc=Symbol.for("_ethersInternal_contract"),Hh=new WeakMap;function cN(e,t){Hh.set(e[uc],t)}function cs(e){return Hh.get(e[uc])}function lN(e){return e&&typeof e=="object"&&"getTopicFilter"in e&&typeof e.getTopicFilter=="function"&&e.fragment}async function Fd(e,t){let n,r=null;if(Array.isArray(t)){const o=function(i){if(dt(i,32))return i;const c=e.interface.getEvent(i);return D(c,"unknown fragment","name",i),c.topicHash};n=t.map(i=>i==null?null:Array.isArray(i)?i.map(o):o(i))}else t==="*"?n=[null]:typeof t=="string"?dt(t,32)?n=[t]:(r=e.interface.getEvent(t),D(r,"unknown fragment","event",t),n=[r.topicHash]):lN(t)?n=await t.getTopicFilter():"fragment"in t?(r=t.fragment,n=[r.topicHash]):D(!1,"unknown event name","event",t);n=n.map(o=>{if(o==null)return null;if(Array.isArray(o)){const i=Array.from(new Set(o.map(c=>c.toLowerCase())).values());return i.length===1?i[0]:(i.sort(),i)}return o.toLowerCase()});const a=n.map(o=>o==null?"null":Array.isArray(o)?o.join("|"):o).join("&");return{fragment:r,tag:a,topics:n}}async function qo(e,t){const{subs:n}=cs(e);return n.get((await Fd(e,t)).tag)||null}async function s0(e,t,n){const r=jr(e.runner);we(r,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:t});const{fragment:a,tag:o,topics:i}=await Fd(e,n),{addr:c,subs:l}=cs(e);let u=l.get(o);if(!u){const m={address:c||e,topics:i},f=C=>{let w=a;if(w==null)try{w=e.interface.getEvent(C.topics[0])}catch{}if(w){const B=w,j=a?e.interface.decodeEventLog(a,C.data,C.topics):[];Vl(e,n,j,Q=>new sN(e,Q,n,B,C))}else Vl(e,n,[],B=>new _h(e,B,n,C))};let g=[];u={tag:o,listeners:[],start:()=>{g.length||g.push(r.on(m,f))},stop:async()=>{if(g.length==0)return;let C=g;g=[],await Promise.all(C),r.off(m,f)}},l.set(o,u)}return u}let $l=Promise.resolve();async function dN(e,t,n,r){await $l;const a=await qo(e,t);if(!a)return!1;const o=a.listeners.length;return a.listeners=a.listeners.filter(({listener:i,once:c})=>{const l=Array.from(n);r&&l.push(r(c?null:i));try{i.call(e,...l)}catch{}return!c}),a.listeners.length===0&&(a.stop(),cs(e).subs.delete(a.tag)),o>0}async function Vl(e,t,n,r){try{await $l}catch{}const a=dN(e,t,n,r);return $l=a,await a}const _i=["then"];var R0;R0=uc;const Yo=class Yo{constructor(t,n,r,a){ie(this,"target");ie(this,"interface");ie(this,"runner");ie(this,"filters");ie(this,R0);ie(this,"fallback");D(typeof t=="string"||Jm(t),"invalid value for Contract target","target",t),r==null&&(r=null);const o=lc.from(n);$e(this,{target:t,runner:r,interface:o}),Object.defineProperty(this,uc,{value:{}});let i,c=null,l=null;if(a){const m=jr(r);l=new Sd(this.interface,m,a)}let u=new Map;if(typeof t=="string")if(dt(t))c=t,i=Promise.resolve(t);else{const m=Xr(r,"resolveName");if(!Ic(m))throw pt("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});i=m.resolveName(t).then(f=>{if(f==null)throw pt("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:t});return cs(this).addr=f,f})}else i=t.getAddress().then(m=>{if(m==null)throw new Error("TODO");return cs(this).addr=m,m});cN(this,{addrPromise:i,addr:c,deployTx:l,subs:u});const d=new Proxy({},{get:(m,f,g)=>{if(typeof f=="symbol"||_i.indexOf(f)>=0)return Reflect.get(m,f,g);try{return this.getEvent(f)}catch(N){if(!Ut(N,"INVALID_ARGUMENT")||N.argument!=="key")throw N}},has:(m,f)=>_i.indexOf(f)>=0?Reflect.has(m,f):Reflect.has(m,f)||this.interface.hasEvent(String(f))});return $e(this,{filters:d}),$e(this,{fallback:o.receive||o.fallback?aN(this):null}),new Proxy(this,{get:(m,f,g)=>{if(typeof f=="symbol"||f in m||_i.indexOf(f)>=0)return Reflect.get(m,f,g);try{return m.getFunction(f)}catch(N){if(!Ut(N,"INVALID_ARGUMENT")||N.argument!=="key")throw N}},has:(m,f)=>typeof f=="symbol"||f in m||_i.indexOf(f)>=0?Reflect.has(m,f):m.interface.hasFunction(f)})}connect(t){return new Yo(this.target,this.interface,t)}attach(t){return new Yo(t,this.interface,this.runner)}async getAddress(){return await cs(this).addrPromise}async getDeployedCode(){const t=jr(this.runner);we(t,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const n=await t.getCode(await this.getAddress());return n==="0x"?null:n}async waitForDeployment(){const t=this.deploymentTransaction();if(t)return await t.wait(),this;if(await this.getDeployedCode()!=null)return this;const r=jr(this.runner);return we(r!=null,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((a,o)=>{const i=async()=>{try{if(await this.getDeployedCode()!=null)return a(this);r.once("block",i)}catch(c){o(c)}};i()})}deploymentTransaction(){return cs(this).deployTx}getFunction(t){return typeof t!="string"&&(t=t.format()),oN(this,t)}getEvent(t){return typeof t!="string"&&(t=t.format()),iN(this,t)}async queryTransaction(t){throw new Error("@TODO")}async queryFilter(t,n,r){n==null&&(n=0),r==null&&(r="latest");const{addr:a,addrPromise:o}=cs(this),i=a||await o,{fragment:c,topics:l}=await Fd(this,t),u={address:i,topics:l,fromBlock:n,toBlock:r},d=jr(this.runner);return we(d,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await d.getLogs(u)).map(m=>{let f=c;if(f==null)try{f=this.interface.getEvent(m.topics[0])}catch{}if(f)try{return new Ed(m,this.interface,f)}catch(g){return new Oh(m,g)}return new ji(m,d)})}async on(t,n){const r=await s0(this,"on",t);return r.listeners.push({listener:n,once:!1}),r.start(),this}async once(t,n){const r=await s0(this,"once",t);return r.listeners.push({listener:n,once:!0}),r.start(),this}async emit(t,...n){return await Vl(this,t,n,null)}async listenerCount(t){if(t){const a=await qo(this,t);return a?a.listeners.length:0}const{subs:n}=cs(this);let r=0;for(const{listeners:a}of n.values())r+=a.length;return r}async listeners(t){if(t){const a=await qo(this,t);return a?a.listeners.map(({listener:o})=>o):[]}const{subs:n}=cs(this);let r=[];for(const{listeners:a}of n.values())r=r.concat(a.map(({listener:o})=>o));return r}async off(t,n){const r=await qo(this,t);if(!r)return this;if(n){const a=r.listeners.map(({listener:o})=>o).indexOf(n);a>=0&&r.listeners.splice(a,1)}return(n==null||r.listeners.length===0)&&(r.stop(),cs(this).subs.delete(r.tag)),this}async removeAllListeners(t){if(t){const n=await qo(this,t);if(!n)return this;n.stop(),cs(this).subs.delete(n.tag)}else{const{subs:n}=cs(this);for(const{tag:r,stop:a}of n.values())a(),n.delete(r)}return this}async addListener(t,n){return await this.on(t,n)}async removeListener(t,n){return await this.off(t,n)}static buildClass(t){class n extends Yo{constructor(a,o=null){super(a,t,o)}}return n}static from(t,n,r){return r==null&&(r=null),new this(t,n,r)}};let Gl=Yo;function uN(){return Gl}class Tn extends uN(){}function ol(e){return e.match(/^ipfs:\/\/ipfs\//i)?e=e.substring(12):e.match(/^ipfs:\/\//i)?e=e.substring(7):D(!1,"unsupported IPFS format","link",e),`https://gateway.ipfs.io/ipfs/${e}`}class mN{constructor(t){ie(this,"name");$e(this,{name:t})}connect(t){return this}supportsCoinType(t){return!1}async encodeAddress(t,n){throw new Error("unsupported coin")}async decodeAddress(t,n){throw new Error("unsupported coin")}}const zh=new RegExp("^(ipfs)://(.*)$","i"),n0=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),zh,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];var Jn,_r,Kn,ga,bc,qh;const va=class va{constructor(t,n,r){me(this,Kn);ie(this,"provider");ie(this,"address");ie(this,"name");me(this,Jn);me(this,_r);$e(this,{provider:t,address:n,name:r}),I(this,Jn,null),I(this,_r,new Tn(n,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],t))}async supportsWildcard(){return y(this,Jn)==null&&I(this,Jn,(async()=>{try{return await y(this,_r).supportsInterface("0x9061b923")}catch(t){if(Ut(t,"CALL_EXCEPTION"))return!1;throw I(this,Jn,null),t}})()),await y(this,Jn)}async getAddress(t){if(t==null&&(t=60),t===60)try{const o=await Ce(this,Kn,ga).call(this,"addr(bytes32)");return o==null||o===ko?null:o}catch(o){if(Ut(o,"CALL_EXCEPTION"))return null;throw o}if(t>=0&&t<2147483648){let o=t+2147483648;const i=await Ce(this,Kn,ga).call(this,"addr(bytes32,uint)",[o]);if(dt(i,20))return nt(i)}let n=null;for(const o of this.provider.plugins)if(o instanceof mN&&o.supportsCoinType(t)){n=o;break}if(n==null)return null;const r=await Ce(this,Kn,ga).call(this,"addr(bytes32,uint)",[t]);if(r==null||r==="0x")return null;const a=await n.decodeAddress(t,r);if(a!=null)return a;we(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${t})`,info:{coinType:t,data:r}})}async getText(t){const n=await Ce(this,Kn,ga).call(this,"text(bytes32,string)",[t]);return n==null||n==="0x"?null:n}async getContentHash(){const t=await Ce(this,Kn,ga).call(this,"contenthash(bytes32)");if(t==null||t==="0x")return null;const n=t.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(n){const a=n[1]==="e3010170"?"ipfs":"ipns",o=parseInt(n[4],16);if(n[5].length===o*2)return`${a}://${px("0x"+n[2])}`}const r=t.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(r&&r[1].length===64)return`bzz://${r[1]}`;we(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:t}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const t=[{type:"name",value:this.name}];try{const n=await this.getText("avatar");if(n==null)return t.push({type:"!avatar",value:""}),{url:null,linkage:t};t.push({type:"avatar",value:n});for(let r=0;r<n0.length;r++){const a=n.match(n0[r]);if(a==null)continue;const o=a[1].toLowerCase();switch(o){case"https":case"data":return t.push({type:"url",value:n}),{linkage:t,url:n};case"ipfs":{const i=ol(n);return t.push({type:"ipfs",value:n}),t.push({type:"url",value:i}),{linkage:t,url:i}}case"erc721":case"erc1155":{const i=o==="erc721"?"tokenURI(uint256)":"uri(uint256)";t.push({type:o,value:n});const c=await this.getAddress();if(c==null)return t.push({type:"!owner",value:""}),{url:null,linkage:t};const l=(a[2]||"").split("/");if(l.length!==2)return t.push({type:`!${o}caip`,value:a[2]||""}),{url:null,linkage:t};const u=l[1],d=new Tn(l[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if(o==="erc721"){const h=await d.ownerOf(u);if(c!==h)return t.push({type:"!owner",value:h}),{url:null,linkage:t};t.push({type:"owner",value:h})}else if(o==="erc1155"){const h=await d.balanceOf(c,u);if(!h)return t.push({type:"!balance",value:"0"}),{url:null,linkage:t};t.push({type:"balance",value:h.toString()})}let m=await d[i](u);if(m==null||m==="0x")return t.push({type:"!metadata-url",value:""}),{url:null,linkage:t};t.push({type:"metadata-url-base",value:m}),o==="erc1155"&&(m=m.replace("{id}",rr(u,32).substring(2)),t.push({type:"metadata-url-expanded",value:m})),m.match(/^ipfs:/i)&&(m=ol(m)),t.push({type:"metadata-url",value:m});let f={};const g=await new Sn(m).send();g.assertOk();try{f=g.bodyJson}catch{try{t.push({type:"!metadata",value:g.bodyText})}catch{const w=g.body;return w&&t.push({type:"!metadata",value:Se(w)}),{url:null,linkage:t}}return{url:null,linkage:t}}if(!f)return t.push({type:"!metadata",value:""}),{url:null,linkage:t};t.push({type:"metadata",value:JSON.stringify(f)});let N=f.image;if(typeof N!="string")return t.push({type:"!imageUrl",value:""}),{url:null,linkage:t};if(!N.match(/^(https:\/\/|data:)/i)){if(N.match(zh)==null)return t.push({type:"!imageUrl-ipfs",value:N}),{url:null,linkage:t};t.push({type:"imageUrl-ipfs",value:N}),N=ol(N)}return t.push({type:"url",value:N}),{linkage:t,url:N}}}}}catch{}return{linkage:t,url:null}}static async getEnsAddress(t){const n=await t.getNetwork(),r=n.getPlugin("org.ethers.plugins.network.Ens");return we(r,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:n}}),r.address}static async fromName(t,n){var a;let r=n;for(;;){if(r===""||r==="."||n!=="eth"&&r==="eth")return null;const o=await Ce(a=va,bc,qh).call(a,t,r);if(o!=null){const i=new va(t,o,n);return r!==n&&!await i.supportsWildcard()?null:i}r=r.split(".").slice(1).join(".")}}};Jn=new WeakMap,_r=new WeakMap,Kn=new WeakSet,ga=async function(t,n){n=(n||[]).slice();const r=y(this,_r).interface;n.unshift(Il(this.name));let a=null;await this.supportsWildcard()&&(a=r.getFunction(t),we(a,"missing fragment","UNKNOWN_ERROR",{info:{funcName:t}}),n=[T1(this.name,255),r.encodeFunctionData(a,n)],t="resolve(bytes,bytes)"),n.push({enableCcipRead:!0});try{const o=await y(this,_r)[t](...n);return a?r.decodeFunctionResult(a,o)[0]:o}catch(o){if(!Ut(o,"CALL_EXCEPTION"))throw o}return null},bc=new WeakSet,qh=async function(t,n){const r=await va.getEnsAddress(t);try{const o=await new Tn(r,["function resolver(bytes32) view returns (address)"],t).resolver(Il(n),{enableCcipRead:!0});return o===ko?null:o}catch(a){throw a}return null},me(va,bc);let mc=va;const r0=BigInt(0);function tt(e,t){return(function(n){return n==null?t:e(n)})}function ii(e,t){return(n=>{if(t&&n==null)return null;if(!Array.isArray(n))throw new Error("not an array");return n.map(r=>e(r))})}function Ci(e,t){return(n=>{const r={};for(const a in e){let o=a;if(t&&a in t&&!(o in n)){for(const i of t[a])if(i in n){o=i;break}}try{const i=e[a](n[o]);i!==void 0&&(r[a]=i)}catch(i){const c=i instanceof Error?i.message:"not-an-error";we(!1,`invalid value for value.${a} (${c})`,"BAD_DATA",{value:n})}}return r})}function hN(e){switch(e){case!0:case"true":return!0;case!1:case"false":return!1}D(!1,`invalid boolean; ${JSON.stringify(e)}`,"value",e)}function Eo(e){return D(dt(e,!0),"invalid data","value",e),e}function It(e){return D(dt(e,32),"invalid hash","value",e),e}const fN=Ci({address:nt,blockHash:It,blockNumber:Je,data:Eo,index:Je,removed:tt(hN,!1),topics:ii(It),transactionHash:It,transactionIndex:Je},{index:["logIndex"]});function pN(e){return fN(e)}const gN=Ci({hash:tt(It),parentHash:It,parentBeaconBlockRoot:tt(It,null),number:Je,timestamp:Je,nonce:tt(Eo),difficulty:Be,gasLimit:Be,gasUsed:Be,stateRoot:tt(It,null),receiptsRoot:tt(It,null),blobGasUsed:tt(Be,null),excessBlobGas:tt(Be,null),miner:tt(nt),prevRandao:tt(It,null),extraData:Eo,baseFeePerGas:tt(Be)},{prevRandao:["mixHash"]});function xN(e){const t=gN(e);return t.transactions=e.transactions.map(n=>typeof n=="string"?n:Qh(n)),t}const bN=Ci({transactionIndex:Je,blockNumber:Je,transactionHash:It,address:nt,topics:ii(It),data:Eo,index:Je,blockHash:It},{index:["logIndex"]});function yN(e){return bN(e)}const NN=Ci({to:tt(nt,null),from:tt(nt,null),contractAddress:tt(nt,null),index:Je,root:tt(Se),gasUsed:Be,blobGasUsed:tt(Be,null),logsBloom:tt(Eo),blockHash:It,hash:It,logs:ii(yN),blockNumber:Je,cumulativeGasUsed:Be,effectiveGasPrice:tt(Be),blobGasPrice:tt(Be,null),status:tt(Je),type:tt(Je,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function wN(e){return NN(e)}function Qh(e){e.to&&Be(e.to)===r0&&(e.to="0x0000000000000000000000000000000000000000");const t=Ci({hash:It,index:tt(Je,void 0),type:n=>n==="0x"||n==null?0:Je(n),accessList:tt(ia,null),blobVersionedHashes:tt(ii(It,!0),null),authorizationList:tt(ii(n=>{let r;if(n.signature)r=n.signature;else{let a=n.yParity;a==="0x1b"?a=0:a==="0x1c"&&(a=1),r=Object.assign({},n,{yParity:a})}return{address:nt(n.address),chainId:Be(n.chainId),nonce:Be(n.nonce),signature:rs.from(r)}},!1),null),blockHash:tt(It,null),blockNumber:tt(Je,null),transactionIndex:tt(Je,null),from:nt,gasPrice:tt(Be),maxPriorityFeePerGas:tt(Be),maxFeePerGas:tt(Be),maxFeePerBlobGas:tt(Be,null),gasLimit:Be,to:tt(nt,null),value:Be,nonce:Je,data:Eo,creates:tt(nt,null),chainId:tt(Be,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(e);if(t.to==null&&t.creates==null&&(t.creates=dy(t)),(e.type===1||e.type===2)&&e.accessList==null&&(t.accessList=[]),e.signature?t.signature=rs.from(e.signature):t.signature=rs.from(e),t.chainId==null){const n=t.signature.legacyChainId;n!=null&&(t.chainId=n)}return t.blockHash&&Be(t.blockHash)===r0&&(t.blockHash=null),t}const vN="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";class Mo{constructor(t){ie(this,"name");$e(this,{name:t})}clone(){return new Mo(this.name)}}class Uc extends Mo{constructor(n,r){n==null&&(n=0);super(`org.ethers.network.plugins.GasCost#${n||0}`);ie(this,"effectiveBlock");ie(this,"txBase");ie(this,"txCreate");ie(this,"txDataZero");ie(this,"txDataNonzero");ie(this,"txAccessListStorageKey");ie(this,"txAccessListAddress");const a={effectiveBlock:n};function o(i,c){let l=(r||{})[i];l==null&&(l=c),D(typeof l=="number",`invalud value for ${i}`,"costs",r),a[i]=l}o("txBase",21e3),o("txCreate",32e3),o("txDataZero",4),o("txDataNonzero",16),o("txAccessListStorageKey",1900),o("txAccessListAddress",2400),$e(this,a)}clone(){return new Uc(this.effectiveBlock,this)}}class $c extends Mo{constructor(n,r){super("org.ethers.plugins.network.Ens");ie(this,"address");ie(this,"targetNetwork");$e(this,{address:n||vN,targetNetwork:r??1})}clone(){return new $c(this.address,this.targetNetwork)}}var Ir;const Qd=class Qd extends Mo{constructor(n){super("org.ethers.plugins.network.FeeData");me(this,Ir);I(this,Ir,n)}get feeDataFunc(){return y(this,Ir)}async getFeeData(n){return await y(this,Ir).call(this,n)}clone(){return new Qd(y(this,Ir))}};Ir=new WeakMap;let a0=Qd;var gi,xi;class jN extends Mo{constructor(n,r){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin");me(this,gi);me(this,xi);I(this,gi,n),I(this,xi,r)}get url(){return y(this,gi)}get processFunc(){return y(this,xi)}clone(){return this}}gi=new WeakMap,xi=new WeakMap;const il=new Map;var to,so,Yn;const ja=class ja{constructor(t,n){me(this,to);me(this,so);me(this,Yn);I(this,to,t),I(this,so,Be(n)),I(this,Yn,new Map)}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return y(this,to)}set name(t){I(this,to,t)}get chainId(){return y(this,so)}set chainId(t){I(this,so,Be(t,"chainId"))}matches(t){if(t==null)return!1;if(typeof t=="string"){try{return this.chainId===Be(t)}catch{}return this.name===t}if(typeof t=="number"||typeof t=="bigint"){try{return this.chainId===Be(t)}catch{}return!1}if(typeof t=="object"){if(t.chainId!=null){try{return this.chainId===Be(t.chainId)}catch{}return!1}return t.name!=null?this.name===t.name:!1}return!1}get plugins(){return Array.from(y(this,Yn).values())}attachPlugin(t){if(y(this,Yn).get(t.name))throw new Error(`cannot replace existing plugin: ${t.name} `);return y(this,Yn).set(t.name,t.clone()),this}getPlugin(t){return y(this,Yn).get(t)||null}getPlugins(t){return this.plugins.filter(n=>n.name.split("#")[0]===t)}clone(){const t=new ja(this.name,this.chainId);return this.plugins.forEach(n=>{t.attachPlugin(n.clone())}),t}computeIntrinsicGas(t){const n=this.getPlugin("org.ethers.plugins.network.GasCost")||new Uc;let r=n.txBase;if(t.to==null&&(r+=n.txCreate),t.data)for(let a=2;a<t.data.length;a+=2)t.data.substring(a,a+2)==="00"?r+=n.txDataZero:r+=n.txDataNonzero;if(t.accessList){const a=ia(t.accessList);for(const o in a)r+=n.txAccessListAddress+n.txAccessListStorageKey*a[o].storageKeys.length}return r}static from(t){if(CN(),t==null)return ja.from("mainnet");if(typeof t=="number"&&(t=BigInt(t)),typeof t=="string"||typeof t=="bigint"){const n=il.get(t);if(n)return n();if(typeof t=="bigint")return new ja("unknown",t);D(!1,"unknown network","network",t)}if(typeof t.clone=="function")return t.clone();if(typeof t=="object"){D(typeof t.name=="string"&&typeof t.chainId=="number","invalid network object name or chainId","network",t);const n=new ja(t.name,t.chainId);return(t.ensAddress||t.ensNetwork!=null)&&n.attachPlugin(new $c(t.ensAddress,t.ensNetwork)),n}D(!1,"invalid network","network",t)}static register(t,n){typeof t=="number"&&(t=BigInt(t));const r=il.get(t);r&&D(!1,`conflicting network for ${JSON.stringify(r.name)}`,"nameOrChainId",t),il.set(t,n)}};to=new WeakMap,so=new WeakMap,Yn=new WeakMap;let en=ja;function o0(e,t){const n=String(e);if(!n.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${e}`);const r=n.split(".");if(r.length===1&&r.push(""),r.length!==2)throw new Error(`invalid gwei value: ${e}`);for(;r[1].length<t;)r[1]+="0";if(r[1].length>9){let a=BigInt(r[1].substring(0,9));r[1].substring(9).match(/^0+$/)||a++,r[1]=a.toString()}return BigInt(r[0]+r[1])}function i0(e){return new jN(e,async(t,n,r)=>{r.setHeader("User-Agent","ethers");let a;try{const[o,i]=await Promise.all([r.send(),t()]);a=o;const c=a.bodyJson.standard;return{gasPrice:i.gasPrice,maxFeePerGas:o0(c.maxFee,9),maxPriorityFeePerGas:o0(c.maxPriorityFee,9)}}catch(o){we(!1,`error encountered with polygon gas station (${JSON.stringify(r.url)})`,"SERVER_ERROR",{request:r,response:a,error:o})}})}let c0=!1;function CN(){if(c0)return;c0=!0;function e(t,n,r){const a=function(){const o=new en(t,n);return r.ensNetwork!=null&&o.attachPlugin(new $c(null,r.ensNetwork)),o.attachPlugin(new Uc),(r.plugins||[]).forEach(i=>{o.attachPlugin(i)}),o};en.register(t,a),en.register(n,a),r.altNames&&r.altNames.forEach(o=>{en.register(o,a)})}e("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),e("ropsten",3,{ensNetwork:3}),e("rinkeby",4,{ensNetwork:4}),e("goerli",5,{ensNetwork:5}),e("kovan",42,{ensNetwork:42}),e("sepolia",11155111,{ensNetwork:11155111}),e("holesky",17e3,{ensNetwork:17e3}),e("classic",61,{}),e("classicKotti",6,{}),e("arbitrum",42161,{ensNetwork:1}),e("arbitrum-goerli",421613,{}),e("arbitrum-sepolia",421614,{}),e("base",8453,{ensNetwork:1}),e("base-goerli",84531,{}),e("base-sepolia",84532,{}),e("bnb",56,{ensNetwork:1}),e("bnbt",97,{}),e("linea",59144,{ensNetwork:1}),e("linea-goerli",59140,{}),e("linea-sepolia",59141,{}),e("matic",137,{ensNetwork:1,plugins:[i0("https://gasstation.polygon.technology/v2")]}),e("matic-amoy",80002,{}),e("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[i0("https://gasstation-testnet.polygon.technology/v2")]}),e("optimism",10,{ensNetwork:1,plugins:[]}),e("optimism-goerli",420,{}),e("optimism-sepolia",11155420,{}),e("xdai",100,{ensNetwork:1})}function Hl(e){return JSON.parse(JSON.stringify(e))}var yn,gs,Zn,Ks,no,Qi;class kN{constructor(t){me(this,no);me(this,yn);me(this,gs);me(this,Zn);me(this,Ks);I(this,yn,t),I(this,gs,null),I(this,Zn,4e3),I(this,Ks,-2)}get pollingInterval(){return y(this,Zn)}set pollingInterval(t){I(this,Zn,t)}start(){y(this,gs)||(I(this,gs,y(this,yn)._setTimeout(Ce(this,no,Qi).bind(this),y(this,Zn))),Ce(this,no,Qi).call(this))}stop(){y(this,gs)&&(y(this,yn)._clearTimeout(y(this,gs)),I(this,gs,null))}pause(t){this.stop(),t&&I(this,Ks,-2)}resume(){this.start()}}yn=new WeakMap,gs=new WeakMap,Zn=new WeakMap,Ks=new WeakMap,no=new WeakSet,Qi=async function(){try{const t=await y(this,yn).getBlockNumber();if(y(this,Ks)===-2){I(this,Ks,t);return}if(t!==y(this,Ks)){for(let n=y(this,Ks)+1;n<=t;n++){if(y(this,gs)==null)return;await y(this,yn).emit("block",n)}I(this,Ks,t)}}catch{}y(this,gs)!=null&&I(this,gs,y(this,yn)._setTimeout(Ce(this,no,Qi).bind(this),y(this,Zn)))};var Ur,$r,Xn;class Rd{constructor(t){me(this,Ur);me(this,$r);me(this,Xn);I(this,Ur,t),I(this,Xn,!1),I(this,$r,n=>{this._poll(n,y(this,Ur))})}async _poll(t,n){throw new Error("sub-classes must override this")}start(){y(this,Xn)||(I(this,Xn,!0),y(this,$r).call(this,-2),y(this,Ur).on("block",y(this,$r)))}stop(){y(this,Xn)&&(I(this,Xn,!1),y(this,Ur).off("block",y(this,$r)))}pause(t){this.stop()}resume(){this.start()}}Ur=new WeakMap,$r=new WeakMap,Xn=new WeakMap;var ro,Nn;class AN extends Rd{constructor(n,r){super(n);me(this,ro);me(this,Nn);I(this,ro,r),I(this,Nn,-2)}pause(n){n&&I(this,Nn,-2),super.pause(n)}async _poll(n,r){const a=await r.getBlock(y(this,ro));a!=null&&(y(this,Nn)===-2?I(this,Nn,a.number):a.number>y(this,Nn)&&(r.emit(y(this,ro),a.number),I(this,Nn,a.number)))}}ro=new WeakMap,Nn=new WeakMap;var yc;class TN extends Rd{constructor(n,r){super(n);me(this,yc);I(this,yc,Hl(r))}async _poll(n,r){throw new Error("@TODO")}}yc=new WeakMap;var ao;class EN extends Rd{constructor(n,r){super(n);me(this,ao);I(this,ao,r)}async _poll(n,r){const a=await r.getTransactionReceipt(y(this,ao));a&&r.emit(y(this,ao),a)}}ao=new WeakMap;var wn,oo,io,Ln,xs,Nc,Wh;class Bd{constructor(t,n){me(this,Nc);me(this,wn);me(this,oo);me(this,io);me(this,Ln);me(this,xs);I(this,wn,t),I(this,oo,Hl(n)),I(this,io,Ce(this,Nc,Wh).bind(this)),I(this,Ln,!1),I(this,xs,-2)}start(){y(this,Ln)||(I(this,Ln,!0),y(this,xs)===-2&&y(this,wn).getBlockNumber().then(t=>{I(this,xs,t)}),y(this,wn).on("block",y(this,io)))}stop(){y(this,Ln)&&(I(this,Ln,!1),y(this,wn).off("block",y(this,io)))}pause(t){this.stop(),t&&I(this,xs,-2)}resume(){this.start()}}wn=new WeakMap,oo=new WeakMap,io=new WeakMap,Ln=new WeakMap,xs=new WeakMap,Nc=new WeakSet,Wh=async function(t){if(y(this,xs)===-2)return;const n=Hl(y(this,oo));n.fromBlock=y(this,xs)+1,n.toBlock=t;const r=await y(this,wn).getLogs(n);if(r.length===0){y(this,xs)<t-60&&I(this,xs,t-60);return}for(const a of r)y(this,wn).emit(y(this,oo),a),I(this,xs,a.blockNumber)};const SN=BigInt(2),FN=10;function Ii(e){return e&&typeof e.then=="function"}function Wi(e,t){return e+":"+JSON.stringify(t,(n,r)=>{if(r==null)return"null";if(typeof r=="bigint")return`bigint:${r.toString()}`;if(typeof r=="string")return r.toLowerCase();if(typeof r=="object"&&!Array.isArray(r)){const a=Object.keys(r);return a.sort(),a.reduce((o,i)=>(o[i]=r[i],o),{})}return r})}class Jh{constructor(t){ie(this,"name");$e(this,{name:t})}start(){}stop(){}pause(t){}resume(){}}function RN(e){return JSON.parse(JSON.stringify(e))}function zl(e){return e=Array.from(new Set(e).values()),e.sort(),e}async function cl(e,t){if(e==null)throw new Error("invalid event");if(Array.isArray(e)&&(e={topics:e}),typeof e=="string")switch(e){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:e,tag:e}}if(dt(e,32)){const n=e.toLowerCase();return{type:"transaction",tag:Wi("tx",{hash:n}),hash:n}}if(e.orphan){const n=e;return{type:"orphan",tag:Wi("orphan",n),filter:RN(n)}}if(e.address||e.topics){const n=e,r={topics:(n.topics||[]).map(a=>a==null?null:Array.isArray(a)?zl(a.map(o=>o.toLowerCase())):a.toLowerCase())};if(n.address){const a=[],o=[],i=c=>{dt(c)?a.push(c):o.push((async()=>{a.push(await Zt(c,t))})())};Array.isArray(n.address)?n.address.forEach(i):i(n.address),o.length&&await Promise.all(o),r.address=zl(a.map(c=>c.toLowerCase()))}return{filter:r,tag:Wi("event",r),type:"event"}}D(!1,"unknown ProviderEvent","event",e)}function ll(){return new Date().getTime()}const BN={cacheTimeout:250,pollingInterval:4e3};var Ht,Dn,zt,co,ms,Vr,er,vn,bi,bs,lo,uo,Ze,is,ql,Ql,Qo,Wl,Wo,Ji;class PN{constructor(t,n){me(this,Ze);me(this,Ht);me(this,Dn);me(this,zt);me(this,co);me(this,ms);me(this,Vr);me(this,er);me(this,vn);me(this,bi);me(this,bs);me(this,lo);me(this,uo);if(I(this,uo,Object.assign({},BN,n||{})),t==="any")I(this,Vr,!0),I(this,ms,null);else if(t){const r=en.from(t);I(this,Vr,!1),I(this,ms,Promise.resolve(r)),setTimeout(()=>{this.emit("network",r,null)},0)}else I(this,Vr,!1),I(this,ms,null);I(this,vn,-1),I(this,er,new Map),I(this,Ht,new Map),I(this,Dn,new Map),I(this,zt,null),I(this,co,!1),I(this,bi,1),I(this,bs,new Map),I(this,lo,!1)}get pollingInterval(){return y(this,uo).pollingInterval}get provider(){return this}get plugins(){return Array.from(y(this,Dn).values())}attachPlugin(t){if(y(this,Dn).get(t.name))throw new Error(`cannot replace existing plugin: ${t.name} `);return y(this,Dn).set(t.name,t.connect(this)),this}getPlugin(t){return y(this,Dn).get(t)||null}get disableCcipRead(){return y(this,lo)}set disableCcipRead(t){I(this,lo,!!t)}async ccipReadFetch(t,n,r){if(this.disableCcipRead||r.length===0||t.to==null)return null;const a=t.to.toLowerCase(),o=n.toLowerCase(),i=[];for(let c=0;c<r.length;c++){const l=r[c],u=l.replace("{sender}",a).replace("{data}",o),d=new Sn(u);l.indexOf("{data}")===-1&&(d.body={data:o,sender:a}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:d,index:c,urls:r});let m="unknown error",f;try{f=await d.send()}catch(g){i.push(g.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:d,result:{error:g}});continue}try{const g=f.bodyJson;if(g.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:d,result:g}),g.data;g.message&&(m=g.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:d,result:g})}catch{}we(f.statusCode<400||f.statusCode>=500,`response not found during CCIP fetch: ${m}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:t,info:{url:l,errorMessage:m}}),i.push(m)}we(!1,`error encountered during CCIP fetch: ${i.map(c=>JSON.stringify(c)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:t,info:{urls:r,errorMessages:i}})}_wrapBlock(t,n){return new L1(xN(t),this)}_wrapLog(t,n){return new ji(pN(t),this)}_wrapTransactionReceipt(t,n){return new Bh(wN(t),this)}_wrapTransactionResponse(t,n){return new oi(Qh(t),this)}_detectNetwork(){we(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(t){we(!1,`unsupported method: ${t.method}`,"UNSUPPORTED_OPERATION",{operation:t.method,info:t})}async getBlockNumber(){const t=Je(await Ce(this,Ze,is).call(this,{method:"getBlockNumber"}),"%response");return y(this,vn)>=0&&I(this,vn,t),t}_getAddress(t){return Zt(t,this)}_getBlockTag(t){if(t==null)return"latest";switch(t){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return t}if(dt(t))return dt(t,32)?t:Ps(t);if(typeof t=="bigint"&&(t=Je(t,"blockTag")),typeof t=="number")return t>=0?Ps(t):y(this,vn)>=0?Ps(y(this,vn)+t):this.getBlockNumber().then(n=>Ps(n+t));D(!1,"invalid blockTag","blockTag",t)}_getFilter(t){const n=(t.topics||[]).map(l=>l==null?null:Array.isArray(l)?zl(l.map(u=>u.toLowerCase())):l.toLowerCase()),r="blockHash"in t?t.blockHash:void 0,a=(l,u,d)=>{let m;switch(l.length){case 0:break;case 1:m=l[0];break;default:l.sort(),m=l}if(r&&(u!=null||d!=null))throw new Error("invalid filter");const f={};return m&&(f.address=m),n.length&&(f.topics=n),u&&(f.fromBlock=u),d&&(f.toBlock=d),r&&(f.blockHash=r),f};let o=[];if(t.address)if(Array.isArray(t.address))for(const l of t.address)o.push(this._getAddress(l));else o.push(this._getAddress(t.address));let i;"fromBlock"in t&&(i=this._getBlockTag(t.fromBlock));let c;return"toBlock"in t&&(c=this._getBlockTag(t.toBlock)),o.filter(l=>typeof l!="string").length||i!=null&&typeof i!="string"||c!=null&&typeof c!="string"?Promise.all([Promise.all(o),i,c]).then(l=>a(l[0],l[1],l[2])):a(o,i,c)}_getTransactionRequest(t){const n=dc(t),r=[];if(["to","from"].forEach(a=>{if(n[a]==null)return;const o=Zt(n[a],this);Ii(o)?r.push((async function(){n[a]=await o})()):n[a]=o}),n.blockTag!=null){const a=this._getBlockTag(n.blockTag);Ii(a)?r.push((async function(){n.blockTag=await a})()):n.blockTag=a}return r.length?(async function(){return await Promise.all(r),n})():n}async getNetwork(){if(y(this,ms)==null){const a=(async()=>{try{const o=await this._detectNetwork();return this.emit("network",o,null),o}catch(o){throw y(this,ms)===a&&I(this,ms,null),o}})();return I(this,ms,a),(await a).clone()}const t=y(this,ms),[n,r]=await Promise.all([t,this._detectNetwork()]);return n.chainId!==r.chainId&&(y(this,Vr)?(this.emit("network",r,n),y(this,ms)===t&&I(this,ms,Promise.resolve(r))):we(!1,`network changed: ${n.chainId} => ${r.chainId} `,"NETWORK_ERROR",{event:"changed"})),n.clone()}async getFeeData(){const t=await this.getNetwork(),n=async()=>{const{_block:a,gasPrice:o,priorityFee:i}=await Jt({_block:Ce(this,Ze,Wl).call(this,"latest",!1),gasPrice:(async()=>{try{const d=await Ce(this,Ze,is).call(this,{method:"getGasPrice"});return Be(d,"%response")}catch{}return null})(),priorityFee:(async()=>{try{const d=await Ce(this,Ze,is).call(this,{method:"getPriorityFee"});return Be(d,"%response")}catch{}return null})()});let c=null,l=null;const u=this._wrapBlock(a,t);return u&&u.baseFeePerGas&&(l=i??BigInt("1000000000"),c=u.baseFeePerGas*SN+l),new e0(o,c,l)},r=t.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(r){const a=new Sn(r.url),o=await r.processFunc(n,this,a);return new e0(o.gasPrice,o.maxFeePerGas,o.maxPriorityFeePerGas)}return await n()}async estimateGas(t){let n=this._getTransactionRequest(t);return Ii(n)&&(n=await n),Be(await Ce(this,Ze,is).call(this,{method:"estimateGas",transaction:n}),"%response")}async call(t){const{tx:n,blockTag:r}=await Jt({tx:this._getTransactionRequest(t),blockTag:this._getBlockTag(t.blockTag)});return await Ce(this,Ze,Ql).call(this,Ce(this,Ze,ql).call(this,n,r,t.enableCcipRead?0:-1))}async getBalance(t,n){return Be(await Ce(this,Ze,Qo).call(this,{method:"getBalance"},t,n),"%response")}async getTransactionCount(t,n){return Je(await Ce(this,Ze,Qo).call(this,{method:"getTransactionCount"},t,n),"%response")}async getCode(t,n){return Se(await Ce(this,Ze,Qo).call(this,{method:"getCode"},t,n))}async getStorage(t,n,r){const a=Be(n,"position");return Se(await Ce(this,Ze,Qo).call(this,{method:"getStorage",position:a},t,r))}async broadcastTransaction(t){const{blockNumber:n,hash:r,network:a}=await Jt({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:t}),network:this.getNetwork()}),o=nc.from(t);if(o.hash!==r)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(o,a).replaceableTransaction(n)}async getBlock(t,n){const{network:r,params:a}=await Jt({network:this.getNetwork(),params:Ce(this,Ze,Wl).call(this,t,!!n)});return a==null?null:this._wrapBlock(a,r)}async getTransaction(t){const{network:n,params:r}=await Jt({network:this.getNetwork(),params:Ce(this,Ze,is).call(this,{method:"getTransaction",hash:t})});return r==null?null:this._wrapTransactionResponse(r,n)}async getTransactionReceipt(t){const{network:n,params:r}=await Jt({network:this.getNetwork(),params:Ce(this,Ze,is).call(this,{method:"getTransactionReceipt",hash:t})});if(r==null)return null;if(r.gasPrice==null&&r.effectiveGasPrice==null){const a=await Ce(this,Ze,is).call(this,{method:"getTransaction",hash:t});if(a==null)throw new Error("report this; could not find tx or effectiveGasPrice");r.effectiveGasPrice=a.gasPrice}return this._wrapTransactionReceipt(r,n)}async getTransactionResult(t){const{result:n}=await Jt({network:this.getNetwork(),result:Ce(this,Ze,is).call(this,{method:"getTransactionResult",hash:t})});return n==null?null:Se(n)}async getLogs(t){let n=this._getFilter(t);Ii(n)&&(n=await n);const{network:r,params:a}=await Jt({network:this.getNetwork(),params:Ce(this,Ze,is).call(this,{method:"getLogs",filter:n})});return a.map(o=>this._wrapLog(o,r))}_getProvider(t){we(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(t){return await mc.fromName(this,t)}async getAvatar(t){const n=await this.getResolver(t);return n?await n.getAvatar():null}async resolveName(t){const n=await this.getResolver(t);return n?await n.getAddress():null}async lookupAddress(t){t=nt(t);const n=Il(t.substring(2).toLowerCase()+".addr.reverse");try{const r=await mc.getEnsAddress(this),o=await new Tn(r,["function resolver(bytes32) view returns (address)"],this).resolver(n);if(o==null||o===ko)return null;const c=await new Tn(o,["function name(bytes32) view returns (string)"],this).name(n);return await this.resolveName(c)!==t?null:c}catch(r){if(Ut(r,"BAD_DATA")&&r.value==="0x"||Ut(r,"CALL_EXCEPTION"))return null;throw r}return null}async waitForTransaction(t,n,r){const a=n??1;return a===0?this.getTransactionReceipt(t):new Promise(async(o,i)=>{let c=null;const l=(async u=>{try{const d=await this.getTransactionReceipt(t);if(d!=null&&u-d.blockNumber+1>=a){o(d),c&&(clearTimeout(c),c=null);return}}catch(d){console.log("EEE",d)}this.once("block",l)});r!=null&&(c=setTimeout(()=>{c!=null&&(c=null,this.off("block",l),i(pt("timeout","TIMEOUT",{reason:"timeout"})))},r)),l(await this.getBlockNumber())})}async waitForBlock(t){we(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(t){const n=y(this,bs).get(t);n&&(n.timer&&clearTimeout(n.timer),y(this,bs).delete(t))}_setTimeout(t,n){n==null&&(n=0);const r=Oo(this,bi)._++,a=()=>{y(this,bs).delete(r),t()};if(this.paused)y(this,bs).set(r,{timer:null,func:a,time:n});else{const o=setTimeout(a,n);y(this,bs).set(r,{timer:o,func:a,time:ll()})}return r}_forEachSubscriber(t){for(const n of y(this,Ht).values())t(n.subscriber)}_getSubscriber(t){switch(t.type){case"debug":case"error":case"network":return new Jh(t.type);case"block":{const n=new kN(this);return n.pollingInterval=this.pollingInterval,n}case"safe":case"finalized":return new AN(this,t.type);case"event":return new Bd(this,t.filter);case"transaction":return new EN(this,t.hash);case"orphan":return new TN(this,t.filter)}throw new Error(`unsupported event: ${t.type}`)}_recoverSubscriber(t,n){for(const r of y(this,Ht).values())if(r.subscriber===t){r.started&&r.subscriber.stop(),r.subscriber=n,r.started&&n.start(),y(this,zt)!=null&&n.pause(y(this,zt));break}}async on(t,n){const r=await Ce(this,Ze,Ji).call(this,t);return r.listeners.push({listener:n,once:!1}),r.started||(r.subscriber.start(),r.started=!0,y(this,zt)!=null&&r.subscriber.pause(y(this,zt))),this}async once(t,n){const r=await Ce(this,Ze,Ji).call(this,t);return r.listeners.push({listener:n,once:!0}),r.started||(r.subscriber.start(),r.started=!0,y(this,zt)!=null&&r.subscriber.pause(y(this,zt))),this}async emit(t,...n){const r=await Ce(this,Ze,Wo).call(this,t,n);if(!r||r.listeners.length===0)return!1;const a=r.listeners.length;return r.listeners=r.listeners.filter(({listener:o,once:i})=>{const c=new sm(this,i?null:o,t);try{o.call(this,...n,c)}catch{}return!i}),r.listeners.length===0&&(r.started&&r.subscriber.stop(),y(this,Ht).delete(r.tag)),a>0}async listenerCount(t){if(t){const r=await Ce(this,Ze,Wo).call(this,t);return r?r.listeners.length:0}let n=0;for(const{listeners:r}of y(this,Ht).values())n+=r.length;return n}async listeners(t){if(t){const r=await Ce(this,Ze,Wo).call(this,t);return r?r.listeners.map(({listener:a})=>a):[]}let n=[];for(const{listeners:r}of y(this,Ht).values())n=n.concat(r.map(({listener:a})=>a));return n}async off(t,n){const r=await Ce(this,Ze,Wo).call(this,t);if(!r)return this;if(n){const a=r.listeners.map(({listener:o})=>o).indexOf(n);a>=0&&r.listeners.splice(a,1)}return(!n||r.listeners.length===0)&&(r.started&&r.subscriber.stop(),y(this,Ht).delete(r.tag)),this}async removeAllListeners(t){if(t){const{tag:n,started:r,subscriber:a}=await Ce(this,Ze,Ji).call(this,t);r&&a.stop(),y(this,Ht).delete(n)}else for(const[n,{started:r,subscriber:a}]of y(this,Ht))r&&a.stop(),y(this,Ht).delete(n);return this}async addListener(t,n){return await this.on(t,n)}async removeListener(t,n){return this.off(t,n)}get destroyed(){return y(this,co)}destroy(){this.removeAllListeners();for(const t of y(this,bs).keys())this._clearTimeout(t);I(this,co,!0)}get paused(){return y(this,zt)!=null}set paused(t){!!t!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(t){if(I(this,vn,-1),y(this,zt)!=null){if(y(this,zt)==!!t)return;we(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(n=>n.pause(t)),I(this,zt,!!t);for(const n of y(this,bs).values())n.timer&&clearTimeout(n.timer),n.time=ll()-n.time}resume(){if(y(this,zt)!=null){this._forEachSubscriber(t=>t.resume()),I(this,zt,null);for(const t of y(this,bs).values()){let n=t.time;n<0&&(n=0),t.time=ll(),setTimeout(t.func,n)}}}}Ht=new WeakMap,Dn=new WeakMap,zt=new WeakMap,co=new WeakMap,ms=new WeakMap,Vr=new WeakMap,er=new WeakMap,vn=new WeakMap,bi=new WeakMap,bs=new WeakMap,lo=new WeakMap,uo=new WeakMap,Ze=new WeakSet,is=async function(t){const n=y(this,uo).cacheTimeout;if(n<0)return await this._perform(t);const r=Wi(t.method,t);let a=y(this,er).get(r);return a||(a=this._perform(t),y(this,er).set(r,a),setTimeout(()=>{y(this,er).get(r)===a&&y(this,er).delete(r)},n)),await a},ql=async function(t,n,r){we(r<FN,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},t,{blockTag:n,enableCcipRead:!0})});const a=dc(t);try{return Se(await this._perform({method:"call",transaction:a,blockTag:n}))}catch(o){if(!this.disableCcipRead&&ud(o)&&o.data&&r>=0&&n==="latest"&&a.to!=null&&yt(o.data,0,4)==="0x556f1830"){const i=o.data,c=await Zt(a.to,this);let l;try{l=UN(yt(o.data,4))}catch(m){we(!1,m.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:a,info:{data:i}})}we(l.sender.toLowerCase()===c.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:i,reason:"OffchainLookup",transaction:a,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:l.errorArgs}});const u=await this.ccipReadFetch(a,l.calldata,l.urls);we(u!=null,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:a,info:{data:o.data,errorArgs:l.errorArgs}});const d={to:c,data:wt([l.selector,IN([u,l.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:d});try{const m=await Ce(this,Ze,ql).call(this,d,n,r+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},d),result:m}),m}catch(m){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},d),error:m}),m}}throw o}},Ql=async function(t){const{value:n}=await Jt({network:this.getNetwork(),value:t});return n},Qo=async function(t,n,r){let a=this._getAddress(n),o=this._getBlockTag(r);return(typeof a!="string"||typeof o!="string")&&([a,o]=await Promise.all([a,o])),await Ce(this,Ze,Ql).call(this,Ce(this,Ze,is).call(this,Object.assign(t,{address:a,blockTag:o})))},Wl=async function(t,n){if(dt(t,32))return await Ce(this,Ze,is).call(this,{method:"getBlock",blockHash:t,includeTransactions:n});let r=this._getBlockTag(t);return typeof r!="string"&&(r=await r),await Ce(this,Ze,is).call(this,{method:"getBlock",blockTag:r,includeTransactions:n})},Wo=async function(t,n){let r=await cl(t,this);return r.type==="event"&&n&&n.length>0&&n[0].removed===!0&&(r=await cl({orphan:"drop-log",log:n[0]},this)),y(this,Ht).get(r.tag)||null},Ji=async function(t){const n=await cl(t,this),r=n.tag;let a=y(this,Ht).get(r);return a||(a={subscriber:this._getSubscriber(n),tag:r,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},y(this,Ht).set(r,a)),a};function MN(e,t){try{const n=Jl(e,t);if(n)return tc(n)}catch{}return null}function Jl(e,t){if(e==="0x")return null;try{const n=Je(yt(e,t,t+32)),r=Je(yt(e,n,n+32));return yt(e,n+32,n+32+r)}catch{}return null}function l0(e){const t=St(e);if(t.length>32)throw new Error("internal; should not happen");const n=new Uint8Array(32);return n.set(t,32-t.length),n}function ON(e){if(e.length%32===0)return e;const t=new Uint8Array(Math.ceil(e.length/32)*32);return t.set(e),t}const _N=new Uint8Array([]);function IN(e){const t=[];let n=0;for(let r=0;r<e.length;r++)t.push(_N),n+=32;for(let r=0;r<e.length;r++){const a=We(e[r]);t[r]=l0(n),t.push(l0(a.length)),t.push(ON(a)),n+=32+Math.ceil(a.length/32)*32}return wt(t)}const d0="0x0000000000000000000000000000000000000000000000000000000000000000";function UN(e){const t={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};we(Ca(e)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const n=yt(e,0,32);we(yt(n,0,12)===yt(d0,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),t.sender=yt(n,12);try{const r=[],a=Je(yt(e,32,64)),o=Je(yt(e,a,a+32)),i=yt(e,a+32);for(let c=0;c<o;c++){const l=MN(i,c*32);if(l==null)throw new Error("abort");r.push(l)}t.urls=r}catch{we(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const r=Jl(e,64);if(r==null)throw new Error("abort");t.calldata=r}catch{we(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}we(yt(e,100,128)===yt(d0,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),t.selector=yt(e,96,100);try{const r=Jl(e,128);if(r==null)throw new Error("abort");t.extraData=r}catch{we(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return t.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(r=>t[r]),t}function ur(e,t){if(e.provider)return e.provider;we(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:t})}async function u0(e,t){let n=dc(t);if(n.to!=null&&(n.to=Zt(n.to,e)),n.from!=null){const r=n.from;n.from=Promise.all([e.getAddress(),Zt(r,e)]).then(([a,o])=>(D(a.toLowerCase()===o.toLowerCase(),"transaction from mismatch","tx.from",o),a))}else n.from=e.getAddress();return await Jt(n)}class Kh{constructor(t){ie(this,"provider");$e(this,{provider:t||null})}async getNonce(t){return ur(this,"getTransactionCount").getTransactionCount(await this.getAddress(),t)}async populateCall(t){return await u0(this,t)}async populateTransaction(t){const n=ur(this,"populateTransaction"),r=await u0(this,t);r.nonce==null&&(r.nonce=await this.getNonce("pending")),r.gasLimit==null&&(r.gasLimit=await this.estimateGas(r));const a=await this.provider.getNetwork();if(r.chainId!=null){const i=Be(r.chainId);D(i===a.chainId,"transaction chainId mismatch","tx.chainId",t.chainId)}else r.chainId=a.chainId;const o=r.maxFeePerGas!=null||r.maxPriorityFeePerGas!=null;if(r.gasPrice!=null&&(r.type===2||o)?D(!1,"eip-1559 transaction do not support gasPrice","tx",t):(r.type===0||r.type===1)&&o&&D(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",t),(r.type===2||r.type==null)&&r.maxFeePerGas!=null&&r.maxPriorityFeePerGas!=null)r.type=2;else if(r.type===0||r.type===1){const i=await n.getFeeData();we(i.gasPrice!=null,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),r.gasPrice==null&&(r.gasPrice=i.gasPrice)}else{const i=await n.getFeeData();if(r.type==null)if(i.maxFeePerGas!=null&&i.maxPriorityFeePerGas!=null)if(r.authorizationList&&r.authorizationList.length?r.type=4:r.type=2,r.gasPrice!=null){const c=r.gasPrice;delete r.gasPrice,r.maxFeePerGas=c,r.maxPriorityFeePerGas=c}else r.maxFeePerGas==null&&(r.maxFeePerGas=i.maxFeePerGas),r.maxPriorityFeePerGas==null&&(r.maxPriorityFeePerGas=i.maxPriorityFeePerGas);else i.gasPrice!=null?(we(!o,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),r.gasPrice==null&&(r.gasPrice=i.gasPrice),r.type=0):we(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else(r.type===2||r.type===3||r.type===4)&&(r.maxFeePerGas==null&&(r.maxFeePerGas=i.maxFeePerGas),r.maxPriorityFeePerGas==null&&(r.maxPriorityFeePerGas=i.maxPriorityFeePerGas))}return await Jt(r)}async populateAuthorization(t){const n=Object.assign({},t);return n.chainId==null&&(n.chainId=(await ur(this,"getNetwork").getNetwork()).chainId),n.nonce==null&&(n.nonce=await this.getNonce()),n}async estimateGas(t){return ur(this,"estimateGas").estimateGas(await this.populateCall(t))}async call(t){return ur(this,"call").call(await this.populateCall(t))}async resolveName(t){return await ur(this,"resolveName").resolveName(t)}async sendTransaction(t){const n=ur(this,"sendTransaction"),r=await this.populateTransaction(t);delete r.from;const a=nc.from(r);return await n.broadcastTransaction(await this.signTransaction(a))}authorize(t){we(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}}var mo,Ki;const Wd=class Wd extends Kh{constructor(n,r){super(r);me(this,mo);ie(this,"address");$e(this,{address:n})}async getAddress(){return this.address}connect(n){return new Wd(this.address,n)}async signTransaction(n){Ce(this,mo,Ki).call(this,"transactions","signTransaction")}async signMessage(n){Ce(this,mo,Ki).call(this,"messages","signMessage")}async signTypedData(n,r,a){Ce(this,mo,Ki).call(this,"typed-data","signTypedData")}};mo=new WeakSet,Ki=function(n,r){we(!1,`VoidSigner cannot sign ${n}`,"UNSUPPORTED_OPERATION",{operation:r})};let m0=Wd;function $N(e){return JSON.parse(JSON.stringify(e))}var Wt,Ys,Gr,tr,Hr,ho,or,Kl,Yl;class Yh{constructor(t){me(this,or);me(this,Wt);me(this,Ys);me(this,Gr);me(this,tr);me(this,Hr);me(this,ho);I(this,Wt,t),I(this,Ys,null),I(this,Gr,Ce(this,or,Kl).bind(this)),I(this,tr,!1),I(this,Hr,null),I(this,ho,!1)}_subscribe(t){throw new Error("subclasses must override this")}_emitResults(t,n){throw new Error("subclasses must override this")}_recover(t){throw new Error("subclasses must override this")}start(){y(this,tr)||(I(this,tr,!0),Ce(this,or,Kl).call(this,-2))}stop(){y(this,tr)&&(I(this,tr,!1),I(this,ho,!0),Ce(this,or,Yl).call(this),y(this,Wt).off("block",y(this,Gr)))}pause(t){t&&Ce(this,or,Yl).call(this),y(this,Wt).off("block",y(this,Gr))}resume(){this.start()}}Wt=new WeakMap,Ys=new WeakMap,Gr=new WeakMap,tr=new WeakMap,Hr=new WeakMap,ho=new WeakMap,or=new WeakSet,Kl=async function(t){try{y(this,Ys)==null&&I(this,Ys,this._subscribe(y(this,Wt)));let n=null;try{n=await y(this,Ys)}catch(o){if(!Ut(o,"UNSUPPORTED_OPERATION")||o.operation!=="eth_newFilter")throw o}if(n==null){I(this,Ys,null),y(this,Wt)._recoverSubscriber(this,this._recover(y(this,Wt)));return}const r=await y(this,Wt).getNetwork();if(y(this,Hr)||I(this,Hr,r),y(this,Hr).chainId!==r.chainId)throw new Error("chaid changed");if(y(this,ho))return;const a=await y(this,Wt).send("eth_getFilterChanges",[n]);await this._emitResults(y(this,Wt),a)}catch(n){console.log("@TODO",n)}y(this,Wt).once("block",y(this,Gr))},Yl=function(){const t=y(this,Ys);t&&(I(this,Ys,null),t.then(n=>{y(this,Wt).destroyed||y(this,Wt).send("eth_uninstallFilter",[n])}))};var zr;class VN extends Yh{constructor(n,r){super(n);me(this,zr);I(this,zr,$N(r))}_recover(n){return new Bd(n,y(this,zr))}async _subscribe(n){return await n.send("eth_newFilter",[y(this,zr)])}async _emitResults(n,r){for(const a of r)n.emit(y(this,zr),n._wrapLog(a,n._network))}}zr=new WeakMap;class GN extends Yh{async _subscribe(t){return await t.send("eth_newPendingTransactionFilter",[])}async _emitResults(t,n){for(const r of n)t.emit("pending",r)}}const HN="bigint,boolean,function,number,string,symbol".split(/,/g);function Yi(e){if(e==null||HN.indexOf(typeof e)>=0||typeof e.getAddress=="function")return e;if(Array.isArray(e))return e.map(Yi);if(typeof e=="object")return Object.keys(e).reduce((t,n)=>(t[n]=e[n],t),{});throw new Error(`should not happen: ${e} (${typeof e})`)}function zN(e){return new Promise(t=>{setTimeout(t,e)})}function ma(e){return e&&e.toLowerCase()}function h0(e){return e&&typeof e.pollingInterval=="number"}const Zh={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class dl extends Kh{constructor(n,r){super(n);ie(this,"address");r=nt(r),$e(this,{address:r})}connect(n){we(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(n){return await this.populateCall(n)}async sendUncheckedTransaction(n){const r=Yi(n),a=[];if(r.from){const i=r.from;a.push((async()=>{const c=await Zt(i,this.provider);D(c!=null&&c.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",n),r.from=c})())}else r.from=this.address;if(r.gasLimit==null&&a.push((async()=>{r.gasLimit=await this.provider.estimateGas({...r,from:this.address})})()),r.to!=null){const i=r.to;a.push((async()=>{r.to=await Zt(i,this.provider)})())}a.length&&await Promise.all(a);const o=this.provider.getRpcTransaction(r);return this.provider.send("eth_sendTransaction",[o])}async sendTransaction(n){const r=await this.provider.getBlockNumber(),a=await this.sendUncheckedTransaction(n);return await new Promise((o,i)=>{const c=[1e3,100];let l=0;const u=async()=>{try{const d=await this.provider.getTransaction(a);if(d!=null){o(d.replaceableTransaction(r));return}}catch(d){if(Ut(d,"CANCELLED")||Ut(d,"BAD_DATA")||Ut(d,"NETWORK_ERROR")||Ut(d,"UNSUPPORTED_OPERATION")){d.info==null&&(d.info={}),d.info.sendTransactionHash=a,i(d);return}if(Ut(d,"INVALID_ARGUMENT")&&(l++,d.info==null&&(d.info={}),d.info.sendTransactionHash=a,l>10)){i(d);return}this.provider.emit("error",pt("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:d}))}this.provider._setTimeout(()=>{u()},c.pop()||4e3)};u()})}async signTransaction(n){const r=Yi(n);if(r.from){const o=await Zt(r.from,this.provider);D(o!=null&&o.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",n),r.from=o}else r.from=this.address;const a=this.provider.getRpcTransaction(r);return await this.provider.send("eth_signTransaction",[a])}async signMessage(n){const r=typeof n=="string"?tn(n):n;return await this.provider.send("personal_sign",[Se(r),this.address.toLowerCase()])}async signTypedData(n,r,a){const o=Yi(a),i=await ni.resolveNames(n,r,o,async c=>{const l=await Zt(c);return D(l!=null,"TypedData does not support null address","value",c),l});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(ni.getPayload(i.domain,r,i.value))])}async unlock(n){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),n,null])}async _legacySignMessage(n){const r=typeof n=="string"?tn(n):n;return await this.provider.send("eth_sign",[this.address.toLowerCase(),Se(r)])}}var qr,fo,jn,Zs,Bs,ys,Dt,yi,Zl;class qN extends PN{constructor(n,r){super(n,r);me(this,yi);me(this,qr);me(this,fo);me(this,jn);me(this,Zs);me(this,Bs);me(this,ys);me(this,Dt);I(this,fo,1),I(this,qr,Object.assign({},Zh,r||{})),I(this,jn,[]),I(this,Zs,null),I(this,ys,null),I(this,Dt,null);{let o=null;const i=new Promise(c=>{o=c});I(this,Bs,{promise:i,resolve:o})}const a=this._getOption("staticNetwork");typeof a=="boolean"?(D(!a||n!=="any","staticNetwork cannot be used on special network 'any'","options",r),a&&n!=null&&I(this,ys,en.from(n))):a&&(D(n==null||a.matches(n),"staticNetwork MUST match network object","options",r),I(this,ys,a))}_getOption(n){return y(this,qr)[n]}get _network(){return we(y(this,ys),"network is not available yet","NETWORK_ERROR"),y(this,ys)}async _perform(n){if(n.method==="call"||n.method==="estimateGas"){let a=n.transaction;if(a&&a.type!=null&&Be(a.type)&&a.maxFeePerGas==null&&a.maxPriorityFeePerGas==null){const o=await this.getFeeData();o.maxFeePerGas==null&&o.maxPriorityFeePerGas==null&&(n=Object.assign({},n,{transaction:Object.assign({},a,{type:void 0})}))}}const r=this.getRpcRequest(n);return r!=null?await this.send(r.method,r.args):super._perform(n)}async _detectNetwork(){const n=this._getOption("staticNetwork");if(n)if(n===!0){if(y(this,ys))return y(this,ys)}else return n;return y(this,Dt)?await y(this,Dt):this.ready?(I(this,Dt,(async()=>{try{const r=en.from(Be(await this.send("eth_chainId",[])));return I(this,Dt,null),r}catch(r){throw I(this,Dt,null),r}})()),await y(this,Dt)):(I(this,Dt,(async()=>{const r={id:Oo(this,fo)._++,method:"eth_chainId",params:[],jsonrpc:"2.0"};this.emit("debug",{action:"sendRpcPayload",payload:r});let a;try{a=(await this._send(r))[0],I(this,Dt,null)}catch(o){throw I(this,Dt,null),this.emit("debug",{action:"receiveRpcError",error:o}),o}if(this.emit("debug",{action:"receiveRpcResult",result:a}),"result"in a)return en.from(Be(a.result));throw this.getRpcError(r,a)})()),await y(this,Dt))}_start(){y(this,Bs)==null||y(this,Bs).resolve==null||(y(this,Bs).resolve(),I(this,Bs,null),(async()=>{for(;y(this,ys)==null&&!this.destroyed;)try{I(this,ys,await this._detectNetwork())}catch(n){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",pt("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:n}})),await zN(1e3)}Ce(this,yi,Zl).call(this)})())}async _waitUntilReady(){if(y(this,Bs)!=null)return await y(this,Bs).promise}_getSubscriber(n){return n.type==="pending"?new GN(this):n.type==="event"?this._getOption("polling")?new Bd(this,n.filter):new VN(this,n.filter):n.type==="orphan"&&n.filter.orphan==="drop-log"?new Jh("orphan"):super._getSubscriber(n)}get ready(){return y(this,Bs)==null}getRpcTransaction(n){const r={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(a=>{if(n[a]==null)return;let o=a;a==="gasLimit"&&(o="gas"),r[o]=Ps(Be(n[a],`tx.${a}`))}),["from","to","data"].forEach(a=>{n[a]!=null&&(r[a]=Se(n[a]))}),n.accessList&&(r.accessList=ia(n.accessList)),n.blobVersionedHashes&&(r.blobVersionedHashes=n.blobVersionedHashes.map(a=>a.toLowerCase())),n.authorizationList&&(r.authorizationList=n.authorizationList.map(a=>{const o=Xm(a);return{address:o.address,nonce:Ps(o.nonce),chainId:Ps(o.chainId),yParity:Ps(o.signature.yParity),r:Ps(o.signature.r),s:Ps(o.signature.s)}})),r}getRpcRequest(n){switch(n.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[ma(n.address),n.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[ma(n.address),n.blockTag]};case"getCode":return{method:"eth_getCode",args:[ma(n.address),n.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[ma(n.address),"0x"+n.position.toString(16),n.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[n.signedTransaction]};case"getBlock":if("blockTag"in n)return{method:"eth_getBlockByNumber",args:[n.blockTag,!!n.includeTransactions]};if("blockHash"in n)return{method:"eth_getBlockByHash",args:[n.blockHash,!!n.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[n.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[n.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(n.transaction),n.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(n.transaction)]};case"getLogs":return n.filter&&n.filter.address!=null&&(Array.isArray(n.filter.address)?n.filter.address=n.filter.address.map(ma):n.filter.address=ma(n.filter.address)),{method:"eth_getLogs",args:[n.filter]}}return null}getRpcError(n,r){const{method:a}=n,{error:o}=r;if(a==="eth_estimateGas"&&o.message){const l=o.message;if(!l.match(/revert/i)&&l.match(/insufficient funds/i))return pt("insufficient funds","INSUFFICIENT_FUNDS",{transaction:n.params[0],info:{payload:n,error:o}});if(l.match(/nonce/i)&&l.match(/too low/i))return pt("nonce has already been used","NONCE_EXPIRED",{transaction:n.params[0],info:{payload:n,error:o}})}if(a==="eth_call"||a==="eth_estimateGas"){const l=Xl(o),u=ai.getBuiltinCallException(a==="eth_call"?"call":"estimateGas",n.params[0],l?l.data:null);return u.info={error:o,payload:n},u}const i=JSON.stringify(WN(o));if(typeof o.message=="string"&&o.message.match(/user denied|ethers-user-denied/i))return pt("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[a]||"unknown",reason:"rejected",info:{payload:n,error:o}});if(a==="eth_sendRawTransaction"||a==="eth_sendTransaction"){const l=n.params[0];if(i.match(/insufficient funds|base fee exceeds gas limit/i))return pt("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:l,info:{error:o}});if(i.match(/nonce/i)&&i.match(/too low/i))return pt("nonce has already been used","NONCE_EXPIRED",{transaction:l,info:{error:o}});if(i.match(/replacement transaction/i)&&i.match(/underpriced/i))return pt("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:l,info:{error:o}});if(i.match(/only replay-protected/i))return pt("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:a,info:{transaction:l,info:{error:o}}})}let c=!!i.match(/the method .* does not exist/i);return c||o&&o.details&&o.details.startsWith("Unauthorized method:")&&(c=!0),c?pt("unsupported operation","UNSUPPORTED_OPERATION",{operation:n.method,info:{error:o,payload:n}}):pt("could not coalesce error","UNKNOWN_ERROR",{error:o,payload:n})}send(n,r){if(this.destroyed)return Promise.reject(pt("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:n}));const a=Oo(this,fo)._++,o=new Promise((i,c)=>{y(this,jn).push({resolve:i,reject:c,payload:{method:n,params:r,id:a,jsonrpc:"2.0"}})});return Ce(this,yi,Zl).call(this),o}async getSigner(n){n==null&&(n=0);const r=this.send("eth_accounts",[]);if(typeof n=="number"){const o=await r;if(n>=o.length)throw new Error("no such account");return new dl(this,o[n])}const{accounts:a}=await Jt({network:this.getNetwork(),accounts:r});n=nt(n);for(const o of a)if(nt(o)===n)return new dl(this,n);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(r=>new dl(this,r))}destroy(){y(this,Zs)&&(clearTimeout(y(this,Zs)),I(this,Zs,null));for(const{payload:n,reject:r}of y(this,jn))r(pt("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:n.method}));I(this,jn,[]),super.destroy()}}qr=new WeakMap,fo=new WeakMap,jn=new WeakMap,Zs=new WeakMap,Bs=new WeakMap,ys=new WeakMap,Dt=new WeakMap,yi=new WeakSet,Zl=function(){if(y(this,Zs))return;const n=this._getOption("batchMaxCount")===1?0:this._getOption("batchStallTime");I(this,Zs,setTimeout(()=>{I(this,Zs,null);const r=y(this,jn);for(I(this,jn,[]);r.length;){const a=[r.shift()];for(;r.length&&a.length!==y(this,qr).batchMaxCount;)if(a.push(r.shift()),JSON.stringify(a.map(i=>i.payload)).length>y(this,qr).batchMaxSize){r.unshift(a.pop());break}(async()=>{const o=a.length===1?a[0].payload:a.map(i=>i.payload);this.emit("debug",{action:"sendRpcPayload",payload:o});try{const i=await this._send(o);this.emit("debug",{action:"receiveRpcResult",result:i});for(const{resolve:c,reject:l,payload:u}of a){if(this.destroyed){l(pt("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:u.method}));continue}const d=i.filter(m=>m.id===u.id)[0];if(d==null){const m=pt("missing response for request","BAD_DATA",{value:i,info:{payload:u}});this.emit("error",m),l(m);continue}if("error"in d){l(this.getRpcError(u,d));continue}c(d.result)}}catch(i){this.emit("debug",{action:"receiveRpcError",error:i});for(const{reject:c}of a)c(i)}})()}},n))};var sr;class Xh extends qN{constructor(n,r){super(n,r);me(this,sr);let a=this._getOption("pollingInterval");a==null&&(a=Zh.pollingInterval),I(this,sr,a)}_getSubscriber(n){const r=super._getSubscriber(n);return h0(r)&&(r.pollingInterval=y(this,sr)),r}get pollingInterval(){return y(this,sr)}set pollingInterval(n){if(!Number.isInteger(n)||n<0)throw new Error("invalid interval");I(this,sr,n),this._forEachSubscriber(r=>{h0(r)&&(r.pollingInterval=y(this,sr))})}}sr=new WeakMap;var po;class QN extends Xh{constructor(n,r,a){n==null&&(n="http://localhost:8545");super(r,a);me(this,po);typeof n=="string"?I(this,po,new Sn(n)):I(this,po,n.clone())}_getConnection(){return y(this,po).clone()}async send(n,r){return await this._start(),await super.send(n,r)}async _send(n){const r=this._getConnection();r.body=JSON.stringify(n),r.setHeader("content-type","application/json");const a=await r.send();a.assertOk();let o=a.bodyJson;return Array.isArray(o)||(o=[o]),o}}po=new WeakMap;function Xl(e){if(e==null)return null;if(typeof e.message=="string"&&e.message.match(/revert/i)&&dt(e.data))return{message:e.message,data:e.data};if(typeof e=="object"){for(const t in e){const n=Xl(e[t]);if(n)return n}return null}if(typeof e=="string")try{return Xl(JSON.parse(e))}catch{}return null}function Ll(e,t){if(e!=null){if(typeof e.message=="string"&&t.push(e.message),typeof e=="object")for(const n in e)Ll(e[n],t);if(typeof e=="string")try{return Ll(JSON.parse(e),t)}catch{}}}function WN(e){const t=[];return Ll(e,t),t}var go,xo;const yr=class yr extends Xh{constructor(n,r,a){const o=Object.assign({},a??{},{batchMaxCount:1});D(n&&n.request,"invalid EIP-1193 provider","ethereum",n);super(r,o);me(this,go);me(this,xo);I(this,xo,null),a&&a.providerInfo&&I(this,xo,a.providerInfo),I(this,go,async(i,c)=>{const l={method:i,params:c};this.emit("debug",{action:"sendEip1193Request",payload:l});try{const u=await n.request(l);return this.emit("debug",{action:"receiveEip1193Result",result:u}),u}catch(u){const d=new Error(u.message);throw d.code=u.code,d.data=u.data,d.payload=l,this.emit("debug",{action:"receiveEip1193Error",error:d}),d}})}get providerInfo(){return y(this,xo)}async send(n,r){return await this._start(),await super.send(n,r)}async _send(n){D(!Array.isArray(n),"EIP-1193 does not support batch request","payload",n);try{const r=await y(this,go).call(this,n.method,n.params||[]);return[{id:n.id,result:r}]}catch(r){return[{id:n.id,error:{code:r.code,data:r.data,message:r.message}}]}}getRpcError(n,r){switch(r=JSON.parse(JSON.stringify(r)),r.error.code||-1){case 4001:r.error.message=`ethers-user-denied: ${r.error.message}`;break;case 4200:r.error.message=`ethers-unsupported: ${r.error.message}`;break}return super.getRpcError(n,r)}async hasSigner(n){n==null&&(n=0);const r=await this.send("eth_accounts",[]);return typeof n=="number"?r.length>n:(n=n.toLowerCase(),r.filter(a=>a.toLowerCase()===n).length!==0)}async getSigner(n){if(n==null&&(n=0),!await this.hasSigner(n))try{await y(this,go).call(this,"eth_requestAccounts",[])}catch(r){const a=r.payload;throw this.getRpcError(a,{id:a.id,error:r})}return await super.getSigner(n)}static async discover(n){if(n==null&&(n={}),n.provider)return new yr(n.provider);const r=n.window?n.window:typeof window<"u"?window:null;if(r==null)return null;const a=n.anyProvider;if(a&&r.ethereum)return new yr(r.ethereum);if(!("addEventListener"in r&&"dispatchEvent"in r&&"removeEventListener"in r))return null;const o=n.timeout?n.timeout:300;return o===0?null:await new Promise((i,c)=>{let l=[];const u=f=>{l.push(f.detail),a&&d()},d=()=>{if(clearTimeout(m),l.length)if(n&&n.filter){const f=n.filter(l.map(g=>Object.assign({},g.info)));if(f==null)i(null);else if(f instanceof yr)i(f);else{let g=null;if(f.uuid&&(g=l.filter(h=>f.uuid===h.info.uuid)[0]),g){const{provider:N,info:h}=g;i(new yr(N,void 0,{providerInfo:h}))}else c(pt("filter returned unknown info","UNSUPPORTED_OPERATION",{value:f}))}}else{const{provider:f,info:g}=l[0];i(new yr(f,void 0,{providerInfo:g}))}else i(null);r.removeEventListener("eip6963:announceProvider",u)},m=setTimeout(()=>{d()},o);r.addEventListener("eip6963:announceProvider",u),r.dispatchEvent(new Event("eip6963:requestProvider"))})}};go=new WeakMap,xo=new WeakMap;let Ot=yr;function an(){const[e,t]=x.useState(!1),[n,r]=x.useState(!1),[a,o]=x.useState(null),[i,c]=x.useState(null);return x.useEffect(()=>{window.ethereum&&(t(!0),window.ethereum.request({method:"eth_accounts"}).then(d=>{r(d.length>0),o(d[0]||null)}),window.ethereum.request({method:"eth_chainId"}).then(d=>{c(parseInt(d,16))}),window.ethereum.on("accountsChanged",d=>{r(d.length>0),o(d[0]||null)}),window.ethereum.on("chainChanged",d=>{c(parseInt(d,16))}))},[]),{isDetected:e,isUnlocked:n,activeAddress:a,chainId:i,connectWallet:async()=>{if(!window.ethereum)throw new Error("MetaMask not detected");const d=await window.ethereum.request({method:"eth_requestAccounts"});return o(d[0]),r(!0),d[0]},switchChain:async d=>{if(!window.ethereum)throw new Error("MetaMask not detected");const m="0x"+d.toString(16);try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:m}]})}catch(f){throw f.code===4902?new Error(`Chain ${d} not added to MetaMask`):f}}}}function Vc({isConnected:e,account:t,supportedNetworks:n,currentNetwork:r,onConnect:a,onSwitchNetwork:o,selectedTargetNetwork:i,onTargetNetworkChange:c}){const[l,u]=x.useState(!1),d=[{id:"ethereum",name:"Ethereum",chainId:1,icon:"ðŸ”·",blockExplorer:"https://etherscan.io",nativeCurrency:"ETH"},{id:"polygon",name:"Polygon",chainId:137,icon:"ðŸŸ£",blockExplorer:"https://polygonscan.com",nativeCurrency:"MATIC"},{id:"bsc",name:"BNB Smart Chain",chainId:56,icon:"ðŸŸ¡",blockExplorer:"https://bscscan.com",nativeCurrency:"BNB"},{id:"hardhat",name:"Hardhat Local",chainId:31337,icon:"âš¡",blockExplorer:"http://localhost:8545",nativeCurrency:"ETH"},{id:"hardhat-2",name:"Hardhat Local 2",chainId:1338,icon:"âš¡",blockExplorer:"http://localhost:9545",nativeCurrency:"ETH"},{id:"arbitrum",name:"Arbitrum",chainId:42161,icon:"ðŸ”µ",blockExplorer:"https://arbiscan.io",nativeCurrency:"ETH"},{id:"optimism",name:"Optimism",chainId:10,icon:"ðŸ”´",blockExplorer:"https://optimistic.etherscan.io",nativeCurrency:"ETH"},{id:"base",name:"Base",chainId:8453,icon:"ðŸ”µ",blockExplorer:"https://basescan.org",nativeCurrency:"ETH"}].filter(N=>n.includes(N.id)),m=async()=>{u(!0);try{await a()}finally{u(!1)}},f=async N=>{c&&c(N),e&&r!==N&&await o(N)},g=d.find(N=>N.id===i);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Connect Your EVM Wallet"}),s.jsx("p",{className:"text-gray-600",children:"Connect your MetaMask or compatible wallet, then select your target network."})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Step 1: Connect Wallet"}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Connect your MetaMask or other Web3 wallet to continue."})]}),e?s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-green-800",children:"âœ… Wallet Connected"}),s.jsx("p",{className:"text-sm text-green-600 font-mono",children:t})]})]})}):s.jsx("div",{className:"flex flex-col items-center space-y-4",children:s.jsxs("div",{className:"p-6 border-2 border-dashed border-gray-300 rounded-lg text-center",children:[s.jsx("div",{className:"text-4xl mb-2",children:"ðŸ¦Š"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"No wallet connected"}),s.jsx("button",{onClick:m,disabled:l,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l?"Connecting...":"Connect Wallet"})]})})]}),e&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Step 2: Select Target Network"}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Choose the blockchain network where you want to export your NFTs."})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:d.map(N=>s.jsxs("button",{onClick:()=>f(N.id),className:be("p-4 border-2 rounded-lg text-left transition-all hover:shadow-md",i===N.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx("span",{className:"text-2xl mr-3",children:N.icon}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900",children:N.name}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Chain ID: ",N.chainId]})]})]}),s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsxs("p",{children:["Currency: ",N.nativeCurrency]}),s.jsxs("a",{href:N.blockExplorer,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 inline-flex items-center mt-1",onClick:h=>h.stopPropagation(),children:["Explorer ",s.jsx(Ds,{className:"w-3 h-3 ml-1"})]})]})]},N.id))}),i&&s.jsx("div",{className:"space-y-3",children:r===i?s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-green-800",children:"âœ… Network Connected"}),s.jsxs("p",{className:"text-sm text-green-600",children:[g==null?void 0:g.name," Network (Chain ID: ",g==null?void 0:g.chainId,")"]})]})]})}):s.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-amber-800",children:"âš ï¸ Network Switch Required"}),s.jsxs("p",{className:"text-sm text-amber-600",children:["Please switch to ",g==null?void 0:g.name," network (Chain ID: ",g==null?void 0:g.chainId,")"]}),r&&s.jsxs("p",{className:"text-xs text-amber-500",children:["Currently on: ",r]})]}),s.jsx("button",{onClick:()=>o(i),className:"px-4 py-2 text-sm bg-amber-100 text-amber-800 rounded-md hover:bg-amber-200 transition-colors",children:"Switch Network"})]})})})]})]})}function Lh({account:e,network:t,selectedNFTs:n,onSelectionChange:r,nftDiscoveryService:a,mode:o="import"}){const[i,c]=x.useState([]),[l,u]=x.useState(null),[d,m]=x.useState([]),[f,g]=x.useState(""),[N,h]=x.useState(!1),[C,w]=x.useState(!1),[B,j]=x.useState(null),{chainId:Q}=an(),{user:F}=ut(),_=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),[M,k]=x.useState(new Map),[K,V]=x.useState(new Map);x.useEffect(()=>{a&&e&&t&&(w(!0),j(null),a.getCollections(t,e).then(c).catch(v=>{console.error("Failed to load NFT collections:",v),j("Failed to load your NFT collections. You can still enter contract addresses manually.")}).finally(()=>w(!1)))},[a,e,t]),x.useEffect(()=>{l&&a&&e&&t&&(w(!0),a.getNFTsInCollection(l.contractAddress,e,t).then(m).catch(v=>{console.error("Failed to load NFTs from collection:",v),j("Failed to load NFTs from this collection.")}).finally(()=>w(!1)))},[l,a,e,t]);const T=async()=>{if(!f.trim())return;if(!/^0x[a-fA-F0-9]{40}$/.test(f.trim())){j("Please enter a valid contract address (0x...)");return}const v=f.trim();w(!0),j(null);try{let U=[];if(a&&e&&t)U=await a.getNFTsInCollection(v,e,t);else if(e&&window.ethereum)U=await pe(v,e,Q||1);else throw new Error("No wallet connected or NFT discovery service available");m(U),u({contractAddress:v,name:`Contract ${v.slice(0,6)}...${v.slice(-4)}`,symbol:"UNKNOWN"}),h(!1),g("")}catch(U){console.error("Failed to load NFTs from manual contract:",U),j(`Failed to load NFTs from this contract: ${U instanceof Error?U.message:"Unknown error"}`)}finally{w(!1)}},ee=async(v,U)=>{if(!window.ethereum||!e){j("Wallet not connected");return}w(!0),console.log(`ðŸ” Manual recovery: checking token ${U} in contract ${v}`);try{const S=new Ot(window.ethereum),H=["function name() view returns (string)","function ownerOf(uint256 tokenId) view returns (address)","function tokenURI(uint256 tokenId) view returns (string)"],he=new Tn(v,H,S),$=await he.name().catch(()=>"Unknown Collection"),W=await he.ownerOf(U);if(console.log(`ðŸ” Token ${U} current owner: ${W}`),W.toLowerCase()===e.toLowerCase()){console.log(`âœ… Token ${U} is owned by user - already should be found`),j(`Token ${U} is owned by you and should already appear in the list`);return}const le=await O(he,v,$,U,W,"ready-to-mint",void 0,Q??1);le?d.some(L=>L.contractAddress===le.contractAddress&&L.tokenId===le.tokenId)?j(`Token ${U} is already in the list`):(m(L=>[...L,le]),console.log(`âœ… Added recovered token ${U} to available NFTs`),l||u({contractAddress:v,name:$||`Contract ${v.slice(0,6)}...${v.slice(-4)}`,symbol:"UNKNOWN"})):j(`Could not retrieve metadata for token ${U}`)}catch(S){console.error("Manual recovery failed:",S),S instanceof Error&&S.message.includes("owner query for nonexistent token")?j(`Token ${U} does not exist in this contract`):j(`Failed to recover token ${U}: ${S instanceof Error?S.message:"Unknown error"}`)}finally{w(!1)}},J=async(v,U,S)=>{try{const H=`${v}-${S}`,he=`${H}-${U}`,$=M.get(he);if($!==void 0)return $==="not-minted"?null:$;let W=M.get(H);if(W){if(W==="none")return null}else{console.log(`ðŸ” Looking up ICRC-7 canister for contract ${v} on network ${S}...`);const le={Ethereum:[BigInt(S)]},ce={contract:v,network:le};try{const ue=(await _.getCkNFTCanister.mutateAsync([ce]))[0];if(W=ue?ue.toString():void 0,W)k(re=>new Map(re).set(H,W)),console.log(`âœ… Cached ICRC-7 canister ID: ${W} for contract ${v}`);else return console.log(`âŒ No ICRC-7 canister found for contract ${v}`),k(re=>new Map(re).set(H,"none")),null}catch(L){return console.warn(`Failed to get ICRC-7 canister for contract ${v}:`,L),null}}if(!W||W==="none")return null;console.log(`ðŸ” Checking ICRC-7 ownership for token ${U} in canister ${W}`);try{const{Actor:le,HttpAgent:ce}=await Xe(async()=>{const{Actor:ne,HttpAgent:ye}=await Promise.resolve().then(()=>Bt);return{Actor:ne,HttpAgent:ye}},void 0),{Principal:L}=await Xe(async()=>{const{Principal:ne}=await import("./index-CstboGu2.js").then(ye=>ye.b3);return{Principal:ne}},__vite__mapDeps([1,2])),ue=new ce({host:"https://icp0.io"}),re=({IDL:ne})=>{const ye=ne.Record({owner:ne.Principal,subaccount:ne.Opt(ne.Vec(ne.Nat8))});return ne.Service({icrc7_owner_of:ne.Func([ne.Vec(ne.Nat)],[ne.Vec(ne.Opt(ye))],["query"])})},se=le.createActor(re,{agent:ue,canisterId:L.fromText(W)}),Ne=BigInt(U),ge=await se.icrc7_owner_of([Ne]);if(ge&&ge.length>0&&ge[0]&&ge[0].length>0){const ye=ge[0][0].owner.toString();return console.log(`âœ… Token ${U} is minted on ICRC-7, owned by ${ye}`),k(G=>new Map(G).set(he,ye)),ye}else return console.log(`ðŸ“‹ Token ${U} not minted on ICRC-7 yet`),k(ne=>new Map(ne).set(he,"not-minted")),null}catch(le){console.warn(`Failed to check ICRC-7 ownership for token ${U}:`,le);const ce=String(le).toLowerCase();return(ce.includes("not found")||ce.includes("does not exist")||ce.includes("unknown"))&&k(L=>new Map(L).set(he,"not-minted")),null}}catch(H){return console.error("Error checking ICRC-7 ownership:",H),null}},pe=async(v,U,S)=>{if(!window.ethereum)throw new Error("MetaMask not available");const H=new Ot(window.ethereum),he=["function name() view returns (string)","function symbol() view returns (string)","function ownerOf(uint256 tokenId) view returns (address)","function tokenURI(uint256 tokenId) view returns (string)","function balanceOf(address owner) view returns (uint256)","function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)","function totalSupply() view returns (uint256)","event Transfer(address indexed from, address indexed to, uint256 indexed tokenId)"],$=new Tn(v,he,H);try{const W=[];console.log(`ðŸ” Verifying contract interface for: ${v}`);let le;try{le=await $.name(),console.log(`âœ… Contract name: ${le}`)}catch{console.warn("âŒ Contract does not support name() function, using fallback"),le="Unknown Collection"}try{await $.balanceOf(U)}catch(ce){throw console.error("âŒ Contract does not support balanceOf - not a valid ERC-721:",ce),new Error("Contract does not appear to be a valid ERC-721 NFT contract")}console.log(`ðŸ” Starting comprehensive NFT scan for contract: ${v}`),console.log(`ðŸ” User address: ${U}`),console.log("ðŸ” Step 1: Finding owned NFTs...");try{const ce=await b($,U,v,le,S);console.log(`âœ… Found ${ce.length} owned NFTs`),W.push(...ce)}catch(ce){console.error("âŒ Error finding owned NFTs:",ce)}console.log("ðŸ” Step 2: Finding bridged NFTs...");try{const ce=await Y($,U,v,le,S);console.log(`âœ… Found ${ce.length} bridged NFTs`),W.push(...ce)}catch(ce){console.error("âŒ Error finding bridged NFTs:",ce)}console.log("ðŸ” Step 3: Finding recently transferred NFTs (fallback)...");try{const ce=await E($,U,v,le,S);console.log(`âœ… Found ${ce.length} recently transferred NFTs`);for(const L of ce)W.some(re=>re.contractAddress===L.contractAddress&&re.tokenId===L.tokenId)||W.push(L)}catch(ce){console.error("âŒ Error finding recently transferred NFTs:",ce)}return console.log(`ðŸŽ¯ Total NFTs found: ${W.length}`),W}catch(W){throw console.error("Contract interaction error:",W),new Error("Failed to interact with contract. Please verify it's a valid ERC-721 contract.")}},E=async(v,U,S,H,he)=>{var le,ce,L;const $=(le=v.runner)==null?void 0:le.provider;if(!$)return[];const W=[];try{const ue=await $.getBlockNumber(),re=Math.max(0,ue-1e5);console.log(`ðŸ” Fallback scan: blocks ${re} to ${ue}`);const se=v.filters.Transfer(U,null,null),Ne=await v.queryFilter(se,re,"latest");console.log(`ðŸ” Found ${Ne.length} total transfers from user`);const ge=new Map;for(const ne of Ne)if("args"in ne&&ne.args){const ye=(ce=ne.args.tokenId)==null?void 0:ce.toString(),G=(L=ne.args.to)==null?void 0:L.toString().toLowerCase(),P=ne.blockNumber;if(ye&&G){const z=ge.get(ye);(!z||P>z.blockNumber)&&ge.set(ye,{tokenId:ye,toAddress:G,blockNumber:P,txHash:ne.transactionHash})}}console.log(`ðŸ” Processing ${ge.size} unique tokens transferred from user`);for(const[ne,ye]of ge)try{const G=await v.ownerOf(ne),P=G.toLowerCase();if(P!==U.toLowerCase()){console.log(`ðŸ” Token ${ne}: transferred to ${ye.toAddress}, now owned by ${G}`);const z=await J(S,ne,he);let A="bridged",Z;z?(A="already-minted",Z=ne,console.log(`ðŸŽ¯ Token ${ne} has already been minted on ICRC-7, owned by ${z} - skipping bridge checks`)):(console.log(`ðŸ“‹ Token ${ne} not minted on ICRC-7 yet, checking bridge status...`),P===ye.toAddress&&(A="ready-to-mint",console.log(`âœ… Token ${ne} appears to be ready for minting`)));const de=await R(v,S,H,ne,G,A,ye.txHash,Z);de&&W.push(de)}}catch(G){console.log(`âŒ Token ${ne} no longer exists or error checking owner:`,G)}}catch(ue){console.error("âŒ Error in fallback scan:",ue)}return W},b=async(v,U,S,H,he)=>{var $,W,le;try{console.log(`ðŸ” Checking balance for user ${U}...`);const ce=await v.balanceOf(U),L=Number(ce);if(console.log(`ðŸ” User balance: ${L} NFTs`),L===0)return[];let ue=[];try{console.log(`ðŸ” Attempting to use ERC-721 Enumerable for ${L} tokens...`);for(let se=0;se<L;se++)try{const Ne=await v.tokenOfOwnerByIndex(U,se);ue.push(Ne.toString())}catch(Ne){throw console.log(`âŒ Failed on token index ${se}, falling back to event scanning...`),ue=[],Ne}console.log(`âœ… Successfully retrieved ${ue.length} tokens via Enumerable`)}catch{console.log("Contract does not support ERC-721 Enumerable, falling back to event scanning..."),ue=[];const Ne=($=v.runner)==null?void 0:$.provider;if(!Ne)throw new Error("No provider available");try{const ge=await Ne.getBlockNumber(),ne=Math.max(0,ge-5e3);console.log(`ðŸ” Event scanning from block ${ne} to ${ge}`);const ye=v.filters.Transfer(null,U,null),G=await v.queryFilter(ye,ne,"latest"),P=v.filters.Transfer(U,null,null),z=await v.queryFilter(P,ne,"latest");console.log(`ðŸ” Found ${G.length} transfers TO user, ${z.length} transfers FROM user`);const A=new Set,Z=new Set;for(const te of G)if("args"in te&&te.args){const fe=(W=te.args.tokenId)==null?void 0:W.toString();fe&&A.add(fe)}for(const te of z)if("args"in te&&te.args){const fe=(le=te.args.tokenId)==null?void 0:le.toString();fe&&Z.add(fe)}const de=Array.from(A).filter(te=>!Z.has(te));console.log(`ðŸ” Potential owned tokens from events: ${de.length}`);for(const te of de)try{(await v.ownerOf(te)).toLowerCase()===U.toLowerCase()&&ue.push(te)}catch{console.log(`Token ${te} does not exist or is burned`)}}catch(ge){throw console.error("âŒ Event scanning also failed:",ge),new Error(`Unable to determine NFT ownership: ${ge instanceof Error?ge.message:"Unknown error"}`)}}const re=[];for(const se of ue){const Ne=await O(v,S,H,se,U,"owned",void 0,he);Ne&&re.push(Ne)}return re}catch(ce){return console.error("âŒ Error finding user owned NFTs:",ce),[]}},Y=async(v,U,S,H,he)=>{var le,ce,L;const $=(le=v.runner)==null?void 0:le.provider;if(!$)return[];const W=[];try{const ue=await $.getBlockNumber(),re=Math.max(0,ue-5e4);console.log(`ðŸ” Scanning blocks ${re} to ${ue} for transfers from ${U}`);const se=v.filters.Transfer(U,null,null),Ne=await v.queryFilter(se,re,"latest");if(console.log(`ðŸ” Found ${Ne.length} transfers from user address`),Ne.length===0)return console.log("âš ï¸ No transfers from user found - skipping bridge address lookup"),[];for(const ge of Ne)if("args"in ge&&ge.args){const ne=(ce=ge.args.tokenId)==null?void 0:ce.toString(),ye=(L=ge.args.to)==null?void 0:L.toString().toLowerCase(),G=ge.transactionHash;if(console.log(`ðŸ” Transfer event: token ${ne} to ${ye}, tx: ${G}`),ne&&ye){console.log(`ðŸ” Checking ICRC-7 ownership for token ${ne} before bridge checks...`);const P=await J(S,ne,he);if(P){console.log(`ðŸŽ¯ Token ${ne} already minted on ICRC-7, owned by ${P} - adding as already-minted`);try{const A=await v.ownerOf(ne),Z=await R(v,S,H,ne,A,"already-minted",G,ne);Z&&W.push(Z)}catch(A){console.log(`âŒ Token ${ne} no longer exists:`,A)}continue}if(console.log(`ðŸ“‹ Token ${ne} not minted on ICRC-7, checking if ${ye} is a bridge address...`),(await p(S)).includes(ye)){console.log(`âœ… Found transfer to bridge address: token ${ne}`);try{const A=await v.ownerOf(ne);if(console.log(`ðŸ” Current owner of token ${ne}: ${A}`),A.toLowerCase()===ye){console.log(`ðŸŽ¯ Token ${ne} is ready to mint!`);const Z=await R(v,S,H,ne,A,"ready-to-mint",G);Z&&W.push(Z)}else console.log(`âŒ Token ${ne} no longer owned by bridge (owner: ${A})`)}catch(A){console.log(`âŒ Token ${ne} no longer exists:`,A)}}else console.log(`âšª Transfer to non-bridge address: ${ye}`)}}}catch(ue){console.error("Error scanning for bridged NFTs:",ue)}return W},p=async v=>{const U=K.get(v);if(U)return console.log("âœ… Using cached bridge addresses for contract:",v),U;const S=[];if(console.log("ðŸ” Getting bridge approval addresses for contract:",v),!_.getApprovalAddress||!(F!=null&&F.principal))return console.log("âš ï¸ No approval address mutation or user principal available"),V(H=>new Map(H).set(v,S)),S;try{const he={Ethereum:[BigInt(Q??1)]},$={remoteNFTPointer:{tokenId:BigInt(0),contract:v,network:he},account:{owner:F.principal,subaccount:[]}};console.log("ðŸ” Requesting approval address with:",$);const W=await _.getApprovalAddress.mutateAsync({request:$,spender:{owner:F.principal,subaccount:[]}});return W?(S.push(W.toLowerCase()),console.log("âœ… Found approval address:",W)):console.log("âŒ No approval address returned"),V(le=>new Map(le).set(v,S)),console.log("ðŸ” Final bridge addresses list:",S),S}catch(H){return console.error("âŒ Failed to get bridge approval addresses:",H),V(he=>new Map(he).set(v,S)),S}},O=async(v,U,S,H,he,$,W,le)=>{try{if($==="owned"||$==="bridged"){const L=await J(U,H,le??Q??1);let ue,re;return L?(ue="already-minted",re=H,console.log(`âœ… Token ${H} already minted on ICRC-7, owned by: ${L}`)):ue=$,await R(v,U,S,H,he,ue,W,re)}else return await R(v,U,S,H,he,$,W)}catch(ce){return console.error(`Error in ownership check for token ${H}:`,ce),await R(v,U,S,H,he,$,W)}},R=async(v,U,S,H,he,$,W,le)=>{try{let ce=`${S} #${H}`,L,ue;try{const re=await v.tokenURI(H);if(re)if(re.includes("example.com")||re.includes("placeholder")||re.includes("localhost")&&!re.includes(window.location.host))console.log(`Skipping placeholder URL for token ${H}: ${re}`),ce=`Mock NFT #${H}`,ue=`This is a mock NFT with token ID ${H} from contract ${U}`,L=`https://picsum.photos/400/400?random=${H}`;else{let Ne=re;re.startsWith("ipfs://")&&(Ne=`https://ipfs.io/ipfs/${re.slice(7)}`);const ge=new AbortController,ne=setTimeout(()=>ge.abort(),5e3);try{const ye=await fetch(Ne,{signal:ge.signal,headers:{Accept:"application/json"}});if(clearTimeout(ne),ye.ok){const G=await ye.json();ce=G.name||ce,ue=G.description,G.image&&(L=G.image,L&&L.startsWith("ipfs://")&&(L=`https://ipfs.io/ipfs/${L.slice(7)}`))}}catch(ye){clearTimeout(ne),console.log(`Failed to fetch metadata for token ${H}:`,ye)}}}catch(re){console.log(`Failed to get tokenURI for token ${H}:`,re)}return{contractAddress:U,tokenId:H,name:ce,image:L,description:ue,ownershipStatus:$,currentOwner:he.toLowerCase(),bridgeTransferHash:W,icrcTokenId:le}}catch(ce){return console.log(`Error processing token ${H}:`,ce),null}},q=v=>{if(o==="import"&&v.ownershipStatus==="already-minted"||o==="burn"&&v.ownershipStatus!=="already-minted")return;const U=n.some(S=>S.contractAddress===v.contractAddress&&S.tokenId===v.tokenId);r(U?n.filter(S=>!(S.contractAddress===v.contractAddress&&S.tokenId===v.tokenId)):[...n,v])};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select NFTs to Import"}),s.jsx("p",{className:"text-gray-600",children:"Choose which NFTs you'd like to bridge to the Internet Computer."}),s.jsxs("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm",children:[s.jsxs("p",{className:"text-blue-800",children:[s.jsx("strong",{children:"ðŸ’¡ Smart Recovery:"})," This scanner will find both NFTs you own and NFTs you previously transferred to the bridge that failed to mint due to insufficient cycles. Ready-to-mint NFTs can be processed faster since they skip the transfer step!"]}),s.jsxs("details",{className:"mt-2 group",children:[s.jsx("summary",{className:"cursor-pointer text-blue-700 hover:text-blue-800 text-xs",children:"ðŸ” Debug: What we're looking for..."}),s.jsxs("div",{className:"mt-2 text-xs text-blue-600 space-y-1",children:[s.jsxs("p",{children:["â€¢ ",s.jsx("strong",{children:"Owned NFTs:"})," Currently in your wallet"]}),s.jsxs("p",{children:["â€¢ ",s.jsx("strong",{children:"Bridge NFTs:"})," Transferred to known bridge addresses"]}),s.jsxs("p",{children:["â€¢ ",s.jsx("strong",{children:"Stranded NFTs:"})," Transferred but not in expected bridge addresses"]}),s.jsxs("p",{children:["â€¢ ",s.jsx("strong",{children:"Scan Range:"})," Last 50,000-100,000 blocks (adjust if needed)"]})]})]})]})]}),B&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800",children:B})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"1. Select NFT Collection"}),s.jsx("button",{onClick:()=>h(!N),className:"text-sm text-blue-600 hover:text-blue-700",children:N?"Browse Collections":"Enter Contract Manually"})]}),N?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-3",children:[s.jsx("input",{type:"text",value:f,onChange:v=>g(v.target.value),placeholder:"Enter contract address (0x...)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("button",{onClick:T,disabled:!f.trim()||C,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Load NFTs"})]}),s.jsx("p",{className:"text-xs text-gray-500",children:"Enter the contract address of an NFT collection to see your NFTs"}),s.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-md",children:s.jsxs("details",{className:"group",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-medium text-amber-800 mb-2",children:"ðŸ” Advanced: Recover Specific Token ID"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-xs text-amber-700",children:"If you know a specific token ID that you transferred but don't see in the list, you can manually check it here:"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",placeholder:"Token ID (e.g., 1234)",className:"flex-1 px-2 py-1 text-sm border border-amber-300 rounded focus:outline-none focus:ring-1 focus:ring-amber-500",onKeyPress:async v=>{if(v.key==="Enter"&&f.trim()){const U=v.target.value.trim();U&&(console.log(`ðŸ” Manual recovery check for token ${U} in contract ${f}`),await ee(f,U))}}}),s.jsx("button",{onClick:()=>{const v=document.querySelector('input[placeholder="Token ID (e.g., 1234)"]'),U=v==null?void 0:v.value.trim();U&&f.trim()&&ee(f,U)},className:"px-2 py-1 text-xs bg-amber-600 text-white rounded hover:bg-amber-700",children:"Check"})]})]})]})})]}):s.jsx("div",{children:C&&i.length===0?s.jsxs("div",{className:"p-6 text-center",children:[s.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-blue-600 border-t-transparent rounded-full mx-auto mb-2"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Loading your NFT collections..."})]}):i.length>0?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:i.map(v=>s.jsx("button",{onClick:()=>u(v),className:be("p-4 border rounded-lg text-left transition-colors",(l==null?void 0:l.contractAddress)===v.contractAddress?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:s.jsxs("div",{className:"flex items-start space-x-3",children:[v.imageUrl&&s.jsx("img",{src:v.imageUrl,alt:v.name,className:"w-12 h-12 rounded-lg object-cover"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-gray-900 truncate",children:v.name}),s.jsxs("p",{className:"text-sm text-gray-600 truncate",children:[v.contractAddress.slice(0,6),"...",v.contractAddress.slice(-4)]}),v.totalSupply&&s.jsxs("p",{className:"text-xs text-gray-500",children:["Supply: ",v.totalSupply]})]}),v.verified&&s.jsx("div",{className:"text-blue-500",children:"âœ“"})]})},v.contractAddress))}):!C&&a?s.jsxs("div",{className:"p-6 text-center border-2 border-dashed border-gray-300 rounded-lg",children:[s.jsx("p",{className:"text-gray-500",children:"No NFT collections found for this account"}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try entering a contract address manually"})]}):s.jsxs("div",{className:"p-6 text-center border-2 border-dashed border-gray-300 rounded-lg",children:[s.jsx("p",{className:"text-gray-500",children:"NFT discovery service not configured"}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Enter contract addresses manually to continue"})]})})]}),l&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"font-medium text-gray-900",children:["2. Select NFTs from ",l.name]}),C&&d.length===0?s.jsxs("div",{className:"p-6 text-center",children:[s.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-blue-600 border-t-transparent rounded-full mx-auto mb-2"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Loading NFTs from collection..."})]}):d.length>0?s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:d.map(v=>{const U=n.some($=>$.contractAddress===v.contractAddress&&$.tokenId===v.tokenId),H=(()=>{switch(v.ownershipStatus){case"ready-to-mint":return{border:"border-amber-500 bg-amber-50",ring:U?"ring-2 ring-amber-200":"",badge:"bg-amber-100 text-amber-800"};case"bridged":return{border:"border-purple-500 bg-purple-50",ring:U?"ring-2 ring-purple-200":"",badge:"bg-purple-100 text-purple-800"};case"already-minted":return{border:"border-green-500 bg-green-50 opacity-60",ring:"",badge:"bg-green-100 text-green-800"};case"owned":default:return{border:U?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300",ring:U?"ring-2 ring-blue-200":"",badge:"bg-green-100 text-green-800"}}})(),he=o==="import"?v.ownershipStatus!=="already-minted":v.ownershipStatus==="already-minted";return s.jsx("div",{className:"relative",children:s.jsxs("button",{onClick:()=>q(v),disabled:!he,className:be("w-full p-3 border rounded-lg text-left transition-all",H.border,H.ring,he?"cursor-pointer":"cursor-not-allowed"),children:[s.jsx("div",{className:"absolute top-2 right-2 z-10",children:s.jsxs("span",{className:be("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",H.badge),children:[v.ownershipStatus==="ready-to-mint"&&"â³ Ready to Mint",v.ownershipStatus==="bridged"&&"ðŸŒ‰ Bridged",v.ownershipStatus==="already-minted"&&"âœ… Already Minted",(v.ownershipStatus==="owned"||!v.ownershipStatus)&&"âœ“ Owned"]})}),v.image&&s.jsx("img",{src:v.image,alt:v.name,className:"w-full h-32 object-cover rounded-md mb-2"}),s.jsx("p",{className:"font-medium text-sm truncate pr-16",children:v.name}),s.jsxs("p",{className:"text-xs text-gray-600",children:["#",v.tokenId]}),v.ownershipStatus==="ready-to-mint"&&s.jsxs("div",{className:"mt-2 p-2 bg-amber-100 rounded text-xs",children:[s.jsx("p",{className:"font-medium text-amber-800",children:"Ready to mint!"}),s.jsx("p",{className:"text-amber-700",children:"This NFT was transferred to the bridge and is ready to be minted on IC without additional transfer fees."}),v.bridgeTransferHash&&s.jsxs("p",{className:"text-amber-600 mt-1 truncate",children:["Transfer: ",v.bridgeTransferHash.slice(0,10),"..."]})]}),v.ownershipStatus==="bridged"&&s.jsxs("div",{className:"mt-2 p-2 bg-purple-100 rounded text-xs",children:[s.jsx("p",{className:"font-medium text-purple-800",children:"In bridge"}),s.jsx("p",{className:"text-purple-700",children:"This NFT is currently held by the bridge."}),v.currentOwner&&s.jsxs("p",{className:"text-purple-600 mt-1 truncate",children:["Owner: ",v.currentOwner.slice(0,10),"..."]})]}),v.ownershipStatus==="already-minted"&&s.jsxs("div",{className:"mt-2 p-2 bg-green-100 rounded text-xs",children:[s.jsx("p",{className:"font-medium text-green-800",children:"Already minted on IC!"}),s.jsx("p",{className:"text-green-700",children:"This NFT has already been successfully minted on the Internet Computer."}),v.icrcTokenId&&s.jsxs("p",{className:"text-green-600 mt-1",children:["ICRC-7 Token ID: ",v.icrcTokenId]})]}),U&&s.jsx("div",{className:"mt-2 text-xs font-medium text-blue-600",children:"âœ“ Selected for bridge"})]})},`${v.contractAddress}-${v.tokenId}`)})}):s.jsxs("div",{className:"p-6 text-center border-2 border-dashed border-gray-300 rounded-lg",children:[s.jsx("p",{className:"text-gray-500",children:"No NFTs found in this collection"}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"You don't own any NFTs from this contract"})]})]}),n.length>0&&s.jsxs("div",{className:"space-y-3 p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("h4",{className:"font-medium text-green-900",children:["Selected NFTs (",n.length,")"]}),s.jsx("div",{className:"space-y-2",children:n.map(v=>{const S=(()=>{switch(v.ownershipStatus){case"ready-to-mint":return{badge:"bg-amber-100 text-amber-800",text:"â³ Ready to mint - will skip transfer steps",description:"This NFT is already in the bridge and can be minted directly on IC."};case"bridged":return{badge:"bg-purple-100 text-purple-800",text:"ðŸŒ‰ In bridge - pending mint approval",description:"This NFT is held by the bridge but may need additional approvals."};case"owned":default:return{badge:"bg-blue-100 text-blue-800",text:"ðŸ”„ Will transfer then mint",description:"This NFT will be transferred to the bridge then minted on IC."}}})();return s.jsx("div",{className:"p-2 bg-white rounded-md border",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-sm",children:v.name}),s.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:["Token ID: ",v.tokenId]}),s.jsx("div",{className:"flex items-center space-x-2 mb-1",children:s.jsx("span",{className:be("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",S.badge),children:S.text})}),s.jsx("p",{className:"text-xs text-gray-500",children:S.description}),v.bridgeTransferHash&&s.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Previous transfer: ",v.bridgeTransferHash.slice(0,16),"..."]})]}),s.jsx("button",{onClick:()=>q(v),className:"text-red-600 hover:text-red-700 text-sm ml-2",children:"Remove"})]})},`${v.contractAddress}-${v.tokenId}`)})}),s.jsxs("div",{className:"pt-3 border-t border-green-200",children:[s.jsx("h5",{className:"text-sm font-medium text-green-900 mb-2",children:"Bridge Process Summary:"}),s.jsxs("div",{className:"text-xs text-green-800 space-y-1",children:[n.filter(v=>v.ownershipStatus==="ready-to-mint").length>0&&s.jsxs("p",{children:["â€¢ ",n.filter(v=>v.ownershipStatus==="ready-to-mint").length," NFT(s) ready to mint directly (faster process)"]}),n.filter(v=>!v.ownershipStatus||v.ownershipStatus==="owned").length>0&&s.jsxs("p",{children:["â€¢ ",n.filter(v=>!v.ownershipStatus||v.ownershipStatus==="owned").length," NFT(s) will be transferred then minted"]}),n.filter(v=>v.ownershipStatus==="bridged").length>0&&s.jsxs("p",{children:["â€¢ ",n.filter(v=>v.ownershipStatus==="bridged").length," NFT(s) may need additional approvals"]}),d.filter(v=>v.ownershipStatus==="already-minted").length>0&&s.jsxs("p",{className:"text-green-600",children:["â„¹ï¸ Found ",d.filter(v=>v.ownershipStatus==="already-minted").length," NFT(s) already minted on IC (not selectable)"]})]})]})]}),!a&&!l&&s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("p",{className:"text-sm text-blue-800 mb-2",children:s.jsx("strong",{children:"Direct Blockchain Scanning Enabled"})}),s.jsx("p",{className:"text-xs text-blue-700 mb-3",children:"No NFT discovery service configured, but you can still enter contract addresses manually. The app will scan the blockchain directly using your wallet to find your NFTs."}),s.jsx("button",{onClick:()=>r([{contractAddress:"0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D",tokenId:"1234",name:"Demo Bored Ape #1234",image:"https://ipfs.io/ipfs/QmRRPWG96cmgTn2qSzjwr2qvfNEuhunv6FNeMFGa9bx6mQ"}]),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Select Demo NFT (for testing)"})]})]})}var JN={};function KN({selectedNFTs:e,costs:t,onCostsCalculated:n,compact:r=!1}){var he;const{chainId:a}=an(),{user:o}=ut(),i=JN.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",c=js(i),{useBalance:l,useApprove:u}=c,d=l(o!=null&&o.principal?{owner:o.principal,subaccount:[]}:void 0),m=u(),f=d.data,g=d.isLoading,N=d.error,h=m.isPending,C=m.error,w=$=>{const le=BigInt(1e12),ce=$/le,ue=($%le).toString().padStart(12,"0").slice(0,3);return`${ce.toLocaleString()}.${ue} TC`},B=$=>f?f>=$:!1,j=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),Q=x.useMemo(()=>{if(e.length===0)return null;const W={Ethereum:[BigInt(a??1)]};return{contract:e[0].contractAddress,network:W}},[e.length>0?(he=e[0])==null?void 0:he.contractAddress:null,a??1]),{data:F,isLoading:_,error:M}=Y0(Q,e.length>0),{data:k,isLoading:K,error:V}=Z0(Q,e.length>0),{data:T,isLoading:ee}=oa(F||void 0);x.useEffect(()=>{F&&t===null&&n(F)},[F,t,n]);const J=t||F,pe=_||K||e.length>0&&!J,E=M||N||V,b=Array.isArray(k)?k.length>0:k!=null,Y=x.useMemo(()=>{if(!k)return null;if(Array.isArray(k)){if(k.length===0)return null;const $=k[0];return $&&typeof $=="object"&&"toString"in $?$.toString():String($)}return typeof k=="object"&&"toString"in k?k.toString():String(k)},[k]),{data:p,isLoading:O,error:R}=X0(Y,b&&!!Y),q=()=>{if(!k)return"N/A";try{if(Array.isArray(k)){if(k.length===0)return"No canister found";const $=k[0];return $&&typeof $=="object"&&"toString"in $?$.toString():String($)}return k&&typeof k=="object"&&"toString"in k?k.toString():typeof k=="string"?k:String(k)}catch($){return console.error("Error converting canister ID to string:",$,k),"Error displaying ID"}},v=x.useCallback(async()=>{if(!Q||!J){console.error("CanisterCostStep: Missing required data for canister creation");return}try{const $=(T==null?void 0:T.isSufficient)&&!(T!=null&&T.isExpired);console.log($?"CanisterCostStep: Sufficient allowance exists, skipping auto-approval":"CanisterCostStep: Will auto-approve cycles during creation");const W=await j.createCanister.mutateAsync({pointer:Q,defaults:{name:`ckNFT for ${Q.contract}`,symbol:"ckNFT",description:`Cross-chain NFT canister for ${Q.contract}`},spender:o!=null&&o.principal?{owner:o.principal,subaccount:[]}:void 0,requiredCycles:J,skipApproval:$});console.log("CanisterCostStep: Canister creation result",W),"Ok"in W?console.log("CanisterCostStep: Canister created successfully",W.Ok.toString()):console.error("CanisterCostStep: Unexpected result format",W)}catch($){console.error("CanisterCostStep: Error creating canister",$)}},[Q,J,T,j.createCanister,o==null?void 0:o.principal]),U=!pe&&J&&f!==void 0&&B(J)&&!b&&!j.createCanister.isPending,S=$=>w($),H=$=>(Number($)/1e12).toFixed(6);return r?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Canister Status"}),s.jsx("p",{className:"text-gray-600",children:"Current status of your NFT canister on the Internet Computer."})]}),E&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-800",children:["Error: ",(()=>{try{return M instanceof Error?M.message:N instanceof Error?N.message:V instanceof Error?V.message:M?String(M):N?String(N):V?String(V):"Unknown error occurred"}catch($){return console.error("Error formatting error message:",$,{costError:M,balanceError:N,existingError:V}),"Error formatting error message"}})()]})}),j.createCanister.error&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-800",children:["Canister creation failed: ",j.createCanister.error instanceof Error?j.createCanister.error.message:String(j.createCanister.error)]})}),pe?s.jsxs("div",{className:"text-center py-6",children:[s.jsx("div",{className:"animate-spin w-6 h-6 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-2"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Loading canister information..."})]}):b?s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-5 h-5 text-green-500 mr-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-green-800",children:"âœ… ckNFT Canister Ready"}),s.jsx("p",{className:"text-xs text-green-600 font-mono mt-1",children:q()})]})]})}):J?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"Canister Creation"}),s.jsxs("div",{className:"text-right",children:[s.jsx("span",{className:"text-sm font-medium",children:S(J)}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",H(J)," ICP"]})]})]}),s.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"Your Balance"}),s.jsx("div",{className:"text-right",children:g?s.jsx("span",{className:"text-sm text-gray-500",children:"Loading..."}):f!==void 0?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:be("text-sm font-medium",B(J)?"text-green-600":"text-red-600"),children:S(f)}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",H(f)," ICP"]})]}):s.jsx("span",{className:"text-sm text-red-600",children:"Unable to load"})})]})]}),U&&s.jsx("button",{onClick:v,disabled:!U||j.createCanister.isPending,className:be("w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors",U&&!j.createCanister.isPending?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:j.createCanister.isPending?s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Creating..."]}):`Create Canister (${S(J)})`})]}):s.jsx("div",{className:"p-4 text-center border-2 border-dashed border-gray-300 rounded-lg",children:s.jsx("p",{className:"text-sm text-gray-500",children:"Select NFTs to see canister costs"})})]}):(console.log("collectionMetadata",p),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Canister Costs"}),s.jsx("p",{className:"text-gray-600",children:"Review the costs for creating your NFT canisters on the Internet Computer."})]}),E&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-800",children:["Error loading information: ",(()=>{try{return M instanceof Error?M.message:N instanceof Error?N.message:V instanceof Error?V.message:M?String(M):N?String(N):V?String(V):"Unknown error occurred"}catch($){return console.error("Error formatting error message:",$,{costError:M,balanceError:N,existingError:V}),"Error formatting error message"}})()]})}),j.createCanister.error&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-800",children:["Canister creation failed: ",j.createCanister.error instanceof Error?j.createCanister.error.message:String(j.createCanister.error)]})}),j.createCanister.isSuccess&&!b&&s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-green-800",children:"âœ… Canister created successfully! Refreshing canister information..."})}),pe?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading canister information and your balance..."})]}):b?s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("svg",{className:"w-5 h-5 text-green-500 mt-0.5 mr-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"ckNFT Canister Already Exists"}),s.jsx("p",{className:"text-sm text-green-700 mb-2",children:"A canister for this contract already exists on the Internet Computer."}),s.jsxs("p",{className:"text-xs text-green-600 font-mono mb-3",children:["Canister ID: ",q()]}),O?s.jsx("div",{className:"mt-2 p-2 bg-green-100 rounded text-xs",children:s.jsx("div",{className:"animate-pulse text-green-700",children:"Loading collection metadata..."})}):R?s.jsx("div",{className:"mt-2 p-2 bg-yellow-100 border border-yellow-200 rounded text-xs",children:s.jsx("div",{className:"text-yellow-700",children:"Unable to load collection metadata"})}):p?s.jsxs("div",{className:"mt-2 p-3 bg-green-100 border border-green-200 rounded text-sm",children:[p.name||p.symbol||p.description||p.totalSupply!==null||p.supplyCap!==null||p.royalties?s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[p.name&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-800",children:"Name:"}),s.jsx("span",{className:"ml-1 text-green-700",children:p.name})]}),p.symbol&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-800",children:"Symbol:"}),s.jsx("span",{className:"ml-1 text-green-700",children:p.symbol})]}),p.description&&s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("span",{className:"font-medium text-green-800",children:"Description:"}),s.jsx("p",{className:"ml-1 text-green-700 text-xs mt-1",children:p.description})]}),p.totalSupply!==null&&p.totalSupply!==void 0&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-800",children:"Total Supply:"}),s.jsx("span",{className:"ml-1 text-green-700",children:String(p.totalSupply)})]}),p.supplyCap!==null&&p.supplyCap!==void 0&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-800",children:"Supply Cap:"}),s.jsx("span",{className:"ml-1 text-green-700",children:String(p.supplyCap)})]}),p.royalties&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-800",children:"Royalties:"}),s.jsxs("span",{className:"ml-1 text-green-700",children:[(Number(p.royalties)/100).toFixed(2),"%"]})]})]}):s.jsxs("div",{className:"text-sm text-amber-700 mb-2",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{className:"font-medium",children:"Canister Metadata Not Yet Initialized"})]}),s.jsx("p",{className:"text-xs text-amber-600 mt-1 ml-6",children:"This canister exists but its collection metadata hasn't been set up yet. The metadata will be populated during the first NFT bridging operation."})]}),p.raw&&s.jsxs("details",{className:"mt-3 p-2 bg-gray-100 rounded",children:[s.jsx("summary",{className:"text-xs text-gray-600 cursor-pointer hover:text-gray-800",children:"ðŸ” Debug: Raw Metadata (Click to expand)"}),s.jsx("pre",{className:"mt-2 text-xs text-gray-700 overflow-x-auto",children:JSON.stringify(p.raw,($,W)=>typeof W=="bigint"?`BigInt(${W.toString()})`:W,2)})]})]}):s.jsx("div",{className:"mt-2 p-2 bg-gray-100 rounded text-xs",children:s.jsx("div",{className:"text-gray-600",children:"No collection metadata available"})})]})]})}),s.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("strong",{children:"No additional costs required!"})," Since the canister already exists, you can proceed directly to bridge your NFTs without paying canister creation fees."]})})]}):J?s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-700",children:"Canister Creation Cost"}),s.jsxs("div",{className:"text-right",children:[s.jsxs("span",{className:"font-medium",children:[S(J)," Cycles"]}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",H(J)," ICP"]})]})]}),s.jsxs("div",{className:"flex justify-between items-center border-t pt-3",children:[s.jsx("span",{className:"text-gray-700",children:"Your Cycles Balance"}),s.jsx("div",{className:"text-right",children:g?s.jsx("span",{className:"text-gray-500",children:"Loading..."}):f!==void 0?s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:be("font-medium",B(J)?"text-green-600":"text-red-600"),children:[S(f)," Cycles"]}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",H(f)," ICP"]})]}):s.jsx("span",{className:"text-red-600",children:"Unable to load"})})]}),f!==void 0&&J&&s.jsx("div",{className:"border-t pt-3",children:B(J)?s.jsxs("div",{className:"flex items-center text-green-700",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:"Sufficient balance available"})]}):s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center text-red-700",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsxs("span",{className:"text-sm font-medium",children:["Insufficient balance (need ",S(J-f)," more cycles)"]})]}),s.jsx("p",{className:"text-xs text-red-600",children:"You need to top up your cycles balance before proceeding."})]})})]})}),J&&s.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-700",children:"Existing Approval"}),s.jsx("div",{className:"text-right",children:ee?s.jsx("span",{className:"text-gray-500",children:"Checking..."}):T?T.isSufficient&&!T.isExpired?s.jsxs("div",{className:"flex items-center text-green-600",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:"Approved"})]}):s.jsxs("div",{className:"flex items-center text-amber-600",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:T.isExpired?"Expired":"Insufficient"})]}):s.jsxs("div",{className:"flex items-center text-red-600",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:"None"})]})})]}),T&&s.jsxs("div",{className:"text-xs text-gray-600 border-t pt-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Current Allowance:"}),s.jsxs("span",{className:"font-mono",children:[w(T.allowance)," Cycles"]})]}),T.expires_at&&s.jsxs("div",{className:"flex justify-between mt-1",children:[s.jsx("span",{children:"Expires:"}),s.jsx("span",{className:"font-mono",children:new Date(Number(T.expires_at)/1e6).toLocaleString()})]})]}),J&&(!(T!=null&&T.isSufficient)||(T==null?void 0:T.isExpired))&&s.jsxs("div",{className:"border-t pt-3",children:[s.jsx("button",{onClick:async()=>{if(J)try{const $=qe.fromText("jio3a-xaaaa-aaaal-ab66q-cai"),W=J*BigInt(110)/BigInt(100),le=BigInt(Date.now()*1e6)+BigInt(1440*60*1e9);await m.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:W,expected_allowance:[],expires_at:[le],spender:{owner:$,subaccount:[]}})}catch($){console.error("Manual approval failed:",$)}},disabled:h,className:be("w-full px-3 py-2 text-sm rounded-md font-medium transition-colors",h?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-amber-600 text-white hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2"),children:h?"Approving...":"Pre-approve Cycles"}),C&&s.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Approval failed: ",C instanceof Error?C.message:String(C)]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This will approve 110% of the required amount for future canister creations."})]})]})}),U&&s.jsx("button",{onClick:v,disabled:!U||j.createCanister.isPending,className:be("w-full px-4 py-3 rounded-lg font-medium transition-colors",U&&!j.createCanister.isPending?"bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:j.createCanister.isPending?s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Creating Canister..."]}):`Create ckNFT Canister (${S(J)} Cycles)`}),s.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("strong",{children:"What are cycles?"})," Cycles are the unit of payment for computation and storage on the Internet Computer. This cost covers creating your NFT canister where your bridged NFTs will be securely stored and managed on-chain."]})}),f!==void 0&&J&&!B(J)&&s.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[s.jsxs("p",{className:"text-sm text-amber-800 mb-2",children:[s.jsx("strong",{children:"Need more cycles?"})," You can top up your cycles balance by:"]}),s.jsxs("ul",{className:"text-xs text-amber-700 space-y-1 ml-4",children:[s.jsx("li",{children:"â€¢ Converting ICP to cycles through the NNS"}),s.jsx("li",{children:"â€¢ Using a cycles wallet or faucet"}),s.jsx("li",{children:"â€¢ Having someone transfer cycles to your account"})]})]})]}):s.jsx("div",{className:"p-6 text-center border-2 border-dashed border-gray-300 rounded-lg",children:s.jsx("p",{className:"text-gray-500",children:"Select NFTs to see canister creation costs"})})]}))}function os(){const{publicKey:e,connected:t,connecting:n,disconnecting:r,wallet:a,wallets:o,select:i,connect:c,disconnect:l,signTransaction:u,signAllTransactions:d,signMessage:m,sendTransaction:f}=jf(),{connection:g}=Cf(),{setVisible:N}=kf(),h=x.useMemo(()=>{var T,ee,J,pe;let V=null;if((a==null?void 0:a.adapter.name)==="Backpack"&&typeof window<"u"){const E=window.backpack;V=((T=E==null?void 0:E.connection)==null?void 0:T.rpcEndpoint)||(E==null?void 0:E._rpcEndpoint)}if(!V&&typeof window<"u"&&window.solana){const E=window.solana;V=((ee=E.connection)==null?void 0:ee.rpcEndpoint)||E._rpcEndpoint}if(!V&&a&&((J=a.adapter)!=null&&J.provider)){const E=a.adapter.provider;V=((pe=E.connection)==null?void 0:pe.rpcEndpoint)||E._rpcEndpoint}return V&&V!==g.rpcEndpoint?(console.log(`[useSolana] Creating wallet-aware connection with RPC: ${V}`),new ws(V,"confirmed")):g},[a,g]),C=x.useCallback(async()=>{if(!a){N(!0);return}try{await c()}catch(V){throw console.error("Failed to connect wallet:",V),V}},[a,c,N]),w=x.useCallback(async()=>{try{await l()}catch(V){throw console.error("Failed to disconnect wallet:",V),V}},[l]),B=x.useCallback(async V=>{if(!u)throw new Error("Wallet does not support transaction signing");if(!e)throw new Error("Wallet not connected");try{return await u(V)}catch(T){throw console.error("Failed to sign transaction:",T),T}},[u,e]),j=x.useCallback(async V=>{if(!d)throw new Error("Wallet does not support batch transaction signing");if(!e)throw new Error("Wallet not connected");try{return await d(V)}catch(T){throw console.error("Failed to sign transactions:",T),T}},[d,e]),Q=x.useCallback(async V=>{if(!m)throw new Error("Wallet does not support message signing");if(!e)throw new Error("Wallet not connected");try{return await m(V)}catch(T){throw console.error("Failed to sign message:",T),T}},[m,e]),F=x.useCallback(async(V,T)=>{if(!f)throw new Error("Wallet does not support transaction sending");if(!e)throw new Error("Wallet not connected");try{return await f(V,h,T)}catch(ee){throw console.error("Failed to send transaction:",ee),ee}},[f,h,e]),_=x.useMemo(()=>h.rpcEndpoint,[h.rpcEndpoint]),M=x.useMemo(()=>{const V=_;return V.includes("devnet")?"devnet":V.includes("testnet")?"testnet":V.includes("localhost")||V.includes("127.0.0.1")||V.includes("0.0.0.0")?(console.log("[useSolana] Detected localhost RPC - assuming devnet cluster"),"devnet"):(V.includes("mainnet-beta")||V.includes("mainnet")||["xnftdata.com","helius-rpc.com","rpcpool.com","quicknode.pro","genesysgo.net","triton.one","hellomoon.io","syndica.io","blockdaemon.com","alchemy.com"].some(ee=>V.includes(ee))||console.log("[useSolana] Unknown RPC endpoint detected:",V,"- defaulting to mainnet-beta for safety"),"mainnet-beta")},[_]);x.useEffect(()=>{t&&a&&(console.log("[useSolana] Debug - Wallet connected:",{walletName:a.adapter.name,hasWindowBackpack:typeof window.backpack<"u",hasWindowSolana:typeof window.solana<"u",adapterProvider:a.adapter?Object.keys(a.adapter.provider||{}):[],detectedRpcEndpoint:_,connectionProviderEndpoint:g.rpcEndpoint}),window.backpack&&console.log("[useSolana] window.backpack properties:",Object.keys(window.backpack)),window.solana&&console.log("[useSolana] window.solana properties:",Object.keys(window.solana)))},[t,a,_,g.rpcEndpoint]);const k=x.useMemo(()=>(e==null?void 0:e.toBase58())??null,[e]),K=x.useMemo(()=>o.length>0,[o]);return{publicKey:e,address:k,connected:t,connecting:n,disconnecting:r,wallet:a,wallets:o,isDetected:K,connection:h,cluster:M,actualRpcEndpoint:_,connect:C,disconnect:w,select:i,openWalletModal:()=>N(!0),closeWalletModal:()=>N(!1),signTransaction:B,signAllTransactions:j,signMessage:Q,sendTransaction:F}}function So(e){let t;switch(e){case"mainnet-beta":t={Mainnet:null};break;case"devnet":t={Devnet:null};break;case"testnet":t={Testnet:null};break;case"localnet":t={Custom:"http://127.0.0.1:8899"};break;default:t={Devnet:null}}return{Solana:[t]}}const Ea={"mainnet-beta":"https://api.mainnet-beta.solana.com",devnet:"https://api.devnet.solana.com",testnet:"https://api.testnet.solana.com",localnet:"http://127.0.0.1:8899"},Vo={"mainnet-beta":"https://solscan.io",devnet:"https://solscan.io",testnet:"https://solscan.io",localnet:"https://explorer.solana.com"};function Zi(e){try{const n=new Ve(e).toBytes();let r=0n;for(let a=0;a<n.length;a++)r=r<<8n|BigInt(n[a]);return r}catch(t){throw console.error(`Failed to convert mint address to tokenId: ${e}`,t),new Error(`Invalid Solana mint address: ${e}`)}}function YN(e){try{const t=new Uint8Array(32);let n=e;for(let r=31;r>=0;r--)t[r]=Number(n&0xFFn),n=n>>8n;return new Ve(t).toString()}catch(t){throw console.error(`Failed to convert tokenId to mint address: ${e}`,t),new Error(`Invalid tokenId for Solana mint conversion: ${e}`)}}var ZN={};function Dh({networkSource:e,selectedNFTs:t=[],selectedSolanaNFTs:n=[],mintCosts:r,onMintCostsCalculated:a}){const{chainId:o}=an();let i;try{i=os()}catch(W){console.warn("Solana wallet provider not available:",W),i=void 0}const{user:c}=ut(),l=(i==null?void 0:i.cluster)??"devnet",d=(e==="evm"?t:n).length,m=e==="evm"?"blue":"purple",f=e==="evm"?"bg-blue-50":"bg-purple-50",g=e==="evm"?"border-blue-200":"border-purple-200",N=e==="evm"?"text-blue-800":"text-purple-800",h=e==="evm"?"bg-blue-600 hover:bg-blue-700":"bg-purple-600 hover:bg-purple-700",C=e==="evm"?"focus:ring-blue-500":"focus:ring-purple-500",w=ZN.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",B=js(w),{useBalance:j,useApprove:Q}=B,F=j(c!=null&&c.principal?{owner:c.principal,subaccount:[]}:void 0),_=Q(),M=F.data,k=F.isLoading,K=F.error,V=_.isPending,T=_.error,ee=W=>{const ce=BigInt(1e12),L=W/ce,re=(W%ce).toString().padStart(12,"0").slice(0,3);return`${L.toLocaleString()}.${re} TC`},J=W=>M?M>=W:!1,pe=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),E=x.useMemo(()=>{if(d===0||!(c!=null&&c.principal))return[];let W;return e==="evm"?W={Ethereum:[BigInt(o??1)]}:W=So(l??"devnet"),e==="evm"?t.map(le=>({nft:{tokenId:BigInt(le.tokenId),contract:le.contractAddress,network:W},resume:[],mintToAccount:{owner:c.principal,subaccount:[]},spender:[]})):n.map(le=>{var ce;return{nft:{tokenId:Zi(le.mintAddress),contract:((ce=le.collection)==null?void 0:ce.address)||le.mintAddress,network:W},resume:[],mintToAccount:{owner:c.principal,subaccount:[]},spender:[]}})},[e,d,o,l,t,n,c==null?void 0:c.principal]),[b,Y]=x.useState(!1),[p,O]=x.useState(null),[R,q]=x.useState(null);x.useEffect(()=>{E.length>0&&!R&&!b&&(Y(!0),O(null),pe.getMintCost.mutateAsync(E).then(W=>{let le=BigInt(0);for(const ce of W)ce!==null&&(le+=ce);q(le),a(le)}).catch(W=>{console.error("Failed to get mint costs:",W),O(W instanceof Error?W.message:String(W))}).finally(()=>{Y(!1)}))},[E,R,b,pe.getMintCost,a]);const v=r||R,U=b||k,S=p||K,{data:H,isLoading:he}=oa(v||void 0);console.log("Allowance info:",H);const $=W=>(Number(W)/1e12).toFixed(6);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"NFT Mint Costs"}),s.jsx("p",{className:"text-gray-600",children:"Review the cycles needed to mint your selected NFTs on the Internet Computer."})]}),S&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-800",children:["Error loading mint costs: ",S instanceof Error?S.message:String(S)]})}),U?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:be("animate-spin w-8 h-8 border-4 border-t-transparent rounded-full mx-auto mb-4",`border-${m}-600`)}),s.jsxs("p",{className:"text-gray-600",children:["Calculating mint costs for ",d," NFT",d!==1?"s":"","..."]})]}):v?s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"text-gray-700",children:["Total Mint Cost (",d," NFT",d!==1?"s":"",")"]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("span",{className:"font-medium",children:[ee(v)," Cycles"]}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",$(v)," ICP"]})]})]}),d>1&&s.jsx("div",{className:"text-xs text-gray-600 border-t pt-2",children:s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Per NFT Cost:"}),s.jsxs("span",{className:"font-mono",children:["â‰ˆ ",ee(v/BigInt(d))," Cycles"]})]})}),s.jsxs("div",{className:"flex justify-between items-center border-t pt-3",children:[s.jsx("span",{className:"text-gray-700",children:"Your Cycles Balance"}),s.jsx("div",{className:"text-right",children:k?s.jsx("span",{className:"text-gray-500",children:"Loading..."}):M!==void 0?s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:be("font-medium",J(v)?"text-green-600":"text-red-600"),children:[ee(M)," Cycles"]}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",$(M)," ICP"]})]}):s.jsx("span",{className:"text-red-600",children:"Unable to load"})})]}),M!==void 0&&v&&s.jsx("div",{className:"border-t pt-3",children:J(v)?s.jsxs("div",{className:"flex items-center text-green-700",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:"Sufficient balance available"})]}):s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center text-red-700",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsxs("span",{className:"text-sm font-medium",children:["Insufficient balance (need ",ee(v-M)," more cycles)"]})]}),s.jsx("p",{className:"text-xs text-red-600",children:"You need to top up your cycles balance before proceeding."})]})})]})}),s.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-700",children:"Mint Approval Status"}),s.jsx("div",{className:"text-right",children:he?s.jsx("span",{className:"text-gray-500",children:"Checking..."}):H?H.isSufficient&&!H.isExpired?s.jsxs("div",{className:"flex items-center text-green-600",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:"Approved"})]}):s.jsxs("div",{className:"flex items-center text-amber-600",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:H.isExpired?"Expired":"Insufficient"})]}):s.jsxs("div",{className:"flex items-center text-red-600",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:"Not Approved"})]})})]}),H&&s.jsxs("div",{className:"text-xs text-gray-600 border-t pt-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Current Allowance:"}),s.jsxs("span",{className:"font-mono",children:[ee(H.allowance)," Cycles"]})]}),H.expires_at&&s.jsxs("div",{className:"flex justify-between mt-1",children:[s.jsx("span",{children:"Expires:"}),s.jsx("span",{className:"font-mono",children:new Date(Number(H.expires_at)/1e6).toLocaleDateString()})]})]}),v&&(!(H!=null&&H.isSufficient)||(H==null?void 0:H.isExpired))&&s.jsxs("div",{className:"border-t pt-3",children:[s.jsx("button",{onClick:async()=>{if(v)try{const W=qe.fromText("jio3a-xaaaa-aaaal-ab66q-cai"),le=v*BigInt(120)/BigInt(100),ce=BigInt(Date.now()*1e6)+BigInt(1440*60*1e9);await _.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:le,expected_allowance:[],expires_at:[ce],spender:{owner:W,subaccount:[]}})}catch(W){console.error("Mint approval failed:",W)}},disabled:V,className:be("w-full px-3 py-2 text-sm rounded-md font-medium transition-colors",V?"bg-gray-300 text-gray-500 cursor-not-allowed":`${h} text-white focus:outline-none focus:ring-2 ${C} focus:ring-offset-2`),children:V?s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full mr-2"}),"Approving..."]}):`Approve Cycles for Minting (${ee(v*BigInt(110)/BigInt(100))} Cycles)`}),T&&s.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Approval failed: ",T instanceof Error?T.message:String(T)]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This will approve 110% of the required amount for minting operations."})]})]})}),s.jsx("div",{className:be("p-4 border rounded-lg",f,g),children:s.jsxs("p",{className:be("text-sm",N),children:[s.jsx("strong",{children:"About NFT minting costs:"})," Each NFT requires cycles to mint on the Internet Computer. This covers the computational cost of creating the NFT, storing metadata, and updating the canister state."]})}),M!==void 0&&v&&!J(v)&&s.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[s.jsxs("p",{className:"text-sm text-amber-800 mb-2",children:[s.jsx("strong",{children:"Need more cycles?"})," You can top up your cycles balance by:"]}),s.jsxs("ul",{className:"text-xs text-amber-700 space-y-1 ml-4",children:[s.jsx("li",{children:"â€¢ Converting ICP to cycles through the NNS"}),s.jsx("li",{children:"â€¢ Using a cycles wallet or faucet"}),s.jsx("li",{children:"â€¢ Having someone transfer cycles to your account"})]})]})]}):s.jsx("div",{className:"p-6 text-center border-2 border-dashed border-gray-300 rounded-lg",children:s.jsx("p",{className:"text-gray-500",children:"Select NFTs to see minting costs"})})]})}function f0({canisterId:e,supportedNetworks:t=["ethereum","polygon"],nftDiscoveryService:n,onComplete:r,onCancel:a,className:o,modal:i=!1,initialStep:c,mockSelectedNFTs:l,mockWalletConnected:u,mockCanisterCosts:d,mockMintCosts:m,mockImportResult:f}){var ne,ye;const g={ethereum:1,polygon:137,bsc:56,hardhat:31337,"hardhat-2":1338,arbitrum:42161,optimism:10,base:8453},N=Object.fromEntries(Object.entries(g).map(([G,P])=>[P,G])),[h,C]=x.useState(c||"connect"),[w,B]=x.useState(l||[]),[j,Q]=x.useState(null),[F,_]=x.useState(d?BigInt(d):null),[M,k]=x.useState(m?BigInt(m):null),[K,V]=x.useState(f||null),[T,ee]=x.useState(null),{activeAddress:J,isUnlocked:pe,connectWallet:E,switchChain:b,chainId:Y}=an(),{user:p}=ut(),O=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),R=x.useMemo(()=>{if(w.length===0)return null;const G=w[0].contractAddress;w.every(A=>A.contractAddress===G)||console.warn("âš ï¸ Selected NFTs are from different contracts. Only NFTs from the first contract will be bridged:",G);let z;if(j)z=j;else if(Y)z={Ethereum:[BigInt(Y)]};else return null;return{contract:G,network:z}},[w,j,Y]);x.useEffect(()=>{console.log("ðŸ” Import wizard contract pointer updated:",{contractPointer:R,targetNetwork:j,chainId:Y,hasSelectedNFTs:w.length>0})},[R,j,Y,w.length]);const q=u!==void 0?u:pe,v=u?"0x742d35Cc6635C0532925a3b8D11e432f1b7C4b7b":J,U=x.useCallback(G=>{try{let P=G.replace(/\x00/g,"").replace(/[\x01-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"");const z=new TextEncoder,A=new TextDecoder("utf-8",{fatal:!1}),Z=z.encode(P);return P=A.decode(Z),P=P.replace(/\uFFFD/g,""),P.trim()}catch(P){return console.warn("Error sanitizing text:",P,"Original:",G),G.replace(/[^\x20-\x7E\n]/g,"").trim()}},[]),S=x.useCallback(G=>{const P=aa(G);return ee(P),P},[]),H=x.useCallback((G,P,z,A)=>{if(!T)return;const Z=mt(T,G,{status:P,...z&&{error:z},...A&&{txHash:A}});ee(Z)},[T]),he=x.useCallback(G=>{if(!T)return;const P=vc(T,G);ee(P)},[T]);x.useEffect(()=>{S("evm-to-ic")},[S]);const $=[{id:"connect",title:"Connect Wallet",description:"Connect your EVM wallet"},{id:"select",title:"Select NFTs",description:"Choose NFTs to import"},{id:"costs",title:"Canister Costs",description:"Review and pay canister fees"},{id:"gas",title:"NFT Mint Costs",description:"Review and approve cycles for NFT minting"},{id:"bridge",title:"Bridge Progress",description:"Monitor the bridging process"},{id:"complete",title:"Complete",description:"Import summary"}],W=$.findIndex(G=>G.id===h),le=x.useCallback(()=>{switch(h){case"connect":return pe&&J&&j!==null;case"select":return w.length>0;case"costs":return F!==null;case"gas":return M!==null;case"bridge":return(K==null?void 0:K.success)===!0;default:return!1}},[h,pe,J,j,w,F,M,K]),ce=x.useMemo(()=>{if(T!=null&&T.steps&&T.steps.some(P=>P.status==="failed"))return console.log("ðŸš¨ Bridge error detected in progress steps:",T.steps.filter(P=>P.status==="failed")),!0;if(h==="costs"){const G=!!O.createCanister.error;return G&&console.log("ðŸš¨ Canister creation error detected:",O.createCanister.error),G}if(h==="gas"){const G=!!O.mintFromEVM.error;return G&&console.log("ðŸš¨ Mint estimation error detected:",O.mintFromEVM.error),G}if(h==="bridge"){const G=!!(O.mintFromEVM.error||O.getApprovalAddress.error);return G&&console.log("ðŸš¨ Bridge mutation error detected:",{mintError:O.mintFromEVM.error,approvalError:O.getApprovalAddress.error}),G}return K&&!K.success?(console.log("ðŸš¨ Import result shows failure:",K.error),!0):!1},[T,h,O.createCanister.error,O.mintFromEVM.error,O.getApprovalAddress.error,K]),L=W>0&&(h!=="bridge"&&h!=="complete"||ce);x.useEffect(()=>{var G;console.log("ðŸ”™ Back button state:",{currentStepIndex:W,currentStep:h,hasError:ce,canGoPrev:L,progressSteps:(G=T==null?void 0:T.steps)==null?void 0:G.map(P=>({id:P.id,status:P.status}))})},[W,h,ce,L,T==null?void 0:T.steps]);const ue=x.useCallback(()=>{if(!le())return;const G=W+1;G<$.length&&C($[G].id)},[W,le,$]),re=x.useCallback(()=>{if(!L)return;const G=W-1;G>=0&&C($[G].id)},[W,L,$]),se=x.useCallback(async()=>{if(!(!w.length||!J||!R||!(p!=null&&p.principal))){C("bridge"),S("evm-to-ic");try{H("connect-evm-wallet","loading"),H("connect-evm-wallet","completed"),console.log(`ðŸš€ Starting bridge process for ${w.length} NFT(s)`);const G=R.contract,P=w.filter(oe=>oe.contractAddress===G);if(P.length!==w.length&&console.warn(`âš ï¸ Filtered ${w.length-P.length} NFT(s) from different contracts. Bridging ${P.length} NFT(s) from contract ${G}`),P.length===0)throw new Error("No NFTs found for the selected contract");const z=P.filter(oe=>oe.ownershipStatus==="ready-to-mint"),A=P.filter(oe=>oe.ownershipStatus==="owned");if(console.log(`ðŸ“Š NFT breakdown for contract ${G}: ${z.length} ready-to-mint, ${A.length} owned`),A.length>0){H("approve-nft-transfer","loading"),console.log(`ðŸ”„ Processing ${A.length} owned NFT(s) for transfer`);for(let oe=0;oe<A.length;oe++){const X=A[oe];console.log(`ðŸš€ Processing owned NFT ${oe+1}/${A.length}: Token ${X.tokenId}`);const je=await O.getApprovalAddress.mutateAsync({request:{account:{owner:p.principal,subaccount:[]},remoteNFTPointer:{tokenId:BigInt(X.tokenId),contract:R.contract,network:R.network}}});if(!je)throw new Error(`Failed to get approval address for NFT ${X.tokenId}`);H("transfer-nft-to-bridge","loading",`Transferring NFT ${oe+1}/${A.length}`);try{if(!window.ethereum)throw new Error("MetaMask not detected");const{ethers:Ae}=await Xe(async()=>{const{ethers:Te}=await import("./index-BTkhUH0V.js");return{ethers:Te}},__vite__mapDeps([5,1,2,3,4])),Pe=await new Ae.BrowserProvider(window.ethereum).getSigner(),_e=["function safeTransferFrom(address from, address to, uint256 tokenId) external","function transferFrom(address from, address to, uint256 tokenId) external","function ownerOf(uint256 tokenId) external view returns (address)"],ke=new Ae.Contract(X.contractAddress,_e,Pe),ve=BigInt(X.tokenId);console.log(`ðŸ” Pre-transfer checks for NFT ${oe+1}:`,{tokenId:ve.toString(),from:J,to:je,contract:X.contractAddress});try{const Te=await ke.ownerOf(ve);if(console.log(`Current NFT ${oe+1} owner:`,Te),console.log("User address:",J),Te.toLowerCase()!==J.toLowerCase())throw new Error(`NFT ${oe+1} ownership mismatch. Current owner: ${Te}, User: ${J}`)}catch(Te){throw console.error(`Ownership check failed for NFT ${oe+1}:`,Te),new Error(`Failed to verify NFT ${oe+1} ownership: ${Te instanceof Error?Te.message:"Unknown error"}`)}console.log(`ðŸš€ Transferring NFT ${oe+1} (${ve.toString()}) from ${J} to ${je}`),H("transfer-nft-to-bridge","loading",`Executing NFT ${oe+1} transfer...`);try{const Te=await ke.safeTransferFrom(J,je,ve);console.log(`Transfer transaction ${oe+1} submitted:`,Te.hash);const Ie=await Te.wait();console.log(`Transfer ${oe+1} confirmed:`,Ie),H("transfer-nft-to-bridge","loading",`NFT ${oe+1} transferred successfully`)}catch(Te){console.warn(`safeTransferFrom failed for NFT ${oe+1}, trying transferFrom:`,Te);const Ie=await ke.transferFrom(J,je,ve);console.log(`Transfer transaction ${oe+1} submitted (via transferFrom):`,Ie.hash);const Ue=await Ie.wait();console.log(`Transfer ${oe+1} confirmed (via transferFrom):`,Ue),H("transfer-nft-to-bridge","loading",`NFT ${oe+1} transferred successfully`)}}catch(Ae){console.error(`NFT ${oe+1} transfer failed:`,Ae);let Fe=`NFT ${oe+1} transfer failed`;throw Ae instanceof Error&&(Ae.message.includes("execution reverted")?Ae.message.includes("ERC721: transfer caller is not owner nor approved")?Fe=`Transfer failed for NFT ${oe+1}: Not approved for transfer. Please ensure the NFT is approved.`:Ae.message.includes("ERC721: transfer from incorrect owner")?Fe=`Transfer failed for NFT ${oe+1}: You do not own this NFT or ownership has changed.`:Ae.message.includes("ERC721: transfer to the zero address")?Fe=`Transfer failed for NFT ${oe+1}: Invalid bridge address received.`:Fe=`Transfer failed for NFT ${oe+1}: ${Ae.message}`:Fe=`NFT ${oe+1}: ${Ae.message}`),H("transfer-nft-to-bridge","failed",Fe),console.error(`ðŸ”¥ Transfer error details for NFT ${oe+1}:`,{error:Ae,tokenId:X.tokenId,contract:X.contractAddress,from:J,to:je,network:Y}),new Error(Fe)}oe<A.length-1&&await new Promise(Ae=>setTimeout(Ae,1e3)),z.push(X),console.log(`âœ… NFT ${oe+1}/${A.length} transferred successfully and added to mint queue`)}await new Promise(oe=>setTimeout(oe,2e3)),H("approve-nft-transfer","completed",`${A.length} NFT(s) transferred`),H("transfer-nft-to-bridge","completed",`All ${A.length} owned NFT(s) transferred successfully`)}else console.log("ðŸƒâ€â™‚ï¸ No owned NFTs to transfer, skipping transfer steps"),H("approve-nft-transfer","completed","Skipped - No owned NFTs to transfer"),H("transfer-nft-to-bridge","completed","Skipped - No owned NFTs to transfer");H("create-cknft-canister","loading");let Z;try{const X=(await O.getCkNFTCanister.mutateAsync([R]))[0];if(X)console.log("Using existing canister:",X),Z={Ok:X};else{const ae=w[0];Z=await O.createCanister.mutateAsync({pointer:R,defaults:{name:U(ae.name||"ckNFT Collection"),symbol:U(`ck${ae.contractAddress.slice(-4)}`),description:U(`Bridged NFT collection from ${R.contract}`)},requiredCycles:F||BigInt(0),skipApproval:!1})}}catch(oe){console.log("Failed to check existing canister, creating new one:",oe);const X=w[0];Z=await O.createCanister.mutateAsync({pointer:R,defaults:{name:U(X.name||"ckNFT Collection"),symbol:U(`ck${X.contractAddress.slice(-4)}`),description:U(`Bridged NFT collection from ${R.contract}`)},requiredCycles:F||BigInt(0),skipApproval:!1})}if("Err"in Z){const oe=(()=>{try{return JSON.stringify(Z.Err,(X,ae)=>typeof ae=="bigint"?ae.toString():ae)}catch{return String(Z.Err)}})();throw new Error(`Canister creation failed: ${oe}`)}const de="Ok"in Z?Z.Ok:Z;H("create-cknft-canister","completed"),H("mint-cknft","loading"),console.log(`ðŸŽ¯ Starting mint process for ${z.length} NFT(s)`);const te=[],fe=[];for(let oe=0;oe<z.length;oe++){const X=z[oe];console.log(`ðŸ”„ Minting NFT ${oe+1}/${z.length}: Token ${X.tokenId}`),H("mint-cknft","loading",`Minting NFT ${oe+1}/${z.length}...`);const ae={nft:{tokenId:BigInt(X.tokenId),contract:R.contract,network:R.network},resume:[],mintToAccount:{owner:p.principal,subaccount:[]},spender:[]};console.log(`ðŸ” Mint request data for NFT ${oe+1} (preserving token ID ${X.tokenId}):`,{mintRequest:{...ae,nft:{...ae.nft,tokenId:ae.nft.tokenId.toString()},mintToAccount:{...ae.mintToAccount,owner:ae.mintToAccount.owner.toString()}},userPrincipal:p.principal,userPrincipalType:typeof p.principal,mintCosts:M==null?void 0:M.toString(),contractPointer:R,selectedNFT:X,note:"Token ID should be preserved: "+X.tokenId});const je=await O.mintFromEVM.mutateAsync({request:ae,requiredCycles:M||void 0,skipApproval:oe>0});if(console.log(`âœ… Raw mint result for NFT ${oe+1} (original token ID: ${X.tokenId}):`,je),console.log("ðŸ” Mint result type analysis:",{resultType:typeof je,hasOk:"Ok"in je,hasErr:"Err"in je,okValue:"Ok"in je?je.Ok:null,okValueType:"Ok"in je?typeof je.Ok:null,originalTokenId:X.tokenId,expectedBehavior:"The IC token should maintain the same ID as the original EVM token"}),"Ok"in je){const Ae=je.Ok,Fe=X.tokenId;console.log(`âœ… Mint request ${oe+1} get_mint_status: ${Ae.toString()}`),console.log("ðŸ” Polling for mint completion status...");let Pe=0;const _e=30;let ke=null,ve="";for(;Pe<_e;)try{const Ie=(await O.getMintStatus.mutateAsync([Ae]))[0];if(Ie&&Array.isArray(Ie)&&Ie.length>0)if(ke=Ie[0],console.log(`ðŸ“Š Mint status poll ${Pe+1}:`,ke),"Complete"in ke){const He=ke.Complete.mintTrx;console.log(`ðŸŽ‰ Mint completed! Transaction ID: ${He.toString()}`),console.log(`ðŸ” Token ID validation - Original: ${Fe}, Expected to be preserved per ICRC-99 protocol`),ve=`Token ${Fe} (IC Tx: ${He.toString()})`,console.log(`âœ… Token ID preserved correctly: ${Fe} (Mint Tx: ${He})`);break}else if("Err"in ke){const Ue=(()=>{try{return JSON.stringify(ke.Err,(He,Ge)=>typeof Ge=="bigint"?Ge.toString():Ge)}catch{return String(ke.Err)}})();throw new Error(`Mint failed for NFT ${oe+1} (Token ${Fe}): ${Ue}`)}else{const Ue=Object.keys(ke)[0];console.log(`â³ Mint still in progress... Status: ${Ue}`),Ue==="CheckingOwner"?H("mint-cknft","loading",`Verifying ownership for NFT ${oe+1}/${z.length}`):Ue==="RetrievingMetadata"?H("mint-cknft","loading",`Retrieving metadata for NFT ${oe+1}/${z.length}`):Ue==="Transferring"?H("mint-cknft","loading",`Transferring NFT ${oe+1}/${z.length}`):Ue==="Minting"&&H("mint-cknft","loading",`Minting NFT ${oe+1}/${z.length} on IC`)}else console.log("â³ Waiting for mint status to be available...");Pe++,Pe<_e&&!("Complete"in(ke||{}))&&await new Promise(Ue=>setTimeout(Ue,2e3))}catch(Te){console.error(`âŒ Error checking mint status (attempt ${Pe+1}):`,Te),Pe++,Pe<_e&&await new Promise(Ie=>setTimeout(Ie,2e3))}(!ke||!("Complete"in ke))&&(console.warn(`âš ï¸ Mint status polling timed out for NFT ${oe+1}`),ve=`Token ${Fe} (IC - Pending)`),fe.push(ve),te.push(je),console.log(`ðŸŽ‰ NFT ${oe+1}/${z.length} processed: ${ve}`)}else{const Ae=(()=>{try{return JSON.stringify(je.Err,(Fe,Pe)=>typeof Pe=="bigint"?Pe.toString():Pe)}catch{return String(je.Err)}})();throw new Error(`Mint failed for NFT ${oe+1} (Token ${X.tokenId}): ${Ae}`)}}H("mint-cknft","completed",`Successfully minted ${te.length} NFT(s)`),H("verify-mint-complete","loading"),H("verify-mint-complete","completed",`All ${te.length} NFT(s) verified`);const xe=z.map(oe=>oe.tokenId);V({success:!0,icTransactionHash:fe.join(" | "),canisterAddress:de.toString(),tokenId:xe.join(", ")}),console.log("ðŸŽ‰ Multi-NFT bridge process completed successfully!",{mintedCount:te.length,tokenReferences:fe,canisterId:de.toString(),tokenIds:xe}),C("complete"),r==null||r({success:!0,icTransactionHash:fe.join(" | "),canisterAddress:de.toString(),tokenId:xe.join(", ")})}catch(G){console.error("Bridge process failed:",G);const P=G instanceof Error?G.message:"Bridge failed";if(T!=null&&T.steps){const z=T.steps.find(A=>A.status==="loading");z&&H(z.id,"failed",P)}V({success:!1,error:P}),r==null||r({success:!1,error:P})}}},[w,J,R,p,O,F,H,r,T,S]),Ne=()=>{switch(h){case"connect":return s.jsx(Vc,{isConnected:q,account:v,supportedNetworks:t,currentNetwork:Y&&N[Y]||null,onConnect:E,onSwitchNetwork:G=>{const P=g[G];if(P)return b(P);throw new Error(`Unsupported network: ${G}`)},selectedTargetNetwork:j&&"Ethereum"in j&&N[Number(j.Ethereum[0])]||void 0,onTargetNetworkChange:G=>{const P=g[G];P&&(console.log("ðŸŽ¯ Target network selected for import:",G,"Chain ID:",P),Q({Ethereum:[BigInt(P)]}))}});case"select":return s.jsx(Lh,{account:v,network:Y&&N[Y]||null,selectedNFTs:w,onSelectionChange:B,nftDiscoveryService:n});case"costs":return s.jsx(KN,{selectedNFTs:w,costs:F,onCostsCalculated:_,compact:ce});case"gas":return s.jsx(Dh,{networkSource:"evm",selectedNFTs:w,mintCosts:M,onMintCostsCalculated:k});case"bridge":return s.jsx(XN,{progress:T,onRetryStep:he,onToggleStage:()=>{},setProgress:ee});case"complete":return s.jsx(LN,{result:K,onStartNew:()=>{C("connect"),B([]),_(null),k(null),V(null),S("evm-to-ic")},onClose:()=>a==null?void 0:a()});default:return null}},ge=s.jsxs("div",{className:be("bg-white rounded-lg shadow-lg",i&&"max-w-4xl mx-auto",o),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Import NFTs from EVM"}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Step ",W+1," of ",$.length,": ",(ne=$[W])==null?void 0:ne.description]})]}),a&&s.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(ra,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"px-6 py-4 border-b border-gray-100",children:[s.jsx("div",{className:"flex items-center justify-between",children:$.map((G,P)=>s.jsxs("div",{className:be("flex items-center",P<$.length-1&&"flex-1"),children:[s.jsx("div",{className:be("flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium",P<W?"bg-green-100 text-green-600":P===W?ce?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-400"),children:P<W?s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):P===W&&ce?s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}):P+1}),s.jsx("span",{className:be("ml-2 text-sm font-medium hidden sm:inline",P<=W?"text-gray-900":"text-gray-400",P===W&&ce&&"text-red-600"),children:G.title}),P<$.length-1&&s.jsx("div",{className:be("flex-1 h-0.5 mx-4",P<W?"bg-green-200":"bg-gray-200")})]},G.id))}),ce&&s.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-md",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-4 h-4 text-red-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsxs("span",{className:"text-sm text-red-700 font-medium",children:["Error in ",(ye=$[W])==null?void 0:ye.title]}),s.jsx("span",{className:"ml-2 text-xs text-red-600",children:"Use the Previous button to go back and retry"})]})})]}),s.jsx("div",{className:"p-6 min-h-[400px]",children:Ne()}),s.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[s.jsxs("button",{onClick:re,disabled:!L,className:be("flex items-center px-4 py-2 text-sm font-medium rounded-md transition-colors",L?ce?"text-white bg-red-600 hover:bg-red-700":"text-gray-700 bg-gray-100 hover:bg-gray-200":"text-gray-400 bg-gray-50 cursor-not-allowed"),children:[s.jsx(ta,{className:"w-4 h-4 mr-1"}),ce?"Go Back & Retry":"Previous"]}),s.jsxs("div",{className:"flex space-x-3",children:[h==="gas"&&le()&&s.jsxs("button",{onClick:se,className:"flex items-center px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors",children:["Start Bridge",s.jsx(Is,{className:"w-4 h-4 ml-1"})]}),h!=="gas"&&h!=="bridge"&&h!=="complete"&&s.jsxs("button",{onClick:ue,disabled:!le(),className:be("flex items-center px-6 py-2 text-sm font-medium rounded-md transition-colors",le()?"text-white bg-blue-600 hover:bg-blue-700":"text-gray-400 bg-gray-100 cursor-not-allowed"),children:["Next",s.jsx(Is,{className:"w-4 h-4 ml-1"})]})]})]})]});return i?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:ge}):ge}function XN({progress:e,onRetryStep:t,onToggleStage:n,setProgress:r}){var c,l;if(!e)return s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Initializing bridge process..."})]});const o=(((c=e.steps)==null?void 0:c.filter(u=>u.status==="loading"||u.status==="failed"))||[])[0],i=((l=e.steps)==null?void 0:l.some(u=>u.status==="failed"))||!1;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:i?"Bridge Failed":"Bridge in Progress"}),s.jsx("p",{className:"text-gray-600",children:i?"An error occurred during the bridge process.":"Bridging your NFT to the Internet Computer..."})]}),o&&s.jsxs("div",{className:`p-4 rounded-lg border ${o.status==="failed"?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:[s.jsxs("div",{className:"flex items-center",children:[o.status==="loading"?s.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full mr-3"}):s.jsx("svg",{className:"w-5 h-5 text-red-500 mr-3",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsxs("div",{children:[s.jsxs("h4",{className:`font-medium ${o.status==="failed"?"text-red-800":"text-blue-800"}`,children:[o.status==="loading"?"In Progress: ":"Failed: ",o.title||o.id]}),o.error&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:o.error}),o.status==="loading"&&s.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Please wait..."})]})]}),o.status==="failed"&&s.jsxs("div",{className:"mt-3 space-x-2",children:[s.jsx("button",{onClick:()=>t(o.id),className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",children:"Retry Step"}),o.id==="transfer-nft-to-bridge"&&r&&s.jsx("button",{onClick:()=>{if(console.log("â­ï¸ Skipping failed transfer step for debugging"),e!=null&&e.steps){const u={...e},d=u.steps.findIndex(m=>m.id===o.id);d!==-1&&(u.steps[d]={...u.steps[d],status:"completed",error:void 0},r(u))}},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Skip for Testing"})]})]}),!o&&!i&&e.steps&&e.steps.length>0&&s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-5 h-5 text-green-500 mr-3",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-green-800",children:"Bridge Complete!"}),s.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Your NFT has been successfully bridged."})]})]})}),s.jsxs("details",{className:"mt-6",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"Show Detailed Progress"}),s.jsx("div",{className:"mt-3 p-4 bg-gray-50 rounded-lg",children:s.jsx(jc,{progress:e,onRetryStep:t,onToggleStage:n})})]})]})}function LN({result:e,onStartNew:t,onClose:n}){const r=e.tokenId?e.tokenId.split(", "):[],a=e.icTransactionHash?e.icTransactionHash.split(" | "):[],o=r.length>1,i=d=>{const m=d.match(/Token (\d+) \(IC Tx: (\d+)\)/);if(m)return{original:m[1],ic:m[1],hasMismatch:!1,txId:m[2]};const f=d.match(/Token (\d+) \(IC - Pending\)/);if(f)return{original:f[1],ic:f[1],hasMismatch:!1,isPending:!0};const g=d.match(/Token (\d+) â†’ (\d+)/);if(g)return{original:g[1],ic:g[2],hasMismatch:!0};const N=d.match(/Token (\d+) \(IC/);if(N)return{original:N[1],ic:N[1],hasMismatch:!1};const h=d.match(/Token (\d+)/);return h?{original:h[1],ic:h[1],hasMismatch:!1}:{original:"Unknown",ic:"Unknown",hasMismatch:!1}},c=a.map(i),l=c.some(d=>d.hasMismatch),u=c.some(d=>d.isPending);return s.jsxs("div",{className:"space-y-6 text-center",children:[s.jsx("div",{children:e.success?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:o?`${r.length} NFTs Imported Successfully!`:"Import Successful!"}),s.jsx("p",{className:"text-gray-600",children:o?`Your ${r.length} NFTs have been successfully bridged to the Internet Computer.`:"Your NFT has been successfully bridged to the Internet Computer."}),l&&s.jsx("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded-md",children:s.jsx("p",{className:"text-sm text-amber-800",children:"âš ï¸ Note: Some token IDs were changed during minting. This should be investigated."})}),u&&s.jsx("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded-md",children:s.jsx("p",{className:"text-sm text-blue-800",children:"â³ Note: Some mints are still pending completion. You can check back later for the final status."})})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Import Failed"}),s.jsx("p",{className:"text-gray-600",children:e.error})]})}),e.success&&s.jsxs("div",{className:"space-y-3 text-sm",children:[c.length>0&&s.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-green-800 mb-2",children:o?`${r.length} NFTs Bridged Successfully!`:"NFT Bridged Successfully!"}),o?s.jsx("div",{className:"space-y-2",children:c.map((d,m)=>s.jsx("div",{className:"text-green-700",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"font-medium",children:["NFT ",m+1,":"]}),s.jsx("div",{className:"text-right",children:d.hasMismatch?s.jsxs("div",{className:"text-amber-700",children:[s.jsxs("code",{className:"bg-amber-100 px-2 py-1 rounded text-xs",children:["EVM: ",d.original," â†’ IC: ",d.ic]}),s.jsx("div",{className:"text-xs text-amber-600 mt-1",children:"âš ï¸ Token ID changed"})]}):d.isPending?s.jsxs("div",{className:"text-blue-700",children:[s.jsxs("code",{className:"bg-blue-100 px-2 py-1 rounded text-xs",children:["Token ID: ",d.original]}),s.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"â³ Mint pending..."})]}):s.jsxs("div",{children:[s.jsxs("code",{className:"bg-green-100 px-2 py-1 rounded text-xs",children:["Token ID: ",d.original]}),s.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["ID preserved âœ“",d.txId?` (Tx: ${d.txId})`:""]})]})})]})},m))}):s.jsx("div",{className:"text-green-700",children:c[0].hasMismatch?s.jsxs("div",{className:"text-amber-700",children:[s.jsxs("code",{className:"bg-amber-100 px-2 py-1 rounded text-xs",children:["EVM: ",c[0].original," â†’ IC: ",c[0].ic]}),s.jsx("div",{className:"text-xs text-amber-600 mt-1",children:"âš ï¸ Token ID was changed during minting"})]}):c[0].isPending?s.jsxs("div",{className:"text-blue-700",children:[s.jsxs("code",{className:"bg-blue-100 px-2 py-1 rounded text-xs",children:["Token ID: ",c[0].original]}),s.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"â³ Mint still pending..."})]}):s.jsxs("div",{children:[s.jsxs("code",{className:"bg-green-100 px-2 py-1 rounded text-xs",children:["Token ID: ",c[0].original]}),s.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["Token ID preserved correctly âœ“",c[0].txId?` (Tx: ${c[0].txId})`:""]})]})})]}),e.canisterAddress&&s.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-blue-800 mb-1",children:"ckNFT Canister"}),s.jsxs("p",{className:"text-blue-700",children:["ID: ",s.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-xs",children:e.canisterAddress})]})]}),s.jsxs("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded-lg",children:[s.jsxs("p",{className:"font-medium text-purple-800 mb-1",children:["Cross-Chain Token ID",o?"s":""]}),s.jsx("div",{className:"text-xs text-purple-600 mb-2",children:"NFT token IDs should remain the same on both EVM and IC networks"}),o?s.jsx("div",{className:"space-y-1",children:r.map((d,m)=>s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"text-purple-700",children:["Original EVM ID ",m+1,":"]}),s.jsx("code",{className:"bg-purple-100 px-2 py-1 rounded text-xs",children:d})]},m))}):s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-purple-700",children:"Original EVM ID:"}),s.jsx("code",{className:"bg-purple-100 px-2 py-1 rounded text-xs",children:r[0]})]})]}),e.evmTransactionHash&&s.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-gray-800 mb-1",children:"EVM Transaction"}),s.jsxs("p",{className:"text-gray-700",children:["Hash: ",s.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-xs",children:e.evmTransactionHash})]})]})]}),s.jsxs("div",{className:"flex justify-center space-x-4",children:[s.jsx("button",{onClick:t,className:"px-6 py-2 text-blue-600 border border-blue-600 rounded-md hover:bg-blue-50 transition-colors",children:"Import More NFTs"}),s.jsx("button",{onClick:n,className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"Close"})]})]})}function ef(e){const[t,n]=x.useState({isSupported:!1,isLoading:!1});return x.useEffect(()=>{if(console.log("ðŸŽ¯ useICRC99Support effect triggered with canisterId:",e),!e){console.log("âŒ No canisterId provided, returning unsupported"),n({isSupported:!1,isLoading:!1});return}let r=!1;return(async()=>{console.log("ðŸš€ Starting ICRC-99 support check for:",e),n(o=>({...o,isLoading:!0}));try{console.log("ðŸ” Checking ICRC-99 support for NFT canister:",e);const o=qe.fromText(e),{HttpAgent:i,Actor:c}=await Xe(async()=>{const{HttpAgent:g,Actor:N}=await Promise.resolve().then(()=>Bt);return{HttpAgent:g,Actor:N}},void 0),l=new i({host:"https://icp0.io"}),d=await c.createActor(({IDL:g})=>{const N=g.Vec(g.Tuple(g.Text,g.Reserved)),h=g.Variant({IC:g.Opt(g.Text),Ethereum:g.Opt(g.Nat),Solana:g.Opt(g.Nat),Bitcoin:g.Opt(g.Text),Other:N}),C=g.Record({contract:g.Text,network:h});return g.Service({icrc99_native_chain:g.Func([],[C],["query"])})},{agent:l,canisterId:o}).icrc99_native_chain();console.log("âœ… ICRC-99 support detected. Native chain result:",d);const m=d.network;let f;"IC"in m?f={IC:m.IC}:"Ethereum"in m?m.Ethereum.length>0?f={Ethereum:[BigInt(m.Ethereum[0])]}:f={Ethereum:[]}:"Solana"in m?m.Solana.length>0?f={Solana:[m.Solana[0]]}:f={Solana:[]}:"Bitcoin"in m?f={Bitcoin:m.Bitcoin}:f={IC:[]},console.log("ðŸ”„ Transformed network for ContractPointer:",f),r||n({isSupported:!0,nativeChain:{network:f,contract:d.contract},isLoading:!1})}catch(o){console.log("âš ï¸ ICRC-99 not supported or call failed:",o),r||n({isSupported:!1,nativeChain:{network:{IC:[]},contract:e},isLoading:!1})}})(),()=>{r=!0}},[e]),t}function DN(e,t,n){const[r,a]=x.useState([]),[o,i]=x.useState(!0),[c,l]=x.useState(null),u=rd(),d=x.useMemo(()=>n,[n==null?void 0:n.override,n==null?void 0:n.queryArgs]);return x.useEffect(()=>{if(!e||e==="aaaaa-aa"||e.length<5||!t||!t.owner||t.owner==="aaaaa-aa"){a([]),i(!1),l(null);return}let m=!1;async function f(){if(i(!0),l(null),d!=null&&d.override){try{const g=await d.override(e,t,d.queryArgs);m||a(g)}catch(g){m||l(g)}finally{m||i(!1)}return}try{const g=ea.createActor(Op,{agent:u,canisterId:e});let N,h=[],C=50,w=[];for(;h=(await g.icrc7_tokens_of({owner:qe.fromText(t.owner),subaccount:t.subaccount?[t.subaccount]:[]},N!==void 0?[N]:[],[BigInt(C)])||[]).map(j=>BigInt(j)),!(h.length===0||(w.push(...h),h.length<C));)N=h[h.length-1];m||a(w)}catch(g){m||l(g)}finally{m||i(!1)}}return f(),()=>{m=!0}},[e,t==null?void 0:t.owner,t==null?void 0:t.subaccount,d,u]),{tokenIds:r,loading:o,error:c}}function ew(e){try{const t=BigInt(e);return YN(t)}catch{return null}}function tw({canisterId:e,tokenId:t,onMetadataLoaded:n}){const{metadata:r,loading:a,error:o}=Mp(e,t);return x.useEffect(()=>{if(r&&!a&&!o){console.log("ðŸ” Processing metadata for token",t,"metadata:",r);const i={tokenId:t.toString(),canisterId:e,metadata:r,name:r.parsedMetadata.icrc97.name||`NFT #${t}`,description:r.parsedMetadata.icrc97.description||void 0,image:r.parsedMetadata.icrc97.image||void 0,attributes:r.parsedMetadata.icrc97.attributes||[]};console.log("ðŸŽ¯ Converted NFT object:",i),n(i)}},[r,a,o,t,e,n]),null}function Gc({sourceCanisterId:e,selectedNFTs:t,onSelectionChange:n,userPrincipal:r,onCanisterChange:a,targetChain:o="evm"}){const[i,c]=x.useState(!1),[l,u]=x.useState(null),[d,m]=x.useState([]),[f,g]=x.useState(0),[N,h]=x.useState(""),[C,w]=x.useState(e||""),[B,j]=x.useState(e||""),[Q,F]=x.useState(null),_=x.useCallback(()=>{switch(o){case"solana":return"Solana";case"ic":return"IC";case"evm":default:return"EVM"}},[o]),M=x.useCallback(()=>{switch(o){case"solana":return"return";case"ic":return"return";case"evm":default:return"export"}},[o]),k=x.useCallback(S=>{if(!S.trim())return F("Canister ID is required"),!1;try{return qe.fromText(S.trim()),F(null),j(S.trim()),u(null),a==null||a(S.trim()),!0}catch{return F("Invalid canister ID format"),!1}},[a]),K=x.useCallback(S=>{w(S),F(null)},[]),V=x.useCallback(()=>{k(C)&&(m([]),g(0))},[C,k]),T=x.useMemo(()=>r?{owner:r.toString(),subaccount:void 0}:null,[r]),ee=B&&B!==""&&B!=="aaaaa-aa"&&T,J=x.useCallback(async()=>[],[]),pe=x.useMemo(()=>({override:ee?void 0:J}),[ee,J]),{tokenIds:E,loading:b,error:Y}=DN(ee?B:"aaaaa-aa",ee?T:{owner:"aaaaa-aa",subaccount:void 0},pe);x.useEffect(()=>{if(Y){u(Y.message||"Failed to fetch owned tokens"),c(!1);return}if(!b&&E.length===0){m([]),c(!1),g(0);return}!b&&E.length>0&&(c(!0),u(null),m([]),g(0))},[E,b,Y]);const p=x.useCallback(S=>{console.log("ðŸ“¥ handleMetadataLoaded called with:",S),m(H=>{if(H.some(W=>W.tokenId===S.tokenId&&W.canisterId===S.canisterId))return console.log("âš ï¸ NFT already exists in list, skipping"),H;const $=[...H,S].sort((W,le)=>parseInt(W.tokenId)-parseInt(le.tokenId));return console.log("âœ… Updated ownedNFTs array:",$),$}),g(H=>{const he=H+1;return console.log(`ðŸ“Š Fetched count: ${he}/${E.length}`),he>=E.length&&(console.log("ðŸ All metadata fetched, stopping loading"),c(!1)),he})},[E.length]);x.useEffect(()=>{c(b||E.length>0&&f<E.length)},[b,E.length,f]);const O=x.useMemo(()=>{if(!N)return d;const S=N.toLowerCase();return d.filter(H=>{var he,$,W;return((he=H.name)==null?void 0:he.toLowerCase().includes(S))||(($=H.description)==null?void 0:$.toLowerCase().includes(S))||H.tokenId.includes(S)||((W=H.attributes)==null?void 0:W.some(le=>le.trait_type.toLowerCase().includes(S)||le.value.toLowerCase().includes(S)))})},[d,N]),R=S=>t.some(H=>H.tokenId===S.tokenId&&H.canisterId===S.canisterId),q=S=>{const H={tokenId:S.tokenId,canisterId:S.canisterId,metadata:S.metadata||void 0,owner:r,image:S.image,name:S.name,description:S.description};R(S)?n(t.filter(he=>!(he.tokenId===S.tokenId&&he.canisterId===S.canisterId))):n([...t,H])},v=()=>{const S=O.filter(H=>!R(H)).map(H=>({tokenId:H.tokenId,canisterId:H.canisterId,metadata:H.metadata||void 0,owner:r,image:H.image,name:H.name,description:H.description}));n([...t,...S])},U=()=>{n([])};return r?s.jsxs("div",{className:"space-y-6",children:[!b&&E.length>0&&B&&s.jsx(s.Fragment,{children:E.map(S=>s.jsx(tw,{canisterId:B,tokenId:S,onMetadataLoaded:p},`${B}-${S}`))}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select NFTs to Export"}),s.jsx("p",{className:"text-gray-600",children:"Choose the ckNFTs you want to export back to EVM blockchain. Enter the canister ID of the NFT collection you want to check."})]}),s.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"canister-id",className:"block text-sm font-medium text-gray-700 mb-2",children:"NFT Collection Canister ID"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("input",{id:"canister-id",type:"text",value:C,onChange:S=>K(S.target.value),placeholder:"e.g., umunu-kh777-77774-qaaca-cai",className:be("w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",Q?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300")}),Q&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:Q})]}),s.jsx("button",{onClick:V,disabled:!C.trim()||i,className:be("px-6 py-2 text-sm font-medium rounded-md transition-colors",!C.trim()||i?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:i?"Loading...":"Load NFTs"})]})]}),B&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx("span",{children:"Currently viewing:"}),s.jsx("code",{className:"px-2 py-1 bg-gray-200 rounded text-xs font-mono",children:B}),s.jsx("button",{onClick:()=>{j(""),m([]),u(null)},className:"text-blue-600 hover:text-blue-700 ml-2",children:"Change Collection"})]})]})}),b&&B&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Qe,{className:"w-8 h-8 text-blue-600 animate-spin mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading Your NFTs"}),s.jsxs("p",{className:"text-gray-600",children:["Fetching your ckNFTs from ",B,"..."]})]}),l&&B&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(lt,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading NFTs"}),s.jsx("p",{className:"text-gray-600 mb-4",children:l}),s.jsxs("div",{className:"space-x-2",children:[s.jsx("button",{onClick:V,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Retry"}),s.jsx("button",{onClick:()=>{j(""),u(null)},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Try Different Collection"})]})]}),!i&&!b&&B&&E.length===0&&!l&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Zo,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No NFTs Found"}),s.jsxs("p",{className:"text-gray-600",children:["No ckNFTs found in canister ",B]}),s.jsx("button",{onClick:()=>{j(""),w("")},className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Try Different Collection"})]}),!b&&B&&E.length>0&&!l&&s.jsxs(s.Fragment,{children:[(i||f<E.length)&&s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-5 h-5 text-blue-600 animate-spin mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-blue-800",children:"Loading NFT metadata..."}),s.jsxs("p",{className:"text-sm text-blue-600",children:[f," of ",E.length," NFTs loaded"]})]})]}),s.jsx("div",{className:"text-right",children:s.jsx("div",{className:"w-32 bg-blue-200 rounded-full h-2",children:s.jsx("div",{className:"h-2 bg-blue-600 rounded-full transition-all duration-300",style:{width:`${f/E.length*100}%`}})})})]})}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsx("input",{type:"text",placeholder:"Search NFTs by name, description, or attributes...",value:N,onChange:S=>h(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:v,disabled:O.every(S=>R(S)),className:"px-4 py-2 text-sm font-medium text-blue-600 border border-blue-600 rounded-md hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Select All"}),s.jsx("button",{onClick:U,disabled:t.length===0,className:"px-4 py-2 text-sm font-medium text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Clear All"})]})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium text-blue-800",children:[t.length," NFT",t.length!==1?"s":""," selected"]}),s.jsxs("p",{className:"text-sm text-blue-600",children:[O.length," NFT",O.length!==1?"s":""," available"]})]}),t.length>0&&s.jsx("div",{className:"text-right",children:s.jsxs("p",{className:"text-sm text-blue-600",children:["Ready for ",M()," to ",_()]})})]})}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:O.map(S=>s.jsx(sw,{nft:S,selected:R(S),onToggle:()=>q(S),operationLabel:M()},`${S.canisterId}-${S.tokenId}`))}),O.length===0&&N&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Zo,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),s.jsx("p",{className:"text-gray-600",children:"No NFTs match your search criteria"}),s.jsx("button",{onClick:()=>h(""),className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"Clear search"})]})]})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(lt,{className:"w-12 h-12 text-yellow-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Connect Your Identity"}),s.jsx("p",{className:"text-gray-600",children:"Please connect your Internet Identity to view and select your ckNFTs for export."})]})}function sw({nft:e,selected:t,onToggle:n,operationLabel:r}){const[a,o]=x.useState(!1);return s.jsx("div",{className:"relative",children:s.jsxs("button",{onClick:n,className:be("w-full p-3 border rounded-lg text-left transition-all cursor-pointer",t?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300"),children:[e.image&&!a?s.jsx("img",{src:e.image,alt:e.name||`NFT #${e.tokenId}`,className:"w-full h-32 object-cover rounded-md mb-2",onError:()=>o(!0)}):s.jsx("div",{className:"w-full h-32 bg-gray-100 rounded-md mb-2 flex items-center justify-center",children:s.jsx(Zo,{className:"w-8 h-8 text-gray-400"})}),s.jsx("p",{className:"font-medium text-sm truncate",children:e.name||`NFT #${e.tokenId}`}),(()=>{const i=ew(e.tokenId);return i?s.jsxs("p",{className:"text-xs text-gray-600 font-mono truncate",title:i,children:[i.slice(0,4),"...",i.slice(-4)]}):s.jsxs("p",{className:"text-xs text-gray-600",children:["#",e.tokenId]})})(),e.description&&s.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:e.description}),e.attributes&&e.attributes.length>0&&s.jsxs("div",{className:"mt-2 space-y-1",children:[e.attributes.slice(0,2).map((i,c)=>s.jsxs("div",{className:"flex justify-between text-xs",children:[s.jsx("span",{className:"text-gray-500 truncate",children:i.trait_type}),s.jsx("span",{className:"text-gray-700 font-medium truncate ml-1",children:i.value})]},c)),e.attributes.length>2&&s.jsxs("p",{className:"text-xs text-gray-500",children:["+",e.attributes.length-2," more"]})]}),t&&s.jsxs("div",{className:"mt-2 text-xs font-medium text-blue-600",children:["âœ“ Selected for ",r]})]})})}const tf="hh-sol-artifact-1",sf="ICRC99NFT",nf="contracts/ICRC99NFT.sol",rf=[{inputs:[{internalType:"string",name:"_name",type:"string"},{internalType:"string",name:"_symbol",type:"string"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"address",name:"owner",type:"address"}],name:"ERC721IncorrectOwner",type:"error"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ERC721InsufficientApproval",type:"error"},{inputs:[{internalType:"address",name:"approver",type:"address"}],name:"ERC721InvalidApprover",type:"error"},{inputs:[{internalType:"address",name:"operator",type:"address"}],name:"ERC721InvalidOperator",type:"error"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"ERC721InvalidOwner",type:"error"},{inputs:[{internalType:"address",name:"receiver",type:"address"}],name:"ERC721InvalidReceiver",type:"error"},{inputs:[{internalType:"address",name:"sender",type:"address"}],name:"ERC721InvalidSender",type:"error"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ERC721NonexistentToken",type:"error"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"OwnableInvalidOwner",type:"error"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"OwnableUnauthorizedAccount",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_fromTokenId",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_toTokenId",type:"uint256"}],name:"BatchMetadataUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_tokenId",type:"uint256"}],name:"MetadataUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"string",name:"uri",type:"string"}],name:"mint_icrc99",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"}],af="0x60806040523480156200001157600080fd5b50604051620017e8380380620017e88339810160408190526200003491620001b1565b3382826000620000458382620002aa565b506001620000548282620002aa565b5050506001600160a01b0381166200008657604051631e4fbdf760e01b81526000600482015260240160405180910390fd5b62000091816200009a565b50505062000376565b600780546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b634e487b7160e01b600052604160045260246000fd5b600082601f8301126200011457600080fd5b81516001600160401b0380821115620001315762000131620000ec565b604051601f8301601f19908116603f011681019082821181831017156200015c576200015c620000ec565b816040528381526020925086838588010111156200017957600080fd5b600091505b838210156200019d57858201830151818301840152908201906200017e565b600093810190920192909252949350505050565b60008060408385031215620001c557600080fd5b82516001600160401b0380821115620001dd57600080fd5b620001eb8683870162000102565b935060208501519150808211156200020257600080fd5b50620002118582860162000102565b9150509250929050565b600181811c908216806200023057607f821691505b6020821081036200025157634e487b7160e01b600052602260045260246000fd5b50919050565b601f821115620002a557600081815260208120601f850160051c81016020861015620002805750805b601f850160051c820191505b81811015620002a1578281556001016200028c565b5050505b505050565b81516001600160401b03811115620002c657620002c6620000ec565b620002de81620002d784546200021b565b8462000257565b602080601f831160018114620003165760008415620002fd5750858301515b600019600386901b1c1916600185901b178555620002a1565b600085815260208120601f198616915b82811015620003475788860151825594840194600190910190840162000326565b5085821015620003665787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b61146280620003866000396000f3fe608060405234801561001057600080fd5b506004361061010b5760003560e01c806370a08231116100a2578063a22cb46511610071578063a22cb4651461021b578063b88d4fde1461022e578063c87b56dd14610241578063e985e9c514610254578063f2fde38b1461026757600080fd5b806370a08231146101e7578063715018a6146101fa5780638da5cb5b1461020257806395d89b411461021357600080fd5b8063095ea7b3116100de578063095ea7b31461019957806323b872dd146101ae57806342842e0e146101c15780636352211e146101d457600080fd5b806301ffc9a71461011057806302684a5c1461013857806306fdde0314610159578063081812fc1461016e575b600080fd5b61012361011e366004610f4b565b61027a565b60405190151581526020015b60405180910390f35b61014b610146366004611010565b6102a5565b60405190815260200161012f565b610161610323565b60405161012f91906110cb565b61018161017c3660046110de565b6103b5565b6040516001600160a01b03909116815260200161012f565b6101ac6101a73660046110f7565b6103de565b005b6101ac6101bc366004611121565b6103ed565b6101ac6101cf366004611121565b610478565b6101816101e23660046110de565b610498565b61014b6101f536600461115d565b6104a3565b6101ac6104eb565b6007546001600160a01b0316610181565b6101616104ff565b6101ac610229366004611178565b61050e565b6101ac61023c3660046111b4565b610519565b61016161024f3660046110de565b610531565b610123610262366004611230565b610642565b6101ac61027536600461115d565b610670565b60006001600160e01b03198216632483248360e11b148061029f575061029f826106ae565b92915050565b6007546000906001600160a01b031633146103075760405162461bcd60e51b815260206004820152601f60248201527f4552433732313a204f6e6c7920746865206f776e65722063616e206d696e740060448201526064015b60405180910390fd5b61031183856106fe565b61031b8483610718565b509192915050565b60606000805461033290611263565b80601f016020809104026020016040519081016040528092919081815260200182805461035e90611263565b80156103ab5780601f10610380576101008083540402835291602001916103ab565b820191906000526020600020905b81548152906001019060200180831161038e57829003601f168201915b5050505050905090565b60006103c082610768565b506000828152600460205260409020546001600160a01b031661029f565b6103e98282336107a1565b5050565b6001600160a01b03821661041757604051633250574960e11b8152600060048201526024016102fe565b60006104248383336107ae565b9050836001600160a01b0316816001600160a01b031614610472576040516364283d7b60e01b81526001600160a01b03808616600483015260248201849052821660448201526064016102fe565b50505050565b61049383838360405180602001604052806000815250610519565b505050565b600061029f82610768565b60006001600160a01b0382166104cf576040516322718ad960e21b8152600060048201526024016102fe565b506001600160a01b031660009081526003602052604090205490565b6104f36108a7565b6104fd60006108d4565b565b60606001805461033290611263565b6103e9338383610926565b6105248484846103ed565b61047233858585856109c5565b606061053c82610768565b506000828152600660205260408120805461055690611263565b80601f016020809104026020016040519081016040528092919081815260200182805461058290611263565b80156105cf5780601f106105a4576101008083540402835291602001916105cf565b820191906000526020600020905b8154815290600101906020018083116105b257829003601f168201915b5050505050905060006105ed60408051602081019091526000815290565b905080516000036105ff575092915050565b81511561063157808260405160200161061992919061129d565b60405160208183030381529060405292505050919050565b61063a84610af0565b949350505050565b6001600160a01b03918216600090815260056020908152604080832093909416825291909152205460ff1690565b6106786108a7565b6001600160a01b0381166106a257604051631e4fbdf760e01b8152600060048201526024016102fe565b6106ab816108d4565b50565b60006001600160e01b031982166380ac58cd60e01b14806106df57506001600160e01b03198216635b5e139f60e01b145b8061029f57506301ffc9a760e01b6001600160e01b031983161461029f565b6103e9828260405180602001604052806000815250610b65565b60008281526006602052604090206107308282611312565b506040518281527ff8e1a15aba9398e019f0b49df1a4fde98ee17ae345cb5f6b5e2c27f5033e8ce79060200160405180910390a15050565b6000818152600260205260408120546001600160a01b03168061029f57604051637e27328960e01b8152600481018490526024016102fe565b6104938383836001610b7d565b6000828152600260205260408120546001600160a01b03908116908316156107db576107db818486610c83565b6001600160a01b03811615610819576107f8600085600080610b7d565b6001600160a01b038116600090815260036020526040902080546000190190555b6001600160a01b03851615610848576001600160a01b0385166000908152600360205260409020805460010190555b60008481526002602052604080822080546001600160a01b0319166001600160a01b0389811691821790925591518793918516917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef91a4949350505050565b6007546001600160a01b031633146104fd5760405163118cdaa760e01b81523360048201526024016102fe565b600780546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b6001600160a01b03821661095857604051630b61174360e31b81526001600160a01b03831660048201526024016102fe565b6001600160a01b03838116600081815260056020908152604080832094871680845294825291829020805460ff191686151590811790915591519182527f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31910160405180910390a3505050565b6001600160a01b0383163b15610ae957604051630a85bd0160e11b81526001600160a01b0384169063150b7a0290610a079088908890879087906004016113d2565b6020604051808303816000875af1925050508015610a42575060408051601f3d908101601f19168201909252610a3f9181019061140f565b60015b610aab573d808015610a70576040519150601f19603f3d011682016040523d82523d6000602084013e610a75565b606091505b508051600003610aa357604051633250574960e11b81526001600160a01b03851660048201526024016102fe565b805181602001fd5b6001600160e01b03198116630a85bd0160e11b14610ae757604051633250574960e11b81526001600160a01b03851660048201526024016102fe565b505b5050505050565b6060610afb82610768565b506000610b1360408051602081019091526000815290565b90506000815111610b335760405180602001604052806000815250610b5e565b80610b3d84610ce7565b604051602001610b4e92919061129d565b6040516020818303038152906040525b9392505050565b610b6f8383610d7a565b6104933360008585856109c5565b8080610b9157506001600160a01b03821615155b15610c53576000610ba184610768565b90506001600160a01b03831615801590610bcd5750826001600160a01b0316816001600160a01b031614155b8015610be05750610bde8184610642565b155b15610c095760405163a9fbf51f60e01b81526001600160a01b03841660048201526024016102fe565b8115610c515783856001600160a01b0316826001600160a01b03167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45b505b5050600090815260046020526040902080546001600160a01b0319166001600160a01b0392909216919091179055565b610c8e838383610dfa565b610493576001600160a01b038316610cbc57604051637e27328960e01b8152600481018290526024016102fe565b60405163177e802f60e01b81526001600160a01b0383166004820152602481018290526044016102fe565b60606000610cf483610e5d565b600101905060008167ffffffffffffffff811115610d1457610d14610f84565b6040519080825280601f01601f191660200182016040528015610d3e576020820181803683370190505b5090508181016020015b600019016f181899199a1a9b1b9c1cb0b131b232b360811b600a86061a8153600a8504945084610d4857509392505050565b6001600160a01b038216610da457604051633250574960e11b8152600060048201526024016102fe565b6000610db2838360006107ae565b9050610dc66007546001600160a01b031690565b6001600160a01b0316336001600160a01b031614610493576040516339e3563760e11b8152600060048201526024016102fe565b60006001600160a01b0383161580159061063a5750826001600160a01b0316846001600160a01b03161480610e345750610e348484610642565b8061063a5750506000908152600460205260409020546001600160a01b03908116911614919050565b60008072184f03e93ff9f4daa797ed6e38ed64bf6a1f0160401b8310610e9c5772184f03e93ff9f4daa797ed6e38ed64bf6a1f0160401b830492506040015b6d04ee2d6d415b85acef81000000008310610ec8576d04ee2d6d415b85acef8100000000830492506020015b662386f26fc100008310610ee657662386f26fc10000830492506010015b6305f5e1008310610efe576305f5e100830492506008015b6127108310610f1257612710830492506004015b60648310610f24576064830492506002015b600a831061029f5760010192915050565b6001600160e01b0319811681146106ab57600080fd5b600060208284031215610f5d57600080fd5b8135610b5e81610f35565b80356001600160a01b0381168114610f7f57600080fd5b919050565b634e487b7160e01b600052604160045260246000fd5b600067ffffffffffffffff80841115610fb557610fb5610f84565b604051601f8501601f19908116603f01168101908282118183101715610fdd57610fdd610f84565b81604052809350858152868686011115610ff657600080fd5b858560208301376000602087830101525050509392505050565b60008060006060848603121561102557600080fd5b8335925061103560208501610f68565b9150604084013567ffffffffffffffff81111561105157600080fd5b8401601f8101861361106257600080fd5b61107186823560208401610f9a565b9150509250925092565b60005b8381101561109657818101518382015260200161107e565b50506000910152565b600081518084526110b781602086016020860161107b565b601f01601f19169290920160200192915050565b602081526000610b5e602083018461109f565b6000602082840312156110f057600080fd5b5035919050565b6000806040838503121561110a57600080fd5b61111383610f68565b946020939093013593505050565b60008060006060848603121561113657600080fd5b61113f84610f68565b925061114d60208501610f68565b9150604084013590509250925092565b60006020828403121561116f57600080fd5b610b5e82610f68565b6000806040838503121561118b57600080fd5b61119483610f68565b9150602083013580151581146111a957600080fd5b809150509250929050565b600080600080608085870312156111ca57600080fd5b6111d385610f68565b93506111e160208601610f68565b925060408501359150606085013567ffffffffffffffff81111561120457600080fd5b8501601f8101871361121557600080fd5b61122487823560208401610f9a565b91505092959194509250565b6000806040838503121561124357600080fd5b61124c83610f68565b915061125a60208401610f68565b90509250929050565b600181811c9082168061127757607f821691505b60208210810361129757634e487b7160e01b600052602260045260246000fd5b50919050565b600083516112af81846020880161107b565b8351908301906112c381836020880161107b565b01949350505050565b601f82111561049357600081815260208120601f850160051c810160208610156112f35750805b601f850160051c820191505b81811015610ae7578281556001016112ff565b815167ffffffffffffffff81111561132c5761132c610f84565b6113408161133a8454611263565b846112cc565b602080601f831160018114611375576000841561135d5750858301515b600019600386901b1c1916600185901b178555610ae7565b600085815260208120601f198616915b828110156113a457888601518255948401946001909101908401611385565b50858210156113c25787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b6001600160a01b03858116825284166020820152604081018390526080606082018190526000906114059083018461109f565b9695505050505050565b60006020828403121561142157600080fd5b8151610b5e81610f3556fea26469706673582212204fd0531b660445db96370b9af98b9cc3ac755c841de1ce0759cd1fa6549dc54364736f6c63430008140033",of="0x608060405234801561001057600080fd5b506004361061010b5760003560e01c806370a08231116100a2578063a22cb46511610071578063a22cb4651461021b578063b88d4fde1461022e578063c87b56dd14610241578063e985e9c514610254578063f2fde38b1461026757600080fd5b806370a08231146101e7578063715018a6146101fa5780638da5cb5b1461020257806395d89b411461021357600080fd5b8063095ea7b3116100de578063095ea7b31461019957806323b872dd146101ae57806342842e0e146101c15780636352211e146101d457600080fd5b806301ffc9a71461011057806302684a5c1461013857806306fdde0314610159578063081812fc1461016e575b600080fd5b61012361011e366004610f4b565b61027a565b60405190151581526020015b60405180910390f35b61014b610146366004611010565b6102a5565b60405190815260200161012f565b610161610323565b60405161012f91906110cb565b61018161017c3660046110de565b6103b5565b6040516001600160a01b03909116815260200161012f565b6101ac6101a73660046110f7565b6103de565b005b6101ac6101bc366004611121565b6103ed565b6101ac6101cf366004611121565b610478565b6101816101e23660046110de565b610498565b61014b6101f536600461115d565b6104a3565b6101ac6104eb565b6007546001600160a01b0316610181565b6101616104ff565b6101ac610229366004611178565b61050e565b6101ac61023c3660046111b4565b610519565b61016161024f3660046110de565b610531565b610123610262366004611230565b610642565b6101ac61027536600461115d565b610670565b60006001600160e01b03198216632483248360e11b148061029f575061029f826106ae565b92915050565b6007546000906001600160a01b031633146103075760405162461bcd60e51b815260206004820152601f60248201527f4552433732313a204f6e6c7920746865206f776e65722063616e206d696e740060448201526064015b60405180910390fd5b61031183856106fe565b61031b8483610718565b509192915050565b60606000805461033290611263565b80601f016020809104026020016040519081016040528092919081815260200182805461035e90611263565b80156103ab5780601f10610380576101008083540402835291602001916103ab565b820191906000526020600020905b81548152906001019060200180831161038e57829003601f168201915b5050505050905090565b60006103c082610768565b506000828152600460205260409020546001600160a01b031661029f565b6103e98282336107a1565b5050565b6001600160a01b03821661041757604051633250574960e11b8152600060048201526024016102fe565b60006104248383336107ae565b9050836001600160a01b0316816001600160a01b031614610472576040516364283d7b60e01b81526001600160a01b03808616600483015260248201849052821660448201526064016102fe565b50505050565b61049383838360405180602001604052806000815250610519565b505050565b600061029f82610768565b60006001600160a01b0382166104cf576040516322718ad960e21b8152600060048201526024016102fe565b506001600160a01b031660009081526003602052604090205490565b6104f36108a7565b6104fd60006108d4565b565b60606001805461033290611263565b6103e9338383610926565b6105248484846103ed565b61047233858585856109c5565b606061053c82610768565b506000828152600660205260408120805461055690611263565b80601f016020809104026020016040519081016040528092919081815260200182805461058290611263565b80156105cf5780601f106105a4576101008083540402835291602001916105cf565b820191906000526020600020905b8154815290600101906020018083116105b257829003601f168201915b5050505050905060006105ed60408051602081019091526000815290565b905080516000036105ff575092915050565b81511561063157808260405160200161061992919061129d565b60405160208183030381529060405292505050919050565b61063a84610af0565b949350505050565b6001600160a01b03918216600090815260056020908152604080832093909416825291909152205460ff1690565b6106786108a7565b6001600160a01b0381166106a257604051631e4fbdf760e01b8152600060048201526024016102fe565b6106ab816108d4565b50565b60006001600160e01b031982166380ac58cd60e01b14806106df57506001600160e01b03198216635b5e139f60e01b145b8061029f57506301ffc9a760e01b6001600160e01b031983161461029f565b6103e9828260405180602001604052806000815250610b65565b60008281526006602052604090206107308282611312565b506040518281527ff8e1a15aba9398e019f0b49df1a4fde98ee17ae345cb5f6b5e2c27f5033e8ce79060200160405180910390a15050565b6000818152600260205260408120546001600160a01b03168061029f57604051637e27328960e01b8152600481018490526024016102fe565b6104938383836001610b7d565b6000828152600260205260408120546001600160a01b03908116908316156107db576107db818486610c83565b6001600160a01b03811615610819576107f8600085600080610b7d565b6001600160a01b038116600090815260036020526040902080546000190190555b6001600160a01b03851615610848576001600160a01b0385166000908152600360205260409020805460010190555b60008481526002602052604080822080546001600160a01b0319166001600160a01b0389811691821790925591518793918516917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef91a4949350505050565b6007546001600160a01b031633146104fd5760405163118cdaa760e01b81523360048201526024016102fe565b600780546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b6001600160a01b03821661095857604051630b61174360e31b81526001600160a01b03831660048201526024016102fe565b6001600160a01b03838116600081815260056020908152604080832094871680845294825291829020805460ff191686151590811790915591519182527f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31910160405180910390a3505050565b6001600160a01b0383163b15610ae957604051630a85bd0160e11b81526001600160a01b0384169063150b7a0290610a079088908890879087906004016113d2565b6020604051808303816000875af1925050508015610a42575060408051601f3d908101601f19168201909252610a3f9181019061140f565b60015b610aab573d808015610a70576040519150601f19603f3d011682016040523d82523d6000602084013e610a75565b606091505b508051600003610aa357604051633250574960e11b81526001600160a01b03851660048201526024016102fe565b805181602001fd5b6001600160e01b03198116630a85bd0160e11b14610ae757604051633250574960e11b81526001600160a01b03851660048201526024016102fe565b505b5050505050565b6060610afb82610768565b506000610b1360408051602081019091526000815290565b90506000815111610b335760405180602001604052806000815250610b5e565b80610b3d84610ce7565b604051602001610b4e92919061129d565b6040516020818303038152906040525b9392505050565b610b6f8383610d7a565b6104933360008585856109c5565b8080610b9157506001600160a01b03821615155b15610c53576000610ba184610768565b90506001600160a01b03831615801590610bcd5750826001600160a01b0316816001600160a01b031614155b8015610be05750610bde8184610642565b155b15610c095760405163a9fbf51f60e01b81526001600160a01b03841660048201526024016102fe565b8115610c515783856001600160a01b0316826001600160a01b03167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45b505b5050600090815260046020526040902080546001600160a01b0319166001600160a01b0392909216919091179055565b610c8e838383610dfa565b610493576001600160a01b038316610cbc57604051637e27328960e01b8152600481018290526024016102fe565b60405163177e802f60e01b81526001600160a01b0383166004820152602481018290526044016102fe565b60606000610cf483610e5d565b600101905060008167ffffffffffffffff811115610d1457610d14610f84565b6040519080825280601f01601f191660200182016040528015610d3e576020820181803683370190505b5090508181016020015b600019016f181899199a1a9b1b9c1cb0b131b232b360811b600a86061a8153600a8504945084610d4857509392505050565b6001600160a01b038216610da457604051633250574960e11b8152600060048201526024016102fe565b6000610db2838360006107ae565b9050610dc66007546001600160a01b031690565b6001600160a01b0316336001600160a01b031614610493576040516339e3563760e11b8152600060048201526024016102fe565b60006001600160a01b0383161580159061063a5750826001600160a01b0316846001600160a01b03161480610e345750610e348484610642565b8061063a5750506000908152600460205260409020546001600160a01b03908116911614919050565b60008072184f03e93ff9f4daa797ed6e38ed64bf6a1f0160401b8310610e9c5772184f03e93ff9f4daa797ed6e38ed64bf6a1f0160401b830492506040015b6d04ee2d6d415b85acef81000000008310610ec8576d04ee2d6d415b85acef8100000000830492506020015b662386f26fc100008310610ee657662386f26fc10000830492506010015b6305f5e1008310610efe576305f5e100830492506008015b6127108310610f1257612710830492506004015b60648310610f24576064830492506002015b600a831061029f5760010192915050565b6001600160e01b0319811681146106ab57600080fd5b600060208284031215610f5d57600080fd5b8135610b5e81610f35565b80356001600160a01b0381168114610f7f57600080fd5b919050565b634e487b7160e01b600052604160045260246000fd5b600067ffffffffffffffff80841115610fb557610fb5610f84565b604051601f8501601f19908116603f01168101908282118183101715610fdd57610fdd610f84565b81604052809350858152868686011115610ff657600080fd5b858560208301376000602087830101525050509392505050565b60008060006060848603121561102557600080fd5b8335925061103560208501610f68565b9150604084013567ffffffffffffffff81111561105157600080fd5b8401601f8101861361106257600080fd5b61107186823560208401610f9a565b9150509250925092565b60005b8381101561109657818101518382015260200161107e565b50506000910152565b600081518084526110b781602086016020860161107b565b601f01601f19169290920160200192915050565b602081526000610b5e602083018461109f565b6000602082840312156110f057600080fd5b5035919050565b6000806040838503121561110a57600080fd5b61111383610f68565b946020939093013593505050565b60008060006060848603121561113657600080fd5b61113f84610f68565b925061114d60208501610f68565b9150604084013590509250925092565b60006020828403121561116f57600080fd5b610b5e82610f68565b6000806040838503121561118b57600080fd5b61119483610f68565b9150602083013580151581146111a957600080fd5b809150509250929050565b600080600080608085870312156111ca57600080fd5b6111d385610f68565b93506111e160208601610f68565b925060408501359150606085013567ffffffffffffffff81111561120457600080fd5b8501601f8101871361121557600080fd5b61122487823560208401610f9a565b91505092959194509250565b6000806040838503121561124357600080fd5b61124c83610f68565b915061125a60208401610f68565b90509250929050565b600181811c9082168061127757607f821691505b60208210810361129757634e487b7160e01b600052602260045260246000fd5b50919050565b600083516112af81846020880161107b565b8351908301906112c381836020880161107b565b01949350505050565b601f82111561049357600081815260208120601f850160051c810160208610156112f35750805b601f850160051c820191505b81811015610ae7578281556001016112ff565b815167ffffffffffffffff81111561132c5761132c610f84565b6113408161133a8454611263565b846112cc565b602080601f831160018114611375576000841561135d5750858301515b600019600386901b1c1916600185901b178555610ae7565b600085815260208120601f198616915b828110156113a457888601518255948401946001909101908401611385565b50858210156113c25787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b6001600160a01b03858116825284166020820152604081018390526080606082018190526000906114059083018461109f565b9695505050505050565b60006020828403121561142157600080fd5b8151610b5e81610f3556fea26469706673582212204fd0531b660445db96370b9af98b9cc3ac755c841de1ce0759cd1fa6549dc54364736f6c63430008140033",Xi={_format:tf,contractName:sf,sourceName:nf,abi:rf,bytecode:af,deployedBytecode:of},nw=Object.freeze(Object.defineProperty({__proto__:null,_format:tf,abi:rf,bytecode:af,contractName:sf,default:Xi,deployedBytecode:of,sourceName:nf},Symbol.toStringTag,{value:"Module"}));var rw={};const aw=()=>({1:{chainId:1,name:"Ethereum Mainnet",rpc:"https://eth.llamarpc.com",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:["https://etherscan.io"]},137:{chainId:137,name:"Polygon",rpc:"https://polygon-rpc.com",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorerUrls:["https://polygonscan.com"]},56:{chainId:56,name:"BSC",rpc:"https://bsc-dataseed.binance.org",nativeCurrency:{name:"BNB",symbol:"BNB",decimals:18},blockExplorerUrls:["https://bscscan.com"]},10:{chainId:10,name:"Optimism",rpc:"https://mainnet.optimism.io",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:["https://optimistic.etherscan.io"]},8453:{chainId:8453,name:"Base",rpc:"https://mainnet.base.org",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:["https://basescan.org"]},42161:{chainId:42161,name:"Arbitrum One",rpc:"https://arb1.arbitrum.io/rpc",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:["https://arbiscan.io"]},31337:{chainId:31337,name:"Hardhat Local",rpc:"http://localhost:8545",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:["http://localhost:8545"]}}),ow=e=>{const n=BigInt(1e12),r=e/n,o=(e%n).toString().padStart(12,"0").slice(0,3);return`${r.toLocaleString()}.${o}`},ul=e=>{const n=BigInt(1e12),r=e/n,o=(e%n).toString().padStart(12,"0").slice(0,3);return`${r.toLocaleString()}.${o} TC`};function iw({selectedNFTs:e,targetChainId:t,remoteContractInfo:n,onRemoteContractInfoChange:r,sourceCanisterId:a,sourceContractPointer:o}){const[i,c]=x.useState(null),[l,u]=x.useState(!1),[d,m]=x.useState(!1),[f,g]=x.useState(null),[N,h]=x.useState(null),[C,w]=x.useState(null),[B,j]=x.useState(null),[Q,F]=x.useState(null),[_,M]=x.useState(null),[k,K]=x.useState(!1),[V,T]=x.useState(!1),[ee,J]=x.useState(!1),[pe,E]=x.useState(null),[b,Y]=x.useState(!1),{activeAddress:p,isUnlocked:O,chainId:R}=an(),{user:q}=ut(),v=rw.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",U=js(v),{useBalance:S,useApprove:H}=U,he=S(q!=null&&q.principal?{owner:q.principal,subaccount:[]}:void 0),$=H(),W=he.data,le=he.isLoading;console.log("ðŸ”„ RemoteContractStep initialized with:",{selectedNFTs:e,targetChainId:t,remoteContractInfo:n,sourceCanisterId:a});const ce="jio3a-xaaaa-aaaal-ab66q-cai",L=rn(ce,vs),ue=od(ce,vs),re=x.useMemo(()=>{if(!t)return null;try{return{Ethereum:[BigInt(t)]}}catch(P){return console.error("Failed to convert targetChainId to BigInt:",t,P),null}},[t]);console.log("ðŸ” Contract check state:",{isCheckingContract:d,existingContract:i,contractCheckComplete:l,unauthenticatedOrchActor:!!L,targetChainId:t,sourceCanisterId:a}),x.useEffect(()=>{const P=async()=>{if(!t||!a||!L||!o||!re){c(null),u(!1);return}if(!d){m(!0),u(!1);try{console.log("ðŸ” Checking for existing ckNFT canister...",{sourceCanisterId:a,targetNetwork:re,sourceContractPointer:o});const z=await L.get_ck_nft_canister([o]);if(console.log("ðŸ” ckNFT canister lookup result:",z),Array.isArray(z)&&z[0]&&z[0][0]){const A=z[0][0];console.log("âœ… Found existing ckNFT canister:",A.toString()),console.log("ðŸ” Now checking for remote contract on target network...");const Z=await L.get_remote([[A,re]]);if(console.log("ðŸ” Remote contract lookup result:",Z),Z&&Z[0]&&Z[0][0]!=null){const de=Z[0][0];console.log("âœ… Found existing remote contract:",de);const te=de.address&&de.address[0],fe={address:te?de.address[0]:`ckNFT-${A.toString().slice(0,8)}...`,network:re,name:`CK-${a.slice(0,5)}...`,symbol:"CKNFT",totalSupply:0,verified:!0,deploymentTx:te?de.address[0]:A.toString()};c(fe),r(te?{address:de.address[0],network:re,deployed:!0}:{network:re,deployed:!1})}else console.log("ðŸ“‹ ckNFT canister exists but no remote contract found - will need to deploy remote contract"),c(null),r({network:re,deployed:!1})}else console.log("ðŸ“‹ No existing ckNFT canister found - will need to deploy new bridge"),c(null),r({network:re,deployed:!1})}catch(z){console.error("âŒ Error checking for existing canister:",z),c(null),r({network:re,deployed:!1})}finally{m(!1),u(!0)}}};!d&&!l&&(console.log("ðŸ”„ Checking for existing contract on target network:",re),P())},[t,a,L,n,d,l,o]),x.useEffect(()=>{if(b||i)return;(async()=>{if(!(!L||!a||!t||d||!l||!o||!re))try{console.log("ðŸ’° Estimating remote contract creation costs (one time only)...",{sourceCanisterId:a,targetChainId:t,sourceContractPointer:o}),Y(!0);const z=await L.get_remote_cost(o,re);g(z),console.log("ðŸ’° Cycles needed for remote contract:",z.toString());const A=await L.get_icrc99_address(qe.fromText(a),re);A&&A[0]&&(j(A[0]),console.log("ðŸ’° Remote funding address:",A[0])),console.log("ðŸ’° Estimating gas using MetaMask provider...");try{const de=aw()[parseInt(t)];if(!de)throw new Error(`Unsupported network: ${t}`);const te=new QN(de.rpc),xe=new lc(Xi.abi).encodeDeploy(["ICDevs.AI NFT","ICDEV"]),oe=`${Xi.bytecode}${xe.slice(2)}`,X=B||ko,ae=await te.estimateGas({data:oe,from:X,value:0}),je=await te.getFeeData(),Ae=je.maxFeePerGas||je.gasPrice||20000000000n;w(ae);const Fe=ae*Ae*120n/100n;h(Fe),console.log("ðŸ’° MetaMask gas estimation complete:",{estimatedGas:ae.toString(),gasPrice:Ae.toString(),totalCost:Fe.toString(),totalCostETH:`${Number(Fe)/1e18} ETH`,network:de.name})}catch(Z){console.warn("MetaMask gas estimation failed, using fallback:",Z);const de=Xi.bytecode.length/2,te=BigInt(Math.max(8e5,de*25)),fe=20000000000n;w(te);const xe=te*fe*120n/100n;h(xe),console.log("ðŸ’° Fallback gas estimation complete:",{estimatedGas:te.toString(),gasPrice:fe.toString(),totalCost:xe.toString(),totalCostETH:`${Number(xe)/1e18} ETH`})}}catch(z){console.error("Error estimating remote contract costs:",z),Y(!1)}})()},[L,a,t,i,d,l,o,b,re]),x.useEffect(()=>{(async()=>{if(!(!B||Q!==null||!R||R.toString()!==t||!window.ethereum))try{console.log("ðŸ’° Checking funding balance for address:",B);const A=await new Ot(window.ethereum).getBalance(B);F(A),console.log("ðŸ’° Current funding balance:",et(A),"ETH")}catch(z){console.error("Error checking funding balance:",z)}})()},[B,R,t,Q]);const se=U.useAllowance(q!=null&&q.principal?{account:{owner:q.principal,subaccount:[]},spender:{owner:qe.fromText(ce),subaccount:[]}}:void 0),Ne=async(P,z=10,A=5e3)=>{J(!0);let Z=0;console.log("ðŸ” Starting to poll for new contract...",{txHash:P,maxAttempts:z,intervalMs:A});const de=setInterval(async()=>{Z++,console.log(`ðŸ” Polling attempt ${Z}/${z} for contract creation...`);try{if(R&&R.toString()===t&&window.ethereum)try{const fe=await new Ot(window.ethereum).getTransactionReceipt(P);fe?(console.log("âœ… Transaction mined on target network:",fe),console.log("ðŸ“‹ Contract address from receipt:",fe.contractAddress)):console.log("â³ Transaction not yet mined on target network")}catch(te){console.warn("Could not check transaction status on target network:",te)}if(L&&a&&t&&re)try{const te={contract:a,network:re},fe=await L.get_ck_nft_canister([te]);if(Array.isArray(fe)&&fe[0]&&fe[0][0]){const xe=fe[0][0];console.log("âœ… Found ckNFT canister:",xe.toString());const oe=await L.get_remote([[xe,re]]);if(Array.isArray(oe)&&oe[0]&&oe[0][0]){const X=oe[0][0],ae=X.address&&X.address.length>0?X.address[0]:null;if(ae){console.log("ðŸŽ‰ Found newly deployed remote contract:",ae);const je={address:ae,network:re,name:`CK-${a.slice(0,5)}...`,symbol:"CKNFT",totalSupply:0,verified:!0,deploymentTx:P};c(je),r({address:ae,network:re,deployed:!0}),clearInterval(de),J(!1),E(null);return}else console.log("â³ Remote contract found but address not yet available")}else console.log("â³ ckNFT canister exists but remote contract not yet deployed")}else console.log("â³ ckNFT canister not yet created")}catch(te){console.warn("Error checking for remote contract:",te)}Z>=z&&(console.warn("âš ï¸ Max polling attempts reached, stopping poll"),clearInterval(de),J(!1),E(null))}catch(te){console.error("Error during contract polling:",te),Z>=z&&(clearInterval(de),J(!1),E(null))}},A);return()=>{clearInterval(de),J(!1)}};x.useEffect(()=>{var P;((P=se.data)==null?void 0:P.allowance)!==void 0?(M(se.data.allowance),console.log("ðŸ’° Current cycles allowance:",se.data.allowance.toString())):(se.data===null||se.error)&&M(BigInt(0))},[se.data,se.error]),x.useEffect(()=>()=>{J(!1),E(null)},[]);const ge=async()=>{var P,z;if(!(q!=null&&q.principal)||!ue||!t||!a||!o||!re){console.error("Missing required information for remote creation");return}try{K(!0),console.log("ðŸš€ Creating remote contract..."),console.log("ðŸ“‹ Using source contract pointer from ICRC-99 check:",o),console.log("ðŸ“‹ Target network for remote creation:",re);let A={},Z={},de=2000000n,te=1000n;if(R&&R.toString()===t&&window.ethereum)try{const Ae=await new Ot(window.ethereum).getFeeData();A={maxFeePerGas:Ae.maxFeePerGas||Ae.gasPrice||50000000000n,l1DataFee:16n},Z={gasPrice:Ae.gasPrice||20000000000n};try{de=1800000n}catch(Fe){console.warn("Could not estimate deployment gas, using default:",Fe)}console.log("ï¿½ Enhanced gas data:",{maxFeePerGas:(P=A.maxFeePerGas)==null?void 0:P.toString(),gasPrice:(z=Z.gasPrice)==null?void 0:z.toString(),estimatedGas:de.toString(),estimatedSize:te.toString()})}catch(je){console.warn("Could not get enhanced gas data, using fallback:",je)}let fe,xe,oe;if(A.maxFeePerGas&&Z.gasPrice){const je=A.l1DataFee&&A.l1DataFee>0n?Z.gasPrice*16n*(te+300n)/(de*120n/100n):0n;fe=A.maxFeePerGas+2000000n+je,xe=de,oe=2000000n,console.log("âœ¨ Using enhanced gas calculation:",{baseMaxFeePerGas:A.maxFeePerGas.toString(),l1DataComponent:je.toString(),finalFeePerGas:fe.toString(),gasLimit:xe.toString()})}else fe=50000000000n,xe=2000000n,oe=2000000000n,console.log("âš ï¸ Using fallback gas calculation");const X=await ue.create_remote(o,re,fe,xe,oe,q!=null&&q.principal?[{owner:q.principal,subaccount:[]}]:[]);console.log("âœ… Remote contract creation initiated:",X);let ae=null;typeof X=="object"&&X!==null?"Ok"in X&&typeof X.Ok=="string"?ae=X.Ok:"transactionHash"in X?ae=X.transactionHash:typeof X=="string"&&(ae=X):typeof X=="string"&&(ae=X),ae?(console.log("ðŸ“‹ Got transaction hash:",ae),E(ae),Ne(ae),r({network:re,deployed:!1})):(console.warn("âš ï¸ No transaction hash received from create_remote, result:",X),r({network:re,deployed:!1}))}catch(A){console.error("âŒ Error creating remote contract:",A);const Z=A instanceof Error?A.message:String(A);throw alert(`Failed to create remote contract: ${Z}`),A}finally{K(!1)}},ne=async()=>{if(!f||!ce)throw new Error("Cannot approve cycles - missing requirements");try{T(!0),console.log("ðŸ’° Approving cycles for remote creation...",{amount:f.toString(),spender:ce});const P=qe.fromText(ce),z=f*BigInt(110)/BigInt(100),A=BigInt(Date.now()*1e6)+BigInt(1440*60*1e9),Z=await $.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:z,expected_allowance:[],expires_at:[A],spender:{owner:P,subaccount:[]}});return se.refetch(),console.log("âœ… Cycles approval successful"),Z}catch(P){throw console.error("Error approving cycles:",P),P}finally{T(!1)}},ye=async()=>{if(!B||!N||!window.ethereum){console.error("Missing required information for funding");return}try{const P=new Ot(window.ethereum),z=await P.getSigner(),A=N*120n/100n;console.log("ðŸ’° Funding remote contract:",{to:B,value:et(A)});const Z=await z.sendTransaction({to:B,value:A});console.log("ðŸ’° Funding transaction sent:",Z.hash);const de=await Z.wait();console.log("ðŸ’° Funding transaction confirmed:",de);const te=await P.getBalance(B);F(te)}catch(P){console.error("Error funding remote contract:",P)}},G=t&&n&&l&&!d;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Remote Contract Configuration"}),s.jsx("p",{className:"text-gray-600",children:"Checking for existing contracts and configuring the target EVM deployment."})]}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Export Summary"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-blue-600",children:"NFTs to Export:"}),s.jsxs("span",{className:"ml-2 font-medium text-blue-800",children:[e.length," NFT",e.length!==1?"s":""]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-blue-600",children:"Source Canister:"}),s.jsx("span",{className:"ml-2 font-medium text-blue-800 font-mono text-xs",children:a})]})]}),e.length>0&&s.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.slice(0,3).map(P=>s.jsx("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-md",children:P.name||`Token ${P.tokenId}`},`${P.canisterId}-${P.tokenId}`)),e.length>3&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-md",children:["+",e.length-3," more"]})]})]}),t&&s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Target Network"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"text-2xl mr-3",children:"ðŸ”—"}),s.jsxs("div",{children:[s.jsxs("h5",{className:"font-medium text-gray-900",children:["Network: Chain ",t]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Chain ID: ",t]})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Contract Status"}),d&&s.jsxs("div",{className:"flex items-center py-4",children:[s.jsx(Qe,{className:"w-5 h-5 text-blue-600 animate-spin mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900",children:"Checking for existing contracts..."}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Searching for contracts linked to canister ",a]})]})]}),!d&&i&&s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(gt,{className:"w-5 h-5 text-green-600 mr-3 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h5",{className:"font-medium text-green-800 mb-1",children:"Existing Contract Found"}),s.jsx("p",{className:"text-sm text-green-700 mb-3",children:"A contract already exists for this canister on the target network. Your NFTs will be exported to this existing contract."}),s.jsx("div",{className:"bg-white border border-green-200 rounded-lg p-3",children:s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx("h6",{className:"font-medium text-gray-900",children:i.name}),s.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",i.symbol,")"]}),i.verified&&s.jsx(gt,{className:"w-4 h-4 text-green-500 ml-2"})]}),s.jsx("p",{className:"text-sm text-gray-600 font-mono mb-2",children:i.address}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[s.jsxs("span",{children:["Total Supply: ",i.totalSupply]}),s.jsxs("a",{href:"#",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 inline-flex items-center",children:["View on Explorer ",s.jsx(Ds,{className:"w-3 h-3 ml-1"})]})]})]})})})]})]})}),!d&&!i&&l&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(cd,{className:"w-5 h-5 text-amber-600 mr-3 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h5",{className:"font-medium text-amber-800 mb-1",children:"New Contract Required"}),s.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"No existing contract found for this canister on the target network. A new ERC-721 contract will be deployed during the export process."}),s.jsx("div",{className:"bg-white border border-amber-200 rounded-lg p-3",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-amber-600",children:"Chain ID:"}),s.jsx("span",{className:"ml-2 font-medium text-amber-800",children:t})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-amber-600",children:"Standard:"}),s.jsx("span",{className:"ml-2 font-medium text-amber-800",children:"ERC-721"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-amber-600",children:"NFTs:"}),s.jsxs("span",{className:"ml-2 font-medium text-amber-800",children:[e.length," token",e.length!==1?"s":""]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-amber-600",children:"Gas Fee:"}),s.jsx("span",{className:"ml-2 font-medium text-amber-800",children:N?`~${et(N)} ETH`:"~0.02 ETH"})]})]})})]})]})}),s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("h5",{className:"font-medium text-blue-800 mb-3",children:"Remote Contract Creation Costs"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-blue-200 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-900",children:"Cycles Required"}),s.jsx("p",{className:"text-sm text-gray-600",children:"For orchestrator contract deployment"})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("span",{className:"font-medium text-blue-800",children:f?`${(Number(f)/1e12).toFixed(3)} T`:"Estimating..."}),s.jsx("p",{className:"text-xs text-gray-500",children:"cycles"})]})]}),s.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-blue-200 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-900",children:"ETH Required"}),s.jsx("p",{className:"text-sm text-gray-600",children:"For EVM contract deployment gas"})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("span",{className:"font-medium text-blue-800",children:N?`${et(N)} ETH`:"Estimating..."}),s.jsx("p",{className:"text-xs text-gray-500",children:C?`~${C.toString()} gas`:"~800k gas"})]})]}),B?s.jsxs("div",{className:"p-3 bg-white border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"font-medium text-gray-900",children:"Funding Address"}),Q!==null&&s.jsxs("span",{className:`text-sm font-medium ${Q>=(N||0n)?"text-green-600":"text-red-600"}`,children:[et(Q)," ETH"]})]}),s.jsx("p",{className:"text-xs text-gray-600 font-mono break-all",children:B}),Q!==null&&N&&Q<N&&s.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(lt,{className:"w-4 h-4 text-red-500 mr-2"}),s.jsx("span",{className:"text-sm text-red-700 font-medium",children:"Insufficient ETH balance"})]}),s.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Need ",et(N-Q)," more ETH"]})]}),Q!==null&&N&&Q>=N&&s.jsxs("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-4 h-4 text-green-500 mr-2"}),s.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Sufficient ETH balance"})]}),s.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Ready for contract deployment"})]})]}):s.jsxs("div",{className:"p-3 bg-white border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"font-medium text-gray-900",children:"Funding Address"}),s.jsx("span",{className:"text-sm text-gray-500",children:"Loading..."})]}),s.jsx("p",{className:"text-xs text-gray-600",children:"Retrieving funding address..."})]}),B&&N&&p&&O&&Q!==null&&Q<N&&s.jsxs("button",{onClick:ye,className:"w-full flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(na,{className:"w-4 h-4 mr-2"}),"Fund Remote Contract"]})]})]})]})]}),l&&!i&&f&&s.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[s.jsx("h4",{className:"text-sm font-medium mb-3",children:"Cycles Approval"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Required:"}),s.jsx("span",{className:"text-sm font-mono",children:ul(f)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Approved:"}),s.jsx("span",{className:"text-sm font-mono",children:_!==null?ul(_):"..."})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Your Balance:"}),s.jsx("span",{className:"text-sm font-mono",children:le?"Loading...":W!==void 0?ul(W):"Unable to load"})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),s.jsx("span",{className:`text-sm font-medium ${_!==null&&_>=f?"text-green-500":"text-orange-500"}`,children:_!==null?_>=f?"Sufficient":"Insufficient":"Checking..."})]}),ee?s.jsxs("div",{className:"w-full mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx(Qe,{className:"mr-2 h-4 w-4 animate-spin text-blue-600"}),s.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"Waiting for contract deployment..."})]}),s.jsx("p",{className:"text-xs text-blue-600 text-center mt-1",children:"Checking target network for new contract"}),pe&&s.jsxs("p",{className:"text-xs text-blue-500 text-center mt-1 font-mono",children:["TX: ",pe.slice(0,10),"...",pe.slice(-8)]})]}):_!==null&&_>=f?s.jsx("button",{onClick:ge,disabled:k,className:"w-full mt-4 flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:k?s.jsxs(s.Fragment,{children:[s.jsx(Qe,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Remote Contract..."]}):"Create Remote Contract"}):s.jsx("button",{onClick:ne,disabled:V||!(q!=null&&q.principal),className:"w-full mt-4 flex items-center justify-center px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50",children:V?s.jsxs(s.Fragment,{children:[s.jsx(Qe,{className:"mr-2 h-4 w-4 animate-spin"}),"Approving Cycles..."]}):"Approve Cycles"}),_!==null&&_<f&&s.jsxs("div",{className:"mt-4 p-3 bg-orange-500/10 border border-orange-500/20 rounded-lg",children:[s.jsxs("p",{className:"text-sm text-orange-600 mb-2",children:['Insufficient cycles approval. Click "Approve Cycles" above to approve'," ",ow(f)," TCycles for the orchestrator canister."]}),!(q!=null&&q.principal)&&s.jsx("p",{className:"text-xs text-orange-500 mb-2",children:"ðŸ” Please connect your wallet to approve cycles."}),s.jsxs("div",{className:"text-xs text-orange-500",children:[s.jsx("p",{className:"mb-1",children:"ðŸ’¡ About cycles approval:"}),s.jsx("p",{children:"â€¢ Allows the orchestrator to spend cycles on your behalf"}),s.jsx("p",{children:"â€¢ Only the approved amount can be spent"}),s.jsx("p",{children:"â€¢ Required for remote contract deployment"})]})]}),_!==null&&_>=f&&s.jsxs("div",{className:"mt-4 p-3 bg-green-500/10 border border-green-500/20 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-4 h-4 text-green-500 mr-2"}),s.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Cycles approved successfully!"})]}),s.jsx("p",{className:"text-xs text-green-500 mt-1",children:"Ready to create the remote contract."})]})]})]}),G&&s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-5 h-5 text-green-600 mr-2"}),s.jsx("span",{className:"font-medium text-green-800",children:"Configuration Complete"})]}),s.jsxs("div",{className:"mt-2 text-sm text-green-700",children:[s.jsxs("p",{children:["âœ“ Target ChainId: ",t]}),s.jsxs("p",{children:["âœ“ Contract: ",i?"Use existing contract":"Deploy new contract"]}),s.jsx("p",{children:"âœ“ Ready to calculate export costs"})]})]})]})}var cw={};function lw({selectedNFTs:e,targetNetwork:t,remoteContractInfo:n,sourceContractPointer:r,onCostsCalculated:a}){const[o,i]=x.useState(!1),[c,l]=x.useState(null),[u,d]=x.useState(null),[m,f]=x.useState(null),[g,N]=x.useState(!1),[h,C]=x.useState(!1),[w,B]=x.useState(null),[j,Q]=x.useState(null),[F,_]=x.useState(null),[M,k]=x.useState(null),[K,V]=x.useState(null),T=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),{user:ee}=ut(),J=cw.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",pe=js(J),E=ee!=null&&ee.principal?{owner:typeof ee.principal=="string"?qe.fromText(ee.principal):ee.principal,subaccount:[]}:void 0,b=pe.useBalance(E),Y=oa(u==null?void 0:u.total);x.useEffect(()=>{b.data!==void 0&&B(b.data)},[b.data]),x.useEffect(()=>{var v,U,S,H;if(console.log("ðŸ” useEffect [allowanceQuery.data, costBreakdown?.total] triggered:",{hasAllowanceData:!!Y.data,allowanceDataRef:Y.data,allowanceAmount:(U=(v=Y.data)==null?void 0:v.allowance)==null?void 0:U.toString(),isExpired:(S=Y.data)==null?void 0:S.isExpired,costBreakdownTotal:(H=u==null?void 0:u.total)==null?void 0:H.toString(),allowanceQueryDataKeys:Y.data?Object.keys(Y.data):"no data"}),Y.data&&(u!=null&&u.total)){const he={amount:Y.data.allowance,isExpired:Y.data.isExpired,isSufficient:Y.data.allowance>=u.total};console.log("ðŸ” Setting new allowance status:",he),V(he);const $=Y.data.allowance>=u.total&&!Y.data.isExpired;console.log("ðŸ” Setting payment approved:",$),N($)}},[Y.data,u==null?void 0:u.total]);const p=x.useMemo(()=>{if(!t||!("Ethereum"in t))return"Unknown";const v=Number(t.Ethereum[0]);return{1:"Ethereum",137:"Polygon",56:"BNB Smart Chain",42161:"Arbitrum",10:"Optimism",8453:"Base"}[v]||`Chain ${v}`},[t]),O=x.useMemo(()=>n!=null&&n.address?{network:t,contract:n.address}:null,[n,t]);x.useEffect(()=>{(async()=>{var U;if(!e.length||!t||!n||!r){d(null),a(0n);return}i(!0),l(null);try{console.log("ðŸ” Calculating export costs for:",{nftCount:e.length,network:p,remoteContract:n,sourceContract:r,hasSourceContractPointer:!!r,sourceContractAddress:r==null?void 0:r.contract});let S,H=0n;if(!n.deployed&&O){console.log("ðŸ“Š Getting remote contract deployment cost...");try{const L=await T.getRemoteCost.mutateAsync({pointer:r,network:t});S=BigInt(L),console.log("ðŸ’° Remote contract deployment cost:",S.toString())}catch(L){console.error("Failed to get deployment cost:",L),S=5000000000n}}try{console.log("ðŸ“Š Getting real cast costs from ckNFT canisters...");const ue=(await T.getCkNFTCanister.mutateAsync([r]))[0];if(ue&&(n!=null&&n.address)){console.log(`ðŸ” Using ckNFT canister ${ue.toString()} for cast cost calculations`);for(const re of e)try{const se=await T.getCastCost.mutateAsync({ckNFTCanisterId:ue,contract:n.address,network:t,tokenId:BigInt(re.tokenId)});H+=se,console.log(`ðŸ’° Real cast cost for NFT ${re.tokenId}: ${se.toString()}`)}catch(se){console.error(`Error getting cast cost for NFT ${re.tokenId}:`,se),H+=1000000000n}console.log("ðŸ’° Total real cast operations cost:",H.toString())}else console.warn("No ckNFT canister found for source contract, using fallback estimation"),H=BigInt(e.length)*1000000000n}catch(L){console.error("Failed to get real cast costs, using estimation:",L);const ue=1000000000n,se=BigInt(Math.floor(({Ethereum:50,Polygon:1,"BNB Smart Chain":5,Arbitrum:.5,Optimism:.5,Base:.5}[p]||10)*100));H=BigInt(e.length)*ue*se/100n}let he=0n,$="0.000",W=null;try{console.log("ðŸ” Getting ckNFT canister for funding address...",{sourceContract:r.contract,sourceContractNetwork:r.network,targetNetwork:t,mutations:!!T,userAuthenticated:!!(ee!=null&&ee.principal)});const ue=(await T.getCkNFTCanister.mutateAsync([r]))[0];ue?(console.log("âœ… Found ckNFT canister for funding address:",ue.toString()),W=await T.getICRC99Address.mutateAsync({canister:ue,network:t}),W?(k(W),console.log("ðŸ’° Got funding address from ckNFT canister:",W)):(console.warn("ðŸ’° No funding address returned from ckNFT canister"),k(null))):(console.warn("âš ï¸ No ckNFT canister found for source contract, cannot get funding address"),k(null))}catch(L){console.error("âŒ Failed to get funding address from orchestrator:",L),console.error("ðŸ’° Error details:",{message:L instanceof Error?L.message:String(L),sourceContractPointer:r,targetNetwork:t,userAuthenticated:!!(ee!=null&&ee.principal),mutationsAvailable:!!(T!=null&&T.getICRC99Address)}),k(null)}try{if(("Ethereum"in t?Number(t.Ethereum[0]):null)&&window.ethereum){const ue=new(await Xe(async()=>{const{ethers:z}=await import("./index-BTkhUH0V.js");return{ethers:z}},__vite__mapDeps([5,1,2,3,4]))).ethers.BrowserProvider(window.ethereum),re=await ue.getFeeData(),se=await Xe(()=>Promise.resolve().then(()=>nw),void 0),Ne=se.abi,ge=se.bytecode;let ne=0n;if(n!=null&&n.deployed&&n.address&&W){console.log("ðŸ’° Estimating gas for mint_icrc99 calls to existing contract:",n.address);try{for(let z=0;z<e.length;z++){const A=e[z],Z=JSON.stringify({name:A.name||`NFT ${A.tokenId}`,description:A.description||"Bridged NFT from Internet Computer",image:A.image||"",tokenId:A.tokenId}),{ethers:de}=await Xe(async()=>{const{ethers:xe}=await import("./index-BTkhUH0V.js");return{ethers:xe}},__vite__mapDeps([5,1,2,3,4])),te=de.getAddress("0x742d35Cc6635C0532925a3b8D11e432f1b7C4b7b"),fe=await ue.estimateGas({to:n.address,data:new de.Interface(Ne).encodeFunctionData("mint_icrc99",[BigInt(A.tokenId),te,Z]),from:W});ne+=fe,console.log(`ðŸ’° Estimated gas for NFT ${A.tokenId}: ${fe.toString()}`)}console.log(`ðŸ’° Total estimated gas for ${e.length} mint operations: ${ne.toString()}`)}catch(z){console.warn("Failed to estimate mint gas, using fallback:",z),ne=BigInt(e.length)*150000n}}else if(n!=null&&n.deployed)console.warn("ðŸ’° No funding address available, using conservative gas estimates"),ne=BigInt(e.length)*150000n;else{console.log("ðŸ’° Estimating gas for contract deployment + mints");try{const z=ge+"0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000054d794e465400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000054d794e4654000000000000000000000000000000000000000000000000000000",A=await ue.estimateGas({data:z,from:W||"0x742d35Cc6635C0532925a3b8D11e432f1b7C4b7b"});console.log("ðŸ’° Estimated deployment gas:",A.toString());let Z=0n;try{const de=JSON.stringify({name:"Sample NFT",description:"Sample bridged NFT",image:"",tokenId:1}),te=await ue.estimateGas({data:ge+new(await Xe(async()=>{const{ethers:fe}=await import("./index-BTkhUH0V.js");return{ethers:fe}},__vite__mapDeps([5,1,2,3,4]))).ethers.Interface(Ne).encodeFunctionData("mint_icrc99",[1n,"0x742d35Cc6635C0532925a3b8D11e432f1b7C4b7b",de]).slice(2),from:W||"0x742d35Cc6635C0532925a3b8D11e432f1b7C4b7b"});Z=BigInt(e.length)*te,console.log("ðŸ’° Estimated mint gas per NFT:",te.toString())}catch(de){console.warn("Failed to estimate individual mint gas:",de),Z=BigInt(e.length)*120000n}ne=A+Z,console.log("ðŸ’° Total gas (deployment + mints):",ne.toString())}catch(z){console.warn("Failed to estimate deployment gas, using fallback:",z),ne=1500000n+BigInt(e.length)*120000n}}const ye=re.gasPrice||re.maxFeePerGas||20000000000n,G=ne*ye,P=await Xe(()=>import("./index-BTkhUH0V.js"),__vite__mapDeps([5,1,2,3,4]));if($=P.ethers.formatEther(G),_($),he=0n,console.log("ðŸ’° Real EVM gas cost calculation:",{gasPrice:ye.toString(),totalGasUnits:ne.toString(),totalGasCostWei:G.toString(),evmGasFeesETH:$,fundingAddress:W,contractDeployed:n==null?void 0:n.deployed,nftCount:e.length}),W)try{const z=await ue.getBalance(W),A=P.ethers.formatEther(z);Q(A),console.log("ðŸ’° ETH balance check for funding address:",{address:W,balanceETH:A,requiredETH:$,hasSufficientBalance:parseFloat(A)>parseFloat($)})}catch(z){console.warn("Could not check funding address balance:",z),Q(null)}}else throw new Error("No MetaMask or chain ID available")}catch(L){console.warn("Failed to get real gas costs, using estimates:",L),console.warn("ðŸ’° Error details:",{message:L instanceof Error?L.message:String(L),sourceContractPointer:r,targetNetwork:t}),he=0n,$="~0.050"}const le=(S||0n)+H+he,ce={remoteContractDeployment:S,castOperations:H,evmGasFees:he,evmGasFeesETH:$,total:le};console.log("ðŸ’° Final cost breakdown:",{remoteContractDeployment:(U=ce.remoteContractDeployment)==null?void 0:U.toString(),castOperations:ce.castOperations.toString(),evmGasFees:ce.evmGasFees.toString(),total:ce.total.toString()}),d(ce),a(le)}catch(S){console.error("Error calculating export costs:",S),l(S instanceof Error?S.message:"Failed to calculate export costs"),d(null),a(0n)}finally{i(!1)}})()},[e,t,n,r,p,O]),x.useEffect(()=>{(async()=>{if(!(!t||m))try{console.log("â›½ Fetching real gas price data for network:",p);const U="Ethereum"in t?Number(t.Ethereum[0]):null;if(!U){console.warn("Unable to determine chain ID for gas price fetching");return}if(window.ethereum)try{const he=new(await Xe(async()=>{const{ethers:W}=await import("./index-BTkhUH0V.js");return{ethers:W}},__vite__mapDeps([5,1,2,3,4]))).ethers.BrowserProvider(window.ethereum),$=await he.getNetwork();if(Number($.chainId)===U){const W=await he.getFeeData(),le=W.gasPrice||W.maxFeePerGas||20000000000n,ce=Number(le)/1e9,L=ce*21e-6*2e3;f({network:p,gasPrice:`${ce.toFixed(1)} gwei`,usdPrice:`$${L.toFixed(2)}`,estimatedConfirmationTime:U===1?"2-5 minutes":"1-3 minutes"}),console.log("â›½ Real gas price fetched:",{gasPrice:`${ce.toFixed(1)} gwei`,chainId:U,network:p});return}}catch(he){console.warn("Could not fetch gas price from MetaMask:",he)}const H={1:{gwei:30,usd:15,confirmTime:"2-5 minutes"},137:{gwei:35,usd:.01,confirmTime:"1-3 minutes"},56:{gwei:5,usd:.05,confirmTime:"1-3 minutes"},42161:{gwei:.1,usd:.5,confirmTime:"1-2 minutes"},10:{gwei:.1,usd:.5,confirmTime:"1-2 minutes"},8453:{gwei:.1,usd:.5,confirmTime:"1-2 minutes"}}[U]||{gwei:20,usd:5,confirmTime:"2-5 minutes"};f({network:p,gasPrice:`${H.gwei} gwei`,usdPrice:`$${H.usd.toFixed(2)}`,estimatedConfirmationTime:H.confirmTime}),console.log("â›½ Using fallback gas price estimates for chain",U)}catch(U){console.error("Error fetching gas price info:",U),f({network:p,gasPrice:"Unknown",usdPrice:"Unknown",estimatedConfirmationTime:"2-5 minutes"})}})()},[t,p,m]);const R=v=>{const S=BigInt(1e12),H=v/S,$=(v%S).toString().padStart(12,"0").slice(0,3);return`${H.toLocaleString()}.${$} TC`},q=async()=>{if(!(!u||!(ee!=null&&ee.principal))){C(!0),i(!0),l(null);try{if(console.log("ðŸ”„ Approving cycles payment for export...",{totalCost:u.total.toString(),userBalance:(w==null?void 0:w.toString())||"unknown",orchestratorCanister:"jio3a-xaaaa-aaaal-ab66q-cai"}),w!==null&&w<u.total)throw new Error(`Insufficient cycles balance. You have ${R(w)} but need ${R(u.total)}. Please deposit more cycles to your account.`);const v=u.total*BigInt(110)/BigInt(100),U=BigInt(1440*60*1e9),S=BigInt(Date.now()*1e6)+U;console.log("ðŸ“ Submitting cycles approval...",{approvalAmount:v.toString(),originalAmount:u.total.toString(),expiryTime:S.toString()}),await T.cyclesApprove.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:v,expected_allowance:[],expires_at:[S],spender:{owner:qe.fromText("jio3a-xaaaa-aaaal-ab66q-cai"),subaccount:[]}}),console.log("âœ… Cycles approval successful!"),await Y.refetch(),await b.refetch(),N(!0)}catch(v){console.error("âŒ Error approving cycles payment:",v),l(v instanceof Error?v.message:"Failed to approve cycles payment"),N(!1)}finally{C(!1),i(!1)}}};return o&&!u?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Qe,{className:"w-8 h-8 text-blue-600 animate-spin mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Calculating Export Costs"}),s.jsxs("p",{className:"text-gray-600",children:["Estimating cycles needed for ",e.length," NFT",e.length!==1?"s":"",n!=null&&n.deployed?"":" and contract deployment","..."]})]}):c?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(lt,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Calculating Costs"}),s.jsx("p",{className:"text-gray-600 mb-4",children:c}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Retry"})]}):u?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Export Costs"}),s.jsxs("p",{className:"text-gray-600",children:["Review the costs for exporting your ",e.length," NFT",e.length!==1?"s":""," to ",p,"."]})]}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-blue-800 mb-3",children:"Export Summary"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-blue-600",children:"NFTs:"}),s.jsxs("span",{className:"ml-2 font-medium text-blue-800",children:[e.length," token",e.length!==1?"s":""]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-blue-600",children:"Target Network:"}),s.jsx("span",{className:"ml-2 font-medium text-blue-800",children:p})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-blue-600",children:"Contract:"}),s.jsx("span",{className:"ml-2 font-medium text-blue-800",children:n!=null&&n.deployed?"Existing":"New Deployment"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-blue-600",children:"Operation:"}),s.jsx("span",{className:"ml-2 font-medium text-blue-800",children:"Cast to EVM"})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Cost Breakdown"}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg divide-y divide-gray-200",children:[s.jsxs("div",{className:"p-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(ld,{className:"w-5 h-5 text-blue-600 mr-3"}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Cast Operations"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Bridge ",e.length," NFT",e.length!==1?"s":""," to ",p]})]})]}),s.jsx("span",{className:"font-medium text-gray-900",children:R(u.castOperations)})]}),u.remoteContractDeployment&&s.jsxs("div",{className:"p-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(_0,{className:"w-5 h-5 text-green-600 mr-3"}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Contract Deployment"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Deploy new ERC-721 contract on ",p]})]})]}),s.jsx("span",{className:"font-medium text-gray-900",children:R(u.remoteContractDeployment)})]}),s.jsxs("div",{className:"p-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(O0,{className:"w-5 h-5 text-orange-600 mr-3"}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"EVM Gas Fees"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Estimated gas costs on ",p]}),j&&F&&s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Balance: ",parseFloat(j).toFixed(4)," ETH",M&&s.jsxs("span",{className:"text-gray-400 ml-1",children:["(",M.slice(0,6),"...",M.slice(-4),")"]}),parseFloat(j)<parseFloat(F)&&s.jsx("span",{className:"text-red-600 ml-1",children:"âš ï¸ Insufficient"})]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("span",{className:"font-medium text-gray-900",children:[u.evmGasFeesETH," ETH"]}),m&&s.jsxs("p",{className:"text-xs text-gray-500",children:["~",m.gasPrice]})]})]})]})]}),m&&s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Current Gas Prices"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-yellow-600",children:"Network:"}),s.jsx("span",{className:"ml-2 font-medium text-yellow-800",children:m.network})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-yellow-600",children:"Gas Price:"}),s.jsx("span",{className:"ml-2 font-medium text-yellow-800",children:m.gasPrice})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-yellow-600",children:"USD Est.:"}),s.jsx("span",{className:"ml-2 font-medium text-yellow-800",children:m.usdPrice})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-yellow-600",children:"Confirmation:"}),s.jsx("span",{className:"ml-2 font-medium text-yellow-800",children:m.estimatedConfirmationTime})]})]})]}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-blue-800 mb-3",children:"ETH Funding Address"}),s.jsx("div",{className:"bg-white border border-blue-200 rounded-lg p-3",children:M?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"font-medium text-gray-900",children:"Address Balance"}),j!==null?s.jsxs("span",{className:`text-sm font-medium ${F&&parseFloat(j)>=parseFloat(F)?"text-green-600":"text-red-600"}`,children:[parseFloat(j).toFixed(6)," ETH"]}):s.jsx("span",{className:"text-sm text-gray-500",children:"Loading..."})]}),s.jsx("p",{className:"text-xs text-gray-600 font-mono break-all mb-2",children:M}),j!==null&&F&&s.jsxs("div",{className:"mt-2",children:[s.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[s.jsx("span",{children:"Required for gas:"}),s.jsxs("span",{children:[parseFloat(F).toFixed(6)," ETH"]})]}),parseFloat(j)<parseFloat(F)?s.jsxs("div",{className:"p-2 bg-red-50 border border-red-200 rounded",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(lt,{className:"w-4 h-4 text-red-500 mr-2"}),s.jsx("span",{className:"text-sm text-red-700 font-medium",children:"Insufficient ETH balance"})]}),s.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Need ",(parseFloat(F)-parseFloat(j)).toFixed(6)," more ETH"]})]}):s.jsxs("div",{className:"p-2 bg-green-50 border border-green-200 rounded",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-4 h-4 text-green-500 mr-2"}),s.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Sufficient ETH balance"})]}),s.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Ready for gas fee payment"})]})]}),j===null&&s.jsx("div",{className:"mt-2 p-2 bg-gray-50 border border-gray-200 rounded",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 text-gray-500 animate-spin mr-2"}),s.jsx("span",{className:"text-sm text-gray-600",children:"Checking balance..."})]})})]}):M?s.jsxs("div",{className:"flex items-center justify-center py-4",children:[s.jsx(Qe,{className:"w-4 h-4 text-gray-500 animate-spin mr-2"}),s.jsx("span",{className:"text-sm text-gray-600",children:"Retrieving funding address from ckNFT canister..."})]}):s.jsxs("div",{className:"py-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center mb-2",children:[s.jsx(lt,{className:"w-5 h-5 text-yellow-500 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"No ICRC-99 Funding Address Available"})]}),s.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"No ckNFT canister found for this source contract"}),s.jsx("div",{className:"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded",children:s.jsx("p",{className:"text-xs text-yellow-700",children:"ðŸ’¡ This may be a new contract that hasn't been registered yet"})})]})}),s.jsxs("div",{className:"mt-3 text-xs text-blue-600",children:[s.jsx("p",{className:"mb-1",children:"ðŸ’¡ About the funding address:"}),M?s.jsxs(s.Fragment,{children:[s.jsx("p",{children:"â€¢ This address pays for EVM gas fees during the export"}),s.jsx("p",{children:"â€¢ Managed by the ckNFT canister on Internet Computer"}),s.jsx("p",{children:"â€¢ Balance is checked automatically before export"}),s.jsx("p",{className:"mt-1 text-green-600",children:"âœ“ Address retrieved successfully"})]}):s.jsxs(s.Fragment,{children:[s.jsx("p",{children:"â€¢ ckNFT canisters manage funding addresses for gas payments"}),s.jsx("p",{children:"â€¢ Each supported contract has a corresponding ckNFT canister"}),s.jsx("p",{children:"â€¢ Contact support if your contract should be supported"})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Payment Approval"}),s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(na,{className:"w-5 h-5 text-gray-600 mr-2"}),s.jsx("h5",{className:"font-medium text-gray-900",children:"Your Cycles Balance"})]}),b.isLoading?s.jsx(Qe,{className:"w-4 h-4 animate-spin text-gray-500"}):s.jsx("span",{className:be("font-medium",w!==null&&u&&w>=u.total?"text-green-600":"text-red-600"),children:w!==null?R(w):"Unknown"})]}),w!==null&&u&&s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-gray-600",children:"Required:"}),s.jsx("span",{className:"text-gray-900",children:R(u.total)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Remaining after export:"}),s.jsx("span",{className:be("font-medium",w>=u.total?"text-green-600":"text-red-600"),children:w>=u.total?R(w-u.total):"Insufficient Balance"})]})]}),w!==null&&u&&w<u.total&&s.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-md",children:s.jsxs("p",{className:"text-sm text-red-700",children:["âš ï¸ Insufficient cycles balance. Please deposit ",R(u.total-w)," more."]})})]}),K&&s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(sa,{className:"w-5 h-5 text-blue-600 mr-2"}),s.jsx("h5",{className:"font-medium text-blue-900",children:"Current Allowance"})]}),s.jsx("span",{className:be("font-medium",K.isSufficient&&!K.isExpired?"text-green-600":"text-orange-600"),children:R(K.amount)})]}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-blue-600",children:"Status:"}),s.jsx("span",{className:be("font-medium",K.isSufficient&&!K.isExpired?"text-green-600":"text-orange-600"),children:K.isExpired?"Expired":K.isSufficient?"Sufficient":"Insufficient"})]}),K.isExpired&&s.jsx("p",{className:"text-orange-700 text-xs",children:"Your previous allowance has expired. A new approval is required."}),!K.isSufficient&&!K.isExpired&&s.jsx("p",{className:"text-orange-700 text-xs",children:"Your current allowance is insufficient for this export operation."})]})]}),g?s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-5 h-5 text-green-600 mr-2"}),s.jsx("span",{className:"font-medium text-green-800",children:"Payment Approved"})]}),s.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Cycles approved for export operation. You can now proceed with the export."}),s.jsxs("div",{className:"mt-2 text-xs text-green-600",children:["Approved: ",K?R(K.amount):"Unknown amount"]})]}):s.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Approve Cycles Payment"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Authorize the orchestrator to use ",u?R(u.total):"..."," for this export"]})]}),s.jsx("button",{onClick:q,disabled:h||b.isLoading||!u||w!==null&&w<u.total,className:be("px-6 py-2 rounded-md font-medium transition-colors",h||b.isLoading||!u||w!==null&&w<u.total?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:h?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Approving..."]}):b.isLoading?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Checking Balance..."]}):"Approve Payment"})]}),s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsx("p",{className:"mb-1",children:"This will:"}),s.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[s.jsx("li",{children:"Approve the cycles ledger transfer"}),s.jsx("li",{children:"Allow the orchestrator to process your export"}),s.jsxs("li",{children:["Enable automatic gas fee payment on ",p]}),s.jsx("li",{children:"Include 10% buffer for gas price fluctuations"})]})]})]})]}),g&&s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-5 h-5 text-blue-600 mr-2"}),s.jsx("span",{className:"font-medium text-blue-800",children:"Ready to Export"})]}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:'All requirements met. Click "Start Export" to begin the bridging process.'}),s.jsxs("div",{className:"mt-2 text-xs text-blue-600 space-y-1",children:[s.jsxs("div",{children:["âœ“ Cycles balance: ",w?R(w):"Verified"]}),s.jsxs("div",{children:["âœ“ Payment approved: ",K?R(K.amount):"Confirmed"]}),s.jsxs("div",{children:["âœ“ Target network: ",p]}),s.jsxs("div",{children:["âœ“ NFTs selected: ",e.length]})]})]}),j&&F&&parseFloat(j)<parseFloat(F)&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-2"}),s.jsx("span",{className:"font-medium text-red-800",children:"Insufficient ETH for Gas Fees"})]}),s.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["The funding address needs ",parseFloat(F).toFixed(4)," ETH for gas fees but only has ",parseFloat(j).toFixed(4)," ETH.",M&&s.jsxs(s.Fragment,{children:[s.jsx("br",{}),s.jsxs("span",{className:"text-xs text-red-600",children:["Address: ",M]})]}),s.jsx("br",{}),"Please add ",(parseFloat(F)-parseFloat(j)).toFixed(4)," ETH to the funding address."]}),s.jsx("div",{className:"mt-3",children:s.jsx("button",{onClick:()=>window.open(`https://faucet.quicknode.com/${p.toLowerCase()}`,"_blank"),className:"px-4 py-2 text-sm font-medium text-red-700 bg-red-100 rounded-md hover:bg-red-200 transition-colors",children:"Get Test ETH"})})]}),w!==null&&u&&w<u.total&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-2"}),s.jsx("span",{className:"font-medium text-red-800",children:"Insufficient Cycles Balance"})]}),s.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["You need ",R(u.total-w)," more to complete this export."]}),s.jsx("div",{className:"mt-3",children:s.jsx("button",{onClick:()=>window.open("https://nns.icp0.io/wallet/","_blank"),className:"px-4 py-2 text-sm font-medium text-red-700 bg-red-100 rounded-md hover:bg-red-200 transition-colors",children:"Get More Cycles"})})]})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(lt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Unable to Calculate Costs"}),s.jsx("p",{className:"text-gray-600",children:"Please check your export configuration and try again."})]})}function p0({sourceCanisterId:e,supportedNetworks:t=["ethereum","polygon","hardhat","hardhat-2"],onComplete:n,onCancel:r,className:a,modal:o=!1,initialStep:i,mockSelectedICNFTs:c,mockWalletConnected:l,mockExportCosts:u,mockExportResult:d}){var z,A;const m={ethereum:1,polygon:137,bsc:56,hardhat:31337,"hardhat-2":1338,arbitrum:42161,optimism:10,base:8453},f=Object.fromEntries(Object.entries(m).map(([Z,de])=>[de,Z])),[g,N]=x.useState(i||"select-ic-nft"),[h,C]=x.useState(c||[]),[w,B]=x.useState(null),[j,Q]=x.useState(null),[F,_]=x.useState(u?BigInt(u):null),[M,k]=x.useState(e||null),[K,V]=x.useState(null);x.useEffect(()=>{console.log("ðŸ’° Export costs updated:",{exportCosts:(F==null?void 0:F.toString())||"null",currentStep:g,canGoNextResult:g==="costs"?F!==null:"not costs step"})},[F,g]);const[T,ee]=x.useState(d||null),[J,pe]=x.useState(null),{activeAddress:E,isUnlocked:b,connectWallet:Y,switchChain:p,chainId:O}=an(),{user:R}=ut(),q=sd(),v=ef(M);x.useEffect(()=>{console.log("ðŸ” EVMExportWizard ICRC-99 support state:",{activeCanisterId:M,icrc99Support:v,sourceCanisterId:e})},[M,v,e]),x.useEffect(()=>{if(!M||v.isLoading){V(null);return}v.isSupported&&v.nativeChain?(console.log("âœ… ICRC-99 supported, using native chain info as source pointer:",v.nativeChain),V(v.nativeChain)):(console.log("ðŸ”„ ICRC-99 not supported, using IC network fallback for canister:",M),V({network:{IC:[]},contract:M}))},[M,v.isLoading,v.isSupported,v.nativeChain]);const U=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),S=rn("jio3a-xaaaa-aaaal-ab66q-cai",vs),H=l!==void 0?l:b,he=l!==void 0?l?"0x742d35Cc6635C0532925a3b8D11e432f1b7C4b7b":null:E;console.log("ðŸ” EVMExportWizard wallet state:",{mockWalletConnected:l,isUnlocked:b,effectiveIsConnected:H,effectiveAccount:he,currentStep:g});const $=x.useCallback(Z=>{const te=aa(Z,[{id:"create-remote-contract",title:"Deploy Remote Contract",description:"Creating or verifying EVM contract for receiving NFTs",estimatedDuration:180,retryable:!0,stage:"contract"},{id:"fund-gas-account",title:"Fund Gas Account",description:"Sending ETH to bridge funding address for gas fees",estimatedDuration:90,retryable:!0,stage:"preparation"},{id:"approve-cycles-cast",title:"Approve Cycles",description:"Approving cycles for cast operations",estimatedDuration:30,retryable:!0,stage:"preparation"},{id:"cast-nfts",title:"Cast NFTs",description:"Exporting ckNFTs to EVM blockchain",estimatedDuration:120,retryable:!0,stage:"execution"},{id:"wait-evm-confirmation",title:"Wait for Confirmation",description:"Monitoring cast operations for completion",estimatedDuration:300,retryable:!1,stage:"execution"}]);return pe(te),te},[]),W=x.useCallback((Z,de,te,fe)=>{if(!J)return;const xe=mt(J,Z,{status:de,...te&&{error:te},...fe&&{txHash:fe}});pe(xe)},[J]),le=x.useCallback(Z=>{if(!J)return;const de=vc(J,Z);pe(de)},[J]);x.useEffect(()=>{$("ic-to-evm")},[$]);const ce=x.useCallback(async(Z,de=10,te=5e3)=>{console.log("ðŸ” Starting to poll for deployed contract address...",{txHash:Z,maxAttempts:de,intervalMs:te});let fe=0;return new Promise((xe,oe)=>{const X=setInterval(async()=>{var ae;fe++,console.log(`ðŸ” Polling attempt ${fe}/${de} for contract address...`);try{if(S&&((ae=h[0])!=null&&ae.canisterId)&&w)try{const je={contract:h[0].canisterId,network:w},Ae=await S.get_ck_nft_canister([je]);if(Array.isArray(Ae)&&Ae[0]&&Ae[0][0]){const Fe=Ae[0][0];console.log("âœ… Found ckNFT canister:",Fe.toString());const Pe=await S.get_remote([[Fe,w]]);if(Array.isArray(Pe)&&Pe[0]&&Pe[0][0]){const _e=Pe[0][0],ke=_e.address&&_e.address.length>0?_e.address[0]:null;if(ke){console.log("ðŸŽ‰ Found newly deployed remote contract address:",ke),Q(ve=>ve?{...ve,address:ke,deployed:!0}:{address:ke,network:w,deployed:!0}),clearInterval(X),xe();return}else console.log("â³ Remote contract found but address not yet available")}else console.log("â³ ckNFT canister exists but remote contract not yet deployed")}else console.log("â³ ckNFT canister not yet created")}catch(je){console.warn("Error checking for remote contract:",je)}fe>=de&&(console.warn("âš ï¸ Max polling attempts reached, contract address may not be available yet"),clearInterval(X),xe())}catch(je){console.error("âŒ Error during contract address polling:",je),clearInterval(X),oe(je)}},te)})},[S,h,w]),L=[{id:"select-ic-nft",title:"Select IC NFTs",description:"Choose ckNFTs to export back to EVM"},{id:"connect",title:"Connect Wallet",description:"Connect your EVM wallet for receiving NFTs"},{id:"remote-contract",title:"Remote Contract",description:"Deploy or use existing EVM contract"},{id:"costs",title:"Export Costs",description:"Review and approve cycles for export operation"},{id:"export",title:"Export Progress",description:"Monitor the export process"},{id:"complete",title:"Complete",description:"Export summary"}],ue=L.findIndex(Z=>Z.id===g),re=x.useCallback(()=>{const Z=(()=>{switch(g){case"select-ic-nft":return h.length>0;case"connect":return b&&E;case"remote-contract":return j!==null&&j.address&&j.address.trim()!=="";case"costs":return F!==null;case"export":return(T==null?void 0:T.success)===!0;default:return!1}})();return console.log("ðŸ” canGoNext check:",{currentStep:g,result:Z,selectedICNFTs:h.length,isUnlocked:b,activeAddress:!!E,remoteContractInfo:j?{address:j.address||"null",deployed:j.deployed,network:j.network}:"null",exportCosts:(F==null?void 0:F.toString())||"null",exportResultSuccess:T==null?void 0:T.success}),Z},[g,h,b,E,j,F,T]),se=x.useMemo(()=>!!(J!=null&&J.steps&&J.steps.some(de=>de.status==="failed")||T&&!T.success),[J,T]);x.useEffect(()=>{T!=null&&T.success&&g!=="complete"&&(console.log("ðŸŽ‰ Export completed successfully, advancing to complete step"),N("complete"))},[T,g]);const Ne=ue>0&&(g!=="export"&&g!=="complete"||se),ge=x.useCallback(()=>{if(!re())return;const Z=ue+1;Z<L.length&&N(L[Z].id)},[ue,re,L]),ne=x.useCallback(()=>{if(!Ne)return;const Z=ue-1;Z>=0&&N(L[Z].id)},[ue,Ne,L]),ye=x.useCallback(async()=>{var Z,de,te,fe,xe,oe,X,ae,je,Ae;if(console.log("ðŸŽ¯ handleStartExport called with:",{selectedICNFTs:h.length,activeAddress:E,userPrincipal:R==null?void 0:R.principal,remoteContractInfo:j,targetNetwork:w}),!h.length||!E||!(R!=null&&R.principal)||!j||!w||!K||!F){console.warn("âŒ Missing required data for export:",{selectedICNFTs:h.length,activeAddress:!!E,userPrincipal:!!(R!=null&&R.principal),remoteContractInfo:!!j,targetNetwork:!!w,sourceContractPointer:!!K,exportCosts:!!F});return}N("export"),$("ic-to-evm");try{if(console.log(`ðŸš€ Starting real ICRC-99 export process for ${h.length} ckNFT(s) to EVM`),console.log("âœ… EVM wallet already connected:",E),W("create-remote-contract","loading"),!j.deployed&&j.address){console.log("ðŸ“¦ Deploying remote contract to EVM...",j.deployed,j.address),W("create-remote-contract","loading","Deploying remote contract to EVM...");try{if(!K)throw new Error("Source contract pointer not available. Please ensure NFTs are selected.");console.log("ðŸ“ Using sourceContractPointer for createRemoteContract (original native network from ICRC-99 or IC fallback):",K),console.log("ðŸ“ Using target network for createRemoteContract:",w),console.log("â›½ Calculating gas parameters for remote contract deployment...");let ve,Te,Ie;try{if(!window.ethereum)throw new Error("MetaMask not available for gas estimation");const Ee=await new Ot(window.ethereum).getFeeData();console.log("ðŸ“Š Current fee data for deployment:",{gasPrice:(Z=Ee.gasPrice)==null?void 0:Z.toString(),maxFeePerGas:(de=Ee.maxFeePerGas)==null?void 0:de.toString(),maxPriorityFeePerGas:(te=Ee.maxPriorityFeePerGas)==null?void 0:te.toString()}),ve=Ee.maxFeePerGas||Ee.gasPrice||BigInt(5e10),Te=Ee.maxPriorityFeePerGas||BigInt(2e9),Ie=BigInt(2e6),console.log("âœ… Calculated deployment gas parameters:",{gasPrice:ve.toString(),maxPriorityFeePerGas:Te.toString(),gasLimit:Ie.toString()})}catch(Ge){console.warn("âš ï¸ Failed to get real-time gas data for deployment, using fallback values:",Ge),ve=BigInt(5e10),Te=BigInt(2e9),Ie=BigInt(2e6)}const Ue=await U.createRemoteContract.mutateAsync({pointer:K,network:w,gasPrice:ve,gasLimit:Ie,maxPriorityFeePerGas:Te});console.log("âœ… Remote contract deployment initiated:",Ue);let He=null;Ue&&typeof Ue=="object"?"Ok"in Ue&&typeof Ue.Ok=="string"?He=Ue.Ok:"transactionHash"in Ue&&(He=Ue.transactionHash):typeof Ue=="string"&&(He=Ue),He?(console.log("ðŸ“‹ Got deployment transaction hash:",He),await ce(He)):(console.warn("âš ï¸ No transaction hash received from deployment, marking as deployed without address"),Q(Ge=>Ge?{...Ge,deployed:!0}:null))}catch(ve){console.error("âŒ Remote contract deployment failed:",ve),W("create-remote-contract","failed",ve instanceof Error?ve.message:"Remote contract deployment failed");return}}W("create-remote-contract","completed"),W("approve-cycles-cast","loading");try{if(!F)throw new Error("Export costs not calculated. Please go back to the costs step.");console.log("ðŸ”‹ Using pre-calculated export costs for cycle approval:",F.toString());const ve=(fe=h[0])==null?void 0:fe.canisterId;if(!ve)throw new Error("No ckNFT canister ID available");const Te=F*BigInt(110)/BigInt(100);await U.cyclesApprove.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:Te,expected_allowance:[],expires_at:[BigInt(Date.now()*1e6)+BigInt(1440*60*1e9)],spender:{owner:qe.fromText(ve),subaccount:[]}}),console.log("âœ… Cycles approved for all casting operations")}catch(ve){console.error("âŒ Failed to approve cycles for casting:",ve),W("approve-cycles-cast","failed",ve instanceof Error?ve.message:"Failed to approve cycles");return}W("approve-cycles-cast","completed"),W("fund-gas-account","loading","Approving NFTs for transfer...");try{const ve=(xe=h[0])==null?void 0:xe.canisterId;if(!ve)throw new Error("No ckNFT canister ID available");const{Actor:Te}=await Xe(async()=>{const{Actor:Ee}=await Promise.resolve().then(()=>Bt);return{Actor:Ee}},void 0),{idlFactory:Ie}=await Xe(async()=>{const{idlFactory:Ee}=await import("./index-BykKOlZ5.js");return{idlFactory:Ee}},__vite__mapDeps([0,1,2,3,4]));if(!q)throw new Error("User must be authenticated to approve NFTs");const Ue=Te.createActor(Ie,{agent:q,canisterId:qe.fromText(ve)}),He=h.map(Ee=>({token_id:BigInt(Ee.tokenId),approval_info:{spender:{owner:qe.fromText(Ee.canisterId),subaccount:[]},memo:[],from_subaccount:[],created_at_time:[],expires_at:[BigInt(Date.now()*1e6)+BigInt(1440*60*1e9)]}})),Ge=await Ue.icrc37_approve_tokens(He);console.log("ðŸ” NFT approval results:",Ge);for(let Ee=0;Ee<Ge.length;Ee++){const De=Ge[Ee];if(Array.isArray(De)&&De.length>0&&De[0]&&"Err"in De[0]){const ft=De[0].Err;throw console.error(`âŒ Failed to approve NFT ${h[Ee].tokenId}:`,ft),new Error(`Failed to approve NFT ${h[Ee].tokenId}: ${JSON.stringify(ft)}`)}}console.log("âœ… All NFTs approved for transfer")}catch(ve){console.error("âŒ Failed to approve NFTs for transfer:",ve),W("fund-gas-account","failed",ve instanceof Error?ve.message:"Failed to approve NFTs");return}W("fund-gas-account","completed"),W("cast-nfts","loading");const Fe=[],Pe=[],_e=[];let ke=[];for(let ve=0;ve<h.length;ve++){const Te=h[ve];console.log(`ðŸ”„ Casting NFT ${ve+1}/${h.length}: Token ${Te.tokenId} from ${Te.canisterId}`),W("cast-nfts","loading",`Casting NFT ${ve+1}/${h.length}: ${Te.name||Te.tokenId}...`);try{const Ie=K;console.log("ðŸ” Using native contract pointer from ICRC-99:",{nativeNetwork:Ie.network,nativeContract:Ie.contract,ckNFTCanister:Te.canisterId,tokenId:Te.tokenId}),console.log("â›½ Calculating gas parameters for NFT cast operation...");let Ue,He,Ge;try{if(!window.ethereum)throw new Error("MetaMask not available for gas estimation");const xt=await new Ot(window.ethereum).getFeeData();console.log("ðŸ“Š Current fee data for cast operation:",{gasPrice:(oe=xt.gasPrice)==null?void 0:oe.toString(),maxFeePerGas:(X=xt.maxFeePerGas)==null?void 0:X.toString(),maxPriorityFeePerGas:(ae=xt.maxPriorityFeePerGas)==null?void 0:ae.toString()}),Ue=xt.maxFeePerGas||xt.gasPrice||BigInt(5e10),He=xt.maxPriorityFeePerGas||BigInt(2e9),Ge=BigInt(3e5),console.log("âœ… Calculated cast gas parameters:",{gasPrice:Ue.toString(),maxPriorityFeePerGas:He.toString(),gasLimit:Ge.toString()})}catch(ze){console.warn("âš ï¸ Failed to get real-time gas data for cast, using fallback values:",ze),Ue=BigInt(5e10),He=BigInt(2e9),Ge=BigInt(3e5)}const Ee={tokenId:BigInt(Te.tokenId),gasPrice:[Ue],memo:[],fromSubaccount:[],remoteContract:{contract:j.address||"",network:w},maxPriorityFeePerGas:[He],created_at_time:[],gasLimit:[Ge],targetOwner:E};console.log("ðŸ“¤ Submitting ckNFT cast request:",{tokenId:Te.tokenId,canisterId:Te.canisterId,targetEVM:E,remoteContract:j.address});const{Actor:De}=await Xe(async()=>{const{Actor:ze}=await Promise.resolve().then(()=>Bt);return{Actor:ze}},void 0),{idlFactory:ft}=await Xe(async()=>{const{idlFactory:ze}=await import("./index-BykKOlZ5.js");return{idlFactory:ze}},__vite__mapDeps([0,1,2,3,4])),vt=De.createActor(ft,{agent:q,canisterId:qe.fromText(Te.canisterId)}),Le=R!=null&&R.principal?{owner:typeof R.principal=="string"?qe.fromText(R.principal):R.principal,subaccount:[]}:null;if(!Le)throw new Error("User account not available for casting");const rt=(await vt.icrc99_cast([Ee],[Le]))[0];if(rt&&rt[0]&&"Ok"in rt[0])console.log(`âœ… NFT ${ve+1}/${h.length} cast submitted successfully. Cast ID: ${rt.Ok}`),Fe.push(rt),_e.push(rt.Ok),Pe.push(`${Te.name||`Token ${Te.tokenId}`} â†’ EVM (Cast ID: ${rt.Ok})`);else{const ze=rt?rt.Err:"No result returned";console.error(`âŒ NFT ${ve+1}/${h.length} cast failed:`,ze);let xt="Cast operation failed";if(ze&&typeof ze=="object")if("InsufficientAllowance"in ze&&Array.isArray(ze.InsufficientAllowance)){const[bt,Ft]=ze.InsufficientAllowance;xt=`Insufficient allowance for NFT casting. Required: ${bt.toString()}, Available: ${Ft.toString()}. Please approve the NFT for transfer before casting.`}else if("InsufficientCycles"in ze&&Array.isArray(ze.InsufficientCycles)){const[bt,Ft]=ze.InsufficientCycles;xt=`Insufficient cycles for casting. Required: ${bt.toString()}, Available: ${Ft.toString()}. Please ensure sufficient cycles are available.`}else if("InsufficientBalance"in ze&&Array.isArray(ze.InsufficientBalance)){const[bt,Ft]=ze.InsufficientBalance;xt=`Insufficient balance for casting. Required: ${bt.toString()}, Available: ${Ft.toString()}.`}else if("NotFound"in ze)xt="NFT not found. Please ensure the NFT exists and you own it.";else if("Unauthorized"in ze)xt="Unauthorized to cast this NFT. Please ensure you own the NFT.";else if("ExistingCast"in ze)xt=`NFT is already being cast. Existing cast ID: ${ze.ExistingCast.toString()}`;else try{xt=`Cast operation failed: ${JSON.stringify(ze,(bt,Ft)=>typeof Ft=="bigint"?Ft.toString():Ft)}`}catch{xt=`Cast operation failed: ${String(ze)}`}else xt=`Cast operation failed: ${String(ze)}`;throw new Error(xt)}}catch(Ie){console.error(`âŒ Error casting NFT ${ve+1}/${h.length}:`,Ie),W("cast-nfts","failed",Ie instanceof Error?Ie.message:`Failed to cast NFT ${ve+1}`);return}}W("cast-nfts","completed",`Successfully submitted ${Fe.length} NFT(s) for casting`),W("wait-evm-confirmation","loading","Monitoring cast operations...");try{console.log("ðŸ” Monitoring cast operations:",_e.map(Ue=>Ue.toString()));let ve=30,Te=!1,Ie=[];for(;ve>0&&!Te;){W("wait-evm-confirmation","loading",`Monitoring cast operations... (${31-ve}/30 checks)`);try{const Ue=(je=h[0])==null?void 0:je.canisterId;if(!Ue)throw new Error("ckNFT canister ID not available for status check");const He=await U.getCastStatus.mutateAsync({castIds:_e,ckNFTCanisterId:Ue,account:R!=null&&R.principal?{owner:R.principal,subaccount:[]}:void 0});console.log("ðŸ” Cast status check results from ckNFT canister:",He);let Ge=0,Ee=!1;for(let De=0;De<He.length;De++){const ft=He[De],vt=ft&&ft[0];if(vt){console.log(`ðŸ” Cast ${_e[De]} state:`,vt);const Le=vt.status;if(Le&&"Completed"in Le){if(Ge++,console.log(`âœ… Cast ${_e[De]} completed with value:`,Le.Completed),vt.history)for(const At of vt.history){const[rt]=At;if(rt&&"WaitingOnTransfer"in rt){const ze=(Ae=rt.WaitingOnTransfer)==null?void 0:Ae.transaction;ze&&!Ie.includes(ze)&&(Ie.push(ze),console.log(`ðŸ“‹ Found transaction hash for cast ${_e[De]}: ${ze}`))}}}else Le&&("Error"in Le||"Failed"in Le)?(Ee=!0,console.error(`âŒ Cast operation ${_e[De]} failed:`,Le)):console.log(`â³ Cast ${_e[De]} still in progress:`,Le)}else console.warn(`âš ï¸ No status found for cast ID ${_e[De]}`)}if(Ee)throw new Error("One or more cast operations failed");Ge===_e.length?(Te=!0,console.log("ðŸŽ‰ All cast operations completed successfully!")):(console.log(`â³ Progress: ${Ge}/${_e.length} casts completed`),await new Promise(De=>setTimeout(De,1e4)))}catch(Ue){console.error("âŒ Error checking cast status:",Ue)}ve--}Te?W("wait-evm-confirmation","completed",`All ${Fe.length} NFT(s) successfully exported to EVM`):(console.warn("âš ï¸ Cast operations still in progress after monitoring timeout"),W("wait-evm-confirmation","completed","Cast operations submitted successfully. Final confirmation may take additional time."))}catch(ve){console.error("âŒ Error monitoring cast operations:",ve),W("wait-evm-confirmation","completed","Cast operations submitted. Monitoring encountered issues but exports should complete.")}ee({success:!0,evmTransactionHash:ke.length>0?ke[0]:void 0,icTransactionHash:_e.map(ve=>ve.toString()).join(", "),remoteContractAddress:j.address||"deployed-contract-address",tokenId:h.map(ve=>ve.tokenId).join(", ")}),console.log("ðŸŽ‰ ICRC-99 export process completed successfully!"),N("complete"),n==null||n({success:!0,evmTransactionHash:ke.length>0?ke[0]:void 0,icTransactionHash:_e.map(ve=>ve.toString()).join(", "),remoteContractAddress:j.address||"deployed-contract-address",tokenId:h.map(ve=>ve.tokenId).join(", ")})}catch(Fe){console.error("Export process failed:",Fe);const Pe=Fe instanceof Error?Fe.message:"Export failed";if(J!=null&&J.steps){const _e=J.steps.find(ke=>ke.status==="loading");_e&&W(_e.id,"failed",Pe)}ee({success:!1,error:Pe}),n==null||n({success:!1,error:Pe})}},[h,E,R,j,w,K,F,W,n,J,$,U]);console.log("EVMExportWizard initialized with steps:",j);const G=()=>{var Z,de;switch(g){case"select-ic-nft":return s.jsxs("div",{className:"space-y-4",children:[s.jsx(Gc,{sourceCanisterId:e,selectedNFTs:h,onSelectionChange:C,userPrincipal:R==null?void 0:R.principal,onCanisterChange:k,targetChain:"evm"}),h.length>0&&M&&s.jsxs("div",{className:"mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"flex items-center space-x-2",children:v.isLoading?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full"}),s.jsx("span",{className:"text-sm text-gray-600",children:"Checking ICRC-99 support..."})]}):v.isSupported?s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm text-green-700 font-medium",children:"ICRC-99 Supported"}),s.jsx("span",{className:"text-xs text-gray-500",children:"- Cross-chain casting available"})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-4 h-4 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm text-yellow-700 font-medium",children:"ICRC-7 Only"}),s.jsx("span",{className:"text-xs text-gray-500",children:"- IC-to-EVM casting available"})]})}),v.nativeChain&&K&&s.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[s.jsx("span",{className:"font-medium",children:"Source Network:"})," ","IC"in K.network?"Internet Computer":"Ethereum"in K.network?"Ethereum Network":"Other Network",s.jsx("br",{}),s.jsx("span",{className:"font-medium",children:"Contract:"})," ",s.jsx("span",{className:"font-mono",children:K.contract})]})]})]});case"connect":return s.jsx(Vc,{isConnected:H,account:he,supportedNetworks:t,currentNetwork:O&&f[O]||null,onConnect:Y,onSwitchNetwork:te=>{const fe=m[te];if(fe)return p(fe);throw new Error(`Unsupported network: ${te}`)},selectedTargetNetwork:w&&"Ethereum"in w&&f[Number(w.Ethereum[0])]||void 0,onTargetNetworkChange:te=>{const fe=m[te];fe&&B({Ethereum:[BigInt(fe)]})}});case"remote-contract":return s.jsx(iw,{selectedNFTs:h,targetChainId:w&&"Ethereum"in w&&((Z=w.Ethereum[0])==null?void 0:Z.toString())||"",remoteContractInfo:j,onRemoteContractInfoChange:Q,sourceCanisterId:((de=h[0])==null?void 0:de.canisterId)||"",sourceContractPointer:K});case"costs":return s.jsx(lw,{selectedNFTs:h,targetNetwork:w,remoteContractInfo:j,sourceContractPointer:K,onCostsCalculated:_});case"export":return s.jsx(dw,{progress:J,onRetryStep:le,onToggleStage:()=>{}});case"complete":return s.jsx(uw,{result:T,onStartNew:()=>{N("select-ic-nft"),C([]),B(null),Q(null),_(null),ee(null),$("ic-to-evm")},onClose:()=>r==null?void 0:r()});default:return null}},P=s.jsxs("div",{className:be("bg-white rounded-lg shadow-lg",o&&"max-w-4xl mx-auto",a),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Export NFTs to EVM"}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Step ",ue+1," of ",L.length,": ",(z=L[ue])==null?void 0:z.description]})]}),r&&s.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(ra,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"px-6 py-4 border-b border-gray-100",children:[s.jsx("div",{className:"flex items-center justify-between",children:L.map((Z,de)=>s.jsxs("div",{className:be("flex items-center",de<L.length-1&&"flex-1"),children:[s.jsx("div",{className:be("flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium",de<ue?"bg-green-100 text-green-600":de===ue?se?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-400"),children:de<ue?s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):de===ue&&se?s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}):de+1}),s.jsx("span",{className:be("ml-2 text-sm font-medium hidden sm:inline",de<=ue?"text-gray-900":"text-gray-400",de===ue&&se&&"text-red-600"),children:Z.title}),de<L.length-1&&s.jsx("div",{className:be("flex-1 h-0.5 mx-4",de<ue?"bg-green-200":"bg-gray-200")})]},Z.id))}),se&&s.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-md",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-4 h-4 text-red-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsxs("span",{className:"text-sm text-red-700 font-medium",children:["Error in ",(A=L[ue])==null?void 0:A.title]}),s.jsx("span",{className:"ml-2 text-xs text-red-600",children:"Use the Previous button to go back and retry"})]})})]}),s.jsx("div",{className:"p-6 min-h-[400px]",children:G()}),s.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[s.jsxs("button",{onClick:ne,disabled:!Ne,className:be("flex items-center px-4 py-2 text-sm font-medium rounded-md transition-colors",Ne?se?"text-white bg-red-600 hover:bg-red-700":"text-gray-700 bg-gray-100 hover:bg-gray-200":"text-gray-400 bg-gray-50 cursor-not-allowed"),children:[s.jsx(ta,{className:"w-4 h-4 mr-1"}),se?"Go Back & Retry":"Previous"]}),s.jsxs("div",{className:"flex space-x-3",children:[g==="costs"&&re()&&s.jsxs("button",{onClick:ye,className:"flex items-center px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors",children:["Start Export",s.jsx(Is,{className:"w-4 h-4 ml-1"})]}),g!=="costs"&&g!=="export"&&g!=="complete"&&s.jsxs("button",{onClick:ge,disabled:!re(),className:be("flex items-center px-6 py-2 text-sm font-medium rounded-md transition-colors",re()?"text-white bg-blue-600 hover:bg-blue-700":"text-gray-400 bg-gray-100 cursor-not-allowed"),children:["Next",s.jsx(Is,{className:"w-4 h-4 ml-1"})]})]})]})]});return o?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:P}):P}function dw({progress:e,onRetryStep:t,onToggleStage:n}){var l,u,d,m;if(!e)return s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Initializing export process..."})]});const a=(((l=e.steps)==null?void 0:l.filter(f=>f.status==="loading"||f.status==="failed"))||[])[0],o=((u=e.steps)==null?void 0:u.some(f=>f.status==="failed"))||!1,i=((d=e.steps)==null?void 0:d.filter(f=>f.status==="completed"))||[],c=((m=e.steps)==null?void 0:m.length)||0;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:o?"Export Failed":"Export in Progress"}),s.jsx("p",{className:"text-gray-600",children:o?"An error occurred during the export process.":"Exporting your ckNFTs back to the EVM blockchain..."})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progress"}),s.jsxs("span",{className:"text-sm text-gray-500",children:[i.length," of ",c," steps completed"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${o?"bg-red-500":"bg-blue-600"}`,style:{width:`${i.length/c*100}%`}})})]}),a&&s.jsxs("div",{className:`p-4 rounded-lg border ${a.status==="failed"?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:[s.jsxs("div",{className:"flex items-center",children:[a.status==="loading"?s.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full mr-3"}):s.jsx("svg",{className:"w-5 h-5 text-red-500 mr-3",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsxs("div",{children:[s.jsxs("h4",{className:`font-medium ${a.status==="failed"?"text-red-800":"text-blue-800"}`,children:[a.status==="loading"?"In Progress: ":"Failed: ",a.title||a.id]}),a.error&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.error}),a.status==="loading"&&s.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Please wait..."})]})]}),a.status==="failed"&&s.jsx("div",{className:"mt-3",children:s.jsx("button",{onClick:()=>t(a.id),className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",children:"Retry Step"})})]}),!a&&!o&&c>0&&s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-5 h-5 text-green-500 mr-3",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-green-800",children:"Export Complete!"}),s.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Your ckNFTs have been successfully exported to EVM."})]})]})}),s.jsxs("details",{className:"mt-6",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"Show Detailed Progress"}),s.jsx("div",{className:"mt-3 p-4 bg-gray-50 rounded-lg",children:s.jsx(jc,{progress:e,onRetryStep:t,onToggleStage:n})})]})]})}function uw({result:e,onStartNew:t,onClose:n}){const r=e.tokenId?e.tokenId.split(", "):[],a=r.length>1;return s.jsxs("div",{className:"space-y-6 text-center",children:[s.jsx("div",{children:e.success?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:a?`${r.length} NFTs Exported Successfully!`:"Export Successful!"}),s.jsx("p",{className:"text-gray-600",children:a?`Your ${r.length} ckNFTs have been successfully exported back to the EVM blockchain.`:"Your ckNFT has been successfully exported back to the EVM blockchain."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"6 18L18 6M6 6l12 12"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Export Failed"}),s.jsx("p",{className:"text-gray-600",children:e.error})]})}),e.success&&s.jsxs("div",{className:"space-y-3 text-sm",children:[e.remoteContractAddress&&s.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-blue-800 mb-1",children:"EVM Contract"}),s.jsx("p",{className:"text-blue-700 font-mono text-xs break-all",children:e.remoteContractAddress})]}),r.length>0&&s.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-green-800 mb-1",children:a?"Exported Token IDs":"Exported Token ID"}),s.jsx("p",{className:"text-green-700",children:e.tokenId})]}),e.evmTransactionHash&&s.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-gray-800 mb-1",children:"EVM Transaction"}),s.jsx("p",{className:"text-gray-700 font-mono text-xs break-all",children:e.evmTransactionHash})]})]}),s.jsxs("div",{className:"flex justify-center space-x-4",children:[s.jsx("button",{onClick:t,className:"px-6 py-2 text-blue-600 border border-blue-600 rounded-md hover:bg-blue-50 transition-colors",children:"Export More NFTs"}),s.jsx("button",{onClick:n,className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"Close"})]})]})}const cf=[{inputs:[{internalType:"string",name:"_name",type:"string"},{internalType:"string",name:"_symbol",type:"string"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"address",name:"owner",type:"address"}],name:"ERC721IncorrectOwner",type:"error"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ERC721InsufficientApproval",type:"error"},{inputs:[{internalType:"address",name:"approver",type:"address"}],name:"ERC721InvalidApprover",type:"error"},{inputs:[{internalType:"address",name:"operator",type:"address"}],name:"ERC721InvalidOperator",type:"error"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"ERC721InvalidOwner",type:"error"},{inputs:[{internalType:"address",name:"receiver",type:"address"}],name:"ERC721InvalidReceiver",type:"error"},{inputs:[{internalType:"address",name:"sender",type:"address"}],name:"ERC721InvalidSender",type:"error"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ERC721NonexistentToken",type:"error"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"OwnableInvalidOwner",type:"error"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"OwnableUnauthorizedAccount",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_fromTokenId",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_toTokenId",type:"uint256"}],name:"BatchMetadataUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_tokenId",type:"uint256"}],name:"MetadataUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"string",name:"uri",type:"string"}],name:"mint_icrc99",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"}];var mw={};function hw({selectedNFTs:e,targetNetwork:t,costs:n,onCostsCalculated:r,compact:a=!1,isConnected:o,activeAddress:i}){var U;const[c,l]=x.useState(!1),[u,d]=x.useState(null),[m,f]=x.useState(null),[g,N]=x.useState(""),[h,C]=x.useState(null),[w,B]=x.useState(null),[j,Q]=x.useState(!1),[F,_]=x.useState(!1),{user:M}=ut(),{activeAddress:k,isUnlocked:K}=an(),V=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),T=mw.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",ee=js(T),J=M!=null&&M.principal?{owner:typeof M.principal=="string"?qe.fromText(M.principal):M.principal,subaccount:[]}:void 0,pe=ee.useBalance(J),E=oa(n==null?void 0:n.cyclesCost),b=i||k,Y=o!==void 0?o:K&&!!b,p=S=>`${(Number(S)/1e12).toFixed(2)} T`,O=S=>h?h>=S:!1;x.useEffect(()=>{pe.data!==void 0&&C(pe.data)},[pe.data]),x.useEffect(()=>{if(E.data&&(n!=null&&n.cyclesCost)){const S={amount:E.data.allowance,isExpired:E.data.isExpired,isSufficient:E.data.allowance>=n.cyclesCost};B(S);const H=S.isSufficient&&!S.isExpired;Q(H)}},[E.data,n==null?void 0:n.cyclesCost]);const R=async()=>{if(!(n!=null&&n.cyclesCost)||!(M!=null&&M.principal)){d("Missing required information for payment approval");return}_(!0),d(null);try{if(console.log("ðŸ§® Approving cycles payment:",{cyclesCost:n.cyclesCost.toString(),userPrincipal:M.principal.toString()}),h!==null&&h<n.cyclesCost)throw new Error(`Insufficient cycles balance. You have ${p(h)} but need ${p(n.cyclesCost)}. Please deposit more cycles to your account.`);const S=qe.fromText("jio3a-xaaaa-aaaal-ab66q-cai"),H=BigInt(Date.now()*1e6+1440*60*1e9);await V.cyclesApprove.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:n.cyclesCost,expected_allowance:[],expires_at:[H],spender:{owner:S,subaccount:[]}}),console.log("âœ… Cycles approval successful"),Q(!0),await E.refetch()}catch(S){console.error("âŒ Error approving cycles payment:",S);let H="Failed to approve cycles payment";S instanceof Error&&(S.message.includes("user rejected")?H="Payment approval cancelled by user":S.message.includes("insufficient funds")?H="Insufficient cycles for approval transaction":(S.message.includes("Insufficient cycles balance"),H=S.message)),d(H)}finally{_(!1)}};if(console.log("ðŸ” BurnCostStep Debug:",{selectedNFTs:e.length,firstNFT:e[0]?{contractAddress:e[0].contractAddress,tokenId:e[0].tokenId,name:e[0].name}:null,targetNetwork:t?JSON.stringify(t,(S,H)=>typeof H=="bigint"?H.toString():H):null,activeAddress:b,hookActiveAddress:k,parentActiveAddress:i,isUnlocked:K,isConnected:o,effectiveIsConnected:Y,userPrincipal:(U=M==null?void 0:M.principal)==null?void 0:U.toString(),costs:!!n}),e.length>0){const S=e[0];console.log("ðŸ” Contract Address Analysis:",{"firstNFT.contractAddress":S.contractAddress,"is mock 0x1234...":S.contractAddress==="0x1234567890123456789012345678901234567890","contractAddress type":typeof S.contractAddress,"contractAddress length":S.contractAddress.length,"first 10 chars":S.contractAddress.slice(0,10),"all selectedNFTs":e.map(H=>({contractAddress:H.contractAddress,tokenId:H.tokenId,name:H.name}))})}x.useEffect(()=>{e.length>0&&t&&!n&&!c&&q()},[e,t,n]);const q=async()=>{if(e.length===0||!t||!(M!=null&&M.principal)){d("Missing required information for cost calculation");return}if(!b||!Y){d("MetaMask wallet must be connected for gas estimation");return}l(!0),d(null);try{console.log("ðŸ§® Calculating burn costs for NFTs:",e.length,"selected"),console.log("ðŸ”¥ Note: User will pay EVM gas fees from their own wallet for NFT transfers to burn addresses");let S=BigInt(0),H=BigInt(0),he=BigInt(0);const $=[];for(let re=0;re<e.length;re++){const se=e[re];console.log(`ðŸ”¥ Processing NFT ${re+1}/${e.length}:`,se),N(`Finding ckNFT canister for NFT ${re+1}/${e.length}...`);const Ne={contract:se.contractAddress,network:t};console.log("ðŸ” Looking for ckNFT canister with REMOTE contract pointer for burn:",Ne);const ge=await V.getCkNFTCanister.mutateAsync([Ne]);if(!ge||ge.length===0||!ge[0]){const ke=t&&"Ethereum"in t?"Ethereum":"Unknown Network";throw new Error(`No ckNFT canister found for contract ${se.contractAddress} on ${ke}. This cast NFT collection needs to be imported first using the Import wizard. Go to the Import tab to create a ckNFT canister for this collection before burning cast NFTs.`)}const ne=ge[0];console.log("âœ… Found ckNFT canister:",ne.toString()),re===0&&f(ne),N(`Getting burn funding address for NFT ${re+1}/${e.length}...`),console.log("ðŸ”¥ Getting burn funding address...");const ye={ckNFTCanisterId:ne,tokenId:BigInt(se.tokenId)};console.log("ðŸ” BURN ADDRESS REQUEST DEBUG:",{ckNFTCanisterId:ne.toString(),tokenId:se.tokenId,tokenIdBigInt:ye.tokenId.toString(),currentNFT:{contractAddress:se.contractAddress,tokenId:se.tokenId,name:se.name},targetNetwork:t?JSON.stringify(t,(ke,ve)=>typeof ve=="bigint"?ve.toString():ve):null,activeUserAddress:b,note:"ISSUE: This will use NATIVE chain, but we need TARGET chain for burn!"}),console.log("ðŸŽ¯ Using getApprovalAddress with TARGET network for burn address...");const G={account:{owner:typeof M.principal=="string"?qe.fromText(M.principal):M.principal,subaccount:[]},remoteNFTPointer:{tokenId:BigInt(se.tokenId),contract:se.contractAddress,network:t}};console.log("ðŸŽ¯ APPROVAL ADDRESS REQUEST (anonymous call):",{account:{owner:G.account.owner.toString(),subaccount:G.account.subaccount},remoteNFTPointer:{tokenId:G.remoteNFTPointer.tokenId.toString(),contract:G.remoteNFTPointer.contract,network:JSON.stringify(G.remoteNFTPointer.network,(ke,ve)=>typeof ve=="bigint"?ve.toString():ve)},note:"This is an anonymous call - no wallet authorization needed"});const P=await V.getApprovalAddress.mutateAsync({request:G});if(!P)throw new Error(`Failed to get approval address for burn operation on target network for NFT ${se.tokenId}`);console.log("âœ… Got burn/approval address for target network:",P),console.log("ðŸ” BURN ADDRESS ANALYSIS:",{returnedAddress:P,expectedFromLogs:"0xadf4de73a3dc0927bc250cd781ee889a91d27751",wrongAddressFromLogs:"0x28e740648dd181db11c61e3834053d08b046ea3c",isExpected:P.toLowerCase()==="0xadf4de73a3dc0927bc250cd781ee889a91d27751".toLowerCase(),isWrongAddress:P.toLowerCase()==="0x28e740648dd181db11c61e3834053d08b046ea3c".toLowerCase(),note:"Should match expected address from logs, not the wrong one"}),N(`Calculating IC cast cost for remote NFT ${re+1}/${e.length}...`),console.log("ðŸ’° Calculating cast cost for remote NFT...");const{Actor:z,HttpAgent:A}=await Xe(async()=>{const{Actor:ke,HttpAgent:ve}=await Promise.resolve().then(()=>Bt);return{Actor:ke,HttpAgent:ve}},void 0),{idlFactory:Z}=await Xe(async()=>{const{idlFactory:ke}=await Promise.resolve().then(()=>K0);return{idlFactory:ke}},void 0),de=new A({host:"https://icp0.io"}),te=z.createActor(Z,{agent:de,canisterId:ne}),fe={network:t,contract:se.contractAddress,tokenId:BigInt(se.tokenId)};console.log("ðŸ“‹ Cast cost request for remote NFT burn:",fe);const xe=await te.icrc99_cast_cost(fe);let oe;if(typeof xe=="bigint")oe=xe;else if(Array.isArray(xe)&&xe.length>0)oe=xe[0];else throw new Error(`Invalid cast cost result format from ckNFT canister for NFT ${se.tokenId}`);if(console.log("âœ… Cast cost calculated:",oe.toString()),N(`Validating NFT ownership and estimating gas costs for NFT ${re+1}/${e.length}...`),console.log("ðŸ‘¤ Validating NFT ownership and estimating gas costs..."),!window.ethereum)throw new Error("MetaMask not found - cannot estimate gas costs");const X=new Ot(window.ethereum),ae=await X.getSigner(),je=new Tn(se.contractAddress,cf,ae);try{const ke=await je.ownerOf(BigInt(se.tokenId));if(ke.toLowerCase()!==b.toLowerCase())throw new Error(`You don't own NFT ${se.tokenId}. Current owner: ${ke.slice(0,6)}...${ke.slice(-4)}`);console.log("âœ… NFT ownership verified")}catch(ke){throw ke.message.includes("You don't own")?ke:new Error(`Failed to verify NFT ownership for ${se.tokenId}: ${ke.message}`)}console.log("â›½ Estimating gas costs for user wallet...");const Ae=await je.safeTransferFrom.estimateGas(b,P,BigInt(se.tokenId));console.log("âœ… Gas estimated:",Ae.toString());const Fe=await X.getFeeData(),Pe=Fe.gasPrice||Fe.maxFeePerGas||BigInt(2e10),_e=Ae*Pe;console.log("ðŸ’° Gas calculation (user will pay):",{gasEstimate:Ae.toString(),gasPrice:Pe.toString(),totalCost:_e.toString(),costInEth:et(_e)}),S+=oe,H+=_e,he+=Ae,$.push({nft:se,cyclesCost:oe,ethCost:_e,gasEstimate:Ae,ckNFTCanisterId:ne,burnFundingAddress:P})}console.log("ðŸ’° Checking user ETH balance for gas payments...");const le=await new Ot(window.ethereum).getBalance(b),ce=le<H;console.log("ðŸ’° User ETH balance check:",{userAddress:b,userBalance:et(le),requiredForGas:et(H),hasSufficientBalance:!ce});const L=$[0],ue={cyclesCost:S,ethCost:H,gasEstimate:he,ckNFTCanisterId:L.ckNFTCanisterId,burnFundingAddress:L.burnFundingAddress,userEthBalance:le,hasInsufficientEthBalance:ce,nftDetails:$};console.log("âœ… Final burn costs calculated for all NFTs:",{totalNFTs:e.length,totalCyclesCost:ue.cyclesCost.toString(),totalEthCost:ue.ethCost.toString(),totalGasEstimate:ue.gasEstimate.toString(),userEthBalance:et(le),hasInsufficientEthBalance:ce,note:"User will pay gas fees from their own wallet",nftDetails:$.map(re=>({tokenId:re.nft.tokenId,cyclesCost:re.cyclesCost.toString(),ethCost:re.ethCost.toString()}))}),N(""),r(ue)}catch(S){console.error("âŒ Error calculating burn costs:",S);let H="Failed to calculate burn costs";S instanceof Error&&(S.message.includes("user rejected")?H="Gas estimation cancelled by user":S.message.includes("insufficient funds")?H="Insufficient funds for gas estimation":(S.message.includes("No ckNFT canister found"),H=S.message)),d(H),N("")}finally{l(!1)}},v=()=>{d(null),q()};return a&&n?s.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-4 h-4 text-green-600 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-green-800",children:"Burn costs calculated"})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Calculate Burn Costs"}),s.jsx("p",{className:"text-gray-600",children:"Review the costs for burning your EVM NFT and minting it on the Internet Computer."})]}),u&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-3 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-red-800",children:u}),s.jsx("button",{onClick:v,className:"mt-2 text-sm text-red-700 hover:text-red-800 underline",children:"Try again"})]})]})}),c&&s.jsxs("div",{className:"p-6 text-center",children:[s.jsx(Qe,{className:"w-6 h-6 animate-spin mx-auto mb-3 text-blue-600"}),s.jsx("p",{className:"text-gray-600",children:"Calculating burn costs..."}),g&&s.jsx("p",{className:"text-sm text-blue-600 mt-1 font-medium",children:g}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"This may take a moment while we query the ckNFT canister and estimate gas costs"})]}),n&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("span",{className:"font-medium text-blue-800",children:"IC Operation Cost"}),s.jsxs("span",{className:"text-blue-700 font-mono text-sm",children:[(Number(n.cyclesCost)/1e12).toFixed(2)," T cycles"]})]}),s.jsx("p",{className:"text-xs text-blue-600",children:"Required for minting ckNFT on Internet Computer"})]}),s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("span",{className:"font-medium text-green-800",children:"EVM Gas Cost"}),s.jsxs("div",{className:"text-right",children:[s.jsxs("span",{className:"text-green-700 font-mono text-sm block",children:[et(n.ethCost)," ETH"]}),s.jsxs("span",{className:"text-green-600 text-xs",children:[n.gasEstimate.toString()," gas"]})]})]}),s.jsx("p",{className:"text-xs text-green-600",children:"Real-time gas estimate for NFT transfer to burn address"})]}),s.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("span",{className:"font-medium text-purple-800",children:"Your ETH Balance"}),s.jsx("div",{className:"text-right",children:n.userEthBalance!==void 0?s.jsxs("span",{className:be("font-mono text-sm block",n.hasInsufficientEthBalance?"text-red-700":"text-green-700"),children:[et(n.userEthBalance)," ETH"]}):s.jsx("span",{className:"text-gray-500 text-sm",children:"Unknown"})})]}),s.jsxs("div",{className:"text-xs",children:[s.jsxs("div",{className:"text-purple-600 mb-1",children:["Address: ",b==null?void 0:b.slice(0,6),"...",b==null?void 0:b.slice(-4)]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-purple-600",children:"Status:"}),n.userEthBalance!==void 0?s.jsx("span",{className:be("font-medium",n.hasInsufficientEthBalance?"text-red-600":"text-green-600"),children:n.hasInsufficientEthBalance?"Insufficient":"Sufficient"}):s.jsx("span",{className:"text-gray-500",children:"Checking..."})]})]})]})]}),n.hasInsufficientEthBalance&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-2"}),s.jsx("span",{className:"font-medium text-red-800",children:"Insufficient ETH for Gas Fees"})]}),s.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["You need ",et(n.ethCost)," ETH for gas fees but only have ",n.userEthBalance?et(n.userEthBalance):"0"," ETH.",s.jsx("br",{}),s.jsxs("span",{className:"text-xs text-red-600 font-mono",children:["Your Address: ",b]}),s.jsx("br",{}),"Please deposit ",n.userEthBalance?et(n.ethCost-n.userEthBalance):et(n.ethCost)," ETH to your wallet before proceeding."]}),s.jsxs("div",{className:"mt-3 flex space-x-2",children:[s.jsx("button",{onClick:()=>navigator.clipboard.writeText(b||""),className:"px-3 py-1 text-xs font-medium text-red-700 bg-red-100 rounded-md hover:bg-red-200 transition-colors",children:"Copy Your Address"}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-3 py-1 text-xs font-medium text-red-700 bg-red-100 rounded-md hover:bg-red-200 transition-colors",children:"Refresh Balance"})]})]}),s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsxs("h4",{className:"font-medium text-gray-800 mb-2",children:["Selected NFTs (",e.length,")"]}),s.jsxs("div",{className:"space-y-3",children:[e.map((S,H)=>s.jsx("div",{className:"p-3 bg-white border border-gray-200 rounded-md",children:s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{children:[s.jsxs("span",{className:"text-gray-600",children:["NFT #",H+1,":"]}),s.jsx("span",{className:"ml-2 font-medium text-gray-800",children:S.name||`Token ${S.tokenId}`})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Contract:"}),s.jsxs("span",{className:"ml-2 font-mono text-gray-800",children:[S.contractAddress.slice(0,6),"...",S.contractAddress.slice(-4)]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Token ID:"}),s.jsx("span",{className:"ml-2 font-medium text-gray-800",children:S.tokenId})]})]})},`${S.contractAddress}-${S.tokenId}`)),m&&s.jsx("div",{className:"pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"ckNFT Canister:"}),s.jsx("span",{className:"ml-2 font-mono text-gray-800",children:m.toString()})]})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Payment Approval"}),s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(na,{className:"w-5 h-5 text-gray-600 mr-2"}),s.jsx("h5",{className:"font-medium text-gray-900",children:"Your Cycles Balance"})]}),pe.isLoading?s.jsx(Qe,{className:"w-4 h-4 animate-spin text-gray-500"}):s.jsx("span",{className:be("font-medium",h!==null&&h>=n.cyclesCost?"text-green-600":"text-red-600"),children:h!==null?p(h):"Unknown"})]}),h!==null&&s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-gray-600",children:"Required:"}),s.jsx("span",{className:"text-gray-900",children:p(n.cyclesCost)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Remaining after burn:"}),s.jsx("span",{className:be("font-medium",h>=n.cyclesCost?"text-green-600":"text-red-600"),children:h>=n.cyclesCost?p(h-n.cyclesCost):"Insufficient Balance"})]})]}),h!==null&&h<n.cyclesCost&&s.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-md",children:s.jsxs("p",{className:"text-sm text-red-700",children:["âš ï¸ Insufficient cycles balance. Please deposit ",p(n.cyclesCost-h)," more."]})})]}),w&&s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(sa,{className:"w-5 h-5 text-blue-600 mr-2"}),s.jsx("h5",{className:"font-medium text-blue-900",children:"Current Allowance"})]}),s.jsx("span",{className:be("font-medium",w.isSufficient&&!w.isExpired?"text-green-600":"text-orange-600"),children:p(w.amount)})]}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-blue-600",children:"Status:"}),s.jsx("span",{className:be("font-medium",w.isSufficient&&!w.isExpired?"text-green-600":"text-orange-600"),children:w.isExpired?"Expired":w.isSufficient?"Sufficient":"Insufficient"})]}),w.isExpired&&s.jsx("p",{className:"text-orange-700 text-xs",children:"Your previous allowance has expired. A new approval is required."}),!w.isSufficient&&!w.isExpired&&s.jsx("p",{className:"text-orange-700 text-xs",children:"Your current allowance is insufficient for this burn operation."})]})]}),j?s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-5 h-5 text-green-600 mr-2"}),s.jsx("span",{className:"font-medium text-green-800",children:"Payment Approved"})]}),s.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Cycles approved for burn operation. You can now proceed with the burn."}),s.jsxs("div",{className:"mt-2 text-xs text-green-600",children:["Approved: ",w?p(w.amount):"Unknown amount"]})]}):s.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Approve Cycles Payment"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Authorize the orchestrator to use ",p(n.cyclesCost)," for this burn"]})]}),s.jsx("button",{onClick:R,disabled:F||pe.isLoading||h!==null&&h<n.cyclesCost,className:be("px-6 py-2 rounded-md font-medium transition-colors",F||pe.isLoading||h!==null&&h<n.cyclesCost?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:F?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Approving..."]}):pe.isLoading?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Checking Balance..."]}):"Approve Payment"})]}),s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsx("p",{className:"mb-1",children:"This will:"}),s.jsxs("ul",{className:"list-disc list-inside text-xs space-y-0.5 ml-2",children:[s.jsxs("li",{children:["Authorize the orchestrator to spend ",p(n.cyclesCost)," from your account"]}),s.jsx("li",{children:"Enable the burn operation to proceed"}),s.jsx("li",{children:"Set approval to expire in 24 hours for security"})]})]}),h!==null&&h<n.cyclesCost&&s.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-700",children:"âš ï¸ Insufficient cycles balance. Please deposit more cycles before approving."})})]}),h!==null&&!O(n.cyclesCost)&&s.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("p",{className:"text-sm text-blue-800 mb-2",children:[s.jsx("strong",{children:"Need more cycles?"})," You can top up your cycles balance by:"]}),s.jsxs("ul",{className:"text-xs text-blue-700 space-y-1 ml-4 list-disc",children:[s.jsx("li",{children:"Converting ICP to cycles using the NNS dapp"}),s.jsx("li",{children:"Using the cycles faucet (if available)"}),s.jsx("li",{children:"Purchasing cycles directly from the Network Nervous System"})]})]})]}),j&&!n.hasInsufficientEthBalance&&s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-green-900",children:"Ready to Proceed"}),s.jsxs("p",{className:"text-sm text-green-600",children:["Costs calculated and payment approved. Go to the Burn tab to execute the burn for ",e.length," NFT",e.length>1?"s":"","."]})]}),s.jsx(gt,{className:"w-8 h-8 text-green-600"})]}),s.jsxs("div",{className:"text-sm text-green-600",children:[s.jsx("p",{className:"mb-1",children:"Next steps:"}),s.jsxs("ul",{className:"list-disc list-inside text-xs space-y-0.5 ml-2",children:[s.jsx("li",{children:"Navigate to the Burn Transaction tab"}),s.jsx("li",{children:"Review the transaction details"}),s.jsx("li",{children:"Execute the burn operation"})]})]})]}),j&&n.hasInsufficientEthBalance&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-red-900",children:"Cannot Proceed - Insufficient ETH"}),s.jsx("p",{className:"text-sm text-red-600",children:"You need more ETH in your wallet to pay for gas fees before proceeding to burn."})]}),s.jsx(lt,{className:"w-8 h-8 text-red-600"})]}),s.jsxs("div",{className:"text-sm text-red-700",children:[s.jsx("p",{className:"mb-1",children:"Required:"}),s.jsxs("ul",{className:"list-disc list-inside text-xs space-y-0.5 ml-2",children:[s.jsxs("li",{children:[et(n.ethCost)," ETH for gas fees"]}),s.jsxs("li",{children:["Your current balance: ",n.userEthBalance?et(n.userEthBalance):"0"," ETH"]}),s.jsxs("li",{children:["Shortfall: ",n.userEthBalance?et(n.ethCost-n.userEthBalance):et(n.ethCost)," ETH"]})]})]})]}),s.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-amber-800",children:[s.jsx("strong",{children:"Note:"})," The burn process will transfer your cast NFT to a special burn address (you pay gas fees), then remint an equivalent ckNFT on the Internet Computer using the remote contract reference. This process is irreversible."]})})]})]})}function fw({selectedNFTs:e,targetNetwork:t,costs:n,onTransactionComplete:r,onTransactionError:a,onBack:o}){const[i,c]=x.useState({status:"idle",currentStep:"",evmTxHashes:[],mintResults:[],currentNFTIndex:0,totalNFTs:e.length}),{activeAddress:l,chainId:u}=an(),{user:d}=ut(),m=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),f=e.length,g=C=>{switch(u){case 1:return`https://etherscan.io/tx/${C}`;case 137:return`https://polygonscan.com/tx/${C}`;case 56:return`https://bscscan.com/tx/${C}`;case 42161:return`https://arbiscan.io/tx/${C}`;case 10:return`https://optimistic.etherscan.io/tx/${C}`;case 8453:return`https://basescan.org/tx/${C}`;case 31337:case 1338:return`http://localhost:8545/tx/${C}`;default:return`https://etherscan.io/tx/${C}`}},N=async()=>{var C,w,B;if(!(n!=null&&n.nftDetails)||n.nftDetails.length===0||!window.ethereum||!(d!=null&&d.principal)||!t){const j="Missing required data for burn execution";c(Q=>({...Q,status:"failed",error:j})),a(j);return}try{const Q=await new Ot(window.ethereum).getSigner();console.log("ðŸ”¥ Starting complete burn process for",n.nftDetails.length,"NFTs"),c(M=>({...M,status:"transferring",currentStep:"Preparing EVM transfers...",totalNFTs:n.nftDetails.length}));const F=[];for(let M=0;M<n.nftDetails.length;M++){const k=n.nftDetails[M];c(ee=>({...ee,currentStep:`Transferring NFT ${M+1}/${n.nftDetails.length} to burn address...`,currentNFTIndex:M})),console.log(`ðŸ”¥ Transferring NFT ${k.nft.tokenId} to burn address:`,k.burnFundingAddress);const V=await new Tn(k.nft.contractAddress,cf,Q).safeTransferFrom(l,k.burnFundingAddress,BigInt(k.nft.tokenId));console.log(`âœ… NFT ${k.nft.tokenId} transfer tx sent:`,V.hash),F.push(V.hash),c(ee=>({...ee,status:"confirming",currentStep:`Waiting for NFT ${M+1}/${n.nftDetails.length} transfer confirmation...`,evmTxHashes:F}));const T=await V.wait();console.log(`âœ… NFT ${k.nft.tokenId} transfer confirmed:`,T)}c(M=>({...M,status:"reminting",currentStep:"Starting IC remint operations..."}));const _=[];for(let M=0;M<n.nftDetails.length;M++){const k=n.nftDetails[M];c(T=>({...T,currentStep:`Reminting ckNFT ${M+1}/${n.nftDetails.length} on IC...`,currentNFTIndex:M}));const K={nft:{tokenId:BigInt(k.nft.tokenId),contract:k.nft.contractAddress,network:t},resume:[],mintToAccount:{owner:d.principal,subaccount:[]},spender:[]};console.log("ðŸŽ¯ Executing IC remint for NFT using remote contract reference:",{mintRequest:K,remoteContractAddress:k.nft.contractAddress,targetNetwork:t,note:"This follows the remintCkNFT pattern from App.tsx"});const V=await m.mintFromEVM.mutateAsync({request:K,requiredCycles:k.cyclesCost,skipApproval:!0});console.log(`âœ… IC remint completed for NFT ${k.nft.tokenId} using remote contract:`,V),_.push(V)}c(M=>({...M,status:"completed",currentStep:"Burn completed successfully!",evmTxHashes:F,mintResults:_})),console.log("ðŸŽ‰ Complete burn process finished successfully:",{nftsProcessed:n.nftDetails.length,evmTransactions:F,mintResults:_}),r(F[0])}catch(j){console.error("âŒ Error during burn execution:",j);let Q="Failed to execute burn operation";j.code===4001?Q="Transaction rejected by user":(C=j.message)!=null&&C.includes("user rejected")?Q="Burn operation cancelled by user":(w=j.message)!=null&&w.includes("insufficient funds")?Q="Insufficient funds for gas fees":(B=j.message)!=null&&B.includes("execution reverted")?Q="Transaction reverted. NFT may not be owned by your address or already transferred.":j.message&&(Q=j.message),c(F=>({...F,status:"failed",error:Q})),a(Q)}},h=()=>{c({status:"idle",currentStep:"",evmTxHashes:[],mintResults:[],currentNFTIndex:0,totalNFTs:e.length})};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Execute Complete Burn Process"}),s.jsx("p",{className:"text-gray-600",children:"Transfer your cast NFTs to burn addresses and remint them as ckNFTs on the Internet Computer."})]}),s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Burn Process Details"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Total NFTs:"}),s.jsx("span",{className:"font-medium text-gray-800",children:f})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Your Address:"}),s.jsxs("span",{className:"font-mono text-gray-800",children:[l==null?void 0:l.slice(0,6),"...",l==null?void 0:l.slice(-4)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Process:"}),s.jsx("span",{className:"text-gray-800",children:"EVM Transfer â†’ IC Remint"})]})]})]}),i.status==="idle"&&n&&s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"Ready to Execute"}),s.jsxs("div",{className:"space-y-2 text-sm text-green-700",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:"âœ… Cycles Payment:"}),s.jsxs("span",{className:"font-medium",children:[(Number(n.cyclesCost)/1e12).toFixed(2)," T approved"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:"âœ… Gas Estimation:"}),s.jsxs("span",{className:"font-medium",children:[n.gasEstimate.toString()," gas (~",(Number(n.ethCost)/1e18).toFixed(4)," ETH)"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:"âœ… Target Addresses:"}),s.jsxs("span",{className:"font-medium",children:[e.length," burn addresses calculated"]})]})]}),s.jsx("p",{className:"text-xs text-green-600 mt-2",children:'Click "Execute Burn Process" below to start the irreversible burn and remint operation.'})]}),i.status!=="idle"&&i.status!=="failed"&&s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center mb-3",children:[s.jsx(Qe,{className:"w-5 h-5 animate-spin text-blue-600 mr-3"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("p",{className:"text-sm font-medium text-blue-800",children:["Processing NFT ",i.currentNFTIndex+1," of ",i.totalNFTs]}),s.jsx("p",{className:"text-xs text-blue-600",children:i.currentStep})]})]}),s.jsx("div",{className:"w-full bg-blue-100 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${(i.currentNFTIndex+(i.status==="completed"?1:0))/i.totalNFTs*100}%`}})}),i.evmTxHashes.length>0&&s.jsxs("div",{className:"mt-3",children:[s.jsx("p",{className:"text-xs text-blue-700 mb-1",children:"EVM Transactions:"}),s.jsx("div",{className:"space-y-1",children:i.evmTxHashes.map((C,w)=>s.jsxs("a",{href:g(C),target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-xs text-blue-700 hover:text-blue-800",children:["NFT ",w+1,": ",C.slice(0,8),"...",C.slice(-6),s.jsx(Ds,{className:"w-3 h-3 ml-1"})]},C))})]})]}),s.jsxs("div",{className:"space-y-4",children:[i.status==="idle"&&s.jsx("div",{className:"space-y-4",children:n!=null&&n.hasInsufficientEthBalance?s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-2"}),s.jsx("span",{className:"font-medium text-red-800",children:"Cannot Execute - Insufficient ETH"})]}),s.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["You need ",n?et(n.ethCost):"0"," ETH for gas fees but only have ",n!=null&&n.userEthBalance?et(n.userEthBalance):"0"," ETH. Please add more ETH to your wallet before proceeding."]})]}):s.jsxs("button",{onClick:N,className:"w-full px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:["ðŸ”¥ Execute Complete Burn Process (",f," NFT",f>1?"s":"",")"]})}),i.status==="completed"&&s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center mb-3",children:[s.jsx(gt,{className:"w-5 h-5 text-green-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-green-800",children:"ðŸŽ‰ Burn Process Completed Successfully!"}),s.jsxs("p",{className:"text-xs text-green-600",children:["All ",i.totalNFTs," NFT",i.totalNFTs>1?"s":""," burned and reminted as ckNFTs on IC"]})]})]}),s.jsxs("div",{className:"mt-3 space-y-2",children:[s.jsx("p",{className:"text-xs text-green-700 font-medium",children:"Process Summary:"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-green-600",children:"EVM Transfers:"}),s.jsxs("span",{className:"ml-1 text-green-800",children:[i.evmTxHashes.length," completed"]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-green-600",children:"IC Remints:"}),s.jsxs("span",{className:"ml-1 text-green-800",children:[i.mintResults.length," completed"]})]})]})]})]}),i.status==="failed"&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-3 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-red-800",children:"Burn Process Failed"}),s.jsx("p",{className:"text-xs text-red-600 mt-1",children:i.error})]})]})}),s.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium text-blue-800 mb-2",children:"Troubleshooting Tips:"}),s.jsxs("ul",{className:"text-xs text-blue-700 space-y-1 list-disc list-inside",children:[s.jsx("li",{children:"Check if you have sufficient ETH for gas fees in your wallet"}),s.jsx("li",{children:"Verify that your cycles allowance hasn't expired"}),s.jsx("li",{children:"Ensure MetaMask is connected and on the correct network"}),s.jsx("li",{children:"Try refreshing costs if gas prices have changed significantly"}),s.jsx("li",{children:"Check if the NFT is still in your wallet (not already transferred)"})]}),s.jsx("p",{className:"text-xs text-blue-600 mt-2",children:'Use the "Back to Costs" button to recalculate costs or approve new allowances.'})]})]})]}),s.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-amber-800",children:[s.jsx("strong",{children:"âš ï¸ Important:"})," This process will permanently transfer your cast NFTs to burn addresses on the remote EVM chain and remint them as ckNFTs on the Internet Computer. This action is irreversible. Make sure you have sufficient ETH for gas fees and cycles are approved for IC operations."]})}),s.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200",children:[o&&s.jsxs("button",{onClick:o,disabled:i.status==="transferring"||i.status==="confirming"||i.status==="reminting",className:"flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[s.jsx(qp,{className:"w-4 h-4 mr-2"}),"Back to Costs"]}),s.jsxs("div",{className:"flex space-x-3",children:[i.status==="idle"&&s.jsx("button",{onClick:N,className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors font-medium",children:"Execute Burn Process"}),i.status==="failed"&&s.jsxs("div",{className:"flex space-x-2",children:[o&&s.jsx("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Back to Costs"}),s.jsx("button",{onClick:h,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors font-medium",children:"Retry Burn"})]}),i.status==="completed"&&i.evmTxHashes.length>0&&s.jsxs("a",{href:`https://etherscan.io/tx/${i.evmTxHashes[0]}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors font-medium",children:["View on Etherscan",s.jsx(Ds,{className:"w-4 h-4 ml-2"})]})]})]})]})}function g0({sourceChainId:e,sourceContractAddress:t,sourceTokenId:n,nftDiscoveryService:r,onComplete:a,onCancel:o,className:i,modal:c=!0,mockBurnResult:l,mockWalletConnected:u,mockSelectedNFTs:d}){var re;const m={ethereum:1,polygon:137,bsc:56,hardhat:31337,"hardhat-2":1338,arbitrum:42161,optimism:10,base:8453},f=Object.fromEntries(Object.entries(m).map(([se,Ne])=>[Ne,se])),g=Object.keys(m),[N,h]=x.useState(null),[C,w]=x.useState("connect"),[B,j]=x.useState(d||[]),[Q,F]=x.useState(null),[_,M]=x.useState(null),[k,K]=x.useState(null),[V,T]=x.useState(l||null);console.log("ðŸ” EVMBurnWizard selectedNFTs state:",{selectedNFTs:B.map(se=>({contractAddress:se.contractAddress,tokenId:se.tokenId,name:se.name,isMockAddress:se.contractAddress==="0x1234567890123456789012345678901234567890"})),count:B.length,currentStep:C});const{activeAddress:ee,isUnlocked:J,connectWallet:pe,switchChain:E,chainId:b}=an(),Y=u!==void 0?u:J,p=u!==void 0?u?"0x742d35Cc6635C0532925a3b8D11e432f1b7C4b7b":null:ee,O=u?1:b;x.useEffect(()=>{e&&t&&n&&j([{tokenId:n,contractAddress:t,name:`Token ${n}`,description:`NFT from contract ${t}`}])},[e,t,n]);const R=[{id:"connect",title:"Connect",description:"Connect EVM wallet"},{id:"select-evm-nft",title:"Select NFT",description:"Choose NFT to burn"},{id:"costs",title:"Costs",description:"Review burn costs"},{id:"burn",title:"Burn",description:"Execute burn operation"},{id:"complete",title:"Complete",description:"Burn summary"}],q=R.findIndex(se=>se.id===C),v=x.useCallback(se=>{const Ne=aa(se,[{id:"verify-evm-connection",title:"Verify EVM Connection",description:"Checking EVM wallet connection to remote network",stage:"setup"},{id:"get-burn-address",title:"Get Burn Address",description:"Getting burn funding address from ckNFT canister",stage:"setup"},{id:"transfer-to-burn",title:"Transfer to Burn Address",description:"Transferring cast NFT to burn address on remote EVM chain",stage:"execution"},{id:"remint-cknft",title:"Remint ckNFT",description:"Reminting ckNFT on IC using remote contract reference (following remintCkNFT pattern)",stage:"execution"}]);return K(Ne),Ne},[]),U=x.useCallback((se,Ne,ge,ne)=>{K(ye=>ye?mt(ye,se,{status:Ne,error:ge,txHash:ne}):null)},[]),S=x.useCallback(()=>{switch(C){case"connect":return J&&ee&&N!==null;case"select-evm-nft":return B.length>0;case"costs":return Q!==null;case"burn":return(V==null?void 0:V.success)===!0;default:return!1}},[C,ee,J,N,B,Q,V]);console.log("EVMBurnWizard canGoNext analysis:",{currentStep:C,activeAddress:!!ee,isUnlocked:J,selectedNFTs:B.length,burnCosts:!!Q,burnResultSuccess:V==null?void 0:V.success});const H=x.useCallback(se=>{console.log("ðŸŽ‰ Burn transaction completed:",se),se&&M(se),T({success:!0}),U("transfer-to-burn","completed",void 0,se),U("remint-cknft","loading","Starting ckNFT remint process using remote contract reference..."),w("complete"),a==null||a({success:!0,icTransactionHash:se||""})},[U,a]),he=x.useCallback(se=>{console.error("âŒ Burn transaction failed:",se),T({success:!1,error:se}),U("transfer-to-burn","failed",se),a==null||a({success:!1,error:se})},[U,a]),$=x.useMemo(()=>!!(k!=null&&k.steps&&k.steps.some(Ne=>Ne.status==="failed")||V&&!V.success),[k,V]);x.useEffect(()=>{V!=null&&V.success&&C!=="complete"&&(console.log("ðŸŽ‰ Burn completed successfully, advancing to complete step"),w("complete"))},[V,C]);const W=q>0&&(C!=="burn"&&C!=="complete"||$),le=x.useCallback(()=>{if(!S())return;const se=q+1;se<R.length&&w(R[se].id)},[q,S,R]),ce=x.useCallback(()=>{if(!W)return;const se=q-1;se>=0&&w(R[se].id)},[q,W,R]),L=()=>{switch(C){case"connect":return s.jsx(Vc,{isConnected:Y,account:p,supportedNetworks:g,currentNetwork:O&&f[O]||null,onConnect:pe,onSwitchNetwork:se=>{const Ne=m[se];if(Ne)return E(Ne);throw new Error(`Unsupported network: ${se}`)},selectedTargetNetwork:N&&"Ethereum"in N&&f[Number(N.Ethereum[0])]||void 0,onTargetNetworkChange:se=>{const Ne=m[se];Ne&&(console.log("ðŸŽ¯ Remote network selected for burn operation:",se,"Chain ID:",Ne),console.log("ðŸ”¥ This represents the REMOTE network where cast NFTs currently exist"),h({Ethereum:[BigInt(Ne)]}))}});case"select-evm-nft":return s.jsx(Lh,{mode:"burn",account:p,network:O&&f[O]||null,selectedNFTs:B,onSelectionChange:j,nftDiscoveryService:r});case"costs":return s.jsx(hw,{selectedNFTs:B,targetNetwork:N,costs:Q,onCostsCalculated:F,compact:$,isConnected:!!ee&&J,activeAddress:ee});case"burn":return s.jsx(fw,{selectedNFTs:B,targetNetwork:N,costs:Q,onTransactionComplete:H,onTransactionError:he,onBack:ce});case"complete":return s.jsx(pw,{result:V,onStartNew:()=>{w("connect"),j([]),F(null),T(null),v("evm-to-ic")},onClose:()=>o==null?void 0:o()});default:return null}},ue=s.jsxs("div",{className:be("bg-white rounded-lg shadow-lg",c&&"max-w-4xl mx-auto",i),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Burn EVM NFT"}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Step ",q+1," of ",R.length,": ",(re=R[q])==null?void 0:re.description]})]}),o&&s.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(ra,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"px-6 py-4 border-b border-gray-100",children:s.jsx("div",{className:"flex items-center justify-between",children:R.map((se,Ne)=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:be("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",Ne<q?"bg-green-100 text-green-800":Ne===q?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-500"),children:Ne+1}),s.jsx("span",{className:be("ml-2 text-sm font-medium",Ne<=q?"text-gray-900":"text-gray-500"),children:se.title}),Ne<R.length-1&&s.jsx("div",{className:be("w-8 h-px mx-4",Ne<q?"bg-green-300":"bg-gray-300")})]},se.id))})}),s.jsx("div",{className:"p-6",children:L()}),s.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[s.jsxs("button",{onClick:ce,disabled:!W,className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ta,{className:"w-4 h-4 mr-1"}),"Previous"]}),s.jsxs("button",{onClick:le,disabled:!S(),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:["Next",s.jsx(Is,{className:"w-4 h-4 ml-1"})]})]})]});return c?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:ue}):ue}function pw({result:e,onStartNew:t,onClose:n}){return s.jsxs("div",{className:"space-y-6 text-center",children:[s.jsx("div",{children:e.success?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Burn Successful!"}),s.jsx("p",{className:"text-gray-600",children:"Your EVM NFT has been successfully burned and minted as a ckNFT on the Internet Computer."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"6 18L18 6M6 6l12 12"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Burn Failed"}),s.jsx("p",{className:"text-gray-600",children:e.error})]})}),e.success&&s.jsxs("div",{className:"space-y-3 text-sm",children:[e.ckNFTCanisterId&&s.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-blue-800 mb-1",children:"ckNFT Canister"}),s.jsx("p",{className:"text-blue-700 font-mono text-xs break-all",children:e.ckNFTCanisterId})]}),e.tokenId&&s.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-green-800 mb-1",children:"Token ID"}),s.jsx("p",{className:"text-green-700",children:e.tokenId})]}),e.icTransactionHash&&s.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-gray-800 mb-1",children:"IC Transaction"}),s.jsx("p",{className:"text-gray-700 font-mono text-xs break-all",children:e.icTransactionHash})]})]}),s.jsxs("div",{className:"flex justify-center space-x-4",children:[s.jsx("button",{onClick:t,className:"px-6 py-2 text-red-600 border border-red-600 rounded-md hover:bg-red-50 transition-colors",children:"Burn More NFTs"}),s.jsx("button",{onClick:n,className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"Close"})]})]})}function gw(e,t){const[n,r]=x.useState(null),[a,o]=x.useState(!0),[i,c]=x.useState(null),l=rd();return x.useEffect(()=>{let u=!1;async function d(){if(!e){o(!1);return}o(!0),c(null);try{const m=ea.createActor(Ms,{agent:l,canisterId:e});console.log("ðŸ” Fetching native chain for canister:",e);const f=await m.icrc99_native_chain();u||(console.log("âœ… Native chain result:",f),r(f))}catch(m){console.error("âŒ Error fetching native chain:",m),u||c(m)}finally{u||o(!1)}}return d(),()=>{u=!0}},[e,t,l]),{nativeChain:n,loading:a,error:i}}var x0={};function xw({selectedCkNFTs:e,targetNetwork:t,targetContract:n,costs:r,onCostsCalculated:a,onApprovalStatusChange:o,onBurnBalanceStatusChange:i,onContinue:c,compact:l=!1}){var re,se,Ne,ge,ne,ye;const[u,d]=x.useState(!1),[m,f]=x.useState(null),[g,N]=x.useState(!1),[h,C]=x.useState(null),[w,B]=x.useState({}),[j,Q]=x.useState(null),[F,_]=x.useState(!1),[M,k]=x.useState(!1),[K,V]=x.useState(!1),[T,ee]=x.useState({}),{user:J}=ut(),pe=rd(),E=(()=>{const G=x0.REACT_APP_ORCHESTRATOR_CANISTER_ID;if(console.log("ðŸ” Orchestrator env value:",{envValue:G,type:typeof G}),!G)return console.log("âš ï¸ REACT_APP_ORCHESTRATOR_CANISTER_ID is not set, using fallback"),"bkyz2-fmaaa-aaaaa-qaaaq-cai";if(typeof G!="string")return console.warn("âš ï¸ REACT_APP_ORCHESTRATOR_CANISTER_ID is not a string:",G),"bkyz2-fmaaa-aaaaa-qaaaq-cai";const P=G.trim();return P===""?(console.log("âš ï¸ REACT_APP_ORCHESTRATOR_CANISTER_ID is empty after trim"),"bkyz2-fmaaa-aaaaa-qaaaq-cai"):(console.log("âœ… Using orchestrator canister ID:",P),P)})(),b=Vt(E),Y=(()=>{const G=x0.REACT_APP_CYCLES_LEDGER_CANISTER_ID;if(console.log("ðŸ” Cycles ledger env value:",{envValue:G,type:typeof G}),!G)return console.log("âš ï¸ REACT_APP_CYCLES_LEDGER_CANISTER_ID is not set, using fallback"),"um5iw-rqaaa-aaaaq-qaaba-cai";if(typeof G!="string")return console.warn("âš ï¸ REACT_APP_CYCLES_LEDGER_CANISTER_ID is not a string:",G),"um5iw-rqaaa-aaaaq-qaaba-cai";const P=G.trim();return P===""?(console.log("âš ï¸ REACT_APP_CYCLES_LEDGER_CANISTER_ID is empty after trim"),"um5iw-rqaaa-aaaaq-qaaba-cai"):(console.log("âœ… Using cycles canister ID:",P),P)})();console.log("ðŸ” About to call useFungibleToken with:",Y);const p=js(Y),O=J!=null&&J.principal?{owner:J.principal,subaccount:[]}:void 0,R=p.useBalance(O),q=e&&e.length>0?qe.fromText(e[0].canisterId):null,v=O&&q?{account:O,spender:{owner:q,subaccount:[]}}:void 0,U=p.useAllowance(v),S=p.useApprove();x.useEffect(()=>{R.data!==void 0&&C(R.data)},[R.data]),x.useEffect(()=>{if(U.data&&(r!=null&&r.cyclesCost)){const G=BigInt(Date.now()*1e6),P=U.data.expires_at.length>0&&U.data.expires_at[0]?U.data.expires_at[0]<G:!1,z=r.cyclesCost*BigInt(110)/BigInt(100),A={amount:U.data.allowance,isExpired:P,isSufficient:U.data.allowance>=z};if(!j||j.amount!==A.amount||j.isExpired!==A.isExpired||j.isSufficient!==A.isSufficient){Q(A);const de=A.isSufficient&&!A.isExpired;F!==de&&(_(de),o==null||o(de,A.amount))}}},[U.data,r==null?void 0:r.cyclesCost,j,F,o]);const H=x.useCallback(async(G,P,z=0)=>{if(!G||!P)return null;try{const A=await b.getBurnFundingAddress.mutateAsync({ckNFTCanisterId:qe.fromText(P),tokenId:BigInt(G)});return console.log("Burn funding address:",A),A}catch(A){if(console.error("Error fetching burn funding address:",A),A instanceof Error&&(A.message.includes("ERR_INSUFFICIENT_RESOURCES")||A.message.includes("Failed to fetch")||A.message.includes("Network"))&&z<2){const de=Math.pow(2,z)*1e3;console.log(`ðŸ”„ Retrying burn funding address fetch in ${de}ms (attempt ${z+1}/2)`),setTimeout(()=>{H(G,P,z+1)},de)}return null}},[b.getBurnFundingAddress]);x.useEffect(()=>{const G=e.map(A=>`${A.canisterId}-${A.tokenId}`),P=Object.keys(w);(G.length!==P.length||G.some(A=>!P.includes(A))||P.some(A=>!G.includes(A)))&&P.length>0&&(console.log("ðŸ”„ NFT selection changed, clearing old burn addresses"),B({}),ee({}))},[e,w]);const he=async()=>{var G,P;if(!(!r||!e.length||!O||!q)){if(F&&(j!=null&&j.isSufficient)&&!(j!=null&&j.isExpired)){console.log("âœ… Payment already approved with sufficient allowance");return}k(!0);try{const z=86400n*1000000000n,A=BigInt(Date.now()*1e6),Z=A+z,de=r.cyclesCost*BigInt(110)/BigInt(100);console.log("ðŸ”‹ Approving cycles with 110% buffer:",{originalCost:r.cyclesCost.toString(),approvalAmount:de.toString(),nftCount:e.length,individualNFTCost:((P=(G=r.nftDetails)==null?void 0:G[0])==null?void 0:P.cyclesCost.toString())||"unknown",isMultipleNFTs:e.length>1,calculationBreakdown:`${r.cyclesCost.toString()} cycles Ã— 110% = ${de.toString()} cycles`}),await S.mutateAsync({spender:{owner:q,subaccount:[]},amount:de,fee:[],memo:[],created_at_time:[A],from_subaccount:[],expected_allowance:[],expires_at:[Z]}),await U.refetch(),console.log("âœ… Cycles approved for return operation with safety buffer")}catch(z){console.error("âŒ Error approving cycles:",z);const A=z instanceof Error?z.message:"Failed to approve cycles";A.includes("ERR_INSUFFICIENT_RESOURCES")||A.includes("Failed to fetch")?f("Network connectivity issue with IC replica. Please check if the local IC replica is running and try again."):f(A)}finally{k(!1)}}},$=async()=>{const G=Object.values(w)[0]||(r==null?void 0:r.burnFundingAddress);if(!r||!G){console.error("âŒ Missing burn funding address for ETH transfer");return}if(!window.ethereum){f("MetaMask is not installed. Please install MetaMask to send ETH.");return}V(!0);try{const z=await new Ot(window.ethereum).getSigner(),A=r.ethCost?r.ethCost*BigInt(2):cu("0.001"),Z=G;console.log("ðŸ’° Sending ETH to burn funding address:",{to:Z,amount:et(A),amountWei:A.toString()});const de={to:Z,value:A},te=await z.sendTransaction(de);console.log("ðŸ“¤ ETH transfer transaction sent:",te.hash),await te.wait(),console.log("âœ… ETH transfer confirmed:",te.hash),setTimeout(async()=>{await le(Z)},2e3)}catch(P){console.error("âŒ Error sending ETH:",P);const z=P instanceof Error?P.message:"Failed to send ETH";z.includes("User denied transaction")?f("Transaction was cancelled by user."):z.includes("insufficient funds")?f("Insufficient ETH balance for transaction."):f(`Failed to send ETH: ${z}`)}finally{V(!1)}},W=async(G,P)=>{if(!window.ethereum){f("MetaMask is not installed. Please install MetaMask to send ETH.");return}V(!0);try{const A=await new Ot(window.ethereum).getSigner(),Z=P?P*BigInt(2):cu("0.001");console.log("ðŸ’° Sending ETH to specific burn funding address:",{to:G,amount:et(Z),amountWei:Z.toString()});const de={to:G,value:Z},te=await A.sendTransaction(de);console.log("ðŸ“¤ ETH transfer transaction sent:",te.hash),await te.wait(),console.log("âœ… ETH transfer confirmed:",te.hash),setTimeout(()=>le(G),2e3)}catch(z){console.error("âŒ Error sending ETH:",z);const A=z instanceof Error?z.message:"Failed to send ETH";A.includes("user rejected")?f("Transaction was cancelled by user"):f(A)}finally{V(!1)}},le=x.useCallback(async G=>{if(!G)return null;try{if(!window.ethereum)return console.warn("âš ï¸ MetaMask not available for balance check"),null;const z=await new Ot(window.ethereum).getBalance(G);return console.log("ðŸ” Burn address balance check:",{address:G,balance:et(z),balanceWei:z.toString()}),ee(A=>({...A,[G]:z})),z}catch(P){return console.error("âŒ Error checking burn address balance:",P),null}finally{}},[]);x.useEffect(()=>{if(!r)return;const G=T,P=[];Object.entries(w).forEach(([,A])=>{A&&G[A]===void 0&&P.push(A)});const z=r==null?void 0:r.burnFundingAddress;z&&G[z]===void 0&&P.push(z),P.length>0&&(console.log("ðŸ” Checking balances for addresses:",P),P.forEach((A,Z)=>{setTimeout(()=>{le(A)},Z*100)}))},[r,w,r==null?void 0:r.burnFundingAddress,le]),x.useEffect(()=>{if(!r||!i)return;const G=[],P={};Object.entries(w).forEach(([,te],fe)=>{var xe,oe;if(te){G.push(te);const X=((oe=(xe=r.nftDetails)==null?void 0:xe[fe])==null?void 0:oe.ethCost)||(r.ethCost?r.ethCost/BigInt(e.length):BigInt(0));P[te]=X}});const z=r.burnFundingAddress;z&&!G.includes(z)&&(G.push(z),P[z]=r.ethCost||BigInt(0));const A={};let Z=!0;for(const te of G){const fe=T[te]||BigInt(0),xe=P[te]||BigInt(0),oe=fe>=xe;A[te]={balance:fe,required:xe,sufficient:oe},oe||(Z=!1)}G.length>0&&G.every(te=>T[te]!==void 0)&&(console.log("ðŸ” Burn address balance validation:",{totalAddresses:G.length,balanceInfo:A,allSufficient:Z}),i(Z,A))},[r,T,w,e.length,i]),x.useEffect(()=>{e.length>0&&t&&n&&(J!=null&&J.principal)&&!g&&!u&&(!r||!r.nftDetails||r.nftDetails.length!==e.length||r.nftDetails.some((P,z)=>z>=e.length||P.nft.tokenId!==e[z].tokenId||P.nft.canisterId!==e[z].canisterId)||r.targetContract!==n||r.targetNetwork!==t&&(!r.targetNetwork||!t||Object.keys(r.targetNetwork)[0]!==Object.keys(t)[0]))&&(console.log("ðŸ”„ NFT selection or target changed, recalculating costs"),ce())},[e,t,n,J==null?void 0:J.principal,r,g,u]);const ce=async()=>{var G,P,z;if(!e.length||!t||!n||!(J!=null&&J.principal)){f("Missing required information for cost calculation");return}N(!0),f(null),d(!0);try{console.log("ðŸ§® Calculating return costs for ckNFTs:",e),console.log("ðŸ” Fetching burn funding addresses for all NFTs...");const A={};if(Object.keys(w).length>0&&e.every(oe=>w[`${oe.canisterId}-${oe.tokenId}`]))console.log("âœ… Using existing burn addresses from state:",{existingCount:Object.keys(w).length,requiredCount:e.length,addresses:Object.values(w)}),Object.assign(A,w);else{const oe=e.filter(X=>!w[`${X.canisterId}-${X.tokenId}`]);console.log("ðŸ”„ Fetching burn addresses for NFTs:",{totalNFTs:e.length,existingAddresses:Object.keys(w).length,missingNFTs:oe.map(X=>X.tokenId),willFetchFor:oe.length});for(const X of e)try{const ae=await H(X.tokenId,X.canisterId);ae&&(A[`${X.canisterId}-${X.tokenId}`]=ae,console.log(`ðŸ” Burn address for NFT ${X.tokenId}: ${ae}`))}catch(ae){console.warn(`âš ï¸ Could not fetch burn address for NFT ${X.tokenId}:`,ae)}B(A)}const de=[];let te=BigInt(0),fe=BigInt(0);for(const oe of e){const X=ea.createActor(Ms,{agent:pe,canisterId:oe.canisterId}),ae={tokenId:BigInt(oe.tokenId),contract:n,network:t};console.log(`ðŸ“‹ Cast cost request for NFT ${oe.tokenId}:`,{tokenId:oe.tokenId,contract:n,network:"Ethereum"in t?`Ethereum (${((G=t.Ethereum)==null?void 0:G[0])||"Mainnet"})`:"Other Network"});const je=await X.icrc99_cast_cost(ae);console.log(`ðŸ’° Cast cost result for NFT ${oe.tokenId}:`,typeof je=="bigint"?je.toString():je);let Ae=BigInt(0);if(typeof je=="bigint")Ae=je;else throw new Error(`Invalid cost calculation result for NFT ${oe.tokenId}`);const Fe=BigInt("150000"),Pe=BigInt("20000000000"),_e=Fe*Pe;te+=Ae,fe+=_e;const ke=A[`${oe.canisterId}-${oe.tokenId}`];de.push({nft:oe,cyclesCost:Ae,ethCost:_e,gasEstimate:Fe,burnFundingAddress:ke})}console.log(`ðŸ’° Total costs for ${e.length} NFTs:`,{totalCyclesCost:te.toString(),totalEthCost:fe.toString(),nftCount:e.length,burnAddresses:Object.keys(A).length});const xe={cyclesCost:te,ethCost:fe,gasEstimate:fe/BigInt("20000000000"),targetNetwork:t,targetContract:n,approvalAddress:"",burnFundingAddresses:Object.values(A),burnFundingAddress:Object.values(A)[0],nftDetails:de};console.log("âœ… Return costs calculated:",{totalCyclesCost:xe.cyclesCost.toString(),totalEthCost:xe.ethCost.toString(),totalGasEstimate:xe.gasEstimate.toString(),targetNetwork:"Ethereum"in xe.targetNetwork?`Ethereum (${((P=xe.targetNetwork.Ethereum)==null?void 0:P[0])||"Mainnet"})`:"Other Network",targetContract:xe.targetContract,burnFundingAddress:xe.burnFundingAddress,hasBurnAddress:!!xe.burnFundingAddress,nftDetailsCount:((z=xe.nftDetails)==null?void 0:z.length)||0,nftCount:e.length}),a(xe)}catch(A){console.error("âŒ Error calculating return costs:",A);const Z=A instanceof Error?A.message:"Failed to calculate return costs";Z.includes("ERR_INSUFFICIENT_RESOURCES")||Z.includes("Failed to fetch")?f("Network connectivity issue with IC replica. Please ensure the local IC replica is running and has sufficient resources."):f(Z)}finally{d(!1),N(!1)}},L=G=>{const P=BigInt(1e12);if(G>=P)return`${(Number(G)/Number(P)).toFixed(1)}T`;const z=BigInt(1e9);return G>=z?`${(Number(G)/Number(z)).toFixed(1)}B`:`${Number(G).toLocaleString()}`},ue=G=>(Number(G)/Math.pow(10,18)).toFixed(6);return l&&r?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Cycles Cost:"}),s.jsxs("span",{className:"font-medium",children:[L(r.cyclesCost)," cycles"]})]}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Gas Estimate:"}),s.jsxs("span",{className:"font-medium",children:[ue(r.ethCost)," ETH"]})]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Return Costs"}),s.jsxs("p",{className:"text-gray-600",children:["Review the costs for returning your ckNFT",e.length>1?"s":""," to the target EVM chain."]})]}),u&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Qe,{className:"w-8 h-8 text-blue-600 animate-spin mx-auto mb-4"}),s.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Calculating Costs"}),s.jsx("p",{className:"text-gray-600",children:"Getting return costs from the ckNFT canister and target network..."})]}),m&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(lt,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),s.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Cost Calculation Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:m}),m&&(m.includes("ERR_INSUFFICIENT_RESOURCES")||m.includes("Failed to fetch")||m.includes("Network connectivity"))&&s.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-left",children:[s.jsx("h5",{className:"font-medium text-yellow-800 mb-2",children:"Network Troubleshooting:"}),s.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1 list-disc list-inside",children:[s.jsx("li",{children:"Ensure the local IC replica is running (`dfx start`)"}),s.jsx("li",{children:"Check if there are sufficient system resources (CPU, Memory)"}),s.jsx("li",{children:"Try refreshing the page and waiting a moment"}),s.jsx("li",{children:"Restart the IC replica if issues persist"})]})]}),s.jsx("button",{onClick:ce,disabled:u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:"Retry Calculation"})]}),r&&!u&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center text-green-600 mb-4",children:[s.jsx(gt,{className:"w-5 h-5 mr-2"}),s.jsx("span",{className:"font-medium",children:"Costs calculated successfully"})]}),s.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(Yd,{className:"w-5 h-5 text-blue-600 mr-2"}),s.jsx("h5",{className:"font-medium text-blue-800",children:"IC Cycles Cost"})]}),s.jsxs("p",{className:"text-2xl font-bold text-blue-700 mb-1",children:[L(r.cyclesCost)," cycles"]}),s.jsxs("p",{className:"text-xs text-blue-600",children:["For IC network operations and EVM transaction processing",e.length>1&&s.jsxs("span",{className:"block mt-1",children:["(",e.length," NFTs Ã— ",L(((se=(re=r.nftDetails)==null?void 0:re[0])==null?void 0:se.cyclesCost)||BigInt(0))," cycles each)"]})]})]}),s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(Hp,{className:"w-5 h-5 text-green-600 mr-2"}),s.jsx("h5",{className:"font-medium text-green-800",children:"EVM Gas Estimate"})]}),s.jsxs("p",{className:"text-2xl font-bold text-green-700 mb-1",children:["~",ue(r.ethCost)," ETH"]}),s.jsxs("p",{className:"text-xs text-green-600",children:["Estimated gas for minting on target EVM chain (funded by bridge)",e.length>1&&s.jsxs("span",{className:"block mt-1",children:["(",e.length," NFTs Ã— ",ue(((ge=(Ne=r.nftDetails)==null?void 0:Ne[0])==null?void 0:ge.ethCost)||BigInt(0))," ETH each)"]})]})]})]}),r.nftDetails&&r.nftDetails.length>1&&s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsx("h6",{className:"font-medium text-gray-800 mb-3",children:"Per-NFT Breakdown"}),s.jsx("div",{className:"space-y-2",children:r.nftDetails.map(G=>s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-gray-600",children:G.nft.name||`NFT #${G.nft.tokenId}`}),s.jsxs("span",{className:"text-gray-800",children:[L(G.cyclesCost)," cycles"]})]},`${G.nft.canisterId}-${G.nft.tokenId}`))})]}),s.jsxs("div",{className:"p-4 bg-white border-2 border-blue-200 rounded-lg shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(na,{className:"w-6 h-6 text-blue-600 mr-2"}),s.jsx("h5",{className:"text-lg font-semibold text-gray-900",children:"Balance vs Cast Cost"})]}),R.isLoading&&s.jsx(Qe,{className:"w-5 h-5 animate-spin text-blue-500"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[s.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:[s.jsx("div",{className:"text-xs text-blue-600 font-medium uppercase tracking-wide mb-1",children:"Your Current Balance"}),s.jsx("div",{className:be("text-2xl font-bold",R.isLoading?"text-gray-400":h!==null&&h>=r.cyclesCost?"text-green-600":"text-red-600"),children:R.isLoading?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-6 h-6 animate-spin mr-2"}),"Loading..."]}):h!==null?`${L(h)} cycles`:"Unknown"})]}),s.jsxs("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-md",children:[s.jsx("div",{className:"text-xs text-orange-600 font-medium uppercase tracking-wide mb-1",children:"Cast Cost Required"}),s.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[L(r.cyclesCost)," cycles"]})]})]}),!R.isLoading&&h!==null&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[s.jsx("span",{className:"font-medium text-gray-700",children:"Difference:"}),s.jsxs("span",{className:be("text-lg font-bold",h>=r.cyclesCost?"text-green-600":"text-red-600"),children:[h>=r.cyclesCost?"+":"",L(h-r.cyclesCost)," cycles"]})]}),h>=r.cyclesCost?s.jsxs("div",{className:"flex items-center p-3 bg-green-50 border border-green-200 rounded-md",children:[s.jsx(gt,{className:"w-5 h-5 text-green-600 mr-2 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-green-800",children:"Sufficient Balance"}),s.jsx("div",{className:"text-sm text-green-700",children:"You have enough cycles for this return operation."})]})]}):s.jsxs("div",{className:"flex items-center p-3 bg-red-50 border border-red-200 rounded-md",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-2 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-red-800",children:"Insufficient Balance"}),s.jsxs("div",{className:"text-sm text-red-700",children:["You need ",L(r.cyclesCost-h)," more cycles to proceed."]})]})]})]}),R.error&&s.jsxs("div",{className:"flex items-center p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:[s.jsx(lt,{className:"w-5 h-5 text-yellow-600 mr-2 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-yellow-800",children:"Balance Check Failed"}),s.jsx("div",{className:"text-sm text-yellow-700",children:"Unable to retrieve your current balance. Please try refreshing."})]})]})]}),j&&s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(sa,{className:"w-5 h-5 text-blue-600 mr-2"}),s.jsx("h5",{className:"font-medium text-blue-900",children:"Current Allowance"})]}),s.jsx("span",{className:be("font-medium",j.isSufficient&&!j.isExpired?"text-green-600":"text-orange-600"),children:L(j.amount)})]}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-blue-600",children:"Status:"}),s.jsx("span",{className:be("font-medium",j.isSufficient&&!j.isExpired?"text-green-600":"text-orange-600"),children:j.isExpired?"Expired":j.isSufficient?"Sufficient":"Insufficient"})]}),j.isExpired&&s.jsx("p",{className:"text-orange-700 text-xs",children:"Your previous allowance has expired. A new approval is required."}),!j.isSufficient&&!j.isExpired&&s.jsx("p",{className:"text-orange-700 text-xs",children:"Your current allowance is insufficient for this return operation."})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Payment Approval"}),F?s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-5 h-5 text-green-600 mr-2"}),s.jsx("span",{className:"font-medium text-green-800",children:"Payment Approved"})]}),s.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Cycles approved for return operation. You can now proceed with the return."}),s.jsxs("div",{className:"mt-2 text-xs text-green-600",children:["Approved: ",j?L(j.amount):"Unknown amount"]}),s.jsx("div",{className:"mt-1 text-xs text-green-600",children:"âœ… Synced with return process - no additional approval needed"})]}):s.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Approve Cycles Payment"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Authorize the ckNFT canister to use ",L(r.cyclesCost)," cycles for this return",e.length>1&&s.jsxs("span",{className:"block text-xs text-gray-500 mt-1",children:["Total for ",e.length," NFTs (includes 10% safety buffer)"]})]}),j&&j.amount>0n&&s.jsx("p",{className:"text-xs text-orange-600 mt-1",children:j.isExpired?"â° Previous approval expired - new approval required":"âš ï¸ Current approval insufficient - additional approval needed"})]}),s.jsx("button",{onClick:he,disabled:M||R.isLoading||h!==null&&h<r.cyclesCost,className:be("px-6 py-2 rounded-md font-medium transition-colors",M||R.isLoading||h!==null&&h<r.cyclesCost?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:M?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Approving..."]}):R.isLoading?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Checking Balance..."]}):"Approve Payment"})]}),s.jsx("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded-md",children:s.jsx("p",{className:"text-xs text-blue-700",children:"ðŸ”„ This approval will be automatically checked by the return process. Once approved here, the return tab will proceed without asking for approval again."})})]})]}),s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[s.jsx("h6",{className:"font-medium text-yellow-800 mb-2",children:"Return Destination"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-yellow-600",children:"Target Network:"}),s.jsx("span",{className:"ml-2 text-yellow-800",children:"Ethereum"in r.targetNetwork?`Ethereum (${((ne=r.targetNetwork.Ethereum)==null?void 0:ne[0])||"Mainnet"})`:"Other Network"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-yellow-600",children:"Target Contract:"}),s.jsx("span",{className:"ml-2 font-mono text-yellow-800 text-xs break-all",children:r.targetContract})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-yellow-600",children:"Target Funding:"}),s.jsx("span",{className:"ml-2 text-yellow-800 text-xs",children:"EVM gas fees funded by the bridge network"})]})]})]}),(Object.keys(w).length>0||r.burnFundingAddress||((ye=r.burnFundingAddresses)==null?void 0:ye.length))&&s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h6",{className:"font-medium text-blue-800",children:"Burn Funding Addresses"}),s.jsx("span",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",children:"Optional"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("p",{className:"text-sm text-blue-700",children:"Send ETH to these addresses to fund gas for the return transactions on the EVM chain. Each NFT has its own burn address. The bridge can also execute returns using its own funding."}),Object.entries(w).map(([G,P],z)=>{var Z,de;const A=e.find(te=>`${te.canisterId}-${te.tokenId}`===G);return s.jsxs("div",{className:"bg-white border border-blue-200 rounded p-3",children:[s.jsx("div",{className:"flex items-center justify-between mb-2",children:s.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["NFT #",(A==null?void 0:A.tokenId)||"Unknown"," Burn Address:"]})}),s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("code",{className:"text-sm font-mono text-gray-800 break-all",children:P}),s.jsx("button",{onClick:()=>navigator.clipboard.writeText(P),className:"ml-2 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Copy"})]}),T[P]!==void 0&&s.jsxs("div",{className:"mb-3 p-2 bg-green-50 border border-green-200 rounded text-sm",children:[s.jsxs("span",{className:"text-green-700 font-medium",children:["Current Balance: ",et(T[P])," ETH"]}),T[P]>0n&&s.jsx("span",{className:"ml-2 text-green-600",children:"âœ… Funded"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:["Recommended: ",(de=(Z=r.nftDetails)==null?void 0:Z[z])!=null&&de.ethCost?`${(Number(r.nftDetails[z].ethCost)/1e18*2).toFixed(6)} ETH`:"0.001 ETH"]}),s.jsx("button",{onClick:()=>{var te,fe;return W(P,(fe=(te=r.nftDetails)==null?void 0:te[z])==null?void 0:fe.ethCost)},disabled:K,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50 transition-colors",children:K?"Sending...":"Send ETH"})]})]},G)}),Object.keys(w).length===0&&r.burnFundingAddress&&s.jsxs("div",{className:"bg-white border border-blue-200 rounded p-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("code",{className:"text-sm font-mono text-gray-800 break-all",children:r.burnFundingAddress}),s.jsx("button",{onClick:()=>navigator.clipboard.writeText(r.burnFundingAddress||""),className:"ml-2 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Copy"})]}),r.burnFundingAddress&&T[r.burnFundingAddress]!==void 0&&s.jsxs("div",{className:"mb-3 p-2 bg-green-50 border border-green-200 rounded text-sm",children:[s.jsxs("span",{className:"text-green-700 font-medium",children:["Current Balance: ",et(T[r.burnFundingAddress])," ETH"]}),T[r.burnFundingAddress]>0n&&s.jsx("span",{className:"ml-2 text-green-600",children:"âœ… Funded"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:["Recommended: ",r.ethCost?`${(Number(r.ethCost)/1e18*2).toFixed(6)} ETH`:"0.001 ETH"]}),s.jsx("button",{onClick:$,disabled:K,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50 transition-colors",children:K?"Sending...":"Send ETH"})]})]})]})]}),(()=>{const G=e.filter(z=>!w[`${z.canisterId}-${z.tokenId}`]),P=e.length>0&&G.length>0&&!(r!=null&&r.burnFundingAddress)&&g;return P&&console.log("ðŸ”„ Missing burn addresses for NFTs:",G.map(z=>z.tokenId)),P})()&&s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin text-gray-500 mr-2"}),s.jsx("span",{className:"text-sm text-gray-600",children:"Fetching burn funding addresses..."})]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"These addresses allow you to fund gas fees for the return transactions."})]}),s.jsxs("div",{className:"flex justify-center gap-4 pt-4",children:[s.jsx("button",{onClick:()=>{a(null),ce()},disabled:u,className:"px-6 py-2 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors disabled:opacity-50",children:"Recalculate Costs"}),c&&s.jsx("button",{onClick:c,disabled:u,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:"Continue to Return"})]})]}),!r&&!u&&!m&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Yd,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Ready to Calculate"}),s.jsxs("p",{className:"text-gray-600 mb-4",children:["Click below to calculate the costs for returning your ckNFT",e.length>1?"s":"","."]}),s.jsx("button",{onClick:ce,disabled:!e.length||!t||!n||!(J!=null&&J.principal),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Calculate Return Costs"})]})]})}var bw={};function b0({ckNFTCanisterId:e,tokenId:t,targetChainId:n,targetContractAddress:r,onComplete:a,onCancel:o,className:i,modal:c=!0,mockReturnResult:l}){var oe;const[u,d]=x.useState("connect"),[m,f]=x.useState([]),[g,N]=x.useState(n||""),[h,C]=x.useState(r||""),[w,B]=x.useState(null),[j,Q]=x.useState(null),[F,_]=x.useState(l||null),[M,k]=x.useState({isApproved:!1}),[K,V]=x.useState({isValidating:!1,isValid:null,error:null,isNativeContract:!1}),[T,ee]=x.useState({hasRequiredBalances:!1,balanceInfo:{}}),J={ethereum:1,polygon:137,bsc:56,hardhat:31337,"hardhat-2":1338,arbitrum:42161,optimism:10,base:8453},pe=Object.fromEntries(Object.entries(J).map(([X,ae])=>[ae,X])),E=["ethereum","polygon","bsc","hardhat","hardhat-2","arbitrum","optimism","base"],{user:b}=ut(),{activeAddress:Y,isUnlocked:p,connectWallet:O,switchChain:R,chainId:q}=an(),v=B0(),U=m.length>0?m[0]:null,{nativeChain:S,loading:H,error:he}=gw((U==null?void 0:U.canisterId)||"",U?BigInt(U.tokenId):void 0),$=x.useCallback(async X=>{if(!v)throw new Error("Authenticated agent not available");return ea.createActor(Ms,{agent:v,canisterId:X})},[v]),W=x.useCallback(async(X,ae)=>{const je=await $(X.canisterId),Ae={token_id:BigInt(X.tokenId),approval_info:{spender:{owner:ae,subaccount:[]},expires_at:[],memo:[],from_subaccount:[],created_at_time:[]}},Fe=await je.icrc37_approve_tokens([Ae]);if(Fe.length===0||"Err"in Fe[0])throw new Error("Token approval failed")},[$]);x.useEffect(()=>{if(S&&U&&!U.nativeChain){if(console.log("ðŸ”— Adding native chain info to selected ckNFT:",S),f(X=>X.map((ae,je)=>je===0?{...ae,nativeChain:S.network,nativeContract:S.contract}:ae)),"Ethereum"in S.network&&S.network.Ethereum.length>0){const X=S.network.Ethereum[0];if(X){const ae=X.toString();console.log("ðŸŽ¯ Auto-selecting target network based on native chain:",ae),N(ae)}}S.contract&&!h&&(console.log("ðŸŽ¯ Auto-filling contract address from native chain:",S.contract),C(S.contract))}},[S,U,h]),x.useEffect(()=>{if(g&&m.length>0&&m[0].nativeChain&&m[0].nativeContract){const X=Ne(g),ae=m[0].nativeChain;X&&"Ethereum"in X&&"Ethereum"in ae&&X.Ethereum[0]===ae.Ethereum[0]&&(!h||h!==m[0].nativeContract)&&(console.log("ðŸŽ¯ Auto-filling native contract address for matching network:",m[0].nativeContract),C(m[0].nativeContract),V({isValidating:!1,isValid:!0,error:null,isNativeContract:!0}))}},[g,m,h]),x.useEffect(()=>{h&&g&&m.length>0?le():V({isValidating:!1,isValid:null,error:null,isNativeContract:!1})},[h,g,m]);const le=async()=>{if(!h||!g||!m.length)return;const X=m[0],ae=Ne(g);V({isValidating:!0,isValid:null,error:null,isNativeContract:!1});try{if(X.nativeContract===h&&X.nativeChain&&ae&&"Ethereum"in X.nativeChain&&"Ethereum"in ae&&X.nativeChain.Ethereum[0]===ae.Ethereum[0])V({isValidating:!1,isValid:!0,error:null,isNativeContract:!0}),console.log("âœ… Contract address matches native contract");else if(X.nativeChain&&X.nativeContract)V({isValidating:!1,isValid:!1,error:`Return wizard can only return to the original chain/contract. Expected: ${X.nativeContract} on chain ${se(X.nativeChain)}`,isNativeContract:!1}),console.warn("âŒ Contract does not match native contract - return wizard only supports native returns");else{const Ae=/^0x[a-fA-F0-9]{40}$/.test(h);V({isValidating:!1,isValid:Ae,error:Ae?null:"Invalid contract address format",isNativeContract:!1})}}catch(je){console.error("âŒ Error validating contract address:",je),V({isValidating:!1,isValid:!1,error:"Failed to validate contract address",isNativeContract:!1})}};x.useEffect(()=>{e&&t&&f([{tokenId:t,canisterId:e,owner:(b==null?void 0:b.principal)||qe.anonymous(),nativeChain:void 0,nativeContract:r}])},[e,t,r,b==null?void 0:b.principal]);const ce=[{id:"connect",title:"Connect",description:"Connect IC wallet"},{id:"select-cknft",title:"Select ckNFT",description:"Choose ckNFT to return"},{id:"select-target-chain",title:"Target Network",description:"Connect wallet & select destination"},{id:"costs",title:"Costs",description:"Review return costs and fund gas account"},{id:"return",title:"Return",description:"Execute return operation"},{id:"complete",title:"Complete",description:"Return summary"}],L=ce.findIndex(X=>X.id===u),ue=bw.REACT_APP_ORCHESTRATOR_CANISTER_ID||"vg3po-ix777-77774-qaafa-cai",re=Vt(ue),se=X=>"IC"in X?`Internet Computer${X.IC.length>0?` (${X.IC[0]})`:""}`:"Ethereum"in X?`Ethereum${X.Ethereum.length>0?` (Chain ${X.Ethereum[0]})`:""}`:"Solana"in X?`Solana${X.Solana.length>0?` (${X.Solana[0]})`:""}`:"Bitcoin"in X?`Bitcoin${X.Bitcoin.length>0?` (${X.Bitcoin[0]})`:""}`:"Other"in X?"Other Network":"Unknown Network",Ne=X=>{const ae=parseInt(X);if(isNaN(ae))return null;switch(ae){case 1:case 5:case 11155111:case 137:case 56:case 31337:case 1338:case 42161:case 10:case 8453:return{Ethereum:[BigInt(ae)]};default:return{Ethereum:[BigInt(ae)]}}},ge=x.useCallback(X=>{const ae=aa(X,[{id:"verify-ic-connection",title:"Verify IC Connection",description:"Checking IC wallet connection",stage:"setup"},{id:"approve-cknft-transfer",title:"Approve ckNFT Transfer",description:"Approving ckNFT transfer to bridge",stage:"preparation"},{id:"fund-burn-address",title:"Fund Burn Address",description:"Sending ETH to burn address for gas fees",stage:"preparation"},{id:"initiate-cast",title:"Initiate Cast",description:"Starting return process to EVM",stage:"execution"},{id:"wait-evm-confirmation",title:"Wait for EVM Confirmation",description:"Waiting for NFT to appear on target EVM chain",stage:"execution"}]);return Q(ae),ae},[]),ne=x.useCallback((X,ae,je,Ae)=>{Q(Fe=>Fe?mt(Fe,X,{status:ae,error:je,txHash:Ae}):null)},[]),ye=x.useCallback(()=>{switch(u){case"connect":return!!(b!=null&&b.principal);case"select-cknft":return m.length>0;case"select-target-chain":return g&&h&&p&&K.isValid===!0;case"costs":return w!==null&&T.hasRequiredBalances;case"return":return(F==null?void 0:F.success)===!0;default:return!1}},[u,b,m,g,h,p,K.isValid,w,F,T.hasRequiredBalances]);console.log("ICReturnWizard canGoNext analysis:",{currentStep:u,userPrincipal:!!(b!=null&&b.principal),selectedCkNFTsLength:m.length,targetChainId:g,targetContractAddress:h,isEvmWalletConnected:p,contractValidation:K.isValid,isNativeContract:K.isNativeContract,returnCosts:!!w,burnBalanceStatus:T.hasRequiredBalances,returnResultSuccess:F==null?void 0:F.success});const G=x.useMemo(()=>!!(j!=null&&j.steps&&j.steps.some(ae=>ae.status==="failed")||F&&!F.success),[j,F]);x.useEffect(()=>{F!=null&&F.success&&u!=="complete"&&(console.log("ðŸŽ‰ Return completed successfully, advancing to complete step"),d("complete"))},[F,u]);const P=L>0&&(u!=="return"&&u!=="complete"||G),z=x.useCallback(()=>{if(!ye())return;const X=L+1;X<ce.length&&d(ce[X].id)},[L,ye,ce]),A=x.useCallback(()=>{if(!P)return;const X=L-1;X>=0&&d(ce[X].id)},[L,P,ce]),Z=x.useCallback(async()=>{var X,ae,je,Ae,Fe,Pe,_e;if(console.log("ðŸŽ¯ handleStartReturn called with:",{selectedCkNFTs:m,targetChainId:g,targetContractAddress:h,userPrincipal:b==null?void 0:b.principal,returnCosts:w}),!m.length||!g||!h||!(b!=null&&b.principal)||!w){console.warn("âŒ Missing required data for return:",{selectedCkNFTsLength:m.length,targetChainId:!!g,targetContractAddress:!!h,userPrincipal:!!(b!=null&&b.principal),returnCosts:!!w});return}if(!Y){console.warn("âŒ MetaMask address required for return operation"),alert("Please connect your MetaMask wallet to continue with the return operation.");return}d("return"),ge("ic-to-evm");try{const ke=m[0];if(console.log(`ðŸš€ Starting IC return process for ckNFT ${ke.tokenId}`),ne("verify-ic-connection","loading"),console.log("âœ… IC wallet already connected:",b.principal),ne("verify-ic-connection","completed"),ne("approve-cknft-transfer","loading","Please approve the ckNFT transfer..."),console.log("ðŸ“ Checking cycles approval status:",M),M.isApproved&&M.allowanceAmount&&M.allowanceAmount>=w.cyclesCost)console.log("âœ… Cycles already approved with sufficient allowance, skipping approval step"),ne("approve-cknft-transfer","completed",`ckNFT transfer pre-approved (${M.allowanceAmount} cycles available)`);else{console.log(`ðŸ“ Approving ${m.length} ckNFT${m.length>1?"s":""} for transfer with ICRC-37...`);const ve=qe.fromText(ue);for(let Te=0;Te<m.length;Te++){const Ie=m[Te];console.log(`ðŸ“ Approving NFT ${Te+1}/${m.length}: ${Ie.tokenId}`),await W(Ie,ve)}ne("approve-cknft-transfer","completed",`${m.length} ckNFT${m.length>1?"s":""} approved for transfer`)}ne("fund-burn-address","loading","Checking burn address funding...");try{const ve=(w==null?void 0:w.burnFundingAddresses)||[],Te=w==null?void 0:w.burnFundingAddress,Ie=ve.length>0?ve:Te?[Te]:[];if(Ie.length===0)console.log("âš ï¸ No burn funding addresses available - proceeding without funding check"),ne("fund-burn-address","completed","No burn addresses to fund");else{if(console.log(`ðŸ’° Checking ${Ie.length} burn address(es) for funding...`),!window.ethereum)throw new Error("MetaMask not available for balance check");const Ue=new Ot(window.ethereum);for(let He=0;He<Ie.length;He++){const Ge=Ie[He];console.log(`ðŸ’° Checking burn address ${He+1}/${Ie.length}: ${Ge}`);const Ee=await Ue.getBalance(Ge),De=((ae=(X=w==null?void 0:w.nftDetails)==null?void 0:X[He])==null?void 0:ae.ethCost)||(w!=null&&w.ethCost?w.ethCost/BigInt(m.length):BigInt(0));console.log(`ðŸ’° Address ${Ge} balance: ${et(Ee)} ETH`),console.log(`ðŸ’° Required gas cost for NFT ${He+1}: ${et(De)} ETH`);const ft=De*BigInt(2);if(Ee<ft){const vt=ft-Ee;throw new Error(`Burn address ${He+1}/${Ie.length} (NFT #${((je=m[He])==null?void 0:je.tokenId)||"Unknown"}) needs ${et(vt)} more ETH. Current: ${et(Ee)} ETH, Required: ${et(ft)} ETH. Address: ${Ge}`)}console.log(`âœ… Burn address ${He+1} sufficiently funded: ${et(Ee)} ETH (required: ${et(ft)} ETH)`)}ne("fund-burn-address","completed",`All ${Ie.length} burn address(es) sufficiently funded`)}}catch(ve){throw console.error("âŒ Burn address funding check failed:",ve),ne("fund-burn-address","failed",ve instanceof Error?ve.message:"Failed to verify burn address funding"),ve}ne("initiate-cast","loading","Initiating cast to target EVM chain..."),console.log("ðŸ”„ Initiating real cast to EVM via mutations.castToEVM...");try{const ve=Ne(g);if(!ve)throw new Error(`Unsupported target chain ID: ${g}`);console.log("â›½ Calculating gas parameters from MetaMask provider...");let Te,Ie,Ue;try{if(!window.ethereum)throw new Error("MetaMask not available for gas estimation");const Le=new Ot(window.ethereum),At=await Le.getNetwork(),rt=parseInt(g);if(Number(At.chainId)!==rt)throw new Error(`MetaMask is on chain ${At.chainId}, but expected ${rt}. Please switch to the target chain.`);const ze=await Le.getFeeData();console.log("ðŸ“Š Current fee data from provider:",{gasPrice:(Ae=ze.gasPrice)==null?void 0:Ae.toString(),maxFeePerGas:(Fe=ze.maxFeePerGas)==null?void 0:Fe.toString(),maxPriorityFeePerGas:(Pe=ze.maxPriorityFeePerGas)==null?void 0:Pe.toString()}),Te=ze.maxFeePerGas||ze.gasPrice||BigInt(5e10),Ie=ze.maxPriorityFeePerGas||BigInt(2e9),Ue=BigInt(3e5),console.log("âœ… Calculated gas parameters:",{gasPrice:Te.toString(),maxPriorityFeePerGas:Ie.toString(),gasLimit:Ue.toString(),totalCostEstimate:et(Te*Ue)})}catch(Le){console.warn("âš ï¸ Failed to get real-time gas data, using fallback values:",Le),Te=BigInt(5e10),Ie=BigInt(2e9),Ue=BigInt(3e5)}const He=m.map(Le=>({tokenId:BigInt(Le.tokenId),gasPrice:[Te],memo:[],fromSubaccount:[],remoteContract:{contract:h,network:ve},maxPriorityFeePerGas:[Ie],created_at_time:[],gasLimit:[Ue],targetOwner:Y||""}));console.log(`ðŸ“‹ Cast requests constructed for ${m.length} NFTs:`,He),console.log("ðŸš€ Calling mutations.castToEVM with cast requests...");const Ge=await re.castToEVM.mutateAsync({castRequests:He,ckNFTCanisterId:qe.fromText(ke.canisterId),spender:void 0});console.log("âœ… Cast operation response:",Ge);const Ee=[];for(let Le=0;Le<Ge.length;Le++){const At=Ge[Le];if(At&&"Ok"in At)Ee.push(At.Ok),console.log(`âœ… Cast ${Le+1} submitted with ID:`,At.Ok.toString());else{if(At&&"Err"in At)throw new Error(`Cast operation ${Le+1} failed: ${JSON.stringify(At.Err)}`);console.warn(`âš ï¸ Cast operation ${Le+1} returned unexpected result:`,At)}}if(Ee.length===0)throw new Error("No valid cast IDs received from cast operation");ne("initiate-cast","completed",`Cast request${m.length>1?"s":""} submitted successfully (${Ee.length} operation${Ee.length>1?"s":""})`),ne("wait-evm-confirmation","loading",`Monitoring ${Ee.length} cast operation${Ee.length>1?"s":""} for EVM confirmation...`),console.log("ðŸ” Starting cast status monitoring for IDs:",Ee.map(Le=>Le.toString()));let De=30,ft=!1,vt=[];for(;De>0&&!ft;){ne("wait-evm-confirmation","loading",`Monitoring cast operation... (${31-De}/30 checks)`);try{const Le=await re.getCastStatus.mutateAsync({castIds:Ee,ckNFTCanisterId:ke.canisterId,account:b!=null&&b.principal?{owner:b.principal,subaccount:[]}:void 0});console.log("ðŸ” Cast status check results:",Le),console.log("ðŸ” castIds array:",Ee.map(rt=>rt.toString()));let At=0;for(let rt=0;rt<Le.length;rt++){const ze=Le[rt],xt=ze&&ze[0];if(xt){console.log(`ðŸ” Cast ${Ee[rt]} state:`,xt);const bt=xt.status;if(bt&&"Completed"in bt){if(At++,console.log(`âœ… Cast ${Ee[rt]} completed:`,bt.Completed),xt.history)for(const Ft of xt.history){const[cr]=Ft;if(cr&&"WaitingOnTransfer"in cr){const ki=(_e=cr.WaitingOnTransfer)==null?void 0:_e.transaction;ki&&!vt.includes(ki)&&(vt.push(ki),console.log(`ðŸ“‹ Found EVM transaction hash: ${ki}`))}}}else if(bt&&("Error"in bt||"Failed"in bt)){let Ft="Unknown error";if("Error"in bt)if(typeof bt.Error=="object"&&bt.Error!==null){const cr=bt.Error;"GenericError"in cr?Ft=`GenericError: ${cr.GenericError}`:Ft=JSON.stringify(cr)}else Ft=String(bt.Error);else"Failed"in bt&&(Ft=String(bt.Failed));throw console.error(`âŒ Cast operation ${Ee[rt]} failed with error:`,Ft),console.error("âŒ Full status object:",bt),new Error(`Cast operation failed: ${Ft}. Please check the burn address funding or network conditions and try again.`)}else console.log(`â³ Cast ${Ee[rt]} still in progress:`,bt)}else console.warn(`âš ï¸ No status found for cast ID ${Ee[rt]}`)}if(console.log(`ðŸ” Completion check: ${At} of ${Ee.length} completed`),At===Ee.length){ft=!0,console.log("ðŸŽ‰ Cast operation completed successfully! Setting final state...");const rt=vt[0]||`cast-${Ee[0].toString()}`;console.log("ðŸ” Setting completion with primaryTxHash:",rt),ne("wait-evm-confirmation","completed",`NFT${m.length>1?"s":""} successfully returned to EVM chain${vt.length>0?` (${vt.length} TX${vt.length>1?"s":""})`:""}`);const ze={success:!0,evmTransactionHash:rt,targetChainId:g,targetContractAddress:h,tokenId:m.length===1?ke.tokenId:`${m.length} NFTs`};console.log("ðŸ” Setting returnResult:",ze),_(ze),console.log("ðŸ” Setting currentStep to complete..."),d("complete"),console.log("ðŸ” Calling onComplete callback..."),a==null||a(ze),console.log(`ðŸŽ‰ IC return process completed successfully for ${m.length} NFT${m.length>1?"s":""}! Exiting function...`);return}else console.log(`â³ Progress: ${At}/${Ee.length} casts completed`),await new Promise(rt=>setTimeout(rt,1e4))}catch(Le){console.error("âŒ Error checking cast status:",Le)}De--}ft||(console.warn("âš ï¸ Cast operation monitoring timed out"),ne("wait-evm-confirmation","completed",`Cast${m.length>1?"s":""} submitted successfully. Final EVM confirmation may take additional time.`),_({success:!0,evmTransactionHash:vt[0]||`cast-${Ee[0].toString()}`,targetChainId:g,targetContractAddress:h,tokenId:m.length===1?ke.tokenId:`${m.length} NFTs`}),d("complete"),a==null||a({success:!0,evmTransactionHash:vt[0]||`cast-${Ee[0].toString()}`,targetChainId:g,targetContractAddress:h,tokenId:m.length===1?ke.tokenId:`${m.length} NFTs`}))}catch(ve){console.error("âŒ Cast operation failed:",ve);const Te=ve instanceof Error?ve.message:"Cast operation failed";throw ne("initiate-cast","failed",Te),ve}}catch(ke){console.error("Return process failed:",ke);const ve=ke instanceof Error?ke.message:"Return failed";if(j!=null&&j.steps){const Te=j.steps.find(Ie=>Ie.status==="loading");Te&&ne(Te.id,"failed",ve)}_({success:!1,error:ve}),a==null||a({success:!1,error:ve})}},[m,g,h,b,w,j,W,re,_,d,a,ne]),de=x.useCallback((X,ae)=>{console.log("ðŸ”„ Cycles approval status changed:",{isApproved:X,allowanceAmount:ae}),k({isApproved:X,allowanceAmount:ae||0n})},[k]),te=x.useCallback((X,ae)=>{console.log("ðŸ” Burn balance status changed:",{hasRequiredBalances:X,balanceInfo:ae}),ee({hasRequiredBalances:X,balanceInfo:ae})},[ee]),fe=()=>{switch(u){case"connect":return s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Connect IC Wallet"}),s.jsx("p",{className:"text-gray-600",children:"Connect your Internet Computer wallet to access your ckNFTs."}),b!=null&&b.principal?s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"âœ… Wallet Connected"}),s.jsx("p",{className:"text-sm text-green-700 font-mono break-all",children:b.principal.toString()})]}):s.jsx("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:s.jsx("p",{className:"text-gray-600",children:"Please connect your IC wallet using Internet Identity, NFID, or another supported provider."})})]});case"select-cknft":return s.jsx(Gc,{selectedNFTs:m,onSelectionChange:f,userPrincipal:b==null?void 0:b.principal,sourceCanisterId:e,onCanisterChange:ae=>{console.log("Canister changed to:",ae)},targetChain:"evm"});case"select-target-chain":return s.jsxs("div",{className:"space-y-6",children:[m.length>0&&m[0].nativeChain&&g&&s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx("svg",{className:"w-5 h-5 text-blue-600 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),s.jsx("h6",{className:"font-medium text-blue-800",children:"Auto-Selected from Native Chain"})]}),s.jsxs("p",{className:"text-sm text-blue-700",children:["The target network has been automatically selected based on the ckNFT's original source chain: ",s.jsx("strong",{children:se(m[0].nativeChain)})]}),g&&!pe[Number(g)]&&s.jsx("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded",children:s.jsxs("p",{className:"text-xs text-amber-700",children:["âš ï¸ Note: This chain (ID: ",g,") may not be fully supported by the wallet interface, but the return operation should still work."]})})]}),s.jsx(Vc,{isConnected:p,account:Y,supportedNetworks:E,currentNetwork:q&&pe[q]||null,onConnect:O,onSwitchNetwork:ae=>{const je=J[ae];if(je)return R(je);throw new Error(`Unsupported network: ${ae}`)},selectedTargetNetwork:g&&pe[Number(g)]||void 0,onTargetNetworkChange:ae=>{const je=J[ae];je&&N(je.toString())}}),g&&s.jsx("div",{className:"border-t border-gray-200 pt-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Step 3: Target Contract Address"}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Enter the contract address where you want to return your NFT."}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:h,onChange:ae=>C(ae.target.value),placeholder:"0x...",className:be("w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2",K.isValid===!0?"border-green-300 focus:ring-green-500":K.isValid===!1?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-blue-500")}),K.isValidating&&s.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]}),K.isValid===!0&&s.jsx("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center text-green-800 text-sm",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),K.isNativeContract?"âœ… Valid native contract - can proceed with return":"âœ… Valid contract address format"]})}),K.isValid===!1&&K.error&&s.jsx("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center text-red-800 text-sm",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),K.error]})})]}),m.length>0&&s.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[s.jsx("h6",{className:"font-medium text-yellow-800 mb-2",children:"ðŸ’¡ Native Chain Information"}),H?s.jsxs("div",{className:"flex items-center text-yellow-600 text-sm",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-600 mr-2"}),"Detecting native chain information..."]}):he?s.jsxs("div",{className:"text-red-600 text-sm",children:["Failed to detect native chain: ",he]}):m[0].nativeChain?s.jsxs("div",{children:[s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-yellow-600",children:"Original Chain:"}),s.jsx("span",{className:"ml-2 text-yellow-800",children:se(m[0].nativeChain)})]}),m[0].nativeContract&&s.jsxs("div",{children:[s.jsx("span",{className:"text-yellow-600",children:"Original Contract:"}),s.jsx("span",{className:"ml-2 font-mono text-yellow-800",children:m[0].nativeContract})]})]}),s.jsx("p",{className:"text-xs text-yellow-600 mt-2",children:"The target network and contract have been automatically selected based on the ckNFT's native chain. The return wizard can only return NFTs to their original source."}),g&&m[0].nativeContract&&h!==m[0].nativeContract&&s.jsx("button",{onClick:()=>{const ae=Ne(g),je=m[0].nativeChain;ae&&je&&"Ethereum"in ae&&"Ethereum"in je&&ae.Ethereum[0]===je.Ethereum[0]&&m[0].nativeContract&&C(m[0].nativeContract)},className:"mt-2 px-3 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-md hover:bg-yellow-200 transition-colors",children:"Use Original Contract Address"})]}):s.jsx("div",{className:"text-gray-600 text-sm",children:"No native chain information available for this ckNFT"})]})]})})]});case"costs":const X=Ne(g);return s.jsx(xw,{selectedCkNFTs:m,targetNetwork:X,targetContract:h,costs:w,onCostsCalculated:B,onApprovalStatusChange:de,onBurnBalanceStatusChange:te,onContinue:()=>d("return")});case"return":return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Returning ckNFT to EVM"}),s.jsx("p",{className:"text-gray-600",children:"Your ckNFT is being returned to the target EVM chain."})]}),j&&s.jsx(jc,{progress:j,onRetryStep:ae=>{const je=vc(j,ae);Q(je)}}),j&&j.steps.some(ae=>ae.status==="failed")&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-red-800",children:"Return Process Failed"}),s.jsx("p",{className:"text-red-600 text-sm",children:"The return process encountered an error. You can start over or try funding the burn address with more ETH."})]}),s.jsx("button",{onClick:()=>{Q(null),d("costs"),B(null)},className:"px-4 py-2 text-sm bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Start Over"})]})}),s.jsx("div",{className:"flex justify-center",children:s.jsx("button",{onClick:Z,disabled:j!==null,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:j?"Returning...":"Start Return Process"})})]});case"complete":return s.jsx(yw,{result:F,onStartNew:()=>{d("connect"),f([]),N(""),C(""),B(null),_(null),Q(null)},onClose:()=>o==null?void 0:o()});default:return null}},xe=s.jsxs("div",{className:be("bg-white rounded-lg shadow-lg",c&&"max-w-4xl mx-auto",i),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Return ckNFT to EVM"}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Step ",L+1," of ",ce.length,": ",(oe=ce[L])==null?void 0:oe.description]})]}),o&&s.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(ra,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"px-6 py-4 border-b border-gray-100",children:s.jsx("div",{className:"flex items-center justify-between",children:ce.map((X,ae)=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:be("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",ae<L?"bg-green-100 text-green-800":ae===L?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-500"),children:ae+1}),s.jsx("span",{className:be("ml-2 text-sm font-medium",ae<=L?"text-gray-900":"text-gray-500"),children:X.title}),ae<ce.length-1&&s.jsx("div",{className:be("w-8 h-px mx-4",ae<L?"bg-green-300":"bg-gray-300")})]},X.id))})}),s.jsx("div",{className:"p-6",children:fe()}),u==="costs"&&w&&!T.hasRequiredBalances&&Object.keys(T.balanceInfo).length>0&&s.jsx("div",{className:"mx-6 mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("svg",{className:"w-5 h-5 text-yellow-600 mr-3 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Insufficient Burn Address Funding"}),s.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"Some burn funding addresses don't have sufficient ETH balance for the return operation. Please fund these addresses before proceeding:"}),s.jsx("div",{className:"space-y-2",children:Object.entries(T.balanceInfo).filter(([,X])=>!X.sufficient).map(([X,ae])=>s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"font-mono text-yellow-800 text-xs break-all mb-1",children:X}),s.jsxs("div",{className:"text-yellow-700",children:["Balance: ",(Number(ae.balance)/1e18).toFixed(6)," ETH | Required: ",(Number(ae.required)/1e18).toFixed(6)," ETH |",s.jsxs("span",{className:"font-medium text-yellow-800",children:["Need: ",((Number(ae.required)-Number(ae.balance))/1e18).toFixed(6)," ETH more"]})]})]},X))}),s.jsx("p",{className:"text-xs text-yellow-600 mt-2",children:'ðŸ’¡ Use the "Send ETH" buttons in the burn funding section above to fund these addresses.'})]})]})}),s.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[s.jsxs("button",{onClick:A,disabled:!P,className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ta,{className:"w-4 h-4 mr-1"}),"Previous"]}),s.jsxs("button",{onClick:z,disabled:!ye(),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:["Next",s.jsx(Is,{className:"w-4 h-4 ml-1"})]})]})]});return c?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:xe}):xe}function yw({result:e,onStartNew:t,onClose:n}){return s.jsxs("div",{className:"space-y-6 text-center",children:[s.jsx("div",{children:e.success?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Return Successful!"}),s.jsx("p",{className:"text-gray-600",children:"Your ckNFT has been successfully returned to the target EVM chain."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"6 18L18 6M6 6l12 12"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Return Failed"}),s.jsx("p",{className:"text-gray-600",children:e.error})]})}),e.success&&s.jsxs("div",{className:"space-y-3 text-sm",children:[e.targetChainId&&s.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-blue-800 mb-1",children:"Target Chain"}),s.jsxs("p",{className:"text-blue-700",children:["Chain ",e.targetChainId]})]}),e.targetContractAddress&&s.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-green-800 mb-1",children:"Contract Address"}),s.jsx("p",{className:"text-green-700 font-mono text-xs break-all",children:e.targetContractAddress})]}),e.tokenId&&s.jsxs("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-purple-800 mb-1",children:"Token ID"}),s.jsx("p",{className:"text-purple-700",children:e.tokenId})]}),e.evmTransactionHash&&s.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("p",{className:"font-medium text-gray-800 mb-1",children:"EVM Transaction"}),s.jsx("p",{className:"text-gray-700 font-mono text-xs break-all",children:e.evmTransactionHash})]})]}),s.jsxs("div",{className:"flex justify-center space-x-4",children:[s.jsx("button",{onClick:t,className:"px-6 py-2 text-blue-600 border border-blue-600 rounded-md hover:bg-blue-50 transition-colors",children:"Return More ckNFTs"}),s.jsx("button",{onClick:n,className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"Close"})]})]})}function Pd({selectedTargetCluster:e,onTargetClusterChange:t}){const{publicKey:n,address:r,connected:a,connecting:o,wallet:i,cluster:c,connection:l,actualRpcEndpoint:u,connect:d,disconnect:m,openWalletModal:f}=os(),[g,N]=x.useState(null),[h,C]=x.useState(!1),w=u||(l==null?void 0:l.rpcEndpoint)||"",j=a&&w&&!["mainnet-beta.solana.com","api.mainnet-beta.solana.com","devnet.solana.com","api.devnet.solana.com","testnet.solana.com","api.testnet.solana.com","xnftdata.com","helius-rpc.com","rpcpool.com","quicknode.pro","genesysgo.net","triton.one","hellomoon.io","syndica.io","blockdaemon.com"].some(T=>w.includes(T))&&(w.includes("localhost")||w.includes("127.0.0.1")||w.includes("0.0.0.0")||!w.includes("mainnet")&&!w.includes("devnet")&&!w.includes("testnet")),Q=x.useMemo(()=>u?new ws(u,"confirmed"):l,[u,l]),F=[{id:"mainnet-beta",name:"Solana Mainnet",icon:"â—Ž",rpcEndpoint:Ea["mainnet-beta"],explorer:Vo["mainnet-beta"],nativeCurrency:"SOL",description:"Production network with real SOL"},{id:"devnet",name:"Solana Devnet",icon:"â—Ž",rpcEndpoint:Ea.devnet,explorer:Vo.devnet,nativeCurrency:"SOL",description:"Test network with free SOL from faucet"},{id:"testnet",name:"Solana Testnet",icon:"â—Ž",rpcEndpoint:Ea.testnet,explorer:Vo.testnet,nativeCurrency:"SOL",description:"Testing network for validators"},...j?[{id:"localnet",name:"Custom RPC (Localhost)",icon:"ðŸ”§",rpcEndpoint:w,explorer:Vo.devnet,nativeCurrency:"SOL",description:"Your wallet is connected to a custom RPC endpoint"}]:[]];x.useEffect(()=>{(async()=>{if(!(!n||!Q)){C(!0);try{console.log("[SolanaConnectionStep] Fetching balance from:",Q.rpcEndpoint);const J=await Q.getBalance(n)/1e9;console.log("[SolanaConnectionStep] Balance:",J,"SOL"),N(J)}catch(ee){console.error("Failed to fetch balance:",ee),N(null)}finally{C(!1)}}})()},[n,Q]);const _=async()=>{try{i?await d():f()}catch(T){console.error("Failed to connect wallet:",T)}},M=async()=>{try{await m(),N(null)}catch(T){console.error("Failed to disconnect wallet:",T)}},k=T=>{t&&t(T)},K=F.find(T=>T.id===e),V=r?`${r.slice(0,4)}...${r.slice(-4)}`:null;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Connect Your Solana Wallet"}),s.jsx("p",{className:"text-gray-600",children:"Connect your Phantom, Solflare, or other Solana wallet, then select your target cluster."})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Step 1: Connect Wallet"}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Connect your Solana wallet to continue. Supports Phantom, Solflare, Backpack, and more."})]}),a?s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-green-800",children:"âœ… Wallet Connected"}),s.jsx("p",{className:"text-sm text-green-600 font-mono",children:V}),i&&s.jsxs("p",{className:"text-xs text-green-500 mt-1",children:["Using ",i.adapter.name]})]})]}),s.jsx("button",{onClick:M,className:"px-3 py-1 text-sm text-green-700 hover:text-green-900 transition-colors",children:"Disconnect"})]})}),l&&s.jsx("div",{className:be("p-3 border rounded-lg text-xs",j?"bg-purple-50 border-purple-200":"bg-blue-50 border-blue-200"),children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("span",{className:"text-base mr-2",children:j?"ðŸ”§":"â„¹ï¸"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:be("font-medium mb-1",j?"text-purple-800":"text-blue-800"),children:j?"Custom RPC Detected":"RPC Connection"}),s.jsx("p",{className:be("font-mono text-xs break-all",j?"text-purple-700":"text-blue-700"),children:w}),j&&s.jsx("p",{className:"text-purple-600 mt-1",children:"Your wallet (Backpack) is using a custom RPC endpoint, likely your local validator. This will be used for all transactions."})]})]})}),s.jsx("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Wallet Balance"}),h?s.jsx("p",{className:"text-sm text-gray-500",children:"Loading..."}):g!==null?s.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[g.toFixed(4)," SOL"]}):s.jsx("p",{className:"text-sm text-gray-500",children:"Unable to fetch balance"})]}),r&&!j&&s.jsxs("a",{href:`${Vo[c]}/account/${r}${c!=="mainnet-beta"?`?cluster=${c}`:""}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 inline-flex items-center text-sm",children:["View Account ",s.jsx(Ds,{className:"w-3 h-3 ml-1"})]})]})})]}):s.jsx("div",{className:"flex flex-col items-center space-y-4",children:s.jsxs("div",{className:"p-6 border-2 border-dashed border-gray-300 rounded-lg text-center",children:[s.jsx("div",{className:"text-4xl mb-2",children:"â—Ž"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"No wallet connected"}),s.jsx("button",{onClick:_,disabled:o,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?"Connecting...":"Connect Wallet"}),!i&&s.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"A wallet selection modal will appear"})]})})]}),a&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Step 2: Select Target Cluster"}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:j?"Your wallet is connected to a custom RPC. Select the corresponding cluster for bridging.":"Choose the Solana cluster where you want to bridge your NFTs."}),j&&s.jsx("div",{className:"mb-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:s.jsxs("p",{className:"text-xs text-amber-800",children:[s.jsx("strong",{children:"ðŸ’¡ Tip:"}),` Since you're using a custom RPC (likely localhost), select "Devnet" as your target cluster. Your wallet will continue using your local validator for transactions.`]})})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:F.map(T=>s.jsxs("button",{onClick:()=>k(T.id),className:be("p-4 border-2 rounded-lg text-left transition-all hover:shadow-md",e===T.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx("span",{className:"text-2xl mr-3",children:T.icon}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900",children:T.name}),s.jsx("p",{className:"text-xs text-gray-500",children:T.description})]})]}),s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsxs("p",{children:["Currency: ",T.nativeCurrency]}),s.jsxs("a",{href:T.explorer,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 inline-flex items-center mt-1",onClick:ee=>ee.stopPropagation(),children:["Explorer ",s.jsx(Ds,{className:"w-3 h-3 ml-1"})]})]})]},T.id))}),e&&s.jsx("div",{className:"space-y-3",children:c===e?s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-green-800",children:"âœ… Cluster Connected"}),s.jsxs("p",{className:"text-sm text-green-600",children:[K==null?void 0:K.name," (",K==null?void 0:K.id,")"]})]})]})}):s.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-amber-800",children:"âš ï¸ Cluster Mismatch"}),s.jsxs("p",{className:"text-sm text-amber-600",children:["Target cluster: ",K==null?void 0:K.name," (",K==null?void 0:K.id,")"]}),s.jsxs("p",{className:"text-xs text-amber-500 mt-1",children:["Currently connected to: ",c]}),s.jsx("p",{className:"text-xs text-amber-500 mt-2",children:"Note: You may need to reconnect your wallet to switch clusters, or use a custom RPC endpoint in your wallet settings."})]})})})})]})]})}const y0=new Ve("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s");function Hc(e){const[t]=Ve.findProgramAddressSync([Buffer.from("metadata"),y0.toBuffer(),e.toBuffer()],y0);return t}function zc(e){try{let t=1;t+=32,t+=32;const n=()=>{const f=e.readUInt32LE(t);t+=4;const g=e.slice(t,t+f).toString("utf8").replace(/\0/g,"");return t+=f,g},r=n(),a=n(),o=n();t+=2;const i=e[t];if(t+=1,i===1){const f=e.readUInt32LE(t);t+=4,t+=f*34}t+=1,t+=1;const c=e[t];t+=1,c===1&&(t+=1);const l=e[t];t+=1,l===1&&(t+=1);let u,d=!1;const m=e[t];if(t+=1,console.log("[parseMetadataAccount] Collection field check:",{hasCollection:m,offsetBefore:t-1,nextBytes:Array.from(e.slice(t,t+40))}),m===1){d=e[t]===1,t+=1;const f=e.slice(t,t+32);u=new Ve(f).toBase58(),t+=32,console.log("[parseMetadataAccount] Extracted collection:",{collectionAddress:u,verified:d,collectionBytes:Array.from(f)})}else console.log("[parseMetadataAccount] No collection field present");return{name:r,symbol:a,uri:o,collectionAddress:u,verified:d}}catch(t){return console.warn("Error parsing metadata account:",t),null}}async function Nw(e,t){try{const n=Hc(t),r=await e.getAccountInfo(n);if(!r||!r.data)return console.warn(`No metadata account found for mint ${t.toBase58()}`),null;const a=zc(r.data);return a?{collectionAddress:a.collectionAddress,verified:a.verified,name:a.name,symbol:a.symbol,uri:a.uri}:null}catch(n){return console.warn(`Error fetching metadata for ${t.toBase58()}:`,n),null}}async function lf(e,t="mainnet-beta",n){try{const r=t.startsWith("http")?t:Ea[t],a=new ws(r,"confirmed");console.log(`[Direct RPC] Fetching NFTs for ${e.toBase58()} from ${r}...`);const o=new Ve("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),i=await a.getParsedTokenAccountsByOwner(e,{programId:o});console.log(`[Direct RPC] Found ${i.value.length} token accounts`);const c=i.value.filter(d=>{const m=d.account.data.parsed.info.tokenAmount.uiAmount,f=d.account.data.parsed.info.tokenAmount.decimals,g=d.account.data.parsed.info.mint;return console.log("[Direct RPC] Token account filter check:",{mint:g,amount:m,decimals:f,amountType:typeof m,decimalsType:typeof f,passes:m===1&&f===0}),m===1&&f===0});console.log(`[Direct RPC] Found ${c.length} potential NFTs owned by ${e.toBase58()}`);const l=[];for(const d of c){const m=d.account.data.parsed.info.mint,f=d.pubkey.toBase58(),g=d.account.data.parsed.info.owner,N=new Ve(m);console.log("[Direct RPC] NFT Token Account:",{mint:m,tokenAccount:f,owner:g,yourWallet:e.toBase58(),ownerMatches:g===e.toBase58()});try{const h=await Nw(a,N);let C,w,B;if(h!=null&&h.uri&&(n==null?void 0:n.includeOffChainMetadata)!==!1)try{console.log(`[fetchUserSolanaNFTs] Fetching NFT off-chain metadata from: ${h.uri}`);const j=await fetch(h.uri);if(j.ok){const Q=await j.json();C=Q.image,w=Q.description,B=Q.attributes,console.log(`[fetchUserSolanaNFTs] âœ“ Fetched NFT off-chain metadata for ${m}`,{hasImage:!!C,hasDescription:!!w,hasAttributes:!!B})}}catch(j){console.warn(`[fetchUserSolanaNFTs] Failed to fetch off-chain metadata for ${m}:`,j)}l.push({mintAddress:m,tokenAddress:f,name:(h==null?void 0:h.name)||`NFT ${m.slice(0,8)}...`,symbol:(h==null?void 0:h.symbol)||"NFT",uri:h==null?void 0:h.uri,image:C,description:w,attributes:B,collectionAddress:h==null?void 0:h.collectionAddress,collectionName:h!=null&&h.collectionAddress?void 0:"Uncategorized NFTs",verified:(h==null?void 0:h.verified)??!1})}catch(h){console.warn(`Failed to fetch metadata for ${m}:`,h),l.push({mintAddress:m,tokenAddress:f,name:`NFT ${m.slice(0,8)}...`,symbol:"NFT",verified:!1})}}const u=n!=null&&n.maxNFTs?l.slice(0,n.maxNFTs):l;return console.log(`[Direct RPC] Returning ${u.length} NFTs`),u}catch(r){throw console.error("[Direct RPC] Error fetching NFTs:",r),new Error(r instanceof Error?`Failed to fetch NFTs: ${r.message}`:"Failed to fetch NFTs from Solana")}}function df(e){const t=new Map;for(const n of e){const r=n.collectionAddress||"uncategorized",a=t.get(r)||[];a.push(n),t.set(r,a)}return t}async function ww(e,t){try{const n=new Ve(t),r=Hc(n),a=await e.getAccountInfo(r);if(!a||!a.data)return console.warn(`No metadata account found for collection ${t}`),null;const o=zc(a.data);return o?{name:o.name,symbol:o.symbol,uri:o.uri}:null}catch(n){return console.warn(`Error fetching collection metadata for ${t}:`,n),null}}function vw(e,t){const n=t[0];return{address:e,name:(n==null?void 0:n.collectionName)||"Uncategorized",symbol:n==null?void 0:n.symbol,image:n==null?void 0:n.image,description:n==null?void 0:n.description,nftCount:t.length,verified:(n==null?void 0:n.verified)||!1,updateAuthority:n==null?void 0:n.updateAuthority,nfts:t}}async function uf(e,t="mainnet-beta",n){const r=t.startsWith("http")?t:Ea[t],a=new ws(r,"confirmed"),o=await lf(e,t,n),i=df(o),c=await Promise.all(Array.from(i.entries()).map(async([l,u])=>{const d=vw(l,u),m=await ww(a,l);if(m&&(d.name=m.name||d.name,d.symbol=m.symbol||d.symbol,m.uri&&(n==null?void 0:n.includeOffChainMetadata)!==!1))try{console.log(`[fetchCollectionsWithNFTs] Fetching collection image from: ${m.uri}`);const f=await fetch(m.uri);if(f.ok){const g=await f.json();d.image=g.image,d.description=g.description,console.log("[fetchCollectionsWithNFTs] âœ“ Fetched collection image:",{hasImage:!!d.image,hasDescription:!!d.description})}}catch(f){console.warn("[fetchCollectionsWithNFTs] Failed to fetch collection off-chain metadata:",f)}return console.log(`[fetchCollectionsWithNFTs] Collection ${l}:`,{name:d.name,symbol:d.symbol,nftCount:d.nftCount,nftsArrayLength:d.nfts.length,firstNFT:d.nfts[0]}),d}));return c.sort((l,u)=>u.nftCount-l.nftCount),{collections:c,nftsByCollection:i}}function Md(e){try{const t=new Ve(e);return Ve.isOnCurve(t.toBytes())}catch{return!1}}async function mf(e,t="mainnet-beta",n=!0){try{if(!Md(e))throw new Error("Invalid mint address");const r=typeof t=="string"&&t.startsWith("http")?t:Ea[t],a=new ws(r,"confirmed"),o=new Ve(e);console.log(`[fetchNFTByMint] Fetching metadata for ${e}...`),console.log(`[fetchNFTByMint] Using RPC endpoint: ${r}`);const i=Hc(o),c=await a.getAccountInfo(i);if(!c||!c.data)return console.log(`[fetchNFTByMint] No metadata account found for ${e}`),console.log(`[fetchNFTByMint] Metadata address would be: ${i.toBase58()}`),null;console.log(`[fetchNFTByMint] Found metadata account, data length: ${c.data.length} bytes`);const l=zc(c.data);if(!l)return console.log("[fetchNFTByMint] Failed to parse metadata"),null;console.log("[fetchNFTByMint] Parsed metadata:",l);let u,d,m;if(l.uri&&n)try{const g=await fetch(l.uri);if(g.ok){const N=await g.json();u=N.image,d=N.description,m=N.attributes,console.log(`[fetchNFTByMint] Fetched off-chain metadata from ${l.uri}`)}}catch(g){console.log("[fetchNFTByMint] Could not fetch off-chain metadata:",g)}const f={mintAddress:e,tokenAddress:e,name:l.name,symbol:l.symbol,uri:l.uri,collectionAddress:l.collectionAddress,verified:l.verified,image:u,description:d,attributes:m};return console.log("[fetchNFTByMint] Final result:",f),f}catch(r){return console.error("[fetchNFTByMint] Error fetching NFT by mint:",r),null}}function jw(){try{const e=localStorage.getItem("solana_nft_history");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"?(console.log("[Recovery] Migrating legacy cache format"),t.map(n=>({mintAddress:n,collectionAddress:"unknown"}))):Array.isArray(t)?t:[]}catch{return[]}}function Dl(e,t){try{const n=jw();n.find(a=>a.mintAddress===e)||(n.push({mintAddress:e,collectionAddress:t||"unknown"}),localStorage.setItem("solana_nft_history",JSON.stringify(n)))}catch(n){console.error("[Recovery] Error updating mint cache:",n)}}function hf(e){try{return localStorage.getItem(`solana_mint_request_${e}`)}catch{return null}}async function ff(e,t,n,r,a,o){console.log("[Comprehensive Discovery] Starting for collection:",a);const i={ckNFTCanister:null,nftsInWallet:[],nftsAtApproval:[],alreadyMinted:new Set};try{console.log("[Comprehensive Discovery] Step 1: Checking for ckNFT canister...");const c=await n.get_ck_nft_canister([{contract:a,network:o}]);if(!c||c.length===0||!c[0]||c[0].length===0)throw console.log("[Comprehensive Discovery] No ckNFT canister found for this collection"),new Error("No ckNFT canister exists for this collection. The collection has not been bridged yet.");const l=c[0][0];i.ckNFTCanister=l.toString(),console.log("[Comprehensive Discovery] âœ“ Found ckNFT canister:",i.ckNFTCanister),console.log("[Comprehensive Discovery] Step 2: Querying user wallet...");const{TOKEN_PROGRAM_ID:u}=await Xe(async()=>{const{TOKEN_PROGRAM_ID:g}=await Promise.resolve().then(()=>Gd);return{TOKEN_PROGRAM_ID:g}},void 0),m=(await t.getParsedTokenAccountsByOwner(e,{programId:u})).value.filter(g=>{const N=g.account.data.parsed.info.tokenAmount.uiAmount,h=g.account.data.parsed.info.tokenAmount.decimals;return N===1&&h===0});console.log(`[Comprehensive Discovery] Found ${m.length} potential NFTs in wallet`);for(const g of m){const N=g.account.data.parsed.info.mint;try{const h=await _d(N,t);h&&h.collectionAddress===a&&(i.nftsInWallet.push(h),console.log(`[Comprehensive Discovery] âœ“ Wallet NFT: ${h.name}`))}catch(h){console.error(`[Comprehensive Discovery] Error fetching metadata for ${N}:`,h)}}console.log("[Comprehensive Discovery] Step 3: Querying approval address...");const f=await Od(e,t,n,r,a);return i.nftsAtApproval=f,console.log(`[Comprehensive Discovery] Found ${f.length} NFTs at approval address`),console.log("[Comprehensive Discovery] Step 4: Checking ckNFT canister for minted NFTs..."),console.log("[Comprehensive Discovery] Summary:"),console.log(`  - ckNFT Canister: ${i.ckNFTCanister}`),console.log(`  - NFTs in wallet: ${i.nftsInWallet.length}`),console.log(`  - NFTs at approval: ${i.nftsAtApproval.length}`),console.log(`  - Already minted: ${i.alreadyMinted.size}`),i}catch(c){throw console.error("[Comprehensive Discovery] Error:",c),c}}function pf(e,t){try{localStorage.setItem(`solana_mint_request_${e}`,t.toString())}catch(n){console.error("[Recovery] Error storing mint request ID:",n)}}async function Cw(e,t,n,r,a,o){try{const i=new Ve(e),c=kw(e);console.log(`[Recovery] Checking NFT ${e} (tokenId: ${c})`);const l=o==="mainnet-beta"?"mainnet-beta":"devnet",u=l==="mainnet-beta"?{Solana:[{Mainnet:null}]}:{Solana:[{Devnet:null}]};console.log("ðŸ”¥ðŸ”¥ðŸ”¥ [RECOVERY] CALLING get_remote_approval_address WITH:",{mintAddress:e,tokenId:c.toString(),contract:a,network:u,cluster:o,normalizedCluster:l,rawNetwork:JSON.stringify(u),userPrincipal:r.toString()});const d=await n.get_remote_approval_address({remoteNFTPointer:{tokenId:c,contract:a,network:u},account:{owner:r,subaccount:[]}},[]);if(!d||d.length===0)return console.log(`[Recovery] Could not get approval address for ${e}`),null;const m=d[0],f=new Ve(m);console.log(`[Recovery] Approval address for ${e}: ${m}`);const{getAssociatedTokenAddress:g}=await Xe(async()=>{const{getAssociatedTokenAddress:F}=await Promise.resolve().then(()=>Gd);return{getAssociatedTokenAddress:F}},void 0),N=await g(i,f),h=await t.getAccountInfo(N);if(!h)return console.log(`[Recovery] No token account at approval address for ${e}`),null;const w=h.data.readBigUInt64LE(64);if(console.log(`[Recovery] Token amount at approval address: ${w}`),w!==BigInt(1))return console.log(`[Recovery] NFT not stuck - amount is ${w}, expected 1`),null;const B=await _d(i,t),j=hf(e),Q=j?BigInt(j):void 0;return console.log(`[Recovery] âœ“ Found stuck NFT: ${B.name} at ${m}`),{...B,approvalAddress:m,mintRequestId:Q}}catch(i){return console.error(`[Recovery] Error checking NFT ${e}:`,i),null}}async function Od(e,t,n,r,a,o){console.log("[Recovery] Discovering NFTs at approval address..."),console.log("  User wallet:",e.toBase58()),console.log("  User principal:",r.toString()),console.log("  Collection filter:",a||"all collections"),console.log("  Cluster:",o);const i=[];try{const c=o==="mainnet-beta"?"mainnet-beta":"devnet",l=c==="mainnet-beta"?{Solana:[{Mainnet:null}]}:{Solana:[{Devnet:null}]};console.log("ðŸ”¥ðŸ”¥ðŸ”¥ [RECOVERY - DISCOVERY] CALLING get_remote_approval_address WITH:",{tokenId:"0 (placeholder)",contract:a||"11111111111111111111111111111111",network:l,cluster:o,normalizedCluster:c,rawNetwork:JSON.stringify(l),userPrincipal:r.toString()});const u=await n.get_remote_approval_address({remoteNFTPointer:{tokenId:BigInt(0),contract:a||"11111111111111111111111111111111",network:l},account:{owner:r,subaccount:[]}},[]);if(!u||u.length===0)return console.log("[Recovery] Could not get approval address - empty result"),i;const d=u[0],m=new Ve(d);console.log("[Recovery] Approval address:",d),console.log("[Recovery] Approval address PublicKey:",m.toBase58());const{TOKEN_PROGRAM_ID:f}=await Xe(async()=>{const{TOKEN_PROGRAM_ID:h}=await Promise.resolve().then(()=>Gd);return{TOKEN_PROGRAM_ID:h}},void 0);console.log("[Recovery] Querying token accounts for approval address...");const g=await t.getParsedTokenAccountsByOwner(m,{programId:f});console.log(`[Recovery] Found ${g.value.length} token accounts at approval address`);for(const h of g.value){const C=h.account.data.parsed.info.mint,w=h.account.data.parsed.info.tokenAmount.uiAmount,B=h.account.data.parsed.info.tokenAmount.decimals;console.log(`[Recovery]   Token account: mint=${C}, amount=${w}, decimals=${B}`)}const N=g.value.filter(h=>{const C=h.account.data.parsed.info.tokenAmount.uiAmount,w=h.account.data.parsed.info.tokenAmount.decimals;return C===1&&w===0});console.log(`[Recovery] Found ${N.length} potential NFTs at approval address`);for(const h of N){const C=h.account.data.parsed.info.mint;try{const w=await _d(C,t);if(!w){console.log(`[Recovery] No metadata for ${C}`);continue}if(a&&w.collectionAddress!==a){console.log(`[Recovery] Skipping ${C} - different collection`);continue}const B=hf(C),j=B?BigInt(B):void 0;i.push({...w,approvalAddress:d,mintRequestId:j}),console.log(`[Recovery] âœ“ Recovered NFT: ${w.name} (${C})`)}catch(w){console.error(`[Recovery] Error fetching metadata for ${C}:`,w)}}return console.log(`[Recovery] Total recovered NFTs: ${i.length}`),i}catch(c){return console.error("[Recovery] Error discovering NFTs at approval address:",c),i}}function kw(e){const n=new Ve(e).toBytes();let r=BigInt(0);for(let a=0;a<n.length;a++)r=r*BigInt(256)+BigInt(n[a]);return r}async function _d(e,t){try{const n=Hc(e),r=await t.getAccountInfo(n);if(!r)return{mintAddress:e.toBase58(),tokenAddress:e.toBase58(),name:`NFT ${e.toBase58().slice(0,8)}...`,symbol:"STUCK"};const a=zc(r.data);if(!a)return{mintAddress:e.toBase58(),tokenAddress:e.toBase58(),name:`NFT ${e.toBase58().slice(0,8)}...`,symbol:"STUCK"};let o,i,c;if(a.uri)try{console.log(`[fetchStuckNFTMetadata] Fetching off-chain metadata from: ${a.uri}`);const l=await fetch(a.uri);if(!l.ok)console.warn(`[fetchStuckNFTMetadata] HTTP ${l.status} when fetching ${a.uri}`);else{const u=await l.json();o=u.image,i=u.description,c=u.attributes,console.log("[fetchStuckNFTMetadata] âœ“ Successfully fetched off-chain metadata",{hasImage:!!o,hasDescription:!!i,hasAttributes:!!c})}}catch(l){console.warn(`[fetchStuckNFTMetadata] Failed to fetch off-chain metadata from ${a.uri}:`,l)}else console.log("[fetchStuckNFTMetadata] No URI in metadata, skipping off-chain fetch");return{mintAddress:e.toBase58(),tokenAddress:e.toBase58(),name:a.name,symbol:a.symbol,uri:a.uri,image:o,description:i,attributes:c,collectionAddress:a.collectionAddress,verified:a.verified}}catch(n){return console.error("[Recovery] Error fetching NFT metadata:",n),{mintAddress:e.toBase58(),tokenAddress:e.toBase58(),name:`NFT ${e.toBase58().slice(0,8)}...`,symbol:"STUCK"}}}const N0=Object.freeze(Object.defineProperty({__proto__:null,addToLocalStorageMintCache:Dl,checkNFTAtApprovalAddress:Cw,discoverCollectionNFTsComprehensive:ff,discoverNFTsAtApprovalAddress:Od,fetchCollectionsWithNFTs:uf,fetchNFTByMint:mf,fetchUserSolanaNFTs:lf,groupNFTsByCollection:df,isValidMintAddress:Md,storeLocalStorageMintRequestId:pf},Symbol.toStringTag,{value:"Module"}));function Aw({selectedCollection:e,onCollectionChange:t,refreshTrigger:n}){const{publicKey:r,connected:a,cluster:o,actualRpcEndpoint:i}=os(),[c,l]=x.useState([]),[u,d]=x.useState(!1),[m,f]=x.useState(null),[g,N]=x.useState(""),[h,C]=x.useState([]),[w,B]=x.useState(!1),[j,Q]=x.useState(!1),[F,_]=x.useState(!1),[M,k]=x.useState(""),{user:K}=ut(),T=rn("jio3a-xaaaa-aaaal-ab66q-cai",vs),ee=async()=>{if(!a||!r){l([]),f(null);return}d(!0),f(null);try{const p=await uf(r,i||o,{includeOffChainMetadata:!0,maxNFTs:1e3});console.log("[SolanaCollectionSelection] Discovered collections:",p.collections),l(p.collections),p.collections.length===0&&f("No NFT collections found in your wallet")}catch(p){console.error("[SolanaCollectionSelection] Error fetching collections:",p),f(p instanceof Error?p.message:"Failed to fetch collections"),l([])}finally{d(!1)}};x.useEffect(()=>{ee()},[a,r,o,i]),x.useEffect(()=>{n!==void 0&&n>0&&(console.log("[SolanaCollectionSelection] External refresh triggered"),ee())},[n]);const J=c.filter(p=>p.name.toLowerCase().includes(g.toLowerCase())),pe=p=>{t({collection:p})},E=async()=>{if(!M.trim())return;const p=M.trim();if(p.length<32||p.length>44){f("Invalid Solana mint address format");return}B(!0);try{const O=i||o,R=new ws(O,"confirmed");console.log("[Manual Entry] Checking stuck NFT:",p);const{fetchNFTByMint:q}=await Xe(async()=>{const{fetchNFTByMint:$}=await Promise.resolve().then(()=>N0);return{fetchNFTByMint:$}},void 0),v=await q(p,O);if(!v){f("Could not find NFT metadata for this mint address"),B(!1);return}const U=v.collectionAddress;if(!U){f("NFT does not have a collection address"),B(!1);return}if(console.log("[Manual Entry] NFT collection:",U),!r||!T||!(K!=null&&K.principal)){f("Wallet or authentication not ready"),B(!1);return}const{checkNFTAtApprovalAddress:S}=await Xe(async()=>{const{checkNFTAtApprovalAddress:$}=await Promise.resolve().then(()=>N0);return{checkNFTAtApprovalAddress:$}},void 0);console.log("[Manual Entry] Checking with cluster:",o);const H=await S(p,R,T,K.principal,U,o);if(!H){f(`NFT ${p.slice(0,8)}... is not at the approval address. It may be in your wallet or already minted.`),B(!1);return}console.log("[Manual Entry] âœ“ Found stuck NFT:",H);const he={address:U,name:v.collectionName||"Recovered Collection",symbol:"",verified:!1,nftCount:1,nfts:[H]};pe(he),_(!1),k("")}catch(O){console.error("[Manual Entry] Error:",O),f(O instanceof Error?O.message:"Failed to check stuck NFT")}finally{B(!1)}},b=async()=>{if(!r||!T||!(K!=null&&K.principal)){console.log("[Recovery] Cannot detect - missing requirements");return}B(!0),Q(!0);try{const p=i||o,O=new ws(p,"confirmed");console.log("[Recovery] Discovering NFTs at approval address..."),console.log("[Recovery] Using cluster:",o);const R=await Od(r,O,T,K.principal,void 0,o);console.log(`[Recovery] Found ${R.length} stuck NFTs at approval address`,R),C(R),R.length===0&&f("No stuck NFTs found at approval address. All your NFTs are either in your wallet or already minted.")}catch(p){console.error("[Recovery] Error detecting stuck NFTs:",p),f(p instanceof Error?p.message:"Failed to detect stuck NFTs")}finally{B(!1)}};return a?u?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Qe,{className:"w-12 h-12 text-purple-600 animate-spin mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Discovering Collections"}),s.jsx("p",{className:"text-gray-600",children:"Scanning your wallet for NFT collections..."})]}):m&&m!=="No NFT collections found in your wallet"?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4",children:s.jsx(lt,{className:"w-8 h-8 text-red-600"})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Collections"}),s.jsx("p",{className:"text-red-600 mb-4",children:m}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Retry"})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Select NFT Collection"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Choose which collection to bridge. Each collection gets its own ckNFT canister on Internet Computer."})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:b,disabled:w||!(K!=null&&K.principal),className:"flex items-center gap-2 px-3 py-2 text-sm text-amber-600 hover:bg-amber-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed border border-amber-200",title:"Check for NFTs stuck in previous transfer attempts",children:[s.jsx(_s,{className:be("w-4 h-4",w&&"animate-pulse")}),w?"Checking...":"Check for Stuck NFTs"]}),s.jsxs("button",{onClick:ee,disabled:u,className:"flex items-center gap-2 px-3 py-2 text-sm text-purple-600 hover:bg-purple-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Refresh NFT list",children:[s.jsx("svg",{className:be("w-4 h-4",u&&"animate-spin"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),u?"Refreshing...":"Refresh"]})]})]}),c.length>0&&s.jsxs("div",{className:"relative",children:[s.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),s.jsx("input",{type:"text",value:g,onChange:p=>N(p.target.value),placeholder:"Search collections...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),!F&&s.jsxs("button",{onClick:()=>_(!0),className:"w-full py-3 px-4 border-2 border-dashed border-amber-300 rounded-lg text-amber-700 hover:border-amber-400 hover:text-amber-800 transition-colors flex items-center justify-center gap-2",children:[s.jsx(_s,{className:"w-5 h-5"}),"Enter Stuck NFT Mint Address"]}),F&&s.jsxs("div",{className:"border-2 border-amber-200 rounded-lg p-4 bg-amber-50",children:[s.jsx("h4",{className:"font-medium text-amber-900 mb-2",children:"Recover Stuck NFT"}),s.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Enter the mint address of an NFT that was transferred but not minted. We'll check if it's at your approval address and can be recovered."}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NFT Mint Address (Required)"}),s.jsx("input",{type:"text",value:M,onChange:p=>k(p.target.value),placeholder:"e.g., AFKq1qdnmWevju6k6n9QdgWvy5K1ELuXy2bQagm1Sjbu",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent font-mono text-sm"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This is the unique address of the specific NFT, not the collection"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:E,disabled:!M.trim()||w,className:"flex-1 px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:w?"Checking...":"Check if Stuck & Recover"}),s.jsx("button",{onClick:()=>{_(!1),k("")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})]}),j&&h.length>0&&s.jsx("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-lg p-6 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[s.jsx(_s,{className:"w-6 h-6 text-amber-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h4",{className:"font-medium text-amber-900 text-lg mb-2",children:["ðŸ”§ Recovery Mode: Stuck NFTs Found (",h.length,")"]}),s.jsx("p",{className:"text-sm text-amber-700 mb-4",children:"These NFTs were previously transferred to the bridge but minting wasn't completed. Select a collection below to resume the minting process."}),Object.entries(h.reduce((p,O)=>{const R=O.collectionAddress||"Unknown Collection";return p[R]||(p[R]=[]),p[R].push(O),p},{})).map(([p,O])=>{var R;return s.jsx("div",{className:"bg-white rounded-lg p-4 mb-3 last:mb-0",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900",children:((R=O[0])==null?void 0:R.collectionName)||"Unknown Collection"}),s.jsxs("p",{className:"text-sm text-gray-600",children:[O.length," stuck NFT",O.length!==1?"s":""," ready to mint"]}),s.jsxs("p",{className:"text-xs text-gray-400 font-mono mt-1",children:[p.slice(0,8),"...",p.slice(-8)]})]}),s.jsxs("button",{onClick:()=>{var v,U,S,H;const q={address:p,name:((v=O[0])==null?void 0:v.collectionName)||"Unknown Collection",symbol:((U=O[0])==null?void 0:U.symbol)||"",image:(S=O[0])==null?void 0:S.image,verified:((H=O[0])==null?void 0:H.verified)||!1,nftCount:O.length,nfts:O};pe(q)},className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors flex items-center gap-2",children:[s.jsx(_s,{className:"w-4 h-4"}),"Resume ",O.length," NFT",O.length!==1?"s":""]})]})},p)})]})]})}),J.length>0?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:J.map(p=>{const O=(e==null?void 0:e.collection.address)===p.address;return s.jsxs("button",{onClick:()=>pe(p),className:be("relative p-4 rounded-lg border-2 text-left transition-all hover:shadow-md",O?"border-purple-600 bg-purple-50":"border-gray-200 hover:border-purple-300"),children:[O&&s.jsx("div",{className:"absolute top-3 right-3",children:s.jsx(Go,{className:"w-6 h-6 text-purple-600"})}),s.jsx("div",{className:"w-full aspect-square rounded-lg bg-gray-100 mb-3 overflow-hidden",children:p.image?s.jsx("img",{src:p.image,alt:p.name,className:"w-full h-full object-cover",onError:R=>{const q=R.target;q.style.display="none",q.parentElement.classList.add("flex","items-center","justify-center"),q.parentElement.innerHTML='<div class="text-gray-400"><svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/></svg></div>'}}):s.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:s.jsx(Zo,{className:"w-12 h-12"})})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-start justify-between mb-1",children:[s.jsx("h4",{className:"font-medium text-gray-900 truncate pr-2",children:p.name}),p.verified&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]}),p.symbol&&s.jsx("p",{className:"text-sm text-gray-600 mb-2",children:p.symbol}),s.jsx("div",{className:"mb-2",children:s.jsx("p",{className:"text-xs text-gray-500 font-mono truncate",title:p.address,children:p.address})}),s.jsx("div",{className:"flex items-center text-sm text-gray-500",children:s.jsxs("span",{children:[p.nfts.length," NFT",p.nfts.length!==1?"s":""]})})]})]},p.address)})}):c.length>0?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Li,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Collections Found"}),s.jsxs("p",{className:"text-gray-600",children:['No collections match "',g,'"']}),s.jsx("button",{onClick:()=>N(""),className:"mt-4 text-purple-600 hover:text-purple-700 font-medium",children:"Clear Search"})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4",children:s.jsx(Zo,{className:"w-8 h-8 text-gray-400"})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Collections Found"}),s.jsxs("p",{className:"text-gray-600 mb-4",children:["Your wallet doesn't contain any NFT collections on ",o]}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto text-left",children:[s.jsx("p",{className:"text-sm font-medium text-blue-900 mb-2",children:"ðŸ’¡ What you can do:"}),s.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[s.jsxs("li",{children:["â€¢ Click ",s.jsx("strong",{children:'"Check for Stuck NFTs"'})," above to find NFTs from incomplete transfers"]}),s.jsxs("li",{children:["â€¢ Click ",s.jsx("strong",{children:'"Enter Collection Address Manually"'})," to add a collection by its mint address"]}),s.jsxs("li",{children:["â€¢ Verify you're on the correct network (",o,")"]})]})]})]}),e&&s.jsxs("div",{className:"mt-6 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-purple-900 mb-2",children:"Selected Collection"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[e.collection.image&&s.jsx("img",{src:e.collection.image,alt:e.collection.name,className:"w-12 h-12 rounded-lg object-cover"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900",children:e.collection.name}),s.jsx("p",{className:"text-xs text-gray-500 font-mono mb-1",title:e.collection.address,children:e.collection.address}),s.jsxs("p",{className:"text-sm text-gray-600",children:[e.collection.nfts.length," NFT",e.collection.nfts.length!==1?"s":"",e.collection.verified&&" â€¢ Verified"]})]})]})]})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-purple-100 mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Wallet Not Connected"}),s.jsx("p",{className:"text-gray-600",children:"Please connect your Solana wallet in Step 1 to view your collections"})]})}function Tw({selectedCollection:e,selectedNFTs:t,onSelectionChange:n,mode:r,targetCanister:a}){const{publicKey:o,connected:i,cluster:c,actualRpcEndpoint:l}=os(),u=x.useMemo(()=>{const E=e.collection.nfts;return console.log("[SolanaNFTSelection] Collection NFTs:",{collectionAddress:e.collection.address,collectionName:e.collection.name,nftCount:E.length,nfts:E}),E},[e]),[d,m]=x.useState(""),[f,g]=x.useState(!1),[N,h]=x.useState(""),[C,w]=x.useState(!1),[B,j]=x.useState(null),[Q,F]=x.useState([]),[_,M]=x.useState(!1),{user:k}=ut(),V=rn("jio3a-xaaaa-aaaal-ab66q-cai",vs);x.useEffect(()=>{(async()=>{if(!(!o||!V||!(k!=null&&k.principal)||!l&&!c)){M(!0);try{const b=l||c,Y=new ws(b,"confirmed");console.log("[SolanaNFTSelection] Running comprehensive discovery...",{userWallet:o.toBase58(),collectionAddress:e.collection.address});const p=await ff(o,Y,V,k.principal,e.collection.address,{Solana:[{Devnet:null}]});if(console.log("[SolanaNFTSelection] Discovery result:",p),F(p.nftsAtApproval),e.collection.nfts.length===0){const O=[...p.nftsInWallet];for(const R of p.nftsAtApproval)O.some(q=>q.mintAddress===R.mintAddress)||O.push(R);e.collection.nfts=O,e.collection.nftCount=O.length,console.log(`[SolanaNFTSelection] Populated manual collection with ${O.length} NFTs`)}}catch(b){console.error("[SolanaNFTSelection] Error in comprehensive discovery:",b)}finally{M(!1)}}})()},[o,k==null?void 0:k.principal,l,c,e.collection.address]);const T=x.useMemo(()=>{if(!d.trim())return console.log("[SolanaNFTSelection] No search query, returning all collection NFTs:",u.length),u;const E=d.toLowerCase(),b=u.filter(Y=>{var p,O;return((p=Y.name)==null?void 0:p.toLowerCase().includes(E))||Y.mintAddress.toLowerCase().includes(E)||((O=Y.symbol)==null?void 0:O.toLowerCase().includes(E))});return console.log("[SolanaNFTSelection] Filtered NFTs:",{query:E,totalNFTs:u.length,filteredCount:b.length}),b},[u,d]);console.log("[SolanaNFTSelection] Component rendering:",{collectionNFTsLength:u.length,filteredNFTsLength:T.length,showingEmptyState:u.length===0,showingGrid:T.length>0});const ee=E=>{const b=E.mintAddress;if(t.some(p=>p.mintAddress===b))n(t.filter(p=>p.mintAddress!==b));else{const p={mintAddress:b,name:E.name||"Unnamed NFT",symbol:E.symbol,image:E.image,collection:E.collectionAddress?{address:E.collectionAddress,name:E.collectionName||"Unknown Collection",verified:E.verified||!1}:void 0,metadata:E,source:"discovered",ownershipState:"owned"};Dl(b,E.collectionAddress||e.collection.address),n([...t,p])}},J=E=>{const b=E.mintAddress;if(t.some(p=>p.mintAddress===b))n(t.filter(p=>p.mintAddress!==b));else{const p={mintAddress:b,name:E.name||"Unnamed NFT",symbol:E.symbol,image:E.image,collection:E.collectionAddress?{address:E.collectionAddress,name:E.collectionName||"Unknown Collection",verified:E.verified||!1}:void 0,metadata:{...E,approvalAddress:E.approvalAddress,mintRequestId:E.mintRequestId},source:"discovered",ownershipState:"ready-to-mint"};n([...t,p])}},pe=async E=>{if(E.preventDefault(),!(!l&&!c||!N.trim())){if(t.some(b=>b.mintAddress===N.trim())){j("This NFT is already selected");return}if(!Md(N.trim())){j("Invalid Solana mint address");return}w(!0),j(null);try{const b=l||c,Y=await mf(N.trim(),b);if(!Y){j("NFT not found or invalid metadata");return}const p={mintAddress:Y.mintAddress,name:Y.name||"Unnamed NFT",symbol:Y.symbol,image:Y.image,collection:Y.collectionAddress?{address:Y.collectionAddress,name:Y.collectionName||"Unknown Collection",verified:Y.verified||!1}:void 0,metadata:Y,source:"manual",ownershipState:"owned"};Dl(Y.mintAddress,Y.collectionAddress||e.collection.address),n([...t,p]),h(""),g(!1)}catch(b){console.error("[SolanaNFTSelectionStep] Manual entry error:",b),j(b instanceof Error?b.message:"Failed to fetch NFT metadata")}finally{w(!1)}}};return!i||!o?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"text-4xl mb-4",children:"â—Ž"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Please connect your wallet first"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Go back to Step 1 to connect your Solana wallet"})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:["Select NFTs to ",r==="import"?"Import":"Burn"]}),s.jsx("p",{className:"text-gray-600",children:r==="import"?"Choose which NFTs to bridge from Solana to Internet Computer":"Select NFTs to burn on Solana and remint on Internet Computer"})]}),t.length>0&&s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"}),s.jsxs("span",{className:"font-medium text-blue-900",children:[t.length," NFT",t.length!==1?"s":""," selected"]})]}),s.jsx("button",{onClick:()=>n([]),className:"text-sm text-blue-700 hover:text-blue-900 underline",children:"Clear all"})]})}),s.jsxs("div",{className:"relative",children:[s.jsx(Li,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),s.jsx("input",{type:"text",value:d,onChange:E=>m(E.target.value),placeholder:"Search by name, symbol, or mint address...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs("button",{onClick:()=>g(!f),className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:text-gray-900 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[s.jsx(cd,{className:"w-4 h-4"}),"Add by Mint Address"]})}),f&&s.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-gray-50",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Add NFT Manually"}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Enter a Solana NFT mint address to add it to your selection. Useful for recovering NFTs that aren't automatically discovered."}),s.jsxs("form",{onSubmit:pe,className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("input",{type:"text",value:N,onChange:E=>{h(E.target.value),j(null)},placeholder:"e.g., 6NS2gnVrBoV44sWGCeSnzHhuf7Fv4sMLh5uEVjTEVvV4",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm",disabled:C}),B&&s.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[s.jsx(lt,{className:"w-4 h-4"}),B]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{type:"submit",disabled:C||!N.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[C&&s.jsx(Qe,{className:"w-4 h-4 animate-spin"}),C?"Loading...":"Add NFT"]}),s.jsx("button",{type:"button",onClick:()=>{g(!1),h(""),j(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})]}),s.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6",children:[s.jsx("h3",{className:"font-medium text-purple-900 mb-1",children:e.collection.name}),s.jsxs("p",{className:"text-sm text-purple-700",children:[u.length," NFT",u.length!==1?"s":""," in this collection"]})]}),_&&s.jsx("div",{className:"mb-6 bg-amber-50 border border-amber-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Qe,{className:"w-5 h-5 text-amber-600 animate-spin"}),s.jsx("p",{className:"text-sm text-amber-700",children:"Checking for previously transferred NFTs..."})]})}),!_&&Q.length>0&&s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(_s,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h4",{className:"font-medium text-amber-900 mb-1",children:["Resume Previous Transfers (",Q.length,")"]}),s.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"These NFTs were previously transferred to the bridge but their mint wasn't completed. Select them to resume the minting process without needing to transfer again."})]})]})}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:Q.map(E=>{const b=t.some(Y=>Y.mintAddress===E.mintAddress);return s.jsxs("div",{onClick:()=>J(E),className:be("border rounded-lg overflow-hidden cursor-pointer transition-all relative",b?"ring-2 ring-amber-500 border-amber-500":"border-amber-200 hover:border-amber-300 hover:shadow-md"),children:[s.jsx("div",{className:"absolute top-2 left-2 z-10",children:s.jsxs("div",{className:"bg-amber-500 text-white text-xs font-medium px-2 py-1 rounded-full flex items-center gap-1",children:[s.jsx(_s,{className:"w-3 h-3"}),"Resume"]})}),s.jsxs("div",{className:"aspect-square bg-gray-100 relative",children:[E.image?s.jsx("img",{src:E.image,alt:E.name||"NFT",className:"w-full h-full object-cover",loading:"lazy"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"ðŸ–¼ï¸"}),s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("div",{className:be("w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors",b?"bg-amber-600 border-amber-600":"bg-white border-gray-300"),children:b&&s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})})]}),s.jsxs("div",{className:"p-3",children:[s.jsx("p",{className:"font-medium text-sm text-gray-900 truncate",children:E.name||"Unnamed NFT"}),E.symbol&&s.jsx("p",{className:"text-xs text-gray-500 truncate",children:E.symbol}),s.jsxs("p",{className:"text-xs text-gray-400 truncate font-mono mt-1",children:[E.mintAddress.slice(0,4),"...",E.mintAddress.slice(-4)]}),E.mintRequestId&&s.jsxs("p",{className:"text-xs text-amber-600 mt-1 font-medium",children:["Request ID: ",E.mintRequestId.toString().slice(0,8),"..."]})]})]},E.mintAddress)})})]}),u.length===0&&s.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[s.jsx("div",{className:"text-4xl mb-4",children:"ðŸ–¼ï¸"}),s.jsx("p",{className:"text-gray-900 font-medium mb-2",children:"No NFTs Found"}),s.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"This collection doesn't have any NFTs in your wallet"}),s.jsx("button",{onClick:()=>g(!0),className:"text-blue-600 hover:text-blue-700 underline text-sm",children:"Add NFT manually by mint address"})]}),T.length>0&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("p",{className:"text-sm text-gray-600",children:[t.length," of ",u.length," NFT",u.length!==1?"s":""," selected"]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:T.map(E=>{const b=t.some(Y=>Y.mintAddress===E.mintAddress);return s.jsxs("div",{onClick:()=>ee(E),className:be("border rounded-lg overflow-hidden cursor-pointer transition-all",b?"ring-2 ring-blue-500 border-blue-500":"border-gray-200 hover:border-gray-300 hover:shadow-md"),children:[s.jsxs("div",{className:"aspect-square bg-gray-100 relative",children:[E.image?s.jsx("img",{src:E.image,alt:E.name||"NFT",className:"w-full h-full object-cover",loading:"lazy"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"ðŸ–¼ï¸"}),s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("div",{className:be("w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors",b?"bg-blue-600 border-blue-600":"bg-white border-gray-300"),children:b&&s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})})]}),s.jsxs("div",{className:"p-3",children:[s.jsx("p",{className:"font-medium text-sm text-gray-900 truncate",children:E.name||"Unnamed NFT"}),E.symbol&&s.jsx("p",{className:"text-xs text-gray-500 truncate",children:E.symbol}),s.jsxs("p",{className:"text-xs text-gray-400 truncate font-mono mt-1",children:[E.mintAddress.slice(0,4),"...",E.mintAddress.slice(-4)]})]})]},E.mintAddress)})})]}),d&&T.length===0&&u.length>0&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-gray-600",children:"No NFTs match your search"}),s.jsx("button",{onClick:()=>m(""),className:"text-blue-600 hover:text-blue-700 underline text-sm mt-2",children:"Clear search"})]})]})}var Ew={};function Sw({selectedCollection:e,costs:t,onCostsCalculated:n,onCanisterCreated:r,compact:a=!1}){var ce;const{cluster:o,actualRpcEndpoint:i}=os(),{user:c}=ut(),l=Ew.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",u=js(l),{useBalance:d,useApprove:m}=u;console.log("[SolanaCanisterCostStep] User auth state:",{user:c?{principal:(ce=c.principal)==null?void 0:ce.toString()}:null,hasPrincipal:!!(c!=null&&c.principal)});const f=d(c!=null&&c.principal?{owner:c.principal,subaccount:[]}:void 0),g=m(),N=f.data,h=f.isLoading,C=f.error,w=g.isPending,B=g.error,j=L=>{const re=BigInt(1e12),se=L/re,ge=(L%re).toString().padStart(12,"0").slice(0,3);return`${se.toLocaleString()}.${ge} TC`},Q=L=>N?N>=L:!1,F=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),_=x.useMemo(()=>i&&i.includes("127.0.0.1")?"localnet":o||"devnet",[i,o]),M=x.useMemo(()=>{if(!e)return null;const L=e.collection.address,ue=So(_);return{contract:L,network:ue}},[e==null?void 0:e.collection.address,_]);console.log("[SolanaCanisterCostStep] Contract pointer created:",{selectedCollection:e==null?void 0:e.collection.address,collectionName:e==null?void 0:e.collection.name,effectiveCluster:_,actualRpcEndpoint:i,contractPointer:M});const{data:k,isLoading:K,error:V}=Y0(M,!!e),{data:T,isLoading:ee,error:J}=Z0(M,!!e),{data:pe,isLoading:E}=oa(k||void 0);console.log("[SolanaCanisterCostStep] Query results:",{realCost:k==null?void 0:k.toString(),isLoadingCost:K,costError:V,existingCanister:T,isLoadingExisting:ee,existingError:J}),x.useEffect(()=>{k&&t===null&&(console.log("[SolanaCanisterCostStep] Updating costs:",k.toString()),n(k))},[k,t,n]);const b=t||k,Y=K||ee||!!e&&!b,p=V||C||J,O=Array.isArray(T)?T.length>0:T!=null,R=x.useMemo(()=>{if(!T)return null;if(Array.isArray(T)){if(T.length===0)return null;const L=T[0];return L&&typeof L=="object"&&"toString"in L?L.toString():String(L)}return typeof T=="object"&&"toString"in T?T.toString():String(T)},[T]);x.useEffect(()=>{R&&r&&(console.log("[SolanaCanisterCostStep] Found existing canister:",R),r(R))},[R,r]);const{data:q,isLoading:v,error:U}=X0(R,O&&!!R),S=()=>{if(!T)return"N/A";try{if(Array.isArray(T)){if(T.length===0)return"No canister found";const L=T[0];return L&&typeof L=="object"&&"toString"in L?L.toString():String(L)}return T&&typeof T=="object"&&"toString"in T?T.toString():typeof T=="string"?T:String(T)}catch(L){return console.error("Error converting canister ID to string:",L,T),"Error displaying ID"}},H=x.useCallback(async()=>{if(!M||!b||!e){console.error("[SolanaCanisterCostStep] Missing required data for canister creation");return}try{console.log("[SolanaCanisterCostStep] Creating canister for collection:",{contractPointer:M,collection:e});const L=(pe==null?void 0:pe.isSufficient)&&!(pe!=null&&pe.isExpired);console.log(L?"[SolanaCanisterCostStep] Sufficient allowance exists, skipping auto-approval":"[SolanaCanisterCostStep] Will auto-approve cycles during creation");const ue=e.collection.name,re=e.collection.symbol||"ckNFT",se=await F.createCanister.mutateAsync({pointer:M,defaults:{name:`ckNFT: ${ue}`,symbol:re,description:`Cross-chain Solana NFTs from collection "${ue}" bridged to Internet Computer from ${_}`},spender:c!=null&&c.principal?{owner:c.principal,subaccount:[]}:void 0,requiredCycles:b,skipApproval:L});if(console.log("[SolanaCanisterCostStep] Canister creation result:",se),"Ok"in se){const Ne=se.Ok.toString();console.log("[SolanaCanisterCostStep] Canister created successfully for collection:",Ne),r&&r(Ne)}else console.error("[SolanaCanisterCostStep] Unexpected result format:",se)}catch(L){console.error("[SolanaCanisterCostStep] Error creating canister:",L)}},[M,b,e,pe,F.createCanister,c==null?void 0:c.principal,_,r]),he=!Y&&b&&(c==null?void 0:c.principal)&&N!==void 0&&Q(b)&&!O&&!F.createCanister.isPending,$=L=>j(L),W=L=>(Number(L)/1e12).toFixed(6),le=L=>{switch(L){case"mainnet-beta":return"Solana Mainnet";case"devnet":return"Solana Devnet";case"testnet":return"Solana Testnet";case"localnet":return"Local Validator";default:return L}};return a?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Canister Status"}),s.jsx("p",{className:"text-gray-600",children:"Current status of your Solana NFT canister on the Internet Computer."}),s.jsxs("p",{className:"text-sm text-purple-600 mt-1",children:["Network: ",le(_)]})]}),p&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-800",children:["Error: ",(()=>{try{return V instanceof Error?V.message:C instanceof Error?C.message:J instanceof Error?J.message:V?String(V):C?String(C):J?String(J):"Unknown error occurred"}catch(L){return console.error("Error formatting error message:",L,{costError:V,balanceError:C,existingError:J}),"Error formatting error message"}})()]})}),F.createCanister.error&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-800",children:["Canister creation failed: ",F.createCanister.error instanceof Error?F.createCanister.error.message:String(F.createCanister.error)]})}),Y?s.jsxs("div",{className:"text-center py-6",children:[s.jsx("div",{className:"animate-spin w-6 h-6 border-4 border-purple-600 border-t-transparent rounded-full mx-auto mb-2"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Loading canister information..."})]}):O?s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-5 h-5 text-green-500 mr-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-green-800",children:"âœ… ckNFT Canister Ready"}),s.jsx("p",{className:"text-xs text-green-600 font-mono mt-1",children:S()})]})]})}):b?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"Canister Creation"}),s.jsxs("div",{className:"text-right",children:[s.jsx("span",{className:"text-sm font-medium",children:$(b)}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",W(b)," ICP"]})]})]}),s.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"Your Balance"}),s.jsx("div",{className:"text-right",children:c!=null&&c.principal?h?s.jsx("span",{className:"text-sm text-gray-500",children:"Loading..."}):N!==void 0?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:be("text-sm font-medium",Q(b)?"text-green-600":"text-red-600"),children:$(N)}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",W(N)," ICP"]})]}):s.jsx("span",{className:"text-sm text-red-600",children:"Unable to load"}):s.jsx("span",{className:"text-sm text-amber-600",children:"Authentication required"})})]})]}),c!=null&&c.principal?he&&s.jsx("button",{onClick:H,disabled:!he||F.createCanister.isPending,className:be("w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors",he&&!F.createCanister.isPending?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:F.createCanister.isPending?s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Creating..."]}):`Create Canister (${$(b)})`}):s.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg text-center",children:s.jsx("p",{className:"text-xs text-amber-700",children:"Connect with NFID or Internet Identity to create canister"})})]}):s.jsx("div",{className:"p-4 text-center border-2 border-dashed border-gray-300 rounded-lg",children:s.jsx("p",{className:"text-sm text-gray-500",children:"Select NFTs to see canister costs"})})]}):(console.log("[SolanaCanisterCostStep] collectionMetadata:",q),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Solana Canister Costs"}),s.jsx("p",{className:"text-gray-600",children:"Review the costs for creating your Solana NFT canister on the Internet Computer."}),s.jsxs("p",{className:"text-sm text-purple-600 mt-1",children:["Network: ",le(_)," â€¢ Collection: ",(e==null?void 0:e.collection.name)||"None selected"]})]}),p&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-800",children:["Error loading information: ",(()=>{try{return V instanceof Error?V.message:C instanceof Error?C.message:J instanceof Error?J.message:V?String(V):C?String(C):J?String(J):"Unknown error occurred"}catch(L){return console.error("Error formatting error message:",L,{costError:V,balanceError:C,existingError:J}),"Error formatting error message"}})()]})}),F.createCanister.error&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-800",children:["Canister creation failed: ",F.createCanister.error instanceof Error?F.createCanister.error.message:String(F.createCanister.error)]})}),F.createCanister.isSuccess&&!O&&s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-green-800",children:"âœ… Canister created successfully! Refreshing canister information..."})}),Y?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-purple-600 border-t-transparent rounded-full mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading canister information and your balance..."})]}):O?s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("svg",{className:"w-5 h-5 text-green-500 mt-0.5 mr-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Solana ckNFT Canister Already Exists"}),s.jsx("p",{className:"text-sm text-green-700 mb-2",children:"A canister for this Solana collection already exists on the Internet Computer."}),s.jsxs("p",{className:"text-xs text-green-600 font-mono mb-3",children:["Canister ID: ",S()]}),v?s.jsx("div",{className:"mt-2 p-2 bg-green-100 rounded text-xs",children:s.jsx("div",{className:"animate-pulse text-green-700",children:"Loading collection metadata..."})}):U?s.jsx("div",{className:"mt-2 p-2 bg-yellow-100 border border-yellow-200 rounded text-xs",children:s.jsx("div",{className:"text-yellow-700",children:"Unable to load collection metadata"})}):q?s.jsx("div",{className:"mt-2 p-3 bg-green-100 border border-green-200 rounded text-sm",children:q.name||q.symbol||q.description||q.totalSupply!==null||q.supplyCap!==null||q.royalties?s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[q.name&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-800",children:"Name:"}),s.jsx("span",{className:"ml-1 text-green-700",children:q.name})]}),q.symbol&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-800",children:"Symbol:"}),s.jsx("span",{className:"ml-1 text-green-700",children:q.symbol})]}),q.description&&s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("span",{className:"font-medium text-green-800",children:"Description:"}),s.jsx("p",{className:"ml-1 text-green-700 text-xs mt-1",children:q.description})]}),q.totalSupply!==null&&q.totalSupply!==void 0&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-800",children:"Total Supply:"}),s.jsx("span",{className:"ml-1 text-green-700",children:String(q.totalSupply)})]}),q.supplyCap!==null&&q.supplyCap!==void 0&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-800",children:"Supply Cap:"}),s.jsx("span",{className:"ml-1 text-green-700",children:String(q.supplyCap)})]}),q.royalties&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-800",children:"Royalties:"}),s.jsxs("span",{className:"ml-1 text-green-700",children:[(Number(q.royalties)/100).toFixed(2),"%"]})]})]}):s.jsxs("div",{className:"text-sm text-amber-700 mb-2",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{className:"font-medium",children:"Canister Metadata Not Yet Initialized"})]}),s.jsx("p",{className:"text-xs text-amber-600 mt-1 ml-6",children:"This canister exists but its collection metadata hasn't been set up yet. The metadata will be populated during the first Solana NFT bridging operation."})]})}):s.jsx("div",{className:"mt-2 p-2 bg-gray-100 rounded text-xs",children:s.jsx("div",{className:"text-gray-600",children:"No collection metadata available"})})]})]})}),s.jsx("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-purple-800",children:[s.jsx("strong",{children:"No additional costs required!"})," Since the canister already exists, you can proceed directly to bridge your Solana NFTs without paying canister creation fees."]})})]}):b?s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-700",children:"Canister Creation Cost"}),s.jsxs("div",{className:"text-right",children:[s.jsxs("span",{className:"font-medium",children:[$(b)," Cycles"]}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",W(b)," ICP"]})]})]}),s.jsxs("div",{className:"flex justify-between items-center border-t pt-3",children:[s.jsx("span",{className:"text-gray-700",children:"Your Cycles Balance"}),s.jsx("div",{className:"text-right",children:h?s.jsx("span",{className:"text-gray-500",children:"Loading..."}):N!==void 0?s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:be("font-medium",Q(b)?"text-green-600":"text-red-600"),children:[$(N)," Cycles"]}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",W(N)," ICP"]})]}):s.jsx("span",{className:"text-red-600",children:"Unable to load"})})]}),N!==void 0&&b&&s.jsx("div",{className:"border-t pt-3",children:Q(b)?s.jsxs("div",{className:"flex items-center text-green-700",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:"Sufficient balance available"})]}):s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center text-red-700",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsxs("span",{className:"text-sm font-medium",children:["Insufficient balance (need ",$(b-N)," more cycles)"]})]}),s.jsx("p",{className:"text-xs text-red-600",children:"You need to top up your cycles balance before proceeding."})]})})]})}),b&&s.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-700",children:"Existing Approval"}),s.jsx("div",{className:"text-right",children:E?s.jsx("span",{className:"text-gray-500",children:"Checking..."}):pe?pe.isSufficient&&!pe.isExpired?s.jsxs("div",{className:"flex items-center text-green-600",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:"Approved"})]}):s.jsxs("div",{className:"flex items-center text-amber-600",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:pe.isExpired?"Expired":"Insufficient"})]}):s.jsxs("div",{className:"flex items-center text-red-600",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm font-medium",children:"None"})]})})]}),pe&&s.jsxs("div",{className:"text-xs text-gray-600 border-t pt-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Current Allowance:"}),s.jsxs("span",{className:"font-mono",children:[j(pe.allowance)," Cycles"]})]}),pe.expires_at&&s.jsxs("div",{className:"flex justify-between mt-1",children:[s.jsx("span",{children:"Expires:"}),s.jsx("span",{className:"font-mono",children:new Date(Number(pe.expires_at)/1e6).toLocaleString()})]})]}),b&&(!(pe!=null&&pe.isSufficient)||(pe==null?void 0:pe.isExpired))&&s.jsxs("div",{className:"border-t pt-3",children:[s.jsx("button",{onClick:async()=>{if(b)try{const L=qe.fromText("jio3a-xaaaa-aaaal-ab66q-cai"),ue=b*BigInt(120)/BigInt(100),re=BigInt(Date.now()*1e6)+BigInt(1440*60*1e9);await g.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:ue,expected_allowance:[],expires_at:[re],spender:{owner:L,subaccount:[]}})}catch(L){console.error("Manual approval failed:",L)}},disabled:w,className:be("w-full px-3 py-2 text-sm rounded-md font-medium transition-colors",w?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-amber-600 text-white hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2"),children:w?"Approving...":"Pre-approve Cycles"}),B&&s.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Approval failed: ",B instanceof Error?B.message:String(B)]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This will approve 110% of the required amount for future canister creations."})]})]})}),b&&!O&&!(c!=null&&c.principal)&&s.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-5 h-5 text-amber-500 mr-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-amber-800",children:"Internet Computer Authentication Required"}),s.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Please connect with NFID or Internet Identity to create canisters and check your cycles balance."})]})]})}),he&&s.jsx("button",{onClick:H,disabled:!he||F.createCanister.isPending,className:be("w-full px-4 py-3 rounded-lg font-medium transition-colors",he&&!F.createCanister.isPending?"bg-purple-600 text-white hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:F.createCanister.isPending?s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Creating Canister..."]}):`Create Solana ckNFT Canister (${$(b)} Cycles)`}),b&&!O&&!(c!=null&&c.principal)&&s.jsx("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"text-center",children:[s.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[s.jsx("strong",{children:"Estimated Cost:"})," ",$(b)," Cycles"]}),s.jsxs("p",{className:"text-xs text-gray-500",children:["â‰ˆ ",W(b)," ICP"]}),s.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Connect to Internet Computer to proceed"})]})}),s.jsx("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-purple-800",children:[s.jsx("strong",{children:"What are cycles?"})," Cycles are the unit of payment for computation and storage on the Internet Computer. This cost covers creating your Solana NFT canister where your bridged NFTs will be securely stored and managed on-chain."]})}),N!==void 0&&b&&!Q(b)&&s.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[s.jsxs("p",{className:"text-sm text-amber-800 mb-2",children:[s.jsx("strong",{children:"Need more cycles?"})," You can top up your cycles balance by:"]}),s.jsxs("ul",{className:"text-xs text-amber-700 space-y-1 ml-4",children:[s.jsx("li",{children:"â€¢ Converting ICP to cycles through the NNS"}),s.jsx("li",{children:"â€¢ Using a cycles wallet or faucet"}),s.jsx("li",{children:"â€¢ Having someone transfer cycles to your account"})]})]})]}):s.jsx("div",{className:"p-6 text-center border-2 border-dashed border-gray-300 rounded-lg",children:s.jsx("p",{className:"text-gray-500",children:"Select NFTs to see canister creation costs"})})]}))}const ns=new Ve("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA");new Ve("TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb");const sn=new Ve("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL");new Ve("So11111111111111111111111111111111111111112");new Ve("9pan9bMn5HatX4EJdBwg9VgCa7Uz5HL8N1m5D3NdXejP");const Id=e=>{const t=e.decode.bind(e),n=e.encode.bind(e);return{decode:t,encode:n}};var mr={},w0;function Fw(){if(w0)return mr;w0=1,Object.defineProperty(mr,"__esModule",{value:!0});function e(a){{const o=Buffer.from(a);o.reverse();const i=o.toString("hex");return i.length===0?BigInt(0):BigInt(`0x${i}`)}}mr.toBigIntLE=e;function t(a){{const o=a.toString("hex");return o.length===0?BigInt(0):BigInt(`0x${o}`)}}mr.toBigIntBE=t;function n(a,o){{const i=a.toString(16),c=Buffer.from(i.padStart(o*2,"0").slice(0,o*2),"hex");return c.reverse(),c}}mr.toBufferLE=n;function r(a,o){{const i=a.toString(16);return Buffer.from(i.padStart(o*2,"0").slice(0,o*2),"hex")}}return mr.toBufferBE=r,mr}var v0=Fw();const Rw=e=>t=>{const n=ss.blob(e,t),{encode:r,decode:a}=Id(n),o=n;return o.decode=(i,c)=>{const l=a(i,c);return v0.toBigIntLE(Buffer.from(l))},o.encode=(i,c,l)=>{const u=v0.toBufferLE(i,e);return r(u,c,l)},o},Ko=Rw(8),Bw=e=>{const t=ss.u8(e),{encode:n,decode:r}=Id(t),a=t;return a.decode=(o,i)=>!!r(o,i),a.encode=(o,i,c)=>{const l=Number(o);return n(l,i,c)},a},Na=e=>{const t=ss.blob(32,e),{encode:n,decode:r}=Id(t),a=t;return a.decode=(o,i)=>{const c=r(o,i);return new Ve(c)},a.encode=(o,i,c)=>{const l=o.toBuffer();return n(l,i,c)},a};class gf extends Error{constructor(t){super(t)}}class xf extends gf{constructor(){super(...arguments),this.name="TokenOwnerOffCurveError"}}var hc;(function(e){e[e.InitializeMint=0]="InitializeMint",e[e.InitializeAccount=1]="InitializeAccount",e[e.InitializeMultisig=2]="InitializeMultisig",e[e.Transfer=3]="Transfer",e[e.Approve=4]="Approve",e[e.Revoke=5]="Revoke",e[e.SetAuthority=6]="SetAuthority",e[e.MintTo=7]="MintTo",e[e.Burn=8]="Burn",e[e.CloseAccount=9]="CloseAccount",e[e.FreezeAccount=10]="FreezeAccount",e[e.ThawAccount=11]="ThawAccount",e[e.TransferChecked=12]="TransferChecked",e[e.ApproveChecked=13]="ApproveChecked",e[e.MintToChecked=14]="MintToChecked",e[e.BurnChecked=15]="BurnChecked",e[e.InitializeAccount2=16]="InitializeAccount2",e[e.SyncNative=17]="SyncNative",e[e.InitializeAccount3=18]="InitializeAccount3",e[e.InitializeMultisig2=19]="InitializeMultisig2",e[e.InitializeMint2=20]="InitializeMint2",e[e.GetAccountDataSize=21]="GetAccountDataSize",e[e.InitializeImmutableOwner=22]="InitializeImmutableOwner",e[e.AmountToUiAmount=23]="AmountToUiAmount",e[e.UiAmountToAmount=24]="UiAmountToAmount",e[e.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",e[e.TransferFeeExtension=26]="TransferFeeExtension",e[e.ConfidentialTransferExtension=27]="ConfidentialTransferExtension",e[e.DefaultAccountStateExtension=28]="DefaultAccountStateExtension",e[e.Reallocate=29]="Reallocate",e[e.MemoTransferExtension=30]="MemoTransferExtension",e[e.CreateNativeMint=31]="CreateNativeMint",e[e.InitializeNonTransferableMint=32]="InitializeNonTransferableMint",e[e.InterestBearingMintExtension=33]="InterestBearingMintExtension",e[e.CpiGuardExtension=34]="CpiGuardExtension",e[e.InitializePermanentDelegate=35]="InitializePermanentDelegate",e[e.TransferHookExtension=36]="TransferHookExtension",e[e.MetadataPointerExtension=39]="MetadataPointerExtension",e[e.GroupPointerExtension=40]="GroupPointerExtension",e[e.GroupMemberPointerExtension=41]="GroupMemberPointerExtension",e[e.ScaledUiAmountExtension=43]="ScaledUiAmountExtension",e[e.PausableExtension=44]="PausableExtension"})(hc||(hc={}));var ed;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initialized=1]="Initialized",e[e.Frozen=2]="Frozen"})(ed||(ed={}));const Ud=ss.struct([Na("mint"),Na("owner"),Ko("amount"),ss.u32("delegateOption"),Na("delegate"),ss.u8("state"),ss.u32("isNativeOption"),Ko("isNative"),Ko("delegatedAmount"),ss.u32("closeAuthorityOption"),Na("closeAuthority")]);Ud.span;function Pw(e,t,n){if(n.length){e.push({pubkey:t,isSigner:!1,isWritable:!1});for(const r of n)e.push({pubkey:r instanceof Ve?r:r.publicKey,isSigner:!0,isWritable:!1})}else e.push({pubkey:t,isSigner:!0,isWritable:!1});return e}const qc=ss.struct([ss.u32("mintAuthorityOption"),Na("mintAuthority"),Ko("supply"),ss.u8("decimals"),Bw("isInitialized"),ss.u32("freezeAuthorityOption"),Na("freezeAuthority")]);qc.span;async function Lr(e,t,n=!1,r=ns,a=sn){if(!n&&!Ve.isOnCurve(t.toBuffer()))throw new xf;const[o]=await Ve.findProgramAddress([t.toBuffer(),r.toBuffer(),e.toBuffer()],a);return o}function $d(e,t,n,r,a=ns,o=sn){return Mw(e,t,n,r,Buffer.alloc(0),a,o)}function Mw(e,t,n,r,a,o=ns,i=sn){const c=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:ad.programId,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];return new P0({keys:c,programId:i,data:a})}const td=ss.struct([ss.u8("instruction"),Ko("amount")]);function Vd(e,t,n,r,a=[],o=ns){const i=Pw([{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0}],n,a),c=Buffer.alloc(td.span);return td.encode({instruction:hc.Transfer,amount:BigInt(r)},c),new P0({keys:i,programId:o,data:c})}const Gd=Object.freeze(Object.defineProperty({__proto__:null,ASSOCIATED_TOKEN_PROGRAM_ID:sn,AccountLayout:Ud,get AccountState(){return ed},MintLayout:qc,TOKEN_PROGRAM_ID:ns,TokenError:gf,get TokenInstruction(){return hc},TokenOwnerOffCurveError:xf,createAssociatedTokenAccountInstruction:$d,createTransferInstruction:Vd,getAssociatedTokenAddress:Lr,transferInstructionData:td},Symbol.toStringTag,{value:"Module"}));var Ow={};function j0(e){return JSON.stringify(e,(t,n)=>typeof n=="bigint"?n.toString()+"n":n)}function _w({selectedNFTs:e,canisterAddress:t,mintCosts:n,targetCluster:r="devnet",onComplete:a,onError:o}){const{publicKey:i,connection:c,address:l,sendTransaction:u}=os(),{user:d}=ut(),m=So(r),f="jio3a-xaaaa-aaaal-ab66q-cai",g=Vt(f),N=rn(f,vs),h=od(f,vs),[C,w]=x.useState(!1),[B,j]=x.useState(null),[Q,F]=x.useState([]),[_,M]=x.useState([]),[k,K]=x.useState(null);x.useEffect(()=>{const E=e.map(b=>({mintAddress:b.mintAddress,name:b.name,status:"pending"}));F(E)},[e]),x.useEffect(()=>{M([{id:"get-approval",title:"Get Orchestrator Approval Address",status:"pending"},{id:"transfer-nfts",title:"Transfer NFTs to Bridge",status:"pending"},{id:"mint-cknfts",title:"Mint ckNFTs on Internet Computer",status:"pending"},{id:"complete",title:"Bridge Complete",status:"pending"}])},[]);const V=(E,b,Y)=>{M(p=>p.map(O=>O.id===E?{...O,status:b,message:Y}:O))},T=(E,b)=>{F(Y=>Y.map(p=>p.mintAddress===E?{...p,...b}:p))},ee=async()=>{var E,b,Y,p,O,R,q;if(!i||!l||!h||!d)throw new Error("Not ready: wallet or orchestrator not connected");try{w(!0),console.log("ðŸ” Step 1: Getting orchestrator approval address..."),console.log("   Using canister:",t),V("get-approval","loading","Querying orchestrator...");const v=e[0];if(!((E=v.collection)!=null&&E.address))throw new Error("NFT missing collection address - cannot determine approval address");const U=v.collection.address,S=e.find(G=>{var P;return((P=G.collection)==null?void 0:P.address)!==U});if(S)throw new Error(`All NFTs must be from the same collection. Found NFT from different collection: ${S.name}`);console.log(`âœ… All ${e.length} NFTs are from collection: ${U}`);const H=Zi(v.mintAddress);console.log("[DEBUG] Approval address request params:",{collectionAddress:U,tokenId:H.toString(),targetCluster:r,targetNetwork:m,userPrincipal:(b=d.principal)==null?void 0:b.toText()});const he={remoteNFTPointer:{tokenId:H,contract:U,network:m},account:{owner:d.principal,subaccount:[]}};console.log("ðŸ”¥ðŸ”¥ðŸ”¥ CALLING get_remote_approval_address WITH:",{tokenId:H.toString(),contract:U,network:m,targetCluster:r,rawNetwork:JSON.stringify(m),userPrincipal:d.principal.toString()});const $=await N.get_remote_approval_address(he,[]);let W;if(Array.isArray($)&&$.length>0&&$[0])W=$[0],console.log("âœ… Approval address RECEIVED:",W),V("get-approval","success",`Approval address: ${W.slice(0,8)}...`);else throw new Error("Failed to get approval address from orchestrator");const le=new Ve(W);console.log("ðŸš€ Step 2: Transferring NFTs to bridge...");const ce=e.filter(G=>G.ownershipState!=="ready-to-mint"),L=e.filter(G=>G.ownershipState==="ready-to-mint");console.log(`  NFTs to transfer: ${ce.length}`),console.log(`  NFTs to resume (already transferred): ${L.length}`),V("transfer-nfts","loading",`Transferring ${ce.length} NFT(s)...`);const ue=[],re=[],se=[];for(let G=0;G<e.length;G++){const P=e[G];if(j(G),P.ownershipState==="ready-to-mint"){console.log(`â© Skipping transfer for NFT ${G+1}/${e.length} (already at approval address):`,P.name),T(P.mintAddress,{status:"minting",progress:"NFT already at approval address, ready to mint"}),se.push(P.mintAddress);continue}if(P.ownershipState==="already-minted"){console.log(`â© Skipping transfer for NFT ${G+1}/${e.length} (already minted on IC):`,P.name),T(P.mintAddress,{status:"completed",progress:"NFT already minted on IC"}),se.push(P.mintAddress);continue}T(P.mintAddress,{status:"transferring",progress:"Verifying current ownership..."});try{const z=new Ve(P.mintAddress);console.log(`ðŸ” Verifying ownership for NFT ${G+1}/${e.length}:`,P.name);const A=await Lr(z,i);let Z=await c.getAccountInfo(A,"confirmed"),de=!1;if(Z){const ke=Z.data.readBigUInt64LE(64);de=ke===BigInt(1),console.log(`  User wallet: ${de?"âœ… NFT present":"âŒ Empty (amount="+ke+")"}`)}else console.log("  User wallet: âŒ Account doesn't exist");let te=!1;const fe=await Lr(z,le),xe=await c.getAccountInfo(fe,"confirmed");if(xe){const ke=xe.data.readBigUInt64LE(64);te=ke===BigInt(1),console.log(`  Approval address: ${te?"âœ… NFT present":"âŒ Empty (amount="+ke+")"}`)}else console.log("  Approval address: âŒ Account doesn't exist");let oe=!1;if(t&&t!=="pending")try{const ke=Zi(P.mintAddress),{Actor:ve,HttpAgent:Te}=await Xe(async()=>{const{Actor:Ee,HttpAgent:De}=await Promise.resolve().then(()=>Bt);return{Actor:Ee,HttpAgent:De}},void 0),Ie=new Te({host:"https://icp0.io"}),Ue=({IDL:Ee})=>Ee.Service({icrc7_owner_of:Ee.Func([Ee.Vec(Ee.Nat)],[Ee.Vec(Ee.Opt(Ee.Record({owner:Ee.Principal,subaccount:Ee.Opt(Ee.Vec(Ee.Nat8))})))],["query"])}),Ge=await ve.createActor(Ue,{agent:Ie,canisterId:t}).icrc7_owner_of([ke]);if(Ge&&Ge.length>0&&Ge[0].length>0){oe=!0;const Ee=Ge[0][0];console.log(`  IC ckNFT: âœ… Already minted (owner: ${Ee.owner.toString()})`)}else console.log("  IC ckNFT: âŒ Not minted yet")}catch(ke){console.warn("  IC ckNFT: âš ï¸ Query failed (assuming not minted):",ke)}if(oe){console.log("â© NFT already minted on IC, skipping transfer and mint"),T(P.mintAddress,{status:"completed",progress:"NFT already minted on IC"}),se.push(P.mintAddress);continue}if(te&&!de){console.log("â© NFT already at approval address, skipping transfer (will mint)"),T(P.mintAddress,{status:"minting",progress:"NFT already at approval address, ready to mint"}),se.push(P.mintAddress);continue}if(!de&&!te){console.error("âŒ NFT not found in user wallet OR approval address!"),T(P.mintAddress,{status:"failed",progress:"NFT not in wallet or approval address - may have been transferred elsewhere",error:"NFT ownership cannot be verified"}),re.push(P.mintAddress);continue}console.log("âœ… NFT verified in user wallet, proceeding with transfer"),T(P.mintAddress,{progress:"Preparing transfer transaction..."}),console.log("  To token account:",fe.toString()),T(P.mintAddress,{progress:"Building transaction..."});const{blockhash:X,lastValidBlockHeight:ae}=await c.getLatestBlockhash("finalized"),je=new wc({blockhash:X,lastValidBlockHeight:ae,feePayer:i});xe||(console.log("  Creating destination token account..."),je.add($d(i,fe,le,z,ns,sn))),je.add(Vd(A,fe,i,1,[],ns)),T(P.mintAddress,{progress:"Awaiting wallet approval..."}),console.log("  Sending transaction to wallet for approval...");const Ae=await u(je);console.log("  âœ… Transaction signed! Signature:",Ae),T(P.mintAddress,{progress:"Confirming transaction..."}),console.log("  Polling for transaction confirmation...");let Fe=!1,Pe=0;const _e=60;for(;!Fe&&Pe<_e;){Pe++;try{const ke=await c.getSignatureStatus(Ae);if(((Y=ke==null?void 0:ke.value)==null?void 0:Y.confirmationStatus)==="finalized"||((p=ke==null?void 0:ke.value)==null?void 0:p.confirmationStatus)==="confirmed"){Fe=!0,console.log(`  âœ… Transaction confirmed after ${Pe} attempts (${ke.value.confirmationStatus})`);break}if((O=ke==null?void 0:ke.value)!=null&&O.err)throw new Error(`Transaction failed: ${JSON.stringify(ke.value.err)}`);if(await c.getBlockHeight()>ae)throw new Error("Transaction expired: block height exceeded");await new Promise(Te=>setTimeout(Te,2e3))}catch(ke){if(console.error(`  Polling attempt ${Pe} failed:`,ke),Pe>=_e)throw ke;await new Promise(ve=>setTimeout(ve,2e3))}}if(!Fe)throw new Error("Transaction confirmation timeout after 2 minutes");console.log(`âœ… NFT ${G+1} transferred successfully`),T(P.mintAddress,{status:"transferring",solanaSignature:Ae,progress:"Transfer confirmed"}),ue.push(Ae)}catch(z){console.error(`âŒ Failed to transfer NFT ${G+1}:`,z);let A="Unknown error",Z=[];if(z instanceof Error){if(A=z.message,"getLogs"in z&&typeof z.getLogs=="function")try{Z=await z.getLogs(c),console.error("  Transaction logs:",Z),A=`${A}

Logs:
${Z.join(`
`)}`}catch(de){console.error("  Failed to get logs:",de)}"logs"in z&&Array.isArray(z.logs)&&(Z=z.logs,console.error("  Transaction logs:",Z),Z.length>0&&(A=`${A}

Logs:
${Z.join(`
`)}`))}T(P.mintAddress,{status:"failed",error:`Transfer failed: ${A}`}),re.push(P.mintAddress)}}if(ue.length+se.length===0)throw new Error("All NFT transfers failed");se.length>0?V("transfer-nfts","success",`${ue.length} transferred, ${se.length} already at approval address`):V("transfer-nfts","success",`${ue.length}/${e.length} NFT(s) transferred`),console.log("ðŸ’° Step 3: Checking cycles allowance..."),V("mint-cknfts","loading","Checking cycles allowance...");try{const G=n*BigInt(120)/BigInt(100);console.log("ðŸ’° Cycles approval details:"),console.log(`  Base mint costs: ${n}`),console.log(`  Approval amount (120% buffer): ${G}`),console.log(`  NFTs to mint: ${e.length}`),console.log(`  Average per NFT: ${G/BigInt(e.length)}`);let P=!0;try{const z=qe.fromText(f),A={account:{owner:d.principal,subaccount:[]},spender:{owner:z,subaccount:[]}},{Actor:Z,HttpAgent:de}=await Xe(async()=>{const{Actor:ae,HttpAgent:je}=await Promise.resolve().then(()=>Bt);return{Actor:ae,HttpAgent:je}},void 0),te=new de({host:"https://icp0.io"}),fe=({IDL:ae})=>{const je=ae.Record({owner:ae.Principal,subaccount:ae.Opt(ae.Vec(ae.Nat8))}),Ae=ae.Record({allowance:ae.Nat,expires_at:ae.Opt(ae.Nat64)});return ae.Service({icrc2_allowance:ae.Func([ae.Record({account:je,spender:je})],[Ae],["query"])})},xe=Ow.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",X=await Z.createActor(fe,{agent:te,canisterId:xe}).icrc2_allowance(A);if(console.log("Current allowance result:",X),X!=null&&X.allowance)if(console.log("Found existing allowance:",X.allowance.toString()),console.log("Required amount:",G.toString()),X.allowance>=G){const ae=BigInt(Date.now()*1e6);X.expires_at.length>0&&X.expires_at[0]<ae?console.log("âš ï¸ Existing allowance is expired, will re-approve"):(P=!1,console.log("âœ… Sufficient allowance already exists, skipping approval"),V("mint-cknfts","loading","Using existing cycles allowance..."))}else console.log("âš ï¸ Existing allowance insufficient, will approve more")}catch(z){console.warn("Could not check current allowance, will approve to be safe:",z)}P&&(console.log("ðŸ’° Approving cycles for minting..."),V("mint-cknfts","loading","Approving cycles for minting..."),await g.cyclesApprove.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:G,expected_allowance:[],expires_at:[BigInt(Date.now()*1e6)+BigInt(1440*60*1e9)],spender:{owner:qe.fromText(f),subaccount:[]}}),console.log(`âœ… Cycles approved: ${G} cycles (with 20% buffer) for ${e.length} NFT(s)`))}catch(G){throw console.error("âŒ Failed to approve cycles:",G),new Error(`Failed to approve cycles for minting: ${G instanceof Error?G.message:"Unknown error"}`)}console.log("ðŸŽ¨ Step 4: Minting ckNFTs on Internet Computer..."),V("mint-cknfts","loading","Calling orchestrator mint...");const ge=[],ne=[];for(let G=0;G<e.length;G++){const P=e[G],z=Q.find(A=>A.mintAddress===P.mintAddress);if((z==null?void 0:z.status)==="completed"){console.log(`â­ï¸  Skipping mint (already minted on IC): ${P.name}`);continue}if((z==null?void 0:z.status)==="failed"){console.log(`â­ï¸  Skipping mint for failed transfer: ${P.name}`);continue}try{T(P.mintAddress,{status:"minting",progress:"Requesting mint..."}),console.log(`ðŸŽ¨ Minting ckNFT ${G+1}:`,P.name);const A=Zi(P.mintAddress),Z=((R=P.collection)==null?void 0:R.address)||P.mintAddress;console.log("  Token ID:",A.toString()),console.log("  Contract:",Z);const de={nft:{tokenId:A,contract:Z,network:m},resume:[],mintToAccount:{owner:d.principal,subaccount:[]},spender:[]};console.log("  Calling mint method..."),console.log(`  Using cycles from allowance (${n} total for ${e.length} NFTs)`);const te=d.principal?[{owner:d.principal,subaccount:[]}]:[];te.length>0?console.log("  User account for allowance check:",{owner:te[0].owner.toString(),subaccount:te[0].subaccount}):console.warn("  No user account - cycles approval check will fail!");const fe=await h.mint(de,te);if("Ok"in fe){const xe=fe.Ok;console.log("  âœ… Mint request submitted. ID:",xe.toString()),pf(P.mintAddress,xe),T(P.mintAddress,{progress:"Polling mint status..."});let oe=0;const X=60;let ae=!1,je=null;for(;oe<X&&!ae;){await new Promise(Fe=>setTimeout(Fe,2e3)),oe++;const Ae=await N.get_mint_status([xe]);if(Ae&&Ae.length>0){const Fe=Ae[0];if(Array.isArray(Fe)&&Fe.length>0){const Pe=Fe[0];if(console.log(`  ðŸ“Š Mint status poll ${oe}/${X}:`,Pe),!Pe)console.log("  â³ No status available yet, continuing to poll...");else if("Complete"in Pe){const _e=Pe.Complete;je=_e.mintTrx.toString(),console.log("âœ… Mint completed successfully!"),console.log("   IC Transaction ID:",je),_e.approvalTrx&&_e.approvalTrx.length>0&&_e.approvalTrx[0]&&console.log("   Approval Transaction ID:",_e.approvalTrx[0].toString()),T(P.mintAddress,{status:"completed",progress:"Minted successfully",icTransactionId:je}),je&&ge.push(je),ne.push(A.toString()),ae=!0}else if("Err"in Pe){const _e=Pe.Err;throw new Error(`Mint failed: ${j0(_e)}`)}else{let ke=`Status: ${Object.keys(Pe)[0]}`;if("CheckingOwner"in Pe){const ve=Pe.CheckingOwner;ke=`Checking ownership (query ${ve.nextQuery}, retry ${ve.retries})`}else if("RetrievingMetadata"in Pe){const ve=Pe.RetrievingMetadata;ke=`Retrieving metadata (query ${ve.nextQuery}, retry ${ve.retries})`}else"Transferring"in Pe?ke="Transferring ownership...":"Minting"in Pe&&(ke="Minting on IC...");console.log(`  â³ ${ke}`),T(P.mintAddress,{progress:ke})}}else console.log("  â³ Status not yet available, continuing to poll...")}else console.log("  â³ No status result, continuing to poll...")}if(!ae)throw new Error(`Mint timeout - status polling exceeded ${X} attempts (${X*2}s)`)}else{const xe="Err"in fe?j0(fe.Err):"Unknown error";throw new Error(`Mint failed: ${xe}`)}}catch(A){console.error(`âŒ Failed to mint ckNFT for ${P.name}:`,A);const Z=A instanceof Error?A.message:"Unknown error";T(P.mintAddress,{status:"failed",error:`Mint failed: ${Z}`})}}V("mint-cknfts","success",`${ne.length} ckNFT(s) minted`),console.log("ðŸŽ‰ Step 4: Bridge complete!"),V("complete","success","All operations complete");const ye={success:!0,totalNFTs:e.length,successfulTransfers:ue.length,failedTransfers:re.length,solanaSignatures:ue,icTransactionIds:ge,mintedTokenIds:ne,canisterAddress:t};K(ye),a&&a(ye)}catch(v){console.error("âŒ Bridge execution failed:",v),V(((q=_.find(U=>U.status==="loading"))==null?void 0:q.id)||"complete","failed",v instanceof Error?v.message:"Unknown error"),o&&v instanceof Error&&o(v)}finally{w(!1),j(null)}},J=E=>{switch(E){case"pending":return"â³";case"loading":return"ðŸ”„";case"success":return"âœ…";case"failed":return"âŒ"}},pe=E=>{switch(E){case"pending":return"â³";case"transferring":return"ðŸ“¤";case"minting":return"ðŸŽ¨";case"completed":return"âœ…";case"failed":return"âŒ"}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Bridge NFTs to Internet Computer"}),s.jsx("p",{className:"text-gray-600",children:"Transfer your Solana NFTs and mint them as ckNFTs on the Internet Computer"})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Bridge Progress"}),_.map((E,b)=>s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"text-2xl",children:J(E.status)}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("p",{className:`font-medium ${E.status==="success"?"text-green-700":E.status==="failed"?"text-red-700":E.status==="loading"?"text-blue-700":"text-gray-500"}`,children:[b+1,". ",E.title]})}),E.message&&s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:E.message})]})]},E.id))]}),Q.length>0&&s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[s.jsxs("h3",{className:"font-semibold text-gray-900 mb-4",children:["NFT Status (",Q.length,")"]}),s.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:Q.map((E,b)=>s.jsx("div",{className:`p-4 rounded-lg border-2 ${B===b?"border-blue-300 bg-blue-50":E.status==="completed"?"border-green-200 bg-green-50":E.status==="failed"?"border-red-200 bg-red-50":"border-gray-200 bg-gray-50"}`,children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"text-2xl",children:pe(E.status)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-gray-900 truncate",children:E.name}),s.jsx("p",{className:"text-xs text-gray-500 font-mono truncate",children:E.mintAddress}),E.progress&&s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:E.progress}),E.solanaSignature&&s.jsx("a",{href:`https://solscan.io/tx/${E.solanaSignature}?cluster=devnet`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline mt-1 block",children:"View Solana TX â†’"}),E.error&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:E.error})]})]})},E.mintAddress))})]}),k&&s.jsxs("div",{className:`p-6 rounded-lg border-2 ${k.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:k.success?"ðŸŽ‰ Bridge Complete!":"âš ï¸ Bridge Completed with Errors"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"Total NFTs"}),s.jsx("p",{className:"font-semibold text-gray-900",children:k.totalNFTs})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"Successful"}),s.jsx("p",{className:"font-semibold text-green-700",children:k.successfulTransfers})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"Failed"}),s.jsx("p",{className:"font-semibold text-red-700",children:k.failedTransfers})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"Minted ckNFTs"}),s.jsx("p",{className:"font-semibold text-green-700",children:k.mintedTokenIds.length})]})]}),k.canisterAddress&&s.jsxs("div",{className:"pt-4 border-t border-green-300",children:[s.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"ckNFT Canister"}),s.jsx("p",{className:"text-sm font-mono font-semibold text-green-800 break-all",children:k.canisterAddress}),s.jsx("a",{href:`https://dashboard.internetcomputer.org/canister/${k.canisterAddress}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline mt-1 inline-block",children:"View on IC Dashboard â†’"})]})]}),!C&&!k&&s.jsx("button",{onClick:ee,disabled:!i||!h||e.length===0,className:"w-full px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-medium",children:"Start Bridge Execution"}),C&&s.jsxs("div",{className:"text-center py-4",children:[s.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"Processing..."})]})]})}function Iw({selectedNFTs:e,mintCosts:t,setMintCosts:n,canisterAddress:r,onBack:a,onContinue:o}){const i=t?t*BigInt(120)/BigInt(100):void 0,{data:c,isLoading:l}=oa(i);return s.jsxs("div",{className:"space-y-6",children:[s.jsx(Dh,{networkSource:"solana",selectedSolanaNFTs:e,mintCosts:t,onMintCostsCalculated:n}),t&&i&&s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Cycles Approval Required"}),s.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Base mint cost:"})," ",t.toString()," cycles"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"With 20% buffer:"})," ",i.toString()," cycles"]}),c&&s.jsxs(s.Fragment,{children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Current allowance:"})," ",c.allowance.toString()," cycles"]}),s.jsx("p",{className:c.isSufficient?"text-green-700 font-semibold":"text-amber-700 font-semibold",children:c.isSufficient?"âœ… Sufficient allowance":"âŒ Insufficient - please approve in next step"})]})]}),s.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"ðŸ’¡ The approval will be requested automatically in Step 5 (Bridge Execution) if not already approved."})]}),s.jsxs("div",{className:"flex justify-between pt-6 border-t",children:[s.jsx("button",{onClick:a,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Back"}),s.jsx("button",{onClick:o,disabled:!r||!t||l,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Continue to bridge - approval will be handled in next step if needed",children:l?"Checking approval...":"Continue to Bridge Execution"})]}),(!r||!t)&&s.jsxs("p",{className:"text-sm text-amber-600 text-center",children:["âš ï¸ ",r?"Calculating mint costs...":"Please create or wait for canister to be detected"]})]})}function C0({onComplete:e,onCancel:t,mode:n="inline"}){var M;const{cluster:r}=os(),[a,o]=x.useState(1),[i,c]=x.useState(r),[l,u]=x.useState(null),[d,m]=x.useState([]),[f,g]=x.useState(null),[N,h]=x.useState(null),[C,w]=x.useState(null),[B,j]=x.useState(0);x.useEffect(()=>{c(r)},[r]),console.log("[SolanaImportWizard] State:",{currentStep:a,hasSelectedCollection:!!l,selectedCollectionAddress:l==null?void 0:l.collection.address,selectedCollectionNFTCount:(M=l==null?void 0:l.collection.nfts)==null?void 0:M.length});const Q=[{number:1,name:"Connect",description:"Connect your Solana wallet"},{number:2,name:"Select NFTs",description:"Choose collection and NFTs"},{number:3,name:"Create Canister",description:"Set up ckNFT canister"},{number:4,name:"Estimate Costs",description:"Check minting fees"},{number:5,name:"Bridge",description:"Execute the bridge transfer"},{number:6,name:"Complete",description:"View your bridged NFTs"}],F=()=>{t&&t()},_=n==="modal"?"bg-white rounded-lg":"bg-white shadow-xl rounded-lg";return s.jsxs("div",{className:_,children:[s.jsxs("div",{className:"px-8 py-6 border-b border-gray-200",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Import Solana NFTs"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Bridge your Solana NFTs to Internet Computer"})]}),t&&s.jsx("button",{onClick:F,className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"mt-6",children:s.jsx("div",{className:"flex items-center justify-between",children:Q.map((k,K)=>s.jsxs("div",{className:"flex items-center flex-1",children:[s.jsxs("div",{className:"flex flex-col items-center flex-1",children:[s.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-semibold transition-colors ${a===k.number?"bg-purple-600 text-white":a>k.number?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:a>k.number?s.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):k.number}),s.jsx("div",{className:"mt-2 text-center",children:s.jsx("p",{className:`text-xs font-medium ${a>=k.number?"text-gray-900":"text-gray-500"}`,children:k.name})})]}),K<Q.length-1&&s.jsx("div",{className:`h-1 flex-1 mx-2 ${a>k.number?"bg-green-500":"bg-gray-200"}`})]},k.number))})})]}),s.jsxs("div",{className:"px-8 py-6",children:[a===1&&s.jsxs("div",{className:"space-y-6",children:[s.jsx(Pd,{selectedTargetCluster:i,onTargetClusterChange:c}),s.jsxs("div",{className:"flex justify-between pt-6 border-t",children:[s.jsx("button",{onClick:F,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:()=>o(2),className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Continue to NFT Selection"})]})]}),a===2&&s.jsxs("div",{className:"space-y-6",children:[s.jsx(Aw,{selectedCollection:l,onCollectionChange:u,refreshTrigger:B}),l&&s.jsx("div",{className:"mt-8 pt-8 border-t border-gray-200",children:s.jsx(Tw,{selectedCollection:l,selectedNFTs:d,onSelectionChange:m,mode:"import"})}),s.jsxs("div",{className:"flex justify-between pt-6 border-t",children:[s.jsx("button",{onClick:()=>{o(1),j(k=>k+1)},className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Back"}),s.jsx("button",{onClick:()=>o(3),disabled:!l||d.length===0,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Continue to Canister Creation"})]})]}),a===3&&l&&s.jsxs("div",{className:"space-y-6",children:[s.jsx(Sw,{selectedCollection:l,costs:f,onCostsCalculated:g,onCanisterCreated:k=>{console.log("[SolanaImportWizard] Canister created/found:",k),w(k)}}),s.jsxs("div",{className:"flex justify-between pt-6 border-t",children:[s.jsx("button",{onClick:()=>o(2),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Back"}),s.jsx("button",{onClick:()=>o(4),className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Continue to Cost Estimation"})]})]}),a===4&&s.jsx(Iw,{selectedNFTs:d,mintCosts:N,setMintCosts:h,canisterAddress:C,onBack:()=>o(3),onContinue:()=>o(5)}),a===5&&C&&N&&s.jsxs("div",{className:"space-y-6",children:[s.jsx(_w,{selectedNFTs:d,canisterAddress:C,mintCosts:N,targetCluster:i,onComplete:k=>{console.log("Bridge complete:",k),k.canisterAddress&&w(k.canisterAddress),j(K=>K+1),o(6),e&&e({success:k.success,solanaTransactionHash:k.solanaSignatures[0],canisterAddress:k.canisterAddress})},onError:k=>{console.error("Bridge error:",k),e&&e({success:!1,error:k.message})}}),s.jsx("div",{className:"flex justify-between pt-6 border-t",children:s.jsx("button",{onClick:()=>o(4),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Back"})})]}),a===6&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"p-8 bg-green-50 border-2 border-green-200 rounded-lg text-center",children:[s.jsx("div",{className:"text-4xl mb-4",children:"ðŸŽ‰"}),s.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-2",children:"Bridge Complete!"}),s.jsx("p",{className:"text-green-700",children:"Your Solana NFTs have been successfully bridged to the Internet Computer"}),s.jsxs("div",{className:"mt-4 space-y-1 text-sm text-green-600",children:[s.jsxs("p",{children:[d.length," NFT",d.length!==1?"s":""," bridged"]}),C&&s.jsxs("p",{children:["Canister: ",C]})]})]}),s.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("strong",{children:"â„¹ï¸ Note:"})," Your NFT list has been automatically refreshed. The bridged NFTs are no longer in your Solana wallet and won't appear when you start a new bridge."]})}),s.jsxs("div",{className:"flex justify-between pt-6 border-t",children:[s.jsx("button",{onClick:()=>{o(1),u(null),m([]),g(null),h(null),w(null),j(k=>k+1)},className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Start New Bridge"}),s.jsx("button",{onClick:()=>{e&&e({success:!0,canisterAddress:C||void 0})},className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Done"})]})]})]})]})}function Uw({selectedNetwork:e,onNetworkChange:t}){const{wallet:n,connected:r,publicKey:a,connect:o,disconnect:i}=os(),[c,l]=x.useState(!1),u=[{id:"mainnet-beta",name:"mainnet-beta",displayName:"Mainnet Beta",endpoint:"https://api.mainnet-beta.solana.com",icon:"â—Ž",explorer:"https://explorer.solana.com",description:"Solana production network with real SOL"},{id:"devnet",name:"devnet",displayName:"Devnet",endpoint:"https://api.devnet.solana.com",icon:"â—Ž",explorer:"https://explorer.solana.com/?cluster=devnet",description:"Solana test network for development"},{id:"testnet",name:"testnet",displayName:"Testnet",endpoint:"https://api.testnet.solana.com",icon:"â—Ž",explorer:"https://explorer.solana.com/?cluster=testnet",description:"Solana test network for testing"},{id:"localnet",name:"localnet",displayName:"Localnet",endpoint:"http://127.0.0.1:8899",icon:"âš¡",explorer:"http://localhost:8899",description:"Local Solana validator for development"}],d=async()=>{if(!n){console.error("No wallet available");return}l(!0);try{await o()}catch(N){console.error("Failed to connect wallet:",N)}finally{l(!1)}},m=async()=>{await i()},f=N=>{t(N.name,N.endpoint)},g=u.find(N=>N.name===e);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Connect Your Solana Wallet"}),s.jsx("p",{className:"text-gray-600",children:"Connect your Phantom or compatible wallet, then select your target network."})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Step 1: Connect Wallet"}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Connect your Phantom, Solflare, or other Solana wallet to continue."})]}),r?s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-green-800",children:"âœ… Wallet Connected"}),s.jsxs("p",{className:"text-sm text-green-600 font-mono",children:[a==null?void 0:a.toBase58().slice(0,8),"...",a==null?void 0:a.toBase58().slice(-8)]}),n&&s.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Using: ",n.adapter.name]})]})]}),s.jsx("button",{onClick:m,className:"text-sm text-green-700 hover:text-green-900 underline",children:"Disconnect"})]})}):s.jsx("div",{className:"flex flex-col items-center space-y-4",children:s.jsxs("div",{className:"p-6 border-2 border-dashed border-gray-300 rounded-lg text-center",children:[s.jsx("div",{className:"text-4xl mb-2",children:"ðŸ‘»"}),s.jsx("p",{className:"text-gray-600 mb-2",children:"No Solana wallet connected"}),!n&&s.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Please install a Solana wallet extension like Phantom"}),s.jsx("button",{onClick:d,disabled:!n||c,className:"px-6 py-3 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Connecting...":"Connect Wallet"}),!n&&s.jsx("div",{className:"mt-4",children:s.jsxs("a",{href:"https://phantom.app/",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-cyan-600 hover:text-cyan-700 flex items-center justify-center",children:["Get Phantom Wallet",s.jsx(Ds,{className:"w-3 h-3 ml-1"})]})})]})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Step 2: Select Target Network"}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Choose the Solana network where you want to export your NFTs."})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:u.map(N=>s.jsxs("button",{onClick:()=>f(N),className:be("p-4 border-2 rounded-lg text-left transition-all hover:shadow-md",e===N.name?"border-cyan-500 bg-cyan-50":"border-gray-200 hover:border-gray-300"),children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx("span",{className:"text-2xl mr-3",children:N.icon}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900",children:N.displayName}),s.jsxs("p",{className:"text-xs text-gray-500",children:[N.endpoint.slice(0,30),"..."]})]})]}),s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:N.description}),s.jsx("div",{className:"flex items-center text-sm",children:s.jsxs("a",{href:N.explorer,target:"_blank",rel:"noopener noreferrer",onClick:h=>h.stopPropagation(),className:"text-cyan-600 hover:text-cyan-700 flex items-center",children:["View Explorer",s.jsx(Ds,{className:"w-3 h-3 ml-1"})]})}),e===N.name&&s.jsxs("div",{className:"mt-3 flex items-center text-sm text-cyan-700",children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Selected"]})]},N.id))})]}),g&&s.jsxs("div",{className:"p-4 bg-cyan-50 border border-cyan-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-cyan-800 mb-2",children:"Target Network Configuration"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-cyan-600",children:"Network:"}),s.jsx("span",{className:"font-medium text-cyan-800",children:g.displayName})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-cyan-600",children:"Endpoint:"}),s.jsx("span",{className:"font-mono text-xs text-cyan-800",children:g.endpoint})]}),g.id==="mainnet-beta"&&s.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded",children:s.jsx("p",{className:"text-xs text-yellow-700",children:"âš ï¸ Mainnet deployment will use real SOL. Make sure you have sufficient balance."})}),g.id==="localnet"&&s.jsx("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded",children:s.jsxs("p",{className:"text-xs text-blue-700",children:["ðŸ’¡ Make sure your local Solana validator is running at ",g.endpoint]})})]})]}),s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ðŸ“š About Solana Networks"}),s.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"Mainnet Beta:"})," Production network with real value. Use for live NFT exports."]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"Devnet:"})," Test network for development. Get free SOL from faucets."]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"Testnet:"})," Stress testing network. May experience instability."]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"Localnet:"})," Local validator running on your machine. Requires setup."]})]}),s.jsxs("div",{className:"mt-4 p-3 bg-white rounded border border-gray-200",children:[s.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-2",children:"Need test SOL?"}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("a",{href:"https://faucet.solana.com/",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-cyan-600 hover:text-cyan-700 flex items-center",children:["Solana Devnet Faucet",s.jsx(Ds,{className:"w-3 h-3 ml-1"})]}),s.jsxs("a",{href:"https://solfaucet.com/",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-cyan-600 hover:text-cyan-700 flex items-center",children:["Community Faucet",s.jsx(Ds,{className:"w-3 h-3 ml-1"})]})]})]})]})]})}var $w={};const k0=[{name:"None",description:"No priority fee (may be slower during congestion)",computeUnitPrice:0,computeUnitLimit:2e5},{name:"Low",description:"Minimal priority (~0.0002 SOL)",computeUnitPrice:1e3,computeUnitLimit:2e5},{name:"Medium",description:"Standard priority (~0.003 SOL)",computeUnitPrice:1e4,computeUnitLimit:3e5},{name:"High",description:"Fast priority (~0.015 SOL)",computeUnitPrice:5e4,computeUnitLimit:3e5}];function Vw({selectedNFTs:e,targetNetwork:t,sourceContractPointer:n,onCostsCalculated:r,onDeploymentComplete:a,onReadyStateChange:o}){var P;const[i,c]=x.useState(!1),[l,u]=x.useState(null),[d,m]=x.useState(null),[f,g]=x.useState(null),[N,h]=x.useState(!1),[C,w]=x.useState(!1),[B,j]=x.useState(null),[Q,F]=x.useState(null),[_,M]=x.useState(null),[k,K]=x.useState(null),[V,T]=x.useState(!1),[ee,J]=x.useState(!1),[pe,E]=x.useState(null),[b,Y]=x.useState(null),[p,O]=x.useState(k0[0]),R=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),{user:q}=ut(),{publicKey:v,sendTransaction:U}=os(),[S,H]=x.useState(!1),he=$w.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",$=js(he),W=q!=null&&q.principal?{owner:typeof q.principal=="string"?qe.fromText(q.principal):q.principal,subaccount:[]}:void 0,le=$.useBalance(W),ce=e.length>0?(P=e[0])==null?void 0:P.canisterId:void 0,L=ce&&W?{account:W,spender:{owner:qe.fromText(ce),subaccount:[]}}:void 0,ue=$.useAllowance(L);x.useEffect(()=>{le.data!==void 0&&j(le.data)},[le.data]),x.useEffect(()=>{var z,A,Z,de,te;if(console.log("ðŸ” Solana Export - ckNFT allowance status update:",{hasAllowanceData:!!ue.data,allowanceAmount:(A=(z=ue.data)==null?void 0:z.allowance)==null?void 0:A.toString(),isExpired:(Z=ue.data)==null?void 0:Z.expires_at,costBreakdownCasting:(de=d==null?void 0:d.nftMinting)==null?void 0:de.toString()}),ue.data&&(d!=null&&d.nftMinting)){const fe=BigInt(Date.now()*1e6),xe=(te=ue.data.expires_at)==null?void 0:te[0],oe=xe!==void 0&&xe<fe,X=d.nftMinting*BigInt(120)/BigInt(100),ae={amount:ue.data.allowance,isExpired:oe,isSufficient:ue.data.allowance>=X&&!oe};console.log("ðŸ” Setting ckNFT allowance status:",ae),Y(ae),h(ae.isSufficient)}},[ue.data,d==null?void 0:d.nftMinting]),x.useEffect(()=>{const z=Q&&_&&parseFloat(Q)>=parseFloat(_)+ge(p),A=N&&z;console.log("ðŸ” Ready state check:",{paymentApproved:N,solBalance:Q,estimatedRentSOL:_,priorityFeeSOL:ge(p),hasSufficientSOL:z,isReady:A}),o&&o(!!A)},[N,Q,_,p,o]);const re=x.useMemo(()=>t?t.name:"Unknown",[t]),se=z=>{switch(z.toLowerCase()){case"mainnet-beta":case"mainnet":return{Mainnet:null};case"devnet":return{Devnet:null};case"testnet":return{Testnet:null};case"localnet":case"localhost":return{Custom:"http://127.0.0.1:8899"};default:return{Custom:z}}};x.useEffect(()=>{(async()=>{var A;if(!e.length||!t||!n){m(null),r(0n);return}c(!0),u(null);try{console.log("ðŸ” Calculating Solana export costs for:",{nftCount:e.length,network:re,collectionDeployed:t.deployed,sourceContract:n});let Z,de=0n;if(!t.deployed){console.log("ðŸ“Š Getting Solana collection deployment cost...");const ae={Solana:[se(t.name)]},je=await R.getRemoteCost.mutateAsync({pointer:n,network:ae});if(je==null)throw new Error("Failed to get deployment cost from orchestrator");Z=BigInt(je),console.log("ðŸ’° Collection deployment cost:",Z.toString())}try{console.log("ðŸ“Š Getting Solana NFT minting costs...");const ae=(await R.getCkNFTCanister.mutateAsync([n]))[0];if(ae){console.log(`ðŸ” Using ckNFT canister ${ae.toString()} for cast cost calculations`);try{console.log("ðŸ”‘ Getting Solana funding address from orchestrator...");const Ie={Solana:[se(t.name)]},Ue=await R.getICRC99Address.mutateAsync({canister:ae,network:Ie});if(Ue){const He=Ue;console.log("ðŸ”‘ Solana funding address:",He),K(He);try{const Ge=new ws(t.endpoint,"confirmed"),Ee=new Ve(He),ft=(await Ge.getBalance(Ee)/In).toFixed(4);console.log(`ðŸ’° Current SOL balance at funding address: ${ft} SOL`),F(ft)}catch(Ge){console.error("Failed to fetch SOL balance:",Ge),F("0.0000")}}else console.warn("No funding address returned from orchestrator"),K(null)}catch(Te){console.error("Failed to get funding address:",Te),K(null)}console.log("ðŸ“Š Calling icrc99_cast_cost for accurate Solana NFT minting costs...");const{createActor:je}=await Xe(async()=>{const{createActor:Te}=await import("./index-BykKOlZ5.js");return{createActor:Te}},__vite__mapDeps([0,1,2,3,4])),Ae=je(ae.toString()),_e={network:{Solana:[se(t.name)]},contract:t.collectionAddress||"",tokenId:BigInt(0)};console.log("ðŸ“Š Cast cost request:",_e);const ke=await Ae.icrc99_cast_cost(_e);if(console.log("ðŸ’° icrc99_cast_cost result:",ke),ke==null)throw new Error("No cost returned from icrc99_cast_cost - this should never happen");const ve=typeof ke=="bigint"?ke:BigInt(ke);de=ve*BigInt(e.length),console.log(`ðŸ’° Cast cost: ${ve.toString()} cycles per NFT Ã— ${e.length} NFTs = ${de.toString()} total`)}else throw new Error("No ckNFT canister ID available - cannot calculate cast costs")}catch(X){throw console.error("âŒ Failed to get cast costs:",X),new Error(`Failed to calculate NFT casting costs: ${X instanceof Error?X.message:String(X)}`)}let te="0.000",fe=null;try{console.log("ðŸ” Getting Solana funding address for export operations..."),console.log("ðŸ” Source contract:",n.contract),console.log("ðŸ” Target network:",re),console.log("ðŸ” NFT TokenId:",e[0]);const ae={Solana:[se(t.name)]};let je;try{je=qe.fromText(n.contract)}catch{throw console.error("Failed to parse canister principal:",n.contract),new Error("Invalid canister principal")}console.log("ðŸ” Checking if NFT needs re-export funding (icrc99_cast_fund_address)...");const Ae=await R.getCastFundAddress.mutateAsync({ckNFTCanisterId:je,tokenId:BigInt(e[0].tokenId)});if(Ae?(T(!0),fe=Ae.address,console.log("âœ… Re-export detected - NFT at approval address:",fe),console.log("ðŸ” This address needs SOL to transfer the NFT")):(T(!1),console.log("ðŸ” Fresh export - getting canister ICRC99 address..."),fe=await R.getICRC99Address.mutateAsync({canister:je,network:ae}),console.log("âœ… Got canister ICRC99 address (payer):",fe)),fe){K(fe),console.log("âœ… Got Solana ICRC99 address (payer):",fe);try{const Fe=new ws(t.endpoint,"confirmed");let Pe=0;if(!t.deployed){const De=await Fe.getMinimumBalanceForRentExemption(82),ft=await Fe.getMinimumBalanceForRentExemption(165),vt=await Fe.getMinimumBalanceForRentExemption(800),Le=await Fe.getMinimumBalanceForRentExemption(282);Pe+=De+ft+vt+Le,console.log("ðŸ’° Collection rent breakdown:",{mintRent:De,ataRent:ft,metadataRent:vt,masterRent:Le,total:De+ft+vt+Le})}const _e=await Fe.getMinimumBalanceForRentExemption(82),ke=await Fe.getMinimumBalanceForRentExemption(165),ve=await Fe.getMinimumBalanceForRentExemption(800),Te=await Fe.getMinimumBalanceForRentExemption(282),Ie=_e+ke+ve+Te;Pe+=Ie*e.length;const Ue=(t.deployed?0:6)+e.length*6;Pe+=Ue*5e3,Pe+=e.length*2e6,Pe=Math.ceil(Pe*1.5),te=(Pe/In).toFixed(6),M(te),console.log("ðŸ’° Solana rent calculation:",{totalRentLamports:Pe,solanaRentFees:te,nftCount:e.length,collectionDeployed:t.deployed}),console.log("ðŸ” Checking SOL balance at funding address:",fe);const He=new Ve(fe);console.log("ðŸ” Created PublicKey:",He.toBase58());const Ge=await Fe.getBalance(He);console.log("ðŸ” Balance in lamports:",Ge);const Ee=(Ge/In).toFixed(6);F(Ee),console.log("âœ… SOL balance check complete:",{address:fe,balanceLamports:Ge,balanceSOL:Ee,requiredSOL:te,hasSufficient:parseFloat(Ee)>=parseFloat(te)})}catch(Fe){console.warn("Failed to get Solana rent estimates:",Fe),te=(t.deployed?.01*e.length:.05+.01*e.length).toFixed(6),M(te)}}else console.warn("ðŸ’° No funding address returned from orchestrator"),K(null)}catch(X){throw console.error("âŒ Failed to get Solana funding address:",X),new Error(`Failed to get funding address and calculate SOL rent: ${X instanceof Error?X.message:String(X)}`)}const xe=(Z||0n)+de,oe={collectionDeployment:Z,nftMinting:de,solanaRentFees:te,total:xe};console.log("ðŸ’° Final Solana cost breakdown:",{collectionDeployment:(A=oe.collectionDeployment)==null?void 0:A.toString(),nftMinting:oe.nftMinting.toString(),solanaRentFees:oe.solanaRentFees,total:oe.total.toString()}),m(oe),r(xe)}catch(Z){console.error("Error calculating Solana export costs:",Z),u(Z instanceof Error?Z.message:"Failed to calculate export costs"),m(null),r(0n)}finally{c(!1)}})()},[e,t,n,re]),x.useEffect(()=>{(async()=>{if(!(!t||f))try{console.log("â›½ Fetching Solana fee data for:",t.name);const A=new ws(t.endpoint,"confirmed"),Z=await A.getLatestBlockhash(),te=(await A.getFeeForMessage(new(await Xe(async()=>{const{TransactionMessage:fe}=await import("./index-CstboGu2.js").then(xe=>xe.b4);return{TransactionMessage:fe}},__vite__mapDeps([1,2]))).TransactionMessage({payerKey:new Ve("11111111111111111111111111111111"),recentBlockhash:Z.blockhash,instructions:[]}).compileToV0Message())).value||5e3;g({network:t.name,lamportsPerSignature:te,solPrice:"$0.03",estimatedConfirmationTime:t.name==="mainnet-beta"?"10-20 seconds":"1-5 seconds"}),console.log("â›½ Solana fees fetched:",{lamportsPerSignature:te,network:t.name})}catch(A){console.error("Error fetching Solana fees:",A),g({network:t.name,lamportsPerSignature:5e3,solPrice:"$0.03",estimatedConfirmationTime:"10-20 seconds"})}})()},[t,f]);const Ne=z=>{const Z=BigInt(1e12),de=z/Z,fe=(z%Z).toString().padStart(12,"0").slice(0,3);return`${de.toLocaleString()}.${fe} TC`},ge=z=>z.computeUnitLimit*z.computeUnitPrice/1e6/In,ne=async()=>{var z,A;if(!(!d||!(q!=null&&q.principal))){w(!0),c(!0),u(null);try{console.log("ðŸ”„ Approving cycles payment for Solana export...",{totalCost:d.total.toString(),deploymentCost:((z=d.collectionDeployment)==null?void 0:z.toString())||"0",castingCost:d.nftMinting.toString(),userBalance:(B==null?void 0:B.toString())||"unknown",needsDeployment:!!d.collectionDeployment});const Z=d.total*BigInt(120)/BigInt(100);if(B!==null&&B<Z)throw new Error(`Insufficient cycles balance. You have ${Ne(B)} but need ${Ne(Z)} (including 120% buffer).`);const de=BigInt(1440*60*1e9),te=BigInt(Date.now()*1e6)+de;if(d.collectionDeployment&&d.collectionDeployment>0n){const oe=d.collectionDeployment*BigInt(120)/BigInt(100);console.log("ðŸ“ Submitting cycles approval to ORCHESTRATOR for collection deployment...",{approvalAmount:oe.toString(),originalAmount:d.collectionDeployment.toString(),expiryTime:te.toString(),spender:"jio3a-xaaaa-aaaal-ab66q-cai"}),await R.cyclesApprove.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:oe,expected_allowance:[],expires_at:[te],spender:{owner:qe.fromText("jio3a-xaaaa-aaaal-ab66q-cai"),subaccount:[]}}),console.log("âœ… Orchestrator approval complete for deployment")}const fe=(A=e[0])==null?void 0:A.canisterId;if(!fe)throw new Error("No ckNFT canister ID available for approval");const xe=d.nftMinting*BigInt(120)/BigInt(100);console.log("ðŸ“ Submitting cycles approval to ckNFT CANISTER for NFT casting...",{approvalAmount:xe.toString(),originalAmount:d.nftMinting.toString(),expiryTime:te.toString(),spender:fe}),await R.cyclesApprove.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:xe,expected_allowance:[],expires_at:[te],spender:{owner:qe.fromText(fe),subaccount:[]}}),console.log("âœ… Cycles approval successful!"),await ue.refetch(),await le.refetch(),h(!0)}catch(Z){console.error("âŒ Error approving cycles payment:",Z),u(Z instanceof Error?Z.message:"Failed to approve cycles payment"),h(!1)}finally{w(!1),c(!1)}}},ye=async()=>{if(!(!k||!t||!v||!U||!_)){H(!0),u(null);try{console.log("ðŸ’¸ Transferring SOL to funding address...",{from:v.toBase58(),to:k,amount:_});const z=new ws(t.endpoint,"confirmed"),A=Math.ceil(parseFloat(_)*In*1.05),Z=new wc().add(ad.transfer({fromPubkey:v,toPubkey:new Ve(k),lamports:A})),{blockhash:de}=await z.getLatestBlockhash();Z.recentBlockhash=de,Z.feePayer=v,console.log("ðŸ“¤ Sending transaction...");const te=await U(Z,{skipPreflight:!1,preflightCommitment:"confirmed"});console.log("â³ Confirming transaction...",te),await z.confirmTransaction(te,"confirmed"),console.log("âœ… SOL transfer successful!",te);const xe=(await z.getBalance(new Ve(k))/In).toFixed(6);F(xe),alert(`Successfully transferred ${(A/In).toFixed(6)} SOL!
Transaction: ${te}`)}catch(z){console.error("âŒ Error transferring SOL:",z),u(z instanceof Error?z.message:"Failed to transfer SOL")}finally{H(!1)}}},G=async()=>{if(!(!n||!t||!(q!=null&&q.principal))){J(!0),u(null);try{console.log("ðŸš€ Deploying collection to Solana...",{sourceContract:n.contract,targetNetwork:re});const A={Solana:[se(re)]},Z=await R.createRemoteContract.mutateAsync({pointer:n,network:A,gasPrice:BigInt(p.computeUnitPrice),gasLimit:BigInt(p.computeUnitLimit),maxPriorityFeePerGas:0n,spender:{owner:q.principal,subaccount:[]}});if(!("Ok"in Z))throw new Error("Failed to initiate deployment: "+JSON.stringify(Z));const de=Z.Ok;console.log("âœ… Collection deployment initiated with remoteId:",de),console.log("â³ Polling for deployment completion...");const te=60;let fe=0,xe=!1;for(;fe<te&&!xe;){fe++,console.log(`ðŸ” Checking deployment status (attempt ${fe}/${te})...`),await new Promise(X=>setTimeout(X,5e3));const oe=await R.getRemoteStatus.mutateAsync([de]);if(oe&&oe.length>0&&oe[0]){const X=oe[0];console.log("ðŸ“Š Deployment status:",{confirmed:X.confirmed,address:X.address,txHash:X.deploymentTrx}),X.confirmed&&X.address?(console.log("âœ… Collection deployed successfully!"),E({address:X.address,txHash:X.deploymentTrx}),xe=!0,a&&a(X.address)):console.log("â³ Deployment still pending...")}else console.log("âš ï¸ No status found for remoteId:",de)}if(!xe)throw new Error("Deployment timed out after 5 minutes. Please check the orchestrator logs.")}catch(z){console.error("âŒ Error deploying collection:",z),u(z instanceof Error?z.message:"Failed to deploy collection")}finally{J(!1)}}};return i&&!d?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Qe,{className:"w-8 h-8 text-cyan-600 animate-spin mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Calculating Solana Export Costs"}),s.jsxs("p",{className:"text-gray-600",children:["Estimating costs for ",e.length," NFT",e.length!==1?"s":"",t!=null&&t.deployed?"":" and collection deployment","..."]})]}):l?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(lt,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Calculating Costs"}),s.jsx("p",{className:"text-gray-600 mb-4",children:l}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-600 text-white rounded-md hover:bg-cyan-700 transition-colors",children:"Retry"})]}):d?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Solana Export Costs"}),s.jsxs("p",{className:"text-gray-600",children:["Review the costs for exporting your ",e.length," NFT",e.length!==1?"s":""," to ",re,"."]})]}),s.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-cyan-800 mb-3",children:"Export Summary"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-cyan-600",children:"NFTs:"}),s.jsxs("span",{className:"ml-2 font-medium text-cyan-800",children:[e.length," token",e.length!==1?"s":""]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-cyan-600",children:"Target Network:"}),s.jsx("span",{className:"ml-2 font-medium text-cyan-800",children:re})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-cyan-600",children:"Collection:"}),s.jsx("span",{className:"ml-2 font-medium text-cyan-800",children:t!=null&&t.deployed?"Existing":"New Deployment"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-cyan-600",children:"Operation:"}),s.jsx("span",{className:"ml-2 font-medium text-cyan-800",children:"Cast to Solana"})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Cost Breakdown"}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg divide-y divide-gray-200",children:[s.jsxs("div",{className:"p-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(ld,{className:"w-5 h-5 text-cyan-600 mr-3"}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"NFT Minting"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Mint ",e.length," NFT",e.length!==1?"s":""," on ",re]})]})]}),s.jsx("span",{className:"font-medium text-gray-900",children:Ne(d.nftMinting)})]}),d.collectionDeployment&&s.jsxs("div",{className:"p-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(_0,{className:"w-5 h-5 text-green-600 mr-3"}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Collection Deployment"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Deploy new Metaplex collection on ",re]})]})]}),s.jsx("span",{className:"font-medium text-gray-900",children:Ne(d.collectionDeployment)})]}),s.jsxs("div",{className:"p-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(O0,{className:"w-5 h-5 text-purple-600 mr-3"}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Solana Rent & Priority Fees"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Mint + ATA + Metadata + Master Edition accounts (10% safety margin)"}),Q&&_&&s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Balance: ",parseFloat(Q).toFixed(4)," SOL",k&&s.jsxs("span",{className:"text-gray-400 ml-1",children:["(",k.slice(0,6),"...",k.slice(-4),")"]}),parseFloat(Q)<parseFloat(_)+ge(p)&&s.jsx("span",{className:"text-red-600 ml-1",children:"âš ï¸ Insufficient"})]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("span",{className:"font-medium text-gray-900",children:[(parseFloat(d.solanaRentFees)+ge(p)).toFixed(6)," SOL"]}),s.jsxs("div",{className:"text-xs text-gray-500 space-y-0.5",children:[s.jsxs("div",{children:["Rent: ",d.solanaRentFees," SOL"]}),s.jsxs("div",{children:["Priority: ",ge(p).toFixed(6)," SOL"]})]})]})]})]})]}),f&&s.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Current Solana Fees"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-purple-600",children:"Network:"}),s.jsx("span",{className:"ml-2 font-medium text-purple-800",children:f.network})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-purple-600",children:"Fee per Signature:"}),s.jsxs("span",{className:"ml-2 font-medium text-purple-800",children:[f.lamportsPerSignature," lamports"]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-purple-600",children:"SOL Price:"}),s.jsx("span",{className:"ml-2 font-medium text-purple-800",children:f.solPrice})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-purple-600",children:"Confirmation:"}),s.jsx("span",{className:"ml-2 font-medium text-purple-800",children:f.estimatedConfirmationTime})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Priority Fee"}),s.jsx("span",{className:"text-sm text-gray-600",children:"Optional: speed up transaction confirmation"})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:k0.map(z=>{const A=ge(z),Z=p.name===z.name;return s.jsxs("button",{onClick:()=>O(z),className:be("p-3 rounded-lg border-2 transition-all text-left",Z?"border-cyan-500 bg-cyan-50":"border-gray-200 hover:border-gray-300 bg-white"),children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:be("font-medium",Z?"text-cyan-800":"text-gray-900"),children:z.name}),Z&&s.jsx(gt,{className:"w-5 h-5 text-cyan-600"})]}),s.jsx("p",{className:"text-xs text-gray-600 mb-2",children:z.description}),s.jsxs("div",{className:"text-xs space-y-1",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500",children:"Fee:"}),s.jsxs("span",{className:be("font-medium",Z?"text-cyan-700":"text-gray-700"),children:[A.toFixed(6)," SOL"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500",children:"Compute Units:"}),s.jsxs("span",{className:be("font-medium",Z?"text-cyan-700":"text-gray-700"),children:[(z.computeUnitLimit/1e3).toFixed(0),"K"]})]})]})]},z.name)})}),s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Selected Priority Fee:"}),s.jsx("span",{className:"ml-2 font-medium text-gray-900",children:p.name})]}),s.jsxs("span",{className:"font-medium text-gray-900",children:[ge(p).toFixed(6)," SOL"]})]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This fee is added per transaction to prioritize your operations during network congestion."})]})]})]}),s.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-cyan-800 mb-3",children:V?"Approval Address (NFT Holder)":"Canister's Solana Address (Transaction Payer)"}),s.jsx("p",{className:"text-xs text-gray-600 mb-3",children:V?"This NFT was previously burned back to IC and is held at an approval address. Fund this address with SOL to transfer the NFT.":"This is the canister's ICRC99 signing address that will pay for Solana transactions. Fund this address with SOL to enable collection deployment and NFT minting."}),s.jsx("div",{className:"bg-white border border-cyan-200 rounded-lg p-3",children:k?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"font-medium text-gray-900",children:"Address Balance"}),Q!==null?s.jsxs("span",{className:`text-sm font-medium ${_&&parseFloat(Q)>=parseFloat(_)?"text-green-600":"text-red-600"}`,children:[parseFloat(Q).toFixed(6)," SOL"]}):s.jsx("span",{className:"text-sm text-gray-500",children:"Loading..."})]}),s.jsx("p",{className:"text-xs text-gray-600 font-mono break-all mb-2",children:k}),Q!==null&&_&&s.jsxs("div",{className:"mt-2",children:[s.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[s.jsx("span",{children:"Required for rent:"}),s.jsxs("span",{children:[parseFloat(_).toFixed(6)," SOL"]})]}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[s.jsx("span",{children:"Priority fee:"}),s.jsxs("span",{children:[ge(p).toFixed(6)," SOL"]})]}),s.jsxs("div",{className:"flex justify-between text-xs font-medium text-gray-900 mb-2",children:[s.jsx("span",{children:"Total required:"}),s.jsxs("span",{children:[(parseFloat(_)+ge(p)).toFixed(6)," SOL"]})]}),parseFloat(Q)<parseFloat(_)+ge(p)?s.jsxs("div",{className:"p-2 bg-red-50 border border-red-200 rounded",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(lt,{className:"w-4 h-4 text-red-500 mr-2"}),s.jsx("span",{className:"text-sm text-red-700 font-medium",children:"Insufficient SOL balance"})]}),s.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Need ",(parseFloat(_)+ge(p)-parseFloat(Q)).toFixed(6)," more SOL"]})]}):s.jsxs("div",{className:"p-2 bg-green-50 border border-green-200 rounded",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-4 h-4 text-green-500 mr-2"}),s.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Sufficient SOL balance"})]}),s.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Ready for rent + priority fee payment"})]})]}),s.jsxs("div",{className:"mt-3 space-y-2",children:[v?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:ye,disabled:S||!_||parseFloat(Q||"0")>=parseFloat(_)+ge(p),className:be("w-full px-4 py-2 rounded-md transition-colors text-sm font-medium",S||!_||parseFloat(Q||"0")>=parseFloat(_)+ge(p)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-cyan-600 text-white hover:bg-cyan-700"),children:S?s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Transferring SOL..."]}):parseFloat(Q||"0")>=parseFloat(_||"0")+ge(p)?"âœ“ Funded":`Transfer ${(parseFloat(_||"0")+ge(p)).toFixed(4)} SOL from Wallet`}),s.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["Connected: ",v.toBase58().slice(0,4),"...",v.toBase58().slice(-4)]})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(k),alert("Address copied to clipboard!")},className:"w-full px-4 py-2 bg-cyan-600 text-white rounded-md hover:bg-cyan-700 transition-colors text-sm font-medium",children:"Copy Address to Fund"}),s.jsx("p",{className:"text-xs text-yellow-600 text-center",children:"âš ï¸ Connect Solana wallet to transfer directly"})]}),(t==null?void 0:t.name)==="localnet"&&s.jsxs("div",{className:"p-2 bg-blue-50 border border-blue-200 rounded",children:[s.jsx("p",{className:"text-xs text-blue-700 font-medium mb-1",children:"Or use CLI:"}),s.jsxs("code",{className:"text-xs text-blue-800 font-mono break-all block",children:["solana airdrop 10 ",k," --url ",t.endpoint]})]}),((t==null?void 0:t.name)==="devnet"||(t==null?void 0:t.name)==="testnet")&&s.jsxs("div",{className:"p-2 bg-blue-50 border border-blue-200 rounded",children:[s.jsx("p",{className:"text-xs text-blue-700 font-medium mb-1",children:"Testnet Funding:"}),s.jsxs("p",{className:"text-xs text-blue-800",children:["Visit"," ",s.jsx("a",{href:"https://faucet.solana.com",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-blue-900",children:"Solana Faucet"})," ","and paste the address above"]})]})]})]}):s.jsxs("div",{className:"py-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center mb-2",children:[s.jsx(lt,{className:"w-5 h-5 text-yellow-500 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"No Funding Address Available"})]}),s.jsx("p",{className:"text-xs text-gray-600",children:"No ckNFT canister found for this source contract"})]})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Cycles Payment Approval"}),s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(na,{className:"w-5 h-5 text-gray-600 mr-2"}),s.jsx("h5",{className:"font-medium text-gray-900",children:"Your Cycles Balance"})]}),le.isLoading?s.jsx(Qe,{className:"w-4 h-4 animate-spin text-gray-500"}):s.jsx("span",{className:be("font-medium",B!==null&&d&&B>=d.total*BigInt(120)/BigInt(100)?"text-green-600":"text-red-600"),children:B!==null?Ne(B):"Unknown"})]}),B!==null&&d&&s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-gray-600",children:"Required (with 120% buffer):"}),s.jsx("span",{className:"text-gray-900",children:Ne(d.total*BigInt(120)/BigInt(100))})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Remaining after export:"}),s.jsx("span",{className:be("font-medium",B>=d.total*BigInt(120)/BigInt(100)?"text-green-600":"text-red-600"),children:B>=d.total*BigInt(120)/BigInt(100)?Ne(B-d.total*BigInt(120)/BigInt(100)):"Insufficient Balance"})]})]})]}),b&&s.jsxs("div",{className:"p-4 bg-cyan-50 border border-cyan-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(sa,{className:"w-5 h-5 text-cyan-600 mr-2"}),s.jsx("h5",{className:"font-medium text-cyan-900",children:"Current Allowance"})]}),s.jsx("span",{className:be("font-medium",b.isSufficient&&!b.isExpired?"text-green-600":"text-orange-600"),children:Ne(b.amount)})]}),s.jsx("div",{className:"text-sm",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-cyan-600",children:"Status:"}),s.jsx("span",{className:be("font-medium",b.isSufficient&&!b.isExpired?"text-green-600":"text-orange-600"),children:b.isExpired?"Expired":b.isSufficient?"Sufficient":"Insufficient"})]})})]}),N?s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-5 h-5 text-green-600 mr-2"}),s.jsx("span",{className:"font-medium text-green-800",children:"Cycles Approved"})]}),s.jsxs("p",{className:"text-sm text-green-700 mt-1",children:[(d==null?void 0:d.collectionDeployment)&&d.collectionDeployment>0n&&s.jsxs("span",{className:"block",children:["âœ“ Orchestrator approved for collection deployment (",Ne(d.collectionDeployment*BigInt(120)/BigInt(100)),")"]}),s.jsxs("span",{className:"block",children:["âœ“ ckNFT canister approved for NFT casting (",d?Ne(d.nftMinting*BigInt(120)/BigInt(100)):"...",")"]})]})]}):s.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Approve Cycles Payment"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Two approvals required:"}),s.jsxs("ul",{className:"text-sm text-gray-600 mt-1 ml-4 list-disc",children:[(d==null?void 0:d.collectionDeployment)&&d.collectionDeployment>0n&&s.jsxs("li",{children:["Orchestrator for deployment: ",Ne(d.collectionDeployment*BigInt(120)/BigInt(100))]}),s.jsxs("li",{children:["ckNFT canister for casting: ",d?Ne(d.nftMinting*BigInt(120)/BigInt(100)):"..."]})]})]}),s.jsx("button",{onClick:ne,disabled:C||le.isLoading||!d||B!==null&&B<d.total*BigInt(120)/BigInt(100),className:be("px-6 py-2 rounded-md font-medium transition-colors",C||le.isLoading||!d||B!==null&&B<d.total*BigInt(120)/BigInt(100)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-cyan-600 text-white hover:bg-cyan-700"),children:C?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Approving..."]}):"Approve Payment"})]})})]}),!(t!=null&&t.deployed)&&N&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Collection Deployment"}),pe?s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(gt,{className:"w-5 h-5 text-green-600 mr-2"}),s.jsx("span",{className:"font-medium text-green-800",children:"Collection Deployed"})]}),s.jsx("p",{className:"text-sm text-green-700 mb-2",children:"Collection successfully deployed to Solana"}),s.jsxs("div",{className:"bg-white border border-green-200 rounded p-2",children:[s.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Collection Address:"}),s.jsx("code",{className:"text-xs font-mono text-green-800 break-all",children:pe.address})]}),pe.txHash&&s.jsxs("div",{className:"bg-white border border-green-200 rounded p-2 mt-2",children:[s.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Transaction Hash:"}),s.jsx("code",{className:"text-xs font-mono text-green-800 break-all",children:pe.txHash})]})]}):s.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Deploy Collection to Solana"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Create the NFT collection on ",re," before minting NFTs"]})]}),s.jsx("button",{onClick:G,disabled:ee||!N||!Q||!_||parseFloat(Q)<parseFloat(_)+ge(p),className:be("px-6 py-2 rounded-md font-medium transition-colors",ee||!N||!Q||!_||parseFloat(Q)<parseFloat(_)+ge(p)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"),children:ee?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Deploying..."]}):"Deploy Collection"})]}),!N&&s.jsx("p",{className:"text-xs text-yellow-600",children:"âš ï¸ Please approve cycles payment first"}),N&&Q&&_&&parseFloat(Q)<parseFloat(_)+ge(p)&&s.jsx("p",{className:"text-xs text-red-600",children:"âš ï¸ Insufficient SOL balance for deployment. Please fund the address above."})]})]}),N&&Q&&_&&parseFloat(Q)>=parseFloat(_)+ge(p)&&s.jsxs("div",{className:"p-4 bg-cyan-50 border border-cyan-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-5 h-5 text-cyan-600 mr-2"}),s.jsx("span",{className:"font-medium text-cyan-800",children:"Ready to Export"})]}),s.jsx("p",{className:"text-sm text-cyan-700 mt-1",children:'All requirements met. Click "Start Export" to begin the Solana bridging process.'})]}),Q&&_&&parseFloat(Q)<parseFloat(_)+ge(p)&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-2"}),s.jsx("span",{className:"font-medium text-red-800",children:"Insufficient SOL for Rent + Priority Fees"})]}),s.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["The funding address needs ",(parseFloat(_)+ge(p)).toFixed(4)," SOL (rent + priority fee) but only has ",parseFloat(Q).toFixed(4)," SOL.",k&&s.jsxs(s.Fragment,{children:[s.jsx("br",{}),s.jsxs("span",{className:"text-xs text-red-600",children:["Address: ",k]})]})]})]})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(lt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Unable to Calculate Costs"}),s.jsx("p",{className:"text-gray-600",children:"Please check your export configuration and try again."})]})}function A0({sourceCanisterId:e,onComplete:t,onCancel:n,className:r,modal:a=!1,initialStep:o}){var se,Ne;const[i,c]=x.useState(o||"select-ic-nft"),[l,u]=x.useState([]),[d,m]=x.useState(null),[f,g]=x.useState(null),[N,h]=x.useState(!1),[C,w]=x.useState(e||null),[B,j]=x.useState(null),[Q,F]=x.useState(null),[_,M]=x.useState(null),[k,K]=x.useState(!1),{wallet:V,connected:T,publicKey:ee}=os(),{user:J}=ut(),pe=sd(),E=ef(C);x.useEffect(()=>{console.log("ðŸ” SolanaExportWizard ICRC-99 support state:",{activeCanisterId:C,icrc99Support:E,sourceCanisterId:e})},[C,E,e]),x.useEffect(()=>{if(!C||E.isLoading){j(null);return}E.isSupported&&E.nativeChain?(console.log("âœ… ICRC-99 supported, using native chain info as source pointer:",E.nativeChain),j(E.nativeChain)):(console.log("ðŸ”„ ICRC-99 not supported, using IC network fallback for canister:",C),j({network:{IC:[]},contract:C}))},[C,E.isLoading,E.isSupported,E.nativeChain]);const b=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),Y=rn("jio3a-xaaaa-aaaal-ab66q-cai",vs),p=x.useCallback((ge,ne)=>{const ye=[];ne&&ye.push({id:"deploy-solana-collection",title:"Deploy Solana Collection",description:"Creating Metaplex NFT collection on Solana",estimatedDuration:120,retryable:!0,stage:"contract"}),ye.push({id:"approve-cycles-cast",title:"Approve Cycles",description:"Approving cycles for cast operations",estimatedDuration:30,retryable:!0,stage:"preparation"},{id:"cast-nfts",title:"Cast NFTs to Solana",description:"Exporting ckNFTs to Solana blockchain",estimatedDuration:120,retryable:!0,stage:"execution"},{id:"wait-solana-confirmation",title:"Confirm Cast Completion",description:"Polling cast status until NFTs are transferred and finalized on Solana",estimatedDuration:180,retryable:!1,stage:"execution"});const G=aa(ge,ye);return M(G),G},[]),O=x.useCallback((ge,ne,ye,G)=>{if(!_)return;const P=mt(_,ge,{status:ne,...ye&&{error:ye},...G&&{txHash:G}});M(P)},[_]),R=x.useCallback(ge=>{if(!_)return;const ne=vc(_,ge);M(ne)},[_]);x.useEffect(()=>{},[]);const q=ge=>{switch(ge.toLowerCase()){case"mainnet-beta":case"mainnet":return{Mainnet:null};case"devnet":return{Devnet:null};case"testnet":return{Testnet:null};case"localnet":case"localhost":return{Custom:"http://127.0.0.1:8899"};default:return{Custom:ge}}},v=x.useCallback(async(ge,ne=10,ye=5e3)=>{console.log("ðŸ” Polling for deployed Solana collection address...",{txHash:ge,maxAttempts:ne,intervalMs:ye});let G=0;return new Promise((P,z)=>{const A=setInterval(async()=>{var Z;G++,console.log(`ðŸ” Polling attempt ${G}/${ne} for collection address...`);try{if(Y&&((Z=l[0])!=null&&Z.canisterId)&&d)try{const de=q(d.name),te={contract:l[0].canisterId,network:{Solana:[de]}},fe=await Y.get_ck_nft_canister([te]);if(Array.isArray(fe)&&fe[0]&&fe[0][0]){const xe=fe[0][0];console.log("âœ… Found ckNFT canister:",xe.toString());const oe={Solana:[q(d.name)]},X=await Y.get_remote([[xe,oe]]);if(Array.isArray(X)&&X[0]&&X[0][0]){const ae=X[0][0],je=ae.address&&ae.address.length>0?ae.address[0]:null;if(je){console.log("ðŸŽ‰ Found newly deployed Solana collection address:",je),m(Ae=>Ae?{...Ae,collectionAddress:je,deployed:!0}:null),clearInterval(A),P();return}}}}catch(de){console.warn(`âš ï¸ Polling attempt ${G} failed:`,de)}G>=ne&&(clearInterval(A),console.warn("â±ï¸ Max polling attempts reached without finding collection address"),z(new Error("Failed to retrieve collection address after deployment")))}catch(de){console.error("Error in polling iteration:",de),clearInterval(A),z(de)}},ye)})},[l,d,Y]),U=x.useCallback(async()=>{var ge;if(console.log("ðŸŽ¯ handleStartExport called with:",{selectedICNFTs:l.length,publicKey:ee==null?void 0:ee.toBase58(),userPrincipal:J==null?void 0:J.principal,targetNetwork:d}),!l.length||!ee||!(J!=null&&J.principal)||!d||!B||!f){console.warn("âŒ Missing required data for export:",{selectedICNFTs:l.length,publicKey:!!ee,userPrincipal:!!(J!=null&&J.principal),targetNetwork:!!d,sourceContractPointer:!!B,exportCosts:!!f});return}c("export"),K(!1),p("ic-to-solana",!d.deployed);try{if(console.log(`ðŸš€ Starting Solana export process for ${l.length} ckNFT(s)`),console.log(`ðŸ“‹ Collection already deployed: ${d.deployed}`),d.deployed)console.log("âœ… Using existing collection:",d.collectionAddress);else{O("deploy-solana-collection","loading"),console.log("ðŸ“¦ Deploying Solana collection..."),O("deploy-solana-collection","loading","Deploying Metaplex collection to Solana...");try{if(!B)throw new Error("Source contract pointer not available");const G={Solana:[q(d.name)]};console.log("ðŸ“ Deploying Solana collection:",{sourceContract:B,targetNetwork:G});const P=await b.createRemoteContract.mutateAsync({pointer:B,network:G,gasPrice:0n,gasLimit:0n,maxPriorityFeePerGas:0n});console.log("âœ… Solana collection deployment initiated:",P);let z=null;P&&typeof P=="object"?"Ok"in P&&typeof P.Ok=="string"?z=P.Ok:"transactionHash"in P&&(z=P.transactionHash):typeof P=="string"&&(z=P),z?(console.log("ðŸ“‹ Got deployment transaction hash:",z),await v(z)):(console.warn("âš ï¸ No transaction hash received from deployment"),m(A=>A?{...A,deployed:!0}:null))}catch(ye){console.error("âŒ Solana collection deployment failed:",ye),K(!0),O("deploy-solana-collection","failed",ye instanceof Error?ye.message:"Collection deployment failed");return}O("deploy-solana-collection","completed")}O("approve-cycles-cast","loading");try{if(!f)throw new Error("Export costs not calculated");if(console.log("ðŸ”‹ Using pre-calculated export costs for cycle approval:",f.toString()),!((ge=l[0])==null?void 0:ge.canisterId))throw new Error("No ckNFT canister ID available");console.log("âœ… Cycles already approved in costs step")}catch(ye){console.error("âŒ Cycle approval verification failed:",ye),K(!0),O("approve-cycles-cast","failed",ye instanceof Error?ye.message:"Cycle approval failed");return}O("approve-cycles-cast","completed"),O("cast-nfts","loading");const ne=[];try{console.log(`ðŸ”„ Starting to cast ${l.length} NFT(s) to Solana`);for(let ye=0;ye<l.length;ye++){const G=l[ye];console.log(`ðŸ”„ Casting NFT ${ye+1}/${l.length}: Token ${G.tokenId} from ${G.canisterId}`),O("cast-nfts","loading",`Casting NFT ${ye+1}/${l.length}: ${G.name||G.tokenId}...`);try{const{Actor:P}=await Xe(async()=>{const{Actor:oe}=await Promise.resolve().then(()=>Bt);return{Actor:oe}},void 0),{idlFactory:z}=await Xe(async()=>{const{idlFactory:oe}=await Promise.resolve().then(()=>K0);return{idlFactory:oe}},void 0);if(!pe)throw new Error("Authenticated agent not available. Please authenticate with Internet Identity.");const A=P.createActor(z,{agent:pe,canisterId:G.canisterId}),Z={owner:typeof J.principal=="string"?qe.fromText(J.principal):J.principal,subaccount:[]},de=d.collectionAddress||"pending",te={targetOwner:ee.toBase58(),tokenId:BigInt(G.tokenId),fromSubaccount:[],remoteContract:{network:d.network,contract:de},gasPrice:[],gasLimit:[],maxPriorityFeePerGas:[],memo:[],created_at_time:[]};console.log("ðŸ“ Submitting cast request:",te);const fe=await A.icrc99_cast([te],[Z]);console.log(`âœ… Cast result for NFT ${ye+1}:`,fe);let xe=fe;for(;Array.isArray(xe)&&xe.length>0;)xe=xe[0];if(console.log("ðŸ“¦ Unwrapped cast result:",xe),xe&&typeof xe=="object"){if("Ok"in xe){const oe=xe.Ok;ne.push({nft:G,txId:oe,success:!0}),console.log(`âœ… NFT ${ye+1}/${l.length} cast successfully. TX ID:`,oe)}else if("Err"in xe){const oe=xe.Err;console.error(`âŒ Cast failed for NFT ${ye+1}:`,oe);let X="Unknown cast error";if(typeof oe=="object")if("InsufficientAllowance"in oe){const[ae,je]=oe.InsufficientAllowance;X=`Insufficient cycles allowance: have ${ae}, need ${je}. Please approve more cycles to the ckNFT canister.`}else"Unauthorized"in oe?X="Unauthorized to cast this NFT. You must be the owner.":"GenericError"in oe&&oe.GenericError.message?X=`Cast error: ${oe.GenericError.message}`:"GenericBatchError"in oe&&oe.GenericBatchError.message?X=`Batch cast error: ${oe.GenericBatchError.message}`:X=`Cast error: ${JSON.stringify(oe)}`;throw new Error(X)}}}catch(P){throw console.error(`âŒ Error casting NFT ${ye+1}/${l.length}:`,P),K(!0),O("cast-nfts","failed",P instanceof Error?P.message:`Failed to cast NFT ${ye+1}`),P}}O("cast-nfts","completed",`Successfully submitted ${ne.length} NFT(s) for casting`)}catch(ye){throw console.error("âŒ NFT casting process failed:",ye),ye}O("wait-solana-confirmation","loading");try{console.log("â³ Polling for cast completion...",{castCount:ne.length,castIds:ne.map(de=>de.txId)});const ye=120;let G=0,P=!1,z=[];for(;G<ye&&!P;){G++,await new Promise(te=>setTimeout(te,5e3)),console.log(`ðŸ” Checking cast status (attempt ${G}/${ye})...`);const de=ne.map(async te=>{try{const fe=BigInt(te.txId),xe=te.nft.canisterId,oe={owner:typeof J.principal=="string"?qe.fromText(J.principal):J.principal,subaccount:[]},X=await b.getCastStatus.mutateAsync({castIds:[fe],ckNFTCanisterId:xe,account:oe});console.log(`ðŸ” Raw status result for cast ${fe}:`,X);const ae=X&&X.length>0?X[0]:null;return ae||console.warn(`âš ï¸ No status returned for cast ${fe}`),{castId:fe,status:ae,nft:te.nft}}catch(fe){return console.error("Error fetching cast status:",fe),{castId:te.txId,status:null,nft:te.nft}}});if(z=await Promise.all(de),P=z.every(te=>{if(!te.status)return console.warn(`âš ï¸ No status for cast ${te.castId}, skipping check`),!1;console.log(`ðŸ” Full status object for cast ${te.castId}:`,te.status),console.log("ðŸ” Type check - is array:",Array.isArray(te.status),"is object:",typeof te.status=="object");const fe=Array.isArray(te.status)?te.status[0]:te.status;if(!fe||!fe.status)return console.error(`âŒ Invalid cast state structure for cast ${te.castId}:`,fe),!1;const xe=fe.status;if(!xe||typeof xe!="object")return console.error(`âŒ Status variant missing or wrong type for cast ${te.castId}:`,xe),!1;if(console.log(`ðŸ“Š Cast ${te.castId} status variant:`,xe),"Completed"in xe)return console.log(`âœ… Cast ${te.castId} completed! Block:`,xe.Completed),!0;if("RemoteFinalized"in xe)return console.log(`âœ… Cast ${te.castId} finalized on Solana! Hash:`,xe.RemoteFinalized),!0;if("Error"in xe)throw console.error(`âŒ Cast ${te.castId} failed:`,xe.Error),new Error(`Cast failed: ${JSON.stringify(xe.Error)}`);return"Created"in xe?console.log(`ðŸ“ Cast ${te.castId}: Created`):"SubmittingToOrchestrator"in xe?(console.log(`ðŸ“¤ Cast ${te.castId}: Submitting to orchestrator...`),O("wait-solana-confirmation","loading",`Cast ${te.castId}: Submitting to orchestrator...`)):"SubmittedToOrchestrator"in xe?(console.log(`âœ… Cast ${te.castId}: Submitted (Remote ID: ${xe.SubmittedToOrchestrator.remoteCastId})`),O("wait-solana-confirmation","loading",`Cast ${te.castId}: Submitted to orchestrator (Remote Cast ID: ${xe.SubmittedToOrchestrator.remoteCastId})`)):"WaitingOnContract"in xe?(console.log(`â³ Cast ${te.castId}: Waiting for collection deployment...`),O("wait-solana-confirmation","loading",`Cast ${te.castId}: Deploying collection on Solana... TX: ${xe.WaitingOnContract.transaction.substring(0,8)}...`)):"WaitingOnMint"in xe?(console.log(`ðŸŽ¨ Cast ${te.castId}: Minting NFT on Solana...`),O("wait-solana-confirmation","loading",`Cast ${te.castId}: Minting NFT on Solana... TX: ${xe.WaitingOnMint.transaction.substring(0,8)}...`)):"WaitingOnTransfer"in xe&&(console.log(`ðŸ“¦ Cast ${te.castId}: Transferring NFT to recipient...`),O("wait-solana-confirmation","loading",`Cast ${te.castId}: Transferring NFT to owner... TX: ${xe.WaitingOnTransfer.transaction.substring(0,8)}...`)),!1}),P){console.log("âœ… All casts completed!");break}}if(!P)throw new Error("Cast polling timeout - exceeded maximum wait time");O("wait-solana-confirmation","completed",`All ${ne.length} NFT(s) successfully exported to Solana and confirmed`);const A=z.map(de=>{var te;return(te=de.status)!=null&&te.status&&"RemoteFinalized"in de.status.status?de.status.status.RemoteFinalized:null}).filter(Boolean),Z={success:!0,collectionAddress:d.collectionAddress,tokenIds:l.map(de=>de.tokenId),solanaTransactionHash:A[0]||void 0};console.log("âœ… Export complete! Transaction hashes:",A),F(Z),c("complete"),t&&t(Z)}catch(ye){throw console.error("âŒ Confirmation failed:",ye),K(!0),O("wait-solana-confirmation","failed",ye instanceof Error?ye.message:"Failed to confirm Solana transactions"),ye}}catch(ne){console.error("âŒ Export process failed:",ne),K(!0);const ye={success:!1,error:ne instanceof Error?ne.message:"Export failed"};F(ye),t&&t(ye)}},[l,ee,J,d,B,f,pe,b,t,v,p,O]),S=[{id:"select-ic-nft",title:"Select NFTs",description:"Choose ckNFTs to export"},{id:"network",title:"Network",description:"Select Solana network"},{id:"costs",title:"Review Costs",description:"Approve export costs"},{id:"export",title:"Export",description:"Execute export to Solana"},{id:"complete",title:"Complete",description:"Export complete"}],H=S.findIndex(ge=>ge.id===i),he=i!=="select-ic-nft"&&i!=="export"&&i!=="complete",$=x.useCallback(()=>{switch(i){case"select-ic-nft":return l.length>0;case"network":return T&&d!==null;case"costs":return f!==null&&f>0n&&N;case"export":case"complete":return!1;default:return!1}},[i,l,T,d,f,N]),W=()=>{if(!$())return;const ge=H+1;ge<S.length&&(c(S[ge].id),K(!1))},le=()=>{if(!he)return;const ge=H-1;ge>=0&&(c(S[ge].id),K(!1))},ce=ge=>{if(u(ge),ge.length>0){const ne=ge[0].canisterId;w(ne)}},L=async(ge,ne)=>{const ye=q(ge),G={Solana:[ye]};let P=!1,z;if(C&&B&&Y)try{console.log("ðŸ” Checking for existing remote collection on",ge);const A={Solana:[ye]},Z=await Y.get_ck_nft_canister([B]);if(Array.isArray(Z)&&Z[0]&&Z[0][0]){const de=Z[0][0];console.log("ðŸ“¦ Checking remote for ckNFT canister:",de.toString());const te=await Y.get_remote([[de,A]]);if(Array.isArray(te)&&te[0]&&te[0][0]){const fe=te[0][0],xe=fe.address&&fe.address.length>0?fe.address[0]:null;xe?(console.log("âœ… Found existing Solana collection:",xe),P=!0,z=xe):console.log("âš ï¸ Remote exists but no address yet")}else console.log("â„¹ï¸ No remote collection found, will need deployment")}}catch(A){console.warn("âš ï¸ Error checking for existing remote:",A)}m({name:ge,endpoint:ne,deployed:P,collectionAddress:z,network:G})},ue=()=>{switch(i){case"select-ic-nft":return s.jsxs("div",{children:[s.jsx(Gc,{selectedNFTs:l,onSelectionChange:ce,sourceCanisterId:e,userPrincipal:J==null?void 0:J.principal,targetChain:"solana"}),l.length>0&&C&&s.jsx("div",{className:"mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:s.jsx("div",{className:"flex items-center space-x-2",children:E.isLoading?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-cyan-600 border-t-transparent rounded-full"}),s.jsx("span",{className:"text-sm text-gray-600",children:"Checking ICRC-99 support..."})]}):E.isSupported?s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm text-green-700 font-medium",children:"ICRC-99 Supported"}),s.jsx("span",{className:"text-xs text-gray-500",children:"- Cross-chain casting available"})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-4 h-4 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("span",{className:"text-sm text-yellow-700 font-medium",children:"ICRC-7 Only"}),s.jsx("span",{className:"text-xs text-gray-500",children:"- IC-to-Solana casting available"})]})})})]});case"network":return s.jsx(Uw,{selectedNetwork:d==null?void 0:d.name,onNetworkChange:L});case"costs":return s.jsx(Vw,{selectedNFTs:l,targetNetwork:d,sourceContractPointer:B,onCostsCalculated:g,onReadyStateChange:h,onDeploymentComplete:ge=>{console.log("âœ… Collection deployment complete, updating network info:",ge),m(ne=>ne?{...ne,deployed:!0,collectionAddress:ge}:null)}});case"export":return s.jsx(Gw,{progress:_,onRetryStep:R});case"complete":return s.jsx(Hw,{result:Q,onStartNew:()=>{c("select-ic-nft"),u([]),m(null),g(null),F(null),K(!1)},onClose:()=>n==null?void 0:n()});default:return null}},re=s.jsxs("div",{className:be("bg-white rounded-lg shadow-lg",a&&"max-w-4xl mx-auto",r),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Export NFTs to Solana"}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Step ",H+1," of ",S.length,": ",(se=S[H])==null?void 0:se.description]})]}),n&&s.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(ra,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"px-6 py-4 border-b border-gray-100",children:[s.jsx("div",{className:"flex items-center justify-between",children:S.map((ge,ne)=>s.jsxs("div",{className:be("flex items-center",ne<S.length-1&&"flex-1"),children:[s.jsx("div",{className:be("flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium",ne<H?"bg-green-100 text-green-600":ne===H?k?"bg-red-100 text-red-600":"bg-cyan-100 text-cyan-600":"bg-gray-100 text-gray-400"),children:ne<H?s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):ne===H&&k?s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}):ne+1}),s.jsx("span",{className:be("ml-2 text-sm font-medium hidden sm:inline",ne<=H?"text-gray-900":"text-gray-400",ne===H&&k&&"text-red-600"),children:ge.title}),ne<S.length-1&&s.jsx("div",{className:be("flex-1 h-0.5 mx-4",ne<H?"bg-green-200":"bg-gray-200")})]},ge.id))}),k&&s.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-md",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-4 h-4 text-red-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsxs("span",{className:"text-sm text-red-700 font-medium",children:["Error in ",(Ne=S[H])==null?void 0:Ne.title]}),s.jsx("span",{className:"ml-2 text-xs text-red-600",children:"Use the Previous button to go back and retry"})]})})]}),s.jsx("div",{className:"p-6 min-h-[400px] max-h-[600px] overflow-y-auto",children:ue()}),s.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[s.jsxs("button",{onClick:le,disabled:!he,className:be("flex items-center px-4 py-2 text-sm font-medium rounded-md transition-colors",he?k?"text-white bg-red-600 hover:bg-red-700":"text-gray-700 bg-gray-100 hover:bg-gray-200":"text-gray-400 bg-gray-50 cursor-not-allowed"),children:[s.jsx(ta,{className:"w-4 h-4 mr-1"}),k?"Go Back & Retry":"Previous"]}),s.jsxs("div",{className:"flex space-x-3",children:[i==="costs"&&$()&&s.jsxs("button",{onClick:U,className:"flex items-center px-6 py-2 text-sm font-medium text-white bg-cyan-600 rounded-md hover:bg-cyan-700 transition-colors",children:["Start Export",s.jsx(Is,{className:"w-4 h-4 ml-1"})]}),i!=="costs"&&i!=="export"&&i!=="complete"&&s.jsxs("button",{onClick:W,disabled:!$(),className:be("flex items-center px-6 py-2 text-sm font-medium rounded-md transition-colors",$()?"text-white bg-cyan-600 hover:bg-cyan-700":"text-gray-400 bg-gray-100 cursor-not-allowed"),children:["Next",s.jsx(Is,{className:"w-4 h-4 ml-1"})]})]})]})]});return a?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:re}):re}function Gw({progress:e,onRetryStep:t}){return e?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Exporting to Solana"}),s.jsx("p",{className:"text-gray-600",children:"Your NFTs are being exported to the Solana blockchain"})]}),e&&s.jsx(jc,{progress:{...e,stages:e.stages.filter(n=>n.id==="preparation"||n.id==="execution")},onRetryStep:t})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-cyan-600 border-t-transparent rounded-full mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Initializing Export"}),s.jsx("p",{className:"text-gray-600",children:"Setting up Solana export process..."})]})}function Hw({result:e,onStartNew:t,onClose:n}){return e.success?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Export Successful!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your NFTs have been successfully exported to Solana."}),s.jsxs("div",{className:"bg-cyan-50 rounded-lg p-4 text-left max-w-md mx-auto mb-6",children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Export Details:"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[e.collectionAddress&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Collection Address:"}),s.jsx("div",{className:"font-mono text-xs break-all text-cyan-700",children:e.collectionAddress})]}),e.tokenIds&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"NFTs Exported:"}),s.jsxs("div",{className:"font-medium text-gray-900",children:[e.tokenIds.length," token",e.tokenIds.length!==1?"s":""]})]}),e.solanaTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all text-cyan-700",children:e.solanaTransactionHash})]})]})]}),s.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[s.jsx("button",{onClick:t,className:"px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg transition-colors",children:"Export More NFTs"}),s.jsx("button",{onClick:n,className:"px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-lg transition-colors",children:"Close"})]})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Export Failed"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"There was an issue exporting your NFTs to Solana."}),e.error&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-left max-w-md mx-auto mb-6",children:[s.jsx("h4",{className:"font-semibold text-red-900 mb-2",children:"Error Details:"}),s.jsx("p",{className:"text-sm text-red-700",children:e.error})]}),s.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[s.jsx("button",{onClick:t,className:"px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors",children:"Try Again"}),s.jsx("button",{onClick:n,className:"px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-lg transition-colors",children:"Close"})]})]})}const T0=new Ve("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s");function zw(e){const[t]=Ve.findProgramAddressSync([Buffer.from("metadata"),T0.toBuffer(),e.toBuffer()],T0);return t}function qw(e){try{let t=1;const n=new Ve(e.slice(t,t+32)).toBase58();t+=32;const r=new Ve(e.slice(t,t+32)).toBase58();t+=32;const a=e.readUInt32LE(t);t+=4;const o=e.slice(t,t+a).toString("utf8").replace(/\0/g,"");t+=a;const i=e.readUInt32LE(t);t+=4;const c=e.slice(t,t+i).toString("utf8").replace(/\0/g,"");t+=i;const l=e.readUInt32LE(t);t+=4;const u=e.slice(t,t+l).toString("utf8").replace(/\0/g,"");t+=l;const d=e.readUInt16LE(t);t+=2;const m=e[t];t+=1;let f;if(m){const B=e.readUInt32LE(t);t+=4,f=[];for(let j=0;j<B;j++){const Q=new Ve(e.slice(t,t+32)).toBase58();t+=32;const F=e[t]===1;t+=1;const _=e[t];t+=1,f.push({address:Q,verified:F,share:_})}}const g=e[t]===1;t+=1;const N=e[t]===1;t+=1;let h;t<e.length&&e[t]===1?(t+=1,h=e[t],t+=1):t<e.length&&(t+=1);let C;t<e.length&&e[t]===1?(t+=1,C=e[t],t+=1):t<e.length&&(t+=1);let w;if(t<e.length&&e[t]===1){t+=1;const B=e[t]===1;t+=1;const j=new Ve(e.slice(t,t+32)).toBase58();t+=32,w={verified:B,key:j}}return{key:e[0],updateAuthority:n,mint:r,name:o,symbol:c,uri:u,sellerFeeBasisPoints:d,creators:f,primarySaleHappened:g,isMutable:N,editionNonce:h,tokenStandard:C,collection:w}}catch(t){return console.error("Failed to parse metadata:",t),null}}async function Qw(e){try{e.startsWith("ipfs://")&&(e=e.replace("ipfs://","https://ipfs.io/ipfs/"));const t=await fetch(e,{headers:{Accept:"application/json"}});return t.ok?await t.json():null}catch(t){return t instanceof TypeError||console.debug(`Metadata fetch error for ${e}:`,t),null}}async function bf(e,t){var n;try{const r=zw(t),a=await e.getAccountInfo(r);if(!a)return console.warn(`No metadata found for mint ${t.toBase58()}`),null;const o=qw(a.data);if(!o)return null;let i=null;return o.uri&&(i=await Qw(o.uri)),{mintAddress:t.toBase58(),tokenAccount:"",name:o.name,symbol:o.symbol,uri:o.uri,collectionAddress:(n=o.collection)==null?void 0:n.key,collectionName:void 0,image:i==null?void 0:i.image,description:i==null?void 0:i.description,metadata:i}}catch(r){return console.error(`Error fetching NFT metadata for ${t.toBase58()}:`,r),null}}async function Ww(e,t){try{console.log("ðŸ” Querying NFTs owned by:",t.toBase58());const n=await e.getTokenAccountsByOwner(t,{programId:ns});console.log(`ðŸ“¦ Found ${n.value.length} token accounts`);const r=[],a=[];for(const{account:o,pubkey:i}of n.value){const c=Ud.decode(o.data);if(c.amount===1n){const u=new Ve(c.mint);a.push((async()=>{try{const d=await e.getAccountInfo(u);if(d&&qc.decode(d.data).decimals===0){const f=await bf(e,u);f&&(f.tokenAccount=i.toBase58(),r.push(f),console.log(`âœ… Found NFT: ${f.name||u.toBase58()}`))}}catch(d){console.warn(`Error checking mint ${u.toBase58()}:`,d)}})())}}return await Promise.all(a),console.log(`âœ… Found ${r.length} NFTs total`),r}catch(n){throw console.error("Error querying owned NFTs:",n),n}}async function E0(e,t,n){try{const r=new Ve(t),a=await e.getAccountInfo(r);if(!a)throw new Error("Mint address not found");if(qc.decode(a.data).decimals!==0)throw new Error("Not an NFT (decimals must be 0)");const i=await bf(e,r);if(!i)throw new Error("No metadata found for this NFT");return i}catch(r){throw console.error(`Error querying NFT ${t}:`,r),r}}function Jw({cluster:e,onSelectionChange:t,className:n}){const{publicKey:r,connected:a,connection:o}=os(),{user:i}=ut(),[c,l]=x.useState(null),[u,d]=x.useState(!1),[m,f]=x.useState(null),[g,N]=x.useState(""),[h,C]=x.useState([]),[w,B]=x.useState(!1),[j,Q]=x.useState(""),[F,_]=x.useState(!1),[M,k]=x.useState("nft"),[K,V]=x.useState(!1),[T,ee]=x.useState("");x.useEffect(()=>{if(!a||!r||!i||!o)return;(async()=>{d(!0),f(null);try{console.log("ðŸ” Fetching burnable NFTs for:",{solanaAddress:r.toBase58(),cluster:e,icPrincipal:i.principal.toText()});const O=await Ww(o,r);console.log(`âœ… Found ${O.length} NFTs owned by wallet`);const R=O.map(q=>({mintAddress:q.mintAddress,collectionAddress:q.collectionAddress||"",cluster:e,name:q.name,description:q.description,image:q.image,metadata:q.metadata}));C(R),d(!1)}catch(O){console.error("Failed to fetch burnable NFTs:",O),f(O instanceof Error?O.message:"Failed to load NFTs"),d(!1)}})()},[a,r,i,e,o]);const J=p=>{const O=(c==null?void 0:c.mintAddress)===p.mintAddress?null:p;console.log("ðŸŽ¯ NFT selection toggled:",{action:O?"select":"deselect",nft:p.mintAddress.slice(0,8)+"...",isRecovery:p.isRecovery,selectedAfter:!!O}),l(O),t==null||t(O)},pe=async()=>{if(!(!j.trim()||!o)){_(!0),f(null);try{console.log("ðŸ” Querying NFT by mint address:",j);const p=await E0(o,j.trim(),r||void 0);if(!p)throw new Error("NFT not found or invalid mint address");const O={mintAddress:p.mintAddress,collectionAddress:p.collectionAddress||"",cluster:e,name:p.name,description:p.description,image:p.image,metadata:p.metadata};h.find(R=>R.mintAddress===p.mintAddress)||C([O,...h]),l(O),t==null||t(O),B(!1),Q(""),console.log("âœ… Successfully added NFT:",p.name||p.mintAddress)}catch(p){console.error("Failed to query NFT:",p),f(p instanceof Error?p.message:"Failed to query NFT")}finally{_(!1)}}},E=async()=>{if(!(!T.trim()||!o)){_(!0),f(null);try{console.log("ðŸ”„ Recovery mode: Checking NFT at approval address:",T);const p=await E0(o,T.trim());if(!p)throw new Error("NFT not found or invalid mint address");const O={mintAddress:p.mintAddress,collectionAddress:p.collectionAddress||"",cluster:e,name:p.name,description:p.description,image:p.image,metadata:p.metadata,isRecovery:!0};h.find(R=>R.mintAddress===p.mintAddress)||C([O,...h]),l(O),t==null||t(O),console.log("âœ… Recovery mode: NFT selected with recovery flag:",{mintAddress:O.mintAddress,isRecovery:O.isRecovery,name:O.name||p.mintAddress}),V(!1),ee(""),console.log("âœ… Recovery mode complete - NFT should be selected and Next button should be enabled")}catch(p){console.error("Recovery mode failed:",p),f(p instanceof Error?p.message:"Failed to verify NFT for recovery")}finally{_(!1)}}},b=h.filter(p=>{var R;if(!g)return!0;const O=g.toLowerCase();return((R=p.name)==null?void 0:R.toLowerCase().includes(O))||p.mintAddress.toLowerCase().includes(O)||p.collectionAddress.toLowerCase().includes(O)}),Y=b.reduce((p,O)=>{const R=O.collectionAddress||"uncategorized";return p.has(R)||p.set(R,[]),p.get(R).push(O),p},new Map);return s.jsxs("div",{className:be("space-y-6",n),children:[s.jsx("div",{className:"rounded-lg border-2 border-orange-500 bg-orange-50 dark:bg-orange-950 p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(_s,{className:"h-6 w-6 text-orange-600 dark:text-orange-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("h3",{className:"text-lg font-semibold text-orange-900 dark:text-orange-100",children:"âš ï¸ Burn and Return to IC"}),s.jsxs("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:["This operation will ",s.jsx("strong",{children:"transfer your NFT to the approval address"})," on Solana and ",s.jsx("strong",{children:"remint it as a ckNFT"})," on the Internet Computer."]}),s.jsxs("ul",{className:"text-sm text-orange-700 dark:text-orange-300 space-y-1 list-disc list-inside",children:[s.jsx("li",{children:"The NFT will be locked on Solana (transferred to orchestrator custody)"}),s.jsx("li",{children:"You will receive the corresponding ckNFT on IC"}),s.jsx("li",{children:"Only works for NFTs in orchestrator-controlled collections"}),s.jsx("li",{children:"This process cannot be undone (but you can cast the ckNFT back to Solana later)"})]})]})]})}),h.length>0&&s.jsxs("div",{className:"relative",children:[s.jsx(Li,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search by name or address...",value:g,onChange:p=>N(p.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"})]}),s.jsx("div",{className:"space-y-3",children:!w&&!K?s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("button",{onClick:()=>B(!0),className:"flex items-center justify-center space-x-2 p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-cyan-400 dark:hover:border-cyan-500 hover:bg-cyan-50 dark:hover:bg-cyan-950 transition-colors text-gray-600 dark:text-gray-400 hover:text-cyan-600 dark:hover:text-cyan-400",children:[s.jsx(cd,{className:"h-5 w-5"}),s.jsx("span",{className:"font-medium text-sm",children:"Add NFT"})]}),s.jsxs("button",{onClick:()=>V(!0),className:"flex items-center justify-center space-x-2 p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-orange-400 dark:hover:border-orange-500 hover:bg-orange-50 dark:hover:bg-orange-950 transition-colors text-gray-600 dark:text-gray-400 hover:text-orange-600 dark:hover:text-orange-400",children:[s.jsx(on,{className:"h-5 w-5"}),s.jsx("span",{className:"font-medium text-sm",children:"Recovery Mode"})]})]}):w?s.jsxs("div",{className:"p-4 border-2 border-cyan-300 dark:border-cyan-700 rounded-lg bg-cyan-50 dark:bg-cyan-950 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Enter NFT Mint Address"}),s.jsx("button",{onClick:()=>{B(!1),Q(""),f(null)},className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancel"})]}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Enter a Solana NFT mint address (e.g., 7PijVMKnnoCXy1iDNH36A5a7XTa97ydMqMen3PFe1QFS) to manually add it. This is useful if you know the specific NFT you want to burn."}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("input",{type:"text",value:j,onChange:p=>Q(p.target.value),onKeyDown:p=>{p.key==="Enter"&&!F&&pe()},placeholder:"Enter mint address...",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",disabled:F}),s.jsx("button",{onClick:pe,disabled:!j.trim()||F,className:be("px-4 py-2 rounded-lg font-medium transition-colors",j.trim()&&!F?"bg-cyan-500 hover:bg-cyan-600 text-white":"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"),children:F?s.jsx(Qe,{className:"h-5 w-5 animate-spin"}):"Add"})]})]}):K?s.jsxs("div",{className:"p-4 border-2 border-orange-300 dark:border-orange-700 rounded-lg bg-orange-50 dark:bg-orange-950 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("h3",{className:"font-medium text-gray-900 dark:text-gray-100 flex items-center space-x-2",children:[s.jsx(on,{className:"h-5 w-5 text-orange-600"}),s.jsx("span",{children:"Recovery Mode"})]}),s.jsx("button",{onClick:()=>{V(!1),ee(""),f(null)},className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancel"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:s.jsx("strong",{children:"Use this if your NFT was already transferred to the approval address but the mint failed."})}),s.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:"This skips the transfer step and goes directly to minting on IC. The NFT must already be at the orchestrator's approval address."})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("input",{type:"text",value:T,onChange:p=>ee(p.target.value),onKeyDown:p=>{p.key==="Enter"&&!F&&E()},placeholder:"Enter NFT mint address...",className:"flex-1 px-3 py-2 border border-orange-300 dark:border-orange-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",disabled:F}),s.jsx("button",{onClick:E,disabled:!T.trim()||F,className:be("px-4 py-2 rounded-lg font-medium transition-colors",T.trim()&&!F?"bg-orange-500 hover:bg-orange-600 text-white":"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"),children:F?s.jsx(Qe,{className:"h-5 w-5 animate-spin"}):"Recover"})]})]}):null}),h.length>0&&s.jsxs("div",{className:"flex items-center justify-center space-x-2 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsxs("button",{onClick:()=>k("nft"),className:be("flex-1 px-4 py-2 rounded-md font-medium transition-colors",M==="nft"?"bg-white dark:bg-gray-700 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:["All NFTs (",h.length,")"]}),s.jsxs("button",{onClick:()=>k("collection"),className:be("flex-1 px-4 py-2 rounded-md font-medium transition-colors",M==="collection"?"bg-white dark:bg-gray-700 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:["By Collection (",Y.size,")"]})]}),c&&s.jsxs("div",{className:"flex items-center justify-between p-3 bg-cyan-50 dark:bg-cyan-950 rounded-lg border border-cyan-200 dark:border-cyan-800",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("span",{className:"text-sm font-medium text-cyan-900 dark:text-cyan-100",children:[s.jsx(on,{className:"inline h-4 w-4 mr-1"}),"1 NFT selected for burn"]}),c.isRecovery&&s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300",children:"Recovery Mode"})]}),s.jsx("button",{onClick:()=>J(c),className:"text-sm text-cyan-600 dark:text-cyan-400 hover:text-cyan-700 dark:hover:text-cyan-300",children:"Clear selection"})]}),u?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"}),s.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading burnable NFTs..."})]}):m?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(_s,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),s.jsx("p",{className:"text-red-600 dark:text-red-400",children:m})]}):b.length===0?s.jsxs("div",{className:"text-center py-12 space-y-4",children:[s.jsx(on,{className:"h-16 w-16 text-gray-400 mx-auto"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"No Burnable NFTs Found"}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-md mx-auto",children:h.length===0?"You don't have any NFTs. Use 'Add NFT by Mint Address' if you know the specific NFT address, or connect to a different Solana wallet.":`No NFTs match "${g}"`})]}),s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500 max-w-md mx-auto",children:[s.jsx("p",{className:"font-medium mb-1",children:"How to burn NFTs:"}),s.jsxs("ol",{className:"list-decimal list-inside text-left space-y-1",children:[s.jsx("li",{children:"You must own an NFT on Solana (cast from IC or purchased)"}),s.jsx("li",{children:"Enter the NFT mint address manually if not auto-detected"}),s.jsx("li",{children:"The orchestrator will verify the NFT and collection"})]})]})]}):M==="nft"?s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(p=>s.jsxs("button",{onClick:()=>J(p),className:be("relative group rounded-lg border-2 p-4 text-left transition-all","hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-cyan-500",(c==null?void 0:c.mintAddress)===p.mintAddress?"border-cyan-500 bg-cyan-50 dark:bg-cyan-950":"border-gray-200 dark:border-gray-700 hover:border-cyan-300 dark:hover:border-cyan-700"),children:[(c==null?void 0:c.mintAddress)===p.mintAddress&&s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("div",{className:"h-6 w-6 rounded-full bg-cyan-500 flex items-center justify-center",children:s.jsx(on,{className:"h-4 w-4 text-white"})})}),s.jsxs("div",{className:"aspect-square rounded-lg bg-gray-100 dark:bg-gray-800 mb-3 overflow-hidden relative",children:[p.image?s.jsx("img",{src:p.image,alt:p.name||"NFT",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(on,{className:"h-12 w-12 text-gray-400"})}),p.isRecovery&&s.jsx("div",{className:"absolute top-2 left-2",children:s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-500 text-white shadow-lg",children:"Recovery"})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:p.name||"Unnamed NFT"}),p.description&&s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:p.description}),s.jsxs("div",{className:"space-y-1 text-xs text-gray-500 dark:text-gray-500",children:[s.jsxs("p",{className:"truncate",title:p.mintAddress,children:[s.jsx("span",{className:"font-medium",children:"Mint:"})," ",p.mintAddress.slice(0,8),"..."]}),s.jsxs("p",{className:"truncate",title:p.collectionAddress,children:[s.jsx("span",{className:"font-medium",children:"Collection:"})," ",p.collectionAddress.slice(0,8),"..."]})]})]}),s.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex items-center text-xs text-orange-600 dark:text-orange-400",children:[s.jsx(on,{className:"h-3 w-3 mr-1"}),s.jsx("span",{className:"font-medium",children:"Can be returned to IC"})]})})]},p.mintAddress))}):s.jsx("div",{className:"space-y-6",children:Array.from(Y.entries()).map(([p,O])=>s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:p==="uncategorized"?"Uncategorized":`Collection ${p.slice(0,8)}...`}),s.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[O.length," NFT",O.length!==1?"s":""]})]}),p!=="uncategorized"&&s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 font-mono",title:p,children:p})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:O.map(R=>s.jsxs("button",{onClick:()=>J(R),className:be("relative group rounded-lg border-2 p-4 text-left transition-all","hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-cyan-500",(c==null?void 0:c.mintAddress)===R.mintAddress?"border-cyan-500 bg-cyan-50 dark:bg-cyan-950":"border-gray-200 dark:border-gray-700 hover:border-cyan-300 dark:hover:border-cyan-700"),children:[(c==null?void 0:c.mintAddress)===R.mintAddress&&s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("div",{className:"h-6 w-6 rounded-full bg-cyan-500 flex items-center justify-center",children:s.jsx(on,{className:"h-4 w-4 text-white"})})}),s.jsx("div",{className:"aspect-square rounded-lg bg-gray-100 dark:bg-gray-800 mb-3 overflow-hidden",children:R.image?s.jsx("img",{src:R.image,alt:R.name||"NFT",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(on,{className:"h-12 w-12 text-gray-400"})})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:R.name||"Unnamed NFT"}),s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 truncate",title:R.mintAddress,children:[R.mintAddress.slice(0,8),"..."]})]})]},R.mintAddress))})]},p))}),!u&&!m&&b.length>0&&s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500 text-center",children:["Showing ",b.length," NFT",b.length!==1?"s":""," from orchestrator-controlled collections"]})]})}var Kw={};const Yw=1000000000n,Zw=5000n,Xw=2040000n,Lw=100000000000n;function Dw({selectedNFT:e,costs:t,onCostsCalculated:n,compact:r=!1,isConnected:a,walletPublicKey:o,connection:i}){const[c,l]=x.useState(!1),[u,d]=x.useState(null),[m,f]=x.useState(""),[g,N]=x.useState(null),[h,C]=x.useState(null),[w,B]=x.useState(!1),[j,Q]=x.useState(!1),{user:F}=ut(),_=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),M=Kw.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",k=js(M),K=F!=null&&F.principal?{owner:typeof F.principal=="string"?qe.fromText(F.principal):F.principal,subaccount:[]}:void 0,V=k.useBalance(K),T=oa(t==null?void 0:t.icMintCost),ee=p=>`${(Number(p)/1e12).toFixed(2)} T`,J=p=>`${(Number(p)/Number(Yw)).toFixed(6)} SOL`,pe=p=>g?g>=p:!1;x.useEffect(()=>{V.data!==void 0&&N(V.data)},[V.data]),x.useEffect(()=>{if(T.data&&(t!=null&&t.icMintCost)){const p={amount:T.data.allowance,isExpired:T.data.isExpired,isSufficient:T.data.allowance>=t.icMintCost};C(p);const O=p.isSufficient&&!p.isExpired;B(O)}},[T.data,t==null?void 0:t.icMintCost]);const E=async()=>{if(!(t!=null&&t.icMintCost)||!(F!=null&&F.principal)){d("Missing required information for payment approval");return}Q(!0),d(null);try{if(console.log("ðŸ§® Approving cycles payment for Solana burn:",{icMintCost:t.icMintCost.toString(),userPrincipal:F.principal.toString()}),g!==null&&g<t.icMintCost)throw new Error(`Insufficient cycles balance. You have ${ee(g)} but need ${ee(t.icMintCost)}. Please deposit more cycles to your account.`);const p=qe.fromText("jio3a-xaaaa-aaaal-ab66q-cai"),O=BigInt(Date.now()*1e6+1440*60*1e9);await _.cyclesApprove.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:t.icMintCost,expected_allowance:[],expires_at:[O],spender:{owner:p,subaccount:[]}}),console.log("âœ… Cycles approval successful for Solana burn"),B(!0),await T.refetch()}catch(p){console.error("âŒ Error approving cycles payment:",p);let O="Failed to approve cycles payment";p instanceof Error&&(p.message.includes("user rejected")?O="Payment approval cancelled by user":p.message.includes("insufficient funds")?O="Insufficient cycles for approval transaction":(p.message.includes("Insufficient cycles balance"),O=p.message)),d(O)}finally{Q(!1)}};x.useEffect(()=>{e&&!t&&!c&&b()},[e,t]);const b=async()=>{if(!e||!(F!=null&&F.principal)){d("Missing required information for cost calculation");return}if(!o||!a){d("Solana wallet must be connected for cost calculation");return}if(!i){d("Solana connection not available");return}l(!0),d(null);try{console.log("ðŸ§® Calculating burn costs for Solana NFT:",e),f("Finding ckNFT canister for Solana collection...");const p={contract:e.collectionAddress,network:So(e.cluster)};console.log("ðŸ” Looking for ckNFT canister with contract pointer:",p);const O=await _.getCkNFTCanister.mutateAsync([p]);if(!O||O.length===0||!O[0])throw new Error(`No ckNFT canister found for Solana collection ${e.collectionAddress}. This collection needs to be imported first using the Import wizard. Go to the Import tab to create a ckNFT canister for this collection before burning NFTs.`);const R=O[0];console.log("âœ… Found ckNFT canister:",R.toString()),f("Getting approval address for burn operation..."),console.log("ðŸ”‘ Getting approval address...");const q=new Ve(e.mintAddress).toBytes();let v=0n;for(let G=0;G<q.length;G++)v=v<<8n|BigInt(q[G]);console.log("ðŸ”¢ Converting NFT mint to tokenId for approval address..."),console.log("   NFT mint address:",e.mintAddress),console.log("   As Nat tokenId:",v);const U={account:{owner:typeof F.principal=="string"?qe.fromText(F.principal):F.principal,subaccount:[]},remoteNFTPointer:{tokenId:v,contract:e.collectionAddress,network:So(e.cluster)}},S=await _.getApprovalAddress.mutateAsync({request:U});if(!S)throw new Error("Failed to get approval address for burn operation");console.log("âœ… Got approval address for burn:",S),f("Calculating SOL transfer costs..."),console.log("ðŸ’° Calculating SOL transfer costs...");const H=new Ve(o),he=new Ve(e.mintAddress),$=new Ve(S),W=await Lr(he,H,!1,ns,sn),le=await Lr(he,$,!1,ns,sn),ce=await i.getAccountInfo(le),L=!ce;console.log("ðŸ“¦ Token account analysis:",{userTokenAccount:W.toBase58(),approvalTokenAccount:le.toBase58(),approvalAccountExists:!!ce,needsAtaCreation:L});const ue=Zw,re=L?Xw:0n,se=ue+re;console.log("ðŸ’° SOL cost breakdown:",{transferFee:J(ue),ataCreationFee:J(re),totalCost:J(se)}),f("Checking SOL balance..."),console.log("ðŸ’° Checking user SOL balance...");const Ne=BigInt(await i.getBalance(H)),ge=Ne<se;console.log("ðŸ’° User SOL balance check:",{userAddress:o,userBalance:J(Ne),requiredForTransfer:J(se),hasSufficientBalance:!ge}),f("Calculating IC mint cost..."),console.log("ðŸ’° Calculating IC mint cost...");const ne=Lw;console.log("âœ… IC mint cost estimated:",ee(ne));const ye={solTransferFee:ue,solAtaCreationFee:re,totalSolCost:se,icMintCost:ne,approvalAddress:S,userSolBalance:Ne,hasInsufficientSolBalance:ge,ckNFTCanisterId:R,nftMintAddress:e.mintAddress};console.log("âœ… Final burn costs calculated:",{totalSolCost:J(ye.totalSolCost),icMintCost:ee(ye.icMintCost),approvalAddress:ye.approvalAddress,hasInsufficientSolBalance:ye.hasInsufficientSolBalance}),f(""),n(ye)}catch(p){console.error("âŒ Error calculating burn costs:",p);let O="Failed to calculate burn costs";p instanceof Error&&(p.message.includes("user rejected")?O="Cost calculation cancelled by user":(p.message.includes("No ckNFT canister found"),O=p.message)),d(O),f("")}finally{l(!1)}},Y=()=>{d(null),b()};return r&&t?s.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-4 h-4 text-green-600 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-green-800",children:"Burn costs calculated"})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Calculate Burn Costs"}),s.jsx("p",{className:"text-gray-600",children:"Review the costs for returning your Solana NFT back to the Internet Computer."})]}),u&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-3 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-red-800",children:u}),s.jsx("button",{onClick:Y,className:"mt-2 text-sm text-red-700 hover:text-red-800 underline",children:"Try again"})]})]})}),c&&s.jsxs("div",{className:"p-6 text-center",children:[s.jsx(Qe,{className:"w-6 h-6 animate-spin mx-auto mb-3 text-blue-600"}),s.jsx("p",{className:"text-gray-600",children:"Calculating burn costs..."}),m&&s.jsx("p",{className:"text-sm text-blue-600 mt-1 font-medium",children:m}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"This may take a moment while we query the orchestrator and Solana network"})]}),t&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("span",{className:"font-medium text-purple-800",children:"SOL Transfer Cost"}),s.jsx("span",{className:"text-purple-700 font-mono text-sm",children:J(t.totalSolCost)})]}),s.jsxs("div",{className:"text-xs text-purple-600 space-y-1",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Transfer Fee:"}),s.jsx("span",{className:"font-mono",children:J(t.solTransferFee)})]}),t.solAtaCreationFee>0n&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"ATA Creation:"}),s.jsx("span",{className:"font-mono",children:J(t.solAtaCreationFee)})]})]}),s.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"SOL fees for transferring NFT to approval address"})]}),s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("span",{className:"font-medium text-blue-800",children:"IC Mint Cost"}),s.jsx("span",{className:"text-blue-700 font-mono text-sm",children:ee(t.icMintCost)})]}),s.jsx("p",{className:"text-xs text-blue-600",children:"Cycles for reminting ckNFT on Internet Computer"})]}),s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("span",{className:"font-medium text-green-800",children:"Your SOL Balance"}),s.jsx("div",{className:"text-right",children:t.userSolBalance!==void 0?s.jsx("span",{className:be("font-mono text-sm block",t.hasInsufficientSolBalance?"text-red-700":"text-green-700"),children:J(t.userSolBalance)}):s.jsx("span",{className:"text-gray-500 text-sm",children:"Unknown"})})]}),s.jsxs("div",{className:"text-xs",children:[s.jsxs("div",{className:"text-green-600 mb-1",children:["Address: ",o==null?void 0:o.slice(0,4),"...",o==null?void 0:o.slice(-4)]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-green-600",children:"Status:"}),t.userSolBalance!==void 0?s.jsx("span",{className:be("font-medium",t.hasInsufficientSolBalance?"text-red-600":"text-green-600"),children:t.hasInsufficientSolBalance?"Insufficient":"Sufficient"}):s.jsx("span",{className:"text-gray-500",children:"Checking..."})]})]})]})]}),t.hasInsufficientSolBalance&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-2"}),s.jsx("span",{className:"font-medium text-red-800",children:"Insufficient SOL for Transfer Fees"})]}),s.jsxs("p",{className:"text-sm text-red-700",children:["You need ",J(t.totalSolCost)," SOL for transfer fees but only have"," ",t.userSolBalance?J(t.userSolBalance):"0 SOL",".",s.jsx("br",{}),s.jsxs("span",{className:"text-xs text-red-600 font-mono block mt-1",children:["Your Address: ",o]}),s.jsx("br",{}),"Please deposit"," ",t.userSolBalance?J(t.totalSolCost-t.userSolBalance):J(t.totalSolCost)," ","SOL to your wallet before proceeding."]}),s.jsxs("div",{className:"mt-3 flex space-x-2",children:[s.jsx("button",{onClick:()=>navigator.clipboard.writeText(o||""),className:"px-3 py-1 text-xs font-medium text-red-700 bg-red-100 rounded-md hover:bg-red-200 transition-colors",children:"Copy Your Address"}),s.jsx("button",{onClick:()=>Y(),className:"px-3 py-1 text-xs font-medium text-red-700 bg-red-100 rounded-md hover:bg-red-200 transition-colors",children:"Refresh Balance"})]})]}),e&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Selected NFT"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Name:"}),s.jsx("span",{className:"font-medium text-gray-800",children:e.name||"Unknown NFT"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Collection:"}),s.jsxs("span",{className:"font-mono text-gray-800 text-xs",children:[e.collectionAddress.slice(0,4),"...",e.collectionAddress.slice(-4)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Mint Address:"}),s.jsxs("span",{className:"font-mono text-gray-800 text-xs",children:[e.mintAddress.slice(0,4),"...",e.mintAddress.slice(-4)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"ckNFT Canister:"}),s.jsx("span",{className:"font-mono text-gray-800 text-xs",children:t.ckNFTCanisterId.toString()})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Approval Address:"}),s.jsxs("span",{className:"font-mono text-gray-800 text-xs",children:[t.approvalAddress.slice(0,4),"...",t.approvalAddress.slice(-4)]})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Cycles Payment Approval"}),s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(na,{className:"w-5 h-5 text-gray-600 mr-2"}),s.jsx("h5",{className:"font-medium text-gray-900",children:"Your Cycles Balance"})]}),V.isLoading?s.jsx(Qe,{className:"w-4 h-4 animate-spin text-gray-500"}):s.jsx("span",{className:be("font-medium",g!==null&&g>=t.icMintCost?"text-green-600":"text-red-600"),children:g!==null?ee(g):"Unknown"})]}),g!==null&&s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-gray-600",children:"Required:"}),s.jsx("span",{className:"text-gray-900",children:ee(t.icMintCost)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Remaining after burn:"}),s.jsx("span",{className:be("font-medium",g>=t.icMintCost?"text-green-600":"text-red-600"),children:g>=t.icMintCost?ee(g-t.icMintCost):"Insufficient Balance"})]})]}),g!==null&&g<t.icMintCost&&s.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-md",children:s.jsxs("p",{className:"text-sm text-red-700",children:["âš ï¸ Insufficient cycles balance. Please deposit"," ",ee(t.icMintCost-g)," more."]})})]}),h&&s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(sa,{className:"w-5 h-5 text-blue-600 mr-2"}),s.jsx("h5",{className:"font-medium text-blue-900",children:"Current Allowance"})]}),s.jsx("span",{className:be("font-medium",h.isSufficient&&!h.isExpired?"text-green-600":"text-orange-600"),children:ee(h.amount)})]}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-blue-600",children:"Status:"}),s.jsx("span",{className:be("font-medium",h.isSufficient&&!h.isExpired?"text-green-600":"text-orange-600"),children:h.isExpired?"Expired":h.isSufficient?"Sufficient":"Insufficient"})]}),h.isExpired&&s.jsx("p",{className:"text-orange-700 text-xs",children:"Your previous allowance has expired. A new approval is required."}),!h.isSufficient&&!h.isExpired&&s.jsx("p",{className:"text-orange-700 text-xs",children:"Your current allowance is insufficient for this burn operation."})]})]}),w?s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(gt,{className:"w-5 h-5 text-green-600 mr-2"}),s.jsx("span",{className:"font-medium text-green-800",children:"Payment Approved"})]}),s.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Cycles approved for burn operation. You can now proceed with the burn."}),s.jsxs("div",{className:"mt-2 text-xs text-green-600",children:["Approved: ",h?ee(h.amount):"Unknown amount"]})]}):s.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Approve Cycles Payment"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Authorize the orchestrator to use ",ee(t.icMintCost)," for this burn"]})]}),s.jsx("button",{onClick:E,disabled:j||V.isLoading||g!==null&&g<t.icMintCost,className:be("px-6 py-2 rounded-md font-medium transition-colors",j||V.isLoading||g!==null&&g<t.icMintCost?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:j?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Approving..."]}):V.isLoading?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Checking Balance..."]}):"Approve Payment"})]}),s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsx("p",{className:"mb-1",children:"This will:"}),s.jsxs("ul",{className:"list-disc list-inside text-xs space-y-0.5 ml-2",children:[s.jsxs("li",{children:["Authorize the orchestrator to spend ",ee(t.icMintCost)," from your account"]}),s.jsx("li",{children:"Enable the burn operation to proceed"}),s.jsx("li",{children:"Set approval to expire in 24 hours for security"})]})]}),g!==null&&g<t.icMintCost&&s.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-700",children:"âš ï¸ Insufficient cycles balance. Please deposit more cycles before approving."})})]}),g!==null&&!pe(t.icMintCost)&&s.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("p",{className:"text-sm text-blue-800 mb-2",children:[s.jsx("strong",{children:"Need more cycles?"})," You can top up your cycles balance by:"]}),s.jsxs("ul",{className:"text-xs text-blue-700 space-y-1 ml-4 list-disc",children:[s.jsx("li",{children:"Converting ICP to cycles using the NNS dapp"}),s.jsx("li",{children:"Using the cycles faucet (if available)"}),s.jsx("li",{children:"Purchasing cycles directly from the Network Nervous System"})]})]})]}),w&&!t.hasInsufficientSolBalance&&s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-green-900",children:"Ready to Proceed"}),s.jsx("p",{className:"text-sm text-green-600",children:"Costs calculated and payment approved. Go to the Burn tab to execute the burn."})]}),s.jsx(gt,{className:"w-8 h-8 text-green-600"})]}),s.jsxs("div",{className:"text-sm text-green-600",children:[s.jsx("p",{className:"mb-1",children:"Next steps:"}),s.jsxs("ul",{className:"list-disc list-inside text-xs space-y-0.5 ml-2",children:[s.jsx("li",{children:"Navigate to the Burn Transaction tab"}),s.jsx("li",{children:"Review the transaction details"}),s.jsx("li",{children:"Execute the burn operation"})]})]})]}),s.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(_s,{className:"w-5 h-5 text-amber-600 mr-2 mt-0.5"}),s.jsx("div",{className:"flex-1",children:s.jsxs("p",{className:"text-sm text-amber-800",children:[s.jsx("strong",{children:"Burn Process:"})," You will transfer your Solana NFT to an approval address (paying SOL gas fees), then the orchestrator will detect the transfer and remint your ckNFT on the Internet Computer. This process is irreversible."]})})]})})]})]})}function e6({selectedNFT:e,burnCosts:t,progress:n,onProgressUpdate:r,onTransactionComplete:a,onError:o}){const{user:i}=ut(),{publicKey:c,connection:l,signTransaction:u}=os(),[d,m]=x.useState({stage:"idle",message:"Ready to begin burn process"}),f=x.useRef(!1),[g,N]=x.useState(!1),C=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),w=x.useCallback(F=>{try{const M=new Ve(F).toBytes();let k=0n;for(let K=0;K<M.length;K++)k=k<<8n|BigInt(M[K]);return k}catch(_){throw console.error("Failed to convert mint to Nat:",_),new Error("Invalid NFT mint address")}},[]),B=x.useCallback(async()=>{if(!e||!t||!c||!l||!u)throw new Error("Missing required data for transfer");if(console.log("ðŸ”„ Step 1: Transferring NFT to approval address..."),m({stage:"transferring",message:"Transferring NFT to approval address on Solana..."}),n){const F=mt(n,"transfer-to-approval",{status:"loading"});r(F)}try{const F=new Ve(e.mintAddress),_=new Ve(t.approvalAddress),M=await Lr(F,c,!1,ns,sn),k=await Lr(F,_,!1,ns,sn);console.log("ðŸ“¦ Token accounts:",{user:M.toBase58(),approval:k.toBase58()});const V=!await l.getAccountInfo(k),T=new wc;if(V){console.log("ðŸ“ Creating ATA for approval address...");const b=$d(c,k,_,F,ns,sn);T.add(b)}console.log("ðŸ“ Adding transfer instruction...");const ee=Vd(M,k,c,1,[],ns);T.add(ee);const{blockhash:J}=await l.getLatestBlockhash();T.recentBlockhash=J,T.feePayer=c,console.log("âœï¸ Signing transaction...");const pe=await u(T);console.log("ðŸ“¡ Sending transaction...");const E=await l.sendRawTransaction(pe.serialize());if(console.log("â³ Confirming transaction:",E),await l.confirmTransaction(E,"finalized"),console.log("âœ… Transfer complete:",E),n){const b=mt(n,"transfer-to-approval",{status:"completed",txHash:E});r(b)}return E}catch(F){if(console.error("âŒ Transfer failed:",F),n){const _=mt(n,"transfer-to-approval",{status:"failed",error:F.message});r(_)}throw new Error(`Transfer failed: ${F.message}`)}},[e,t,c,l,u,n,r]),j=x.useCallback(async F=>{if(!e||!t||!i)throw new Error("Missing required data for mint");if(console.log("ðŸ”„ Step 2: Calling orchestrator.mint() to return NFT to IC..."),m({stage:"minting",message:"Minting ckNFT back on Internet Computer...",solanaSignature:F}),n){const _=mt(n,"mint-on-ic",{status:"loading"});r(_)}try{const _=w(e.mintAddress);console.log("ðŸ“ž Calling orchestrator.mint()..."),console.log("  Collection:",e.collectionAddress),console.log("  Network:",e.cluster),console.log("  TokenId (Nat):",_);const M={contract:e.collectionAddress,network:So(e.cluster),tokenId:_},k={owner:i.principal,subaccount:[]},K={owner:i.principal,subaccount:[]},V={nft:M,resume:[],mintToAccount:k,spender:[]},T=await C.mintFromEVM.mutateAsync({request:V,spender:K,skipApproval:!1});if(console.log("ðŸ“‹ Mint result:",T),"Ok"in T){const ee=T.Ok;if(console.log("âœ… Mint request created:",ee),n){const J=mt(n,"mint-on-ic",{status:"completed",txHash:ee.toString()});r(J)}return ee.toString()}else if("Err"in T){const ee=JSON.stringify(T.Err);throw new Error(`Mint failed: ${ee}`)}else throw new Error("Mint failed with unknown error")}catch(_){if(console.error("âŒ Mint failed:",_),n){const M=mt(n,"mint-on-ic",{status:"failed",error:_.message});r(M)}throw new Error(`Mint failed: ${_.message}`)}},[e,t,i,w,C.mintFromEVM,n,r]),Q=x.useCallback(async()=>{if(!(f.current||g)){f.current=!0,N(!0);try{if(console.log("ðŸ” DEBUG: Starting burn execution"),console.log("  selectedNFT:",e),console.log("  isRecovery flag:",e==null?void 0:e.isRecovery),console.log("  Recovery mode active?",(e==null?void 0:e.isRecovery)===!0),n){const M=mt(n,"verify-connection",{status:"loading"});r(M)}if(!e||!t||!c||!i)throw new Error("Missing required connection or data");if(n){const M=mt(n,"verify-connection",{status:"completed"});r(M)}if(n){const M=mt(n,"get-approval-address",{status:"completed"});r(M)}let F;if(console.log("ðŸ” Checking recovery mode..."),console.log("  selectedNFT.isRecovery:",e.isRecovery),console.log("  Type:",typeof e.isRecovery),console.log("  Strict equality check:",e.isRecovery===!0),e.isRecovery){if(console.log("ðŸ”„ Recovery mode detected - skipping transfer step"),console.log("   NFT is already at approval address, proceeding directly to mint"),m({stage:"minting",message:"Recovery mode: NFT already transferred. Calling mint on IC..."}),F="recovery-mode-skip-transfer",n){const M=mt(n,"transfer-to-approval",{status:"completed"});r(M)}}else console.log("ðŸ”„ Normal mode detected - will transfer NFT"),F=await B();const _=await j(F);m({stage:"complete",message:"Burn complete! NFT returned to IC",solanaSignature:F,icTransactionHash:_}),a(F,_)}catch(F){console.error("âŒ Burn execution failed:",F),m({stage:"error",message:F.message,error:F.message}),o(F.message),f.current=!1}}},[g,e,t,c,i,l,n,r,B,j,a,o]);return x.useEffect(()=>{!g&&!f.current&&Q()},[Q,g]),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:be("w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",d.stage==="idle"&&"bg-gray-100",d.stage==="transferring"&&"bg-blue-100",d.stage==="minting"&&"bg-purple-100",d.stage==="complete"&&"bg-green-100",d.stage==="error"&&"bg-red-100"),children:[(d.stage==="idle"||d.stage==="transferring"||d.stage==="minting")&&s.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),d.stage==="complete"&&s.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),d.stage==="error"&&s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]}),s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:[d.stage==="idle"&&"Starting Burn Process...",d.stage==="transferring"&&"Transferring NFT",d.stage==="minting"&&"Minting on IC",d.stage==="complete"&&"Burn Complete!",d.stage==="error"&&"Burn Failed"]}),s.jsx("p",{className:"text-gray-600",children:d.message})]}),(d.solanaSignature||d.icTransactionHash)&&s.jsxs("div",{className:"space-y-3",children:[d.solanaSignature&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Solana Transfer Signature:"}),s.jsx("div",{className:"text-xs font-mono text-gray-800 break-all",children:d.solanaSignature})]}),d.icTransactionHash&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"IC Transaction Hash:"}),s.jsx("div",{className:"text-xs font-mono text-gray-800 break-all",children:d.icTransactionHash})]})]}),d.error&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800",children:d.error})}),e&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Burning NFT:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Mint:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:e.mintAddress})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Collection:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:e.collectionAddress})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Network:"}),s.jsx("div",{className:"text-xs",children:e.cluster})]})]})]})]})}function t6({result:e,onStartNew:t,onClose:n}){return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"text-center",children:e.success?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Burn Complete!"}),s.jsx("p",{className:"text-gray-600",children:"Your Solana NFT has been returned to the Internet Computer as a ckNFT."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Burn Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There was an error during the burn process."}),e.error&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800 font-mono",children:e.error})})]})}),e.success&&s.jsxs("div",{className:"space-y-3",children:[e.solanaSignature&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Solana Transfer Signature:"}),s.jsx("div",{className:"text-xs font-mono text-gray-800 break-all",children:e.solanaSignature})]}),e.icTransactionHash&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"IC Transaction Hash:"}),s.jsx("div",{className:"text-xs font-mono text-gray-800 break-all",children:e.icTransactionHash})]}),e.ckNFTCanisterId&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ckNFT Canister:"}),s.jsx("div",{className:"text-xs font-mono text-gray-800",children:e.ckNFTCanisterId})]})]}),s.jsxs("div",{className:"flex space-x-3",children:[e.success&&s.jsx("button",{onClick:t,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Burn Another NFT"}),s.jsx("button",{onClick:n,className:be("px-6 py-3 rounded-lg font-medium transition-colors",e.success?"flex-1 bg-gray-100 text-gray-700 hover:bg-gray-200":"w-full bg-blue-600 text-white hover:bg-blue-700"),children:"Close"})]})]})}function S0({cluster:e="devnet",sourceMintAddress:t,sourceCollectionAddress:n,onComplete:r,onCancel:a,className:o,modal:i=!0,mockBurnResult:c}){var q;const[l,u]=x.useState("connect"),[d,m]=x.useState(null),[f,g]=x.useState(null),[N,h]=x.useState(null),[C,w]=x.useState(c||null),[B,j]=x.useState(e||"devnet"),{publicKey:Q,connected:F,connection:_}=os(),{user:M}=ut();x.useEffect(()=>{t&&n&&m({mintAddress:t,collectionAddress:n,cluster:B,name:`NFT ${t.slice(0,4)}...${t.slice(-4)}`})},[t,n,B]);const k=[{id:"connect",title:"Connect",description:"Connect Solana wallet & IC"},{id:"select-nft",title:"Select NFT",description:"Choose NFT to burn"},{id:"costs",title:"Costs",description:"Review burn costs"},{id:"burn",title:"Burn",description:"Execute burn & mint"},{id:"complete",title:"Complete",description:"Burn summary"}],K=k.findIndex(v=>v.id===l),V=x.useCallback(v=>{const U=aa(v,[{id:"verify-connection",title:"Verify Connection",description:"Checking Solana wallet and IC authentication",stage:"setup"},{id:"get-approval-address",title:"Get Approval Address",description:"Deriving approval address for NFT return",stage:"setup"},{id:"transfer-to-approval",title:"Transfer to Approval Address",description:"Transferring NFT to approval address on Solana",stage:"execution"},{id:"mint-on-ic",title:"Mint ckNFT on IC",description:"Calling orchestrator.mint() to return ckNFT",stage:"execution"}]);return h(U),U},[]),T=x.useCallback((v,U,S,H)=>{h(he=>he?mt(he,v,{status:U,error:S,txHash:H}):null)},[]),ee=x.useCallback(()=>{switch(l){case"connect":return F&&Q&&M;case"select-nft":return d!==null;case"costs":return f!==null&&f.userSolBalance!==void 0&&!f.hasInsufficientSolBalance;case"burn":return(C==null?void 0:C.success)===!0;default:return!1}},[l,F,Q,M,d,f,C]);console.log("ðŸ” SolanaBurnWizard canGoNext analysis:",{currentStep:l,connected:F,publicKey:!!Q,user:!!M,selectedNFT:!!d,burnCosts:!!f,hasSufficientSOL:f?!f.hasInsufficientSolBalance:!1,burnResultSuccess:C==null?void 0:C.success,canGoNext:ee()});const J=x.useCallback((v,U)=>{console.log("ðŸŽ‰ Burn transaction completed:",{solanaSignature:v,icTxHash:U}),w({success:!0,solanaSignature:v,icTransactionHash:U,ckNFTCanisterId:f==null?void 0:f.ckNFTCanisterId.toString()}),T("transfer-to-approval","completed",void 0,v),T("mint-on-ic","completed",void 0,U),u("complete"),r==null||r({success:!0,solanaSignature:v,icTransactionHash:U,ckNFTCanisterId:f==null?void 0:f.ckNFTCanisterId.toString()})},[T,r,f]),pe=x.useCallback((v,U)=>{console.error("âŒ Burn transaction failed:",v),w({success:!1,error:v}),U&&T(U,"failed",v),r==null||r({success:!1,error:v})},[T,r]),E=x.useMemo(()=>!!(N!=null&&N.steps&&N.steps.some(U=>U.status==="failed")||C&&!C.success),[N,C]);x.useEffect(()=>{C!=null&&C.success&&l!=="complete"&&(console.log("ðŸŽ‰ Burn completed successfully, advancing to complete step"),u("complete"))},[C,l]);const b=K>0&&(l!=="burn"&&l!=="complete"||E),Y=x.useCallback(()=>{if(!ee())return;const v=K+1;v<k.length&&u(k[v].id)},[K,ee,k]),p=x.useCallback(()=>{if(!b)return;const v=K-1;v>=0&&u(k[v].id)},[K,b,k]),O=()=>{switch(l){case"connect":return s.jsxs("div",{className:"space-y-6",children:[s.jsx(Pd,{selectedTargetCluster:B,onTargetClusterChange:v=>{console.log("Target cluster changed:",v),j(v)}}),F&&Q&&M&&s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-5 h-5 text-green-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-green-900",children:"Ready to Burn"}),s.jsx("div",{className:"text-sm text-green-700",children:"Solana wallet and IC account connected"})]})]})})]});case"select-nft":return s.jsx(Jw,{cluster:B,onSelectionChange:m});case"costs":return s.jsx(Dw,{selectedNFT:d,costs:f,onCostsCalculated:g,isConnected:F,walletPublicKey:Q==null?void 0:Q.toBase58(),connection:_});case"burn":return s.jsx(e6,{selectedNFT:d,burnCosts:f,progress:N,onProgressUpdate:h,onTransactionComplete:J,onError:pe});case"complete":return C?s.jsx(t6,{result:C,onStartNew:()=>{u("connect"),m(null),g(null),w(null),V("solana-to-ic")},onClose:()=>a==null?void 0:a()}):null;default:return null}},R=s.jsxs("div",{className:be("bg-white rounded-lg shadow-lg",i&&"max-w-4xl mx-auto",o),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Burn Solana NFT"}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Step ",K+1," of ",k.length,": ",(q=k[K])==null?void 0:q.description]})]}),a&&s.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(ra,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"px-6 py-4 border-b border-gray-100",children:s.jsx("div",{className:"flex items-center justify-between",children:k.map((v,U)=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:be("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",U<K?"bg-green-100 text-green-800":U===K?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-500"),children:U+1}),s.jsx("span",{className:be("ml-2 text-sm font-medium",U<=K?"text-gray-900":"text-gray-500"),children:v.title}),U<k.length-1&&s.jsx("div",{className:be("w-8 h-px mx-4",U<K?"bg-green-300":"bg-gray-300")})]},v.id))})}),s.jsx("div",{className:"p-6",children:O()}),l!=="complete"&&s.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[s.jsxs("button",{onClick:p,disabled:!b,className:be("flex items-center px-4 py-2 rounded-lg font-medium transition-colors",b?"text-gray-700 hover:bg-gray-200":"text-gray-400 cursor-not-allowed"),children:[s.jsx(ta,{className:"w-5 h-5 mr-1"}),"Back"]}),s.jsxs("button",{onClick:Y,disabled:!ee(),className:be("flex items-center px-6 py-2 rounded-lg font-medium transition-colors",ee()?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:["Next",s.jsx(Is,{className:"w-5 h-5 ml-1"})]})]})]});return i?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:R}):R}var s6={};const n6=BigInt(In),r6=5000n,ha=10000000n,a6=2500000000000n;function o6({selectedNFT:e,costs:t,onCostsCalculated:n,compact:r=!1,isConnected:a,walletPublicKey:o,connection:i,sendTransaction:c,targetSolanaAddress:l}){const[u,d]=x.useState(!1),[m,f]=x.useState(null),[g,N]=x.useState(""),[h,C]=x.useState(null),[w,B]=x.useState(null),[j,Q]=x.useState(!1),[F,_]=x.useState(!1),[M,k]=x.useState(!1),[K,V]=x.useState(null),[T,ee]=x.useState(null),{user:J}=ut(),pe=Vt("jio3a-xaaaa-aaaal-ab66q-cai"),E=s6.CYCLES_LEDGER_CANISTER_ID||"um5iw-rqaaa-aaaaq-qaaba-cai",b=js(E),Y=J!=null&&J.principal?{owner:typeof J.principal=="string"?qe.fromText(J.principal):J.principal,subaccount:[]}:void 0,p=b.useBalance(Y),O=x.useMemo(()=>{if(!(!(J!=null&&J.principal)||!(t!=null&&t.ckNFTCanisterId)))return{account:{owner:J.principal,subaccount:[]},spender:{owner:t.ckNFTCanisterId,subaccount:[]}}},[J==null?void 0:J.principal,t==null?void 0:t.ckNFTCanisterId]),R=b.useAllowance(O),q=$=>`${(Number($)/1e12).toFixed(2)} T`,v=$=>`${(Number($)/Number(n6)).toFixed(6)} SOL`;x.useEffect(()=>{p.data!==void 0&&C(p.data)},[p.data]),x.useEffect(()=>{if(R.data&&(t!=null&&t.castCycleCost)){const $=BigInt(Date.now()*1e6),W=R.data.expires_at.length>0&&R.data.expires_at[0]?R.data.expires_at[0]<$:!1,le={amount:R.data.allowance,isExpired:W,isSufficient:R.data.allowance>=t.castCycleCost};B(le);const ce=le.isSufficient&&!le.isExpired;Q(ce)}},[R.data,t==null?void 0:t.castCycleCost]);const U=async()=>{if(!(t!=null&&t.castCycleCost)||!(t!=null&&t.ckNFTCanisterId)||!(J!=null&&J.principal)){f("Missing required information for payment approval");return}_(!0),f(null);try{if(console.log("ðŸ§® Approving cycles payment for Solana return/cast:",{castCycleCost:t.castCycleCost.toString(),ckNFTCanisterId:t.ckNFTCanisterId.toString(),userPrincipal:J.principal.toString()}),h!==null&&h<t.castCycleCost)throw new Error(`Insufficient cycles balance. You have ${q(h)} but need ${q(t.castCycleCost)}. Please deposit more cycles to your account.`);const $=t.ckNFTCanisterId,W=BigInt(Date.now()*1e6+1440*60*1e9);console.log("ðŸ”‘ Approving cycles for ckNFT canister (NOT orchestrator):",$.toString()),await pe.cyclesApprove.mutateAsync({fee:[],memo:[],from_subaccount:[],created_at_time:[],amount:t.castCycleCost,expected_allowance:[],expires_at:[W],spender:{owner:$,subaccount:[]}}),console.log("âœ… Cycles approval successful for Solana return/cast"),Q(!0),await R.refetch()}catch($){console.error("âŒ Error approving cycles payment:",$);let W="Failed to approve cycles payment";$ instanceof Error&&($.message.includes("user rejected")?W="Payment approval cancelled by user":$.message.includes("insufficient funds")?W="Insufficient cycles for approval transaction":($.message.includes("Insufficient cycles balance"),W=$.message)),f(W)}finally{_(!1)}},S=async()=>{if(!(t!=null&&t.castSignerAddress)||!c||!i||!o||!a){f("Missing required information for funding cast signer");return}k(!0),ee(null);try{console.log("ðŸ’° Funding cast signer address:",{address:t.castSignerAddress,amount:v(ha),from:o});const $=new wc().add(ad.transfer({fromPubkey:new Ve(o),toPubkey:new Ve(t.castSignerAddress),lamports:Number(ha)})),{blockhash:W}=await i.getLatestBlockhash();$.recentBlockhash=W,$.feePayer=new Ve(o);const le=await c($);console.log("ðŸ“¤ Transaction sent:",le),await i.confirmTransaction(le,"confirmed"),console.log("âœ… Transaction confirmed:",le),V(le);const ce=await i.getBalance(new Ve(t.castSignerAddress));n({...t,castSignerBalance:BigInt(ce),needsCastSignerFunding:BigInt(ce)<ha}),console.log("ðŸ’° Cast signer balance updated:",v(BigInt(ce)))}catch($){console.error("âŒ Failed to fund cast signer:",$);let W="Failed to fund cast signer address";$ instanceof Error&&($.message.includes("user rejected")?W="Funding transaction cancelled by user":W=$.message),ee(W)}finally{k(!1)}};x.useEffect(()=>{e&&!t&&!u&&H()},[e,t,l]);const H=async()=>{if(!e||!(J!=null&&J.principal)){f("Missing required information for cost calculation");return}if(!o||!a){f("Solana wallet must be connected for cost calculation");return}if(!i){f("Solana connection not available");return}if(!l){f("Target Solana address must be specified");return}d(!0),f(null);try{console.log("ðŸ§® Calculating return costs for ckNFT:",e),N("Querying native chain information from ckNFT canister...");const $=qe.fromText(e.canisterId),W=BigInt(e.tokenId);console.log("ðŸ“– Querying ckNFT canister:",{canisterId:$.toString(),tokenId:W.toString()});const le=new nd({host:"https://icp0.io"}),ce=ea.createActor(Ms,{agent:le,canisterId:$}),L=await ce.icrc99_native_chain();if(!L)throw new Error("Failed to retrieve native chain information from ckNFT canister");console.log("ï¿½ Native chain pointer:",L);const ue=L.network,re=L.contract;if(!ue)throw new Error("Native chain network not found in RemoteContractPointer");if(!re)throw new Error("Native contract address not found in RemoteContractPointer. This ckNFT may not be a wrapped Solana NFT.");console.log("âœ… Native chain information:",{nativeChain:ue,nativeContract:re}),N("Querying cast cost from ckNFT canister..."),console.log("ðŸ’° Querying cast cost...");let se=a6;try{const Z=await ce.icrc99_cast_cost({contract:re,network:ue,tokenId:W});Z&&(se=BigInt(Z),console.log("âœ… Cast cost from canister:",q(se)))}catch(Z){console.warn("âš ï¸ Failed to query cast cost, using estimate:",Z)}N("Getting burn funding address from orchestrator..."),console.log("ðŸ”‘ Getting burn funding address for cast operation...");let Ne,ge;try{const Z=await pe.getBurnFundingAddress.mutateAsync({ckNFTCanisterId:$,tokenId:W});console.log("ðŸ“‹ Burn funding address result:",Z),Z&&(Ne=Z,console.log("âœ… Burn funding address from orchestrator:",Ne))}catch(Z){console.warn("âš ï¸ Failed to get burn funding address from orchestrator:",Z)}if(!Ne)throw new Error("Failed to get burn funding address from orchestrator. This Solana address is required to execute the cast (return) operation.");try{const Z=new Ve(Ne),de=await i.getBalance(Z);ge=BigInt(de),console.log("ðŸ’° Cast signer balance:",v(ge))}catch(Z){console.warn("âš ï¸ Failed to get cast signer balance:",Z)}N("Calculating Solana transaction costs..."),console.log("ðŸ’° Calculating Solana costs...");const ne=r6,ye=ha,G=!ge||ge<ye,P=G?ye-(ge||0n):0n,z=ne+P;console.log("ðŸ’° SOL cost breakdown:",{transferFee:v(ne),castSignerFunding:v(P),needsCastSignerFunding:G,totalCost:v(z)});const A={castCycleCost:se,solanaTransferFee:ne,castSignerFundingRequired:P,totalSolCost:z,castSignerAddress:Ne,castSignerBalance:ge,needsCastSignerFunding:G,ckNFTCanisterId:$,tokenId:W,nativeChain:ue,nativeContract:re};console.log("âœ… Final return costs calculated:",{castCycleCost:q(A.castCycleCost),totalSolCost:v(A.totalSolCost),needsCastSignerFunding:A.needsCastSignerFunding}),N(""),n(A)}catch($){console.error("âŒ Error calculating return costs:",$);let W="Failed to calculate return costs";$ instanceof Error&&(W=$.message),f(W),N("")}finally{d(!1)}},he=()=>{f(null),H()};return r&&t?s.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Go,{className:"w-4 h-4 text-green-600 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-green-800",children:"Return costs calculated"})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Calculate Return Costs"}),s.jsx("p",{className:"text-gray-600",children:"Review the costs for returning your ckNFT back to its original Solana chain."})]}),m&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(lt,{className:"w-5 h-5 text-red-600 mr-3 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-red-800",children:m}),s.jsx("button",{onClick:he,className:"mt-2 text-sm text-red-700 hover:text-red-800 underline",children:"Try again"})]})]})}),u&&s.jsxs("div",{className:"p-6 text-center",children:[s.jsx(Qe,{className:"w-6 h-6 animate-spin mx-auto mb-3 text-blue-600"}),s.jsx("p",{className:"text-gray-600",children:"Calculating return costs..."}),g&&s.jsx("p",{className:"text-sm text-blue-600 mt-1 font-medium",children:g}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"This may take a moment while we query the ckNFT canister and Solana network"})]}),t&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"p-4 bg-blue-50 border-2 border-blue-300 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(cg,{className:"w-5 h-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Cast Operation"}),s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("strong",{children:"Important:"})," For return operations, you approve the ",s.jsx("strong",{children:"ckNFT canister"}),"(not the orchestrator) to spend cycles. The ckNFT canister will burn your ckNFT and trigger the transfer of the original NFT back to your Solana wallet."]}),s.jsxs("p",{className:"text-xs text-blue-700 mt-2",children:["ckNFT Canister: ",s.jsx("span",{className:"font-mono",children:t.ckNFTCanisterId.toString()})]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("span",{className:"font-medium text-blue-800",children:"IC Cast Cost"}),s.jsx("span",{className:"text-blue-700 font-mono text-sm",children:q(t.castCycleCost)})]}),s.jsx("p",{className:"text-xs text-blue-600",children:"Cycles for burning ckNFT and unlocking original NFT on Solana"})]}),s.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("span",{className:"font-medium text-purple-800",children:"Solana Costs"}),s.jsx("span",{className:"text-purple-700 font-mono text-sm",children:v(t.totalSolCost)})]}),s.jsxs("div",{className:"text-xs text-purple-600 space-y-1",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Transfer Fee:"}),s.jsx("span",{className:"font-mono",children:v(t.solanaTransferFee)})]}),t.needsCastSignerFunding&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Cast Signer Funding:"}),s.jsx("span",{className:"font-mono",children:v(t.castSignerFundingRequired)})]})]}),s.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"SOL fees for executing the return transaction"})]})]}),t.castSignerAddress&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Cast Signer Information"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Signer Address:"}),s.jsxs("span",{className:"font-mono text-gray-800 text-xs",children:[t.castSignerAddress.slice(0,8),"...",t.castSignerAddress.slice(-8)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Current Balance:"}),s.jsx("span",{className:be("font-mono text-xs",t.needsCastSignerFunding?"text-red-700":"text-green-700"),children:t.castSignerBalance!==void 0?v(t.castSignerBalance):"Unknown"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Funding Status:"}),s.jsx("span",{className:be("font-medium text-xs",t.needsCastSignerFunding?"text-red-700":"text-green-700"),children:t.needsCastSignerFunding?`Needs ${v(t.castSignerFundingRequired)}`:"Sufficient"})]})]}),t.needsCastSignerFunding&&!K&&s.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:[s.jsxs("p",{className:"text-xs text-yellow-800 mb-3",children:["The cast signer address needs ",v(ha)," SOL to execute the return transaction. You can pre-fund this address now to ensure the transaction will succeed."]}),s.jsx("button",{onClick:S,disabled:M||!a||!c,className:be("w-full px-4 py-2 rounded-md text-sm font-medium transition-colors","flex items-center justify-center space-x-2",M||!a||!c?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-yellow-600 text-white hover:bg-yellow-700"),children:M?s.jsxs(s.Fragment,{children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin"}),s.jsx("span",{children:"Funding..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(ld,{className:"w-4 h-4"}),s.jsxs("span",{children:["Fund Cast Signer (",v(ha)," SOL)"]})]})}),T&&s.jsx("p",{className:"mt-2 text-xs text-red-600",children:T})]}),K&&s.jsx("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-md",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(Go,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs text-green-800 font-medium mb-1",children:"âœ… Cast signer funded successfully!"}),s.jsx("a",{href:`https://explorer.solana.com/tx/${K}?cluster=custom`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-700 underline break-all",children:"View transaction"})]})]})})]}),e&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Selected ckNFT"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Token ID:"}),s.jsx("span",{className:"font-mono text-gray-800 text-xs",children:e.tokenId})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"ckNFT Canister:"}),s.jsxs("span",{className:"font-mono text-gray-800 text-xs",children:[e.canisterId.slice(0,8),"...",e.canisterId.slice(-8)]})]}),t.nativeContract&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Native Collection:"}),s.jsxs("span",{className:"font-mono text-gray-800 text-xs",children:[t.nativeContract.slice(0,8),"...",t.nativeContract.slice(-8)]})]}),l&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Return To:"}),s.jsxs("span",{className:"font-mono text-gray-800 text-xs",children:[l.slice(0,8),"...",l.slice(-8)]})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Cycles Payment Approval"}),s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(na,{className:"w-5 h-5 text-gray-600 mr-2"}),s.jsx("h5",{className:"font-medium text-gray-900",children:"Your Cycles Balance"})]}),p.isLoading?s.jsx(Qe,{className:"w-4 h-4 animate-spin text-gray-500"}):s.jsx("span",{className:be("font-medium",h!==null&&h>=t.castCycleCost?"text-green-600":"text-red-600"),children:h!==null?q(h):"Unknown"})]}),h!==null&&s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"text-gray-600",children:"Required:"}),s.jsx("span",{className:"text-gray-900",children:q(t.castCycleCost)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Remaining after return:"}),s.jsx("span",{className:be("font-medium",h>=t.castCycleCost?"text-green-600":"text-red-600"),children:h>=t.castCycleCost?q(h-t.castCycleCost):"Insufficient Balance"})]})]}),h!==null&&h<t.castCycleCost&&s.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-md",children:s.jsxs("p",{className:"text-sm text-red-700",children:["âš ï¸ Insufficient cycles balance. Please deposit"," ",q(t.castCycleCost-h)," more."]})})]}),w&&s.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(sa,{className:"w-5 h-5 text-blue-600 mr-2"}),s.jsx("h5",{className:"font-medium text-blue-900",children:"Current Allowance (to ckNFT Canister)"})]}),s.jsx("span",{className:be("font-medium",w.isSufficient&&!w.isExpired?"text-green-600":"text-orange-600"),children:q(w.amount)})]}),s.jsx("div",{className:"text-sm space-y-1",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-blue-600",children:"Status:"}),s.jsx("span",{className:be("font-medium",w.isSufficient&&!w.isExpired?"text-green-600":"text-orange-600"),children:w.isExpired?"Expired":w.isSufficient?"Sufficient":"Insufficient"})]})})]}),j?s.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(Go,{className:"w-5 h-5 text-green-600 mr-2"}),s.jsx("span",{className:"font-medium text-green-800",children:"Payment Approved"})]}),s.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Cycles approved for cast operation. You can now proceed with the return."})]}):s.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-gray-900",children:"Approve Cycles Payment to ckNFT Canister"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Authorize the ckNFT canister to use ",q(t.castCycleCost)," for this return"]})]}),s.jsx("button",{onClick:U,disabled:F||p.isLoading||h!==null&&h<t.castCycleCost,className:be("px-6 py-2 rounded-md font-medium transition-colors whitespace-nowrap",F||p.isLoading||h!==null&&h<t.castCycleCost?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:F?s.jsxs("div",{className:"flex items-center",children:[s.jsx(Qe,{className:"w-4 h-4 animate-spin mr-2"}),"Approving..."]}):"Approve Payment"})]})})]}),j&&s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-green-900",children:"Ready to Proceed"}),s.jsx("p",{className:"text-sm text-green-600",children:"Costs calculated and payment approved. Go to the Return tab to execute the cast operation."})]}),s.jsx(Go,{className:"w-8 h-8 text-green-600"})]})}),s.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(_s,{className:"w-5 h-5 text-amber-600 mr-2 mt-0.5"}),s.jsx("div",{className:"flex-1",children:s.jsxs("p",{className:"text-sm text-amber-800",children:[s.jsx("strong",{children:"Return Process:"})," The ckNFT canister will burn your ckNFT on IC and transfer the original NFT from custody back to your Solana wallet. This operation is irreversible and the ckNFT will be destroyed."]})})]})})]})]})}function i6({selectedNFT:e,returnCosts:t,targetSolanaAddress:n,progress:r,onProgressUpdate:a,onComplete:o,onError:i}){const{user:c}=ut(),l=B0(),[u,d]=x.useState(!1),m=x.useRef(!1),f=x.useCallback(async()=>{var g;if(m.current||u||!l||!c){console.log("â¸ï¸ Skipping return execution:",{hasExecuted:m.current,isExecuting:u,hasAgent:!!l,hasUser:!!c});return}m.current=!0,d(!0),console.log("ðŸš€ Starting Solana return execution...");try{if(r){const M=mt(r,"verify-connection",{status:"loading"});a(M)}const N=ea.createActor(Ms,{agent:l,canisterId:e.canisterId});if(console.log("âœ… Created ckNFT actor for canister:",e.canisterId),r){const M=mt(r,"verify-connection",{status:"completed"});a(M)}if(r){const M=mt(r,"prepare-cast",{status:"loading"});a(M)}const h={tokenId:e.tokenId,fromSubaccount:[],remoteContract:{network:t.nativeChain,contract:t.nativeContract},targetOwner:n,memo:[],created_at_time:[],gasPrice:[],gasLimit:[],maxPriorityFeePerGas:[]};if(console.log("ðŸ“‹ Cast request prepared:",h),r){const M=mt(r,"prepare-cast",{status:"completed"});a(M)}if(r){const M=mt(r,"execute-cast",{status:"loading"});a(M)}const C=await N.icrc99_cast([h],[{owner:c.principal,subaccount:[]}]);if(console.log("ðŸŽ¯ Cast executed:",C),!C||C.length===0||!C[0]||C[0].length===0||!C[0][0])throw new Error("Cast request failed: No result returned");const w=C[0][0];if("Err"in w)throw new Error(`Cast request failed: ${JSON.stringify(w.Err)}`);const B=w.Ok;if(console.log("âœ… Cast request ID:",B),r){const M=mt(r,"execute-cast",{status:"completed"});a(M)}if(r){const M=mt(r,"monitor-status",{status:"loading"});a(M)}let j=!1,Q=0;const F=30;let _;for(;!j&&Q<F;){await new Promise(M=>setTimeout(M,1e4)),Q++,console.log(`â³ Checking cast status (attempt ${Q}/${F})...`);try{const M=await N.icrc99_cast_status([B],[]);if(M&&M.length>0){const k=M[0],K=k&&k[0];if(K){console.log("ðŸ“Š Cast state:",K);const V=K.status;if(V&&"Completed"in V){if(console.log("ðŸŽ‰ Cast completed successfully!",V.Completed),j=!0,K.history)for(const T of K.history){const[ee]=T;if(ee&&"WaitingOnTransfer"in ee&&(_=(g=ee.WaitingOnTransfer)==null?void 0:g.transaction,_)){console.log("ðŸ“ Solana transaction signature:",_);break}}break}else if(V&&("Error"in V||"Failed"in V)){let T="Unknown error";if("Error"in V){const ee=V.Error;ee&&"GenericError"in ee?T=`GenericError: ${ee.GenericError}`:T=JSON.stringify(ee)}else"Failed"in V&&(T=String(V.Failed));throw new Error(`Cast failed: ${T}`)}else console.log("â³ Cast still in progress, current status:",Object.keys(V)[0])}}}catch(M){console.warn("âš ï¸ Error checking cast status:",M)}}if(!j)throw new Error(`Cast did not complete after ${F} attempts (${F*10} seconds)`);if(r){const M=mt(r,"monitor-status",{status:"completed",txHash:_});a(M)}console.log("ðŸŽ‰ Return completed successfully!"),o(_),d(!1)}catch(N){console.error("âŒ Return execution failed:",N);const h=N instanceof Error?N.message:String(N);i(h,"execute-cast"),d(!1)}},[u,l,c,e,t,n,r,a,o,i]);return x.useEffect(()=>{u||f()},[]),null}function c6({result:e,onStartNew:t,onClose:n}){return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"text-center",children:e.success?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Return Complete!"}),s.jsx("p",{className:"text-gray-600",children:"Your ckNFT has been returned to Solana as the original NFT."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Return Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There was an error during the return process."}),e.error&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800 font-mono",children:e.error})})]})}),e.success&&s.jsxs("div",{className:"space-y-3",children:[e.solanaSignature&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Solana Signature:"}),s.jsx("div",{className:"text-xs font-mono text-gray-800 break-all",children:e.solanaSignature})]}),e.ckNFTCanisterId&&s.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ckNFT Canister:"}),s.jsx("div",{className:"text-xs font-mono text-gray-800",children:e.ckNFTCanisterId})]})]}),s.jsxs("div",{className:"flex space-x-3",children:[e.success&&s.jsx("button",{onClick:t,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Return Another NFT"}),s.jsx("button",{onClick:n,className:be("px-6 py-3 rounded-lg font-medium transition-colors",e.success?"flex-1 bg-gray-100 text-gray-700 hover:bg-gray-200":"w-full bg-blue-600 text-white hover:bg-blue-700"),children:"Close"})]})]})}function F0({ckNFTCanisterId:e,tokenId:t,onComplete:n,onCancel:r,className:a,modal:o=!0}){const[i,c]=x.useState("connect-ic"),[l,u]=x.useState(null),[d,m]=x.useState(null),[f,g]=x.useState(null),[N,h]=x.useState(null),[C,w]=x.useState(!1),{publicKey:B,connected:j,connection:Q,sendTransaction:F}=os(),{user:_}=ut(),M=[{id:"connect-ic",title:"Connect IC",description:"Connect IC wallet"},{id:"select-cknft",title:"Select ckNFT",description:"Choose ckNFT to return"},{id:"connect-solana",title:"Connect Solana",description:"Connect Solana wallet"},{id:"costs",title:"Costs",description:"Review return costs"},{id:"return",title:"Return",description:"Execute return"},{id:"complete",title:"Complete",description:"Return summary"}],k=M.findIndex(R=>R.id===i),K=x.useCallback(R=>{const q=aa(R,[{id:"verify-connection",title:"Verify Connection",description:"Checking Solana wallet and IC authentication",stage:"setup"},{id:"prepare-cast",title:"Prepare Cast Request",description:"Preparing cast operation parameters",stage:"setup"},{id:"execute-cast",title:"Execute Cast",description:"Calling icrc99_cast on ckNFT canister",stage:"execution"},{id:"monitor-status",title:"Monitor Cast Status",description:"Waiting for cast to complete on Solana",stage:"execution"}]);return g(q),q},[]),V=x.useCallback((R,q,v,U)=>{g(S=>S?mt(S,R,{status:q,error:v,txHash:U}):null)},[]),T=x.useCallback(()=>{switch(i){case"connect-ic":return _!==null;case"select-cknft":return l!==null;case"connect-solana":return j&&B!==null;case"costs":return d!==null&&d.castSignerAddress!==void 0&&!d.needsCastSignerFunding;case"return":return(N==null?void 0:N.success)===!0;default:return!1}},[i,_,l,j,B,d,N]),ee=x.useCallback(R=>{console.log("ðŸŽ‰ Return transaction completed:",{solanaSignature:R}),h({success:!0,solanaSignature:R,ckNFTCanisterId:l==null?void 0:l.canisterId,tokenId:l==null?void 0:l.tokenId}),V("execute-cast","completed",void 0,R),V("monitor-status","completed"),c("complete"),n==null||n({success:!0,solanaSignature:R,ckNFTCanisterId:l==null?void 0:l.canisterId,tokenId:l==null?void 0:l.tokenId})},[V,n,l]),J=x.useCallback((R,q)=>{console.error("âŒ Return transaction failed:",R),h({success:!1,error:R}),q&&V(q,"failed",R),n==null||n({success:!1,error:R})},[V,n]),pe=x.useCallback(()=>{const R=k+1;R<M.length&&(w(!1),c(M[R].id))},[k,M]),E=x.useCallback(()=>{const R=k-1;R>=0&&(w(!0),c(M[R].id),setTimeout(()=>w(!1),500))},[k,M]),b=x.useCallback(()=>{c("connect-ic"),u(null),m(null),g(null),h(null)},[]),Y=x.useCallback(()=>{r&&r()},[r]);x.useEffect(()=>{i==="connect-ic"&&_&&!C&&(console.log("âœ… IC connected, auto-advancing to ckNFT selection"),pe())},[i,_,C,pe]),x.useEffect(()=>{i==="connect-solana"&&j&&B&&!C&&(console.log("âœ… Solana connected, auto-advancing to costs"),pe())},[i,j,B,C,pe]);const p=()=>{var R;switch(i){case"connect-ic":return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Connect Internet Computer"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Connect with your IC wallet to access your ckNFTs"})]}),s.jsx("div",{className:"text-center text-sm text-gray-500",children:_?s.jsxs("div",{className:"text-green-600",children:["âœ… Connected as ",_.principal.toText().slice(0,10),"..."]}):s.jsx("div",{children:"Please connect using the login button in the header"})})]});case"select-cknft":return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select ckNFT to Return"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Choose the Solana-originated ckNFT you want to return"})]}),s.jsx(Gc,{selectedNFTs:l?[l]:[],onSelectionChange:q=>u(q[0]||null),userPrincipal:_==null?void 0:_.principal,targetChain:"solana"})]});case"connect-solana":return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Connect Solana Wallet"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Connect your Solana wallet to receive the returned NFT"})]}),s.jsx(Pd,{})]});case"costs":return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Review Costs & Approve"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Review the costs and approve cycles for the return operation"})]}),l&&s.jsx(o6,{selectedNFT:{canisterId:l.canisterId,tokenId:BigInt(l.tokenId),metadata:((R=l.metadata)==null?void 0:R.allMetadata)||[]},costs:d,onCostsCalculated:m,isConnected:j,walletPublicKey:B==null?void 0:B.toString(),connection:Q,sendTransaction:F,targetSolanaAddress:B==null?void 0:B.toString()})]});case"return":return f||K("ic-to-evm"),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Returning ckNFT to Solana"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Please wait while we process your return..."})]}),l&&d&&B&&f&&s.jsx(i6,{selectedNFT:{canisterId:l.canisterId,tokenId:BigInt(l.tokenId)},returnCosts:d,targetSolanaAddress:B.toString(),progress:f,onProgressUpdate:g,onComplete:ee,onError:J})]});case"complete":return N&&s.jsx(c6,{result:N,onStartNew:b,onClose:Y});default:return null}},O=s.jsxs("div",{className:be("bg-white rounded-lg shadow-lg",a),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Return ckNFT to Solana"}),s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Step ",k+1," of ",M.length,": ",M[k].title]})]}),s.jsx("button",{onClick:Y,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(ra,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"p-6",children:p()}),i!=="return"&&i!=="complete"&&s.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[s.jsxs("button",{onClick:E,disabled:k===0,className:be("flex items-center gap-2 px-4 py-2 rounded-lg transition-colors",k===0?"opacity-50 cursor-not-allowed":"hover:bg-gray-100"),children:[s.jsx(ta,{className:"w-4 h-4"}),"Back"]}),s.jsxs("button",{onClick:pe,disabled:!T(),className:be("flex items-center gap-2 px-6 py-2 rounded-lg transition-colors font-medium",T()?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:[i==="costs"?"Start Return":"Continue",s.jsx(Is,{className:"w-4 h-4"})]})]})]});return o?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:O})}):O}function l6(){const[e,t]=x.useState(!1),[n,r]=x.useState(!1),[a,o]=x.useState(!1),[i,c]=x.useState(!1),[l,u]=x.useState(!1),[d,m]=x.useState(!1),[f,g]=x.useState(!1),[N,h]=x.useState(!1),[C,w]=x.useState(null),[B,j]=x.useState(null),[Q,F]=x.useState(null),[_,M]=x.useState(null),[k,K]=x.useState(null),[V,T]=x.useState(null),[ee,J]=x.useState(null),[pe,E]=x.useState(null),[b,Y]=x.useState(null),[p,O]=x.useState(!1),[R,q]=x.useState(!1),[v,U]=x.useState(!1),[S,H]=x.useState(!1),[he,$]=x.useState(!1),[W,le]=x.useState(!1),[ce,L]=x.useState(!1),[ue,re]=x.useState(!1),se=A=>{console.log("Import completed:",A),j(A),A.success?(O(!0),console.log("ðŸŽ‰ NFT successfully imported!",{evmTx:A.evmTransactionHash,icTx:A.icTransactionHash,canister:A.canisterAddress,tokenId:A.tokenId})):console.error("âŒ Import failed:",A.error)},Ne=A=>{console.log("Export completed:",A),F(A),A.success?(q(!0),console.log("ðŸŽ‰ NFT successfully exported!",{evmTx:A.evmTransactionHash,icTx:A.icTransactionHash,contract:A.remoteContractAddress,tokenId:A.tokenId})):console.error("âŒ Export failed:",A.error)},ge=A=>{console.log("Burn completed:",A),M(A),A.success?(U(!0),console.log("ðŸ”¥ NFT successfully burned and ckNFT minted!",{icTx:A.icTransactionHash,canister:A.ckNFTCanisterId,tokenId:A.tokenId})):console.error("âŒ Burn failed:",A.error)},ne=A=>{console.log("Return completed:",A),K(A),A.success?(H(!0),console.log("â†©ï¸ ckNFT successfully returned to EVM!",{evmTx:A.evmTransactionHash,chainId:A.targetChainId,contract:A.targetContractAddress,tokenId:A.tokenId})):console.error("âŒ Return failed:",A.error)},ye=A=>{console.log("Solana Import completed:",A),T(A),A.success?($(!0),console.log("ðŸŽ‰ Solana NFT successfully imported!",{solanaTx:A.solanaTransactionHash,icTx:A.icTransactionHash,canister:A.canisterAddress,tokenId:A.tokenId})):console.error("âŒ Solana Import failed:",A.error)},G=A=>{console.log("Solana Export completed:",A),J(A),A.success?(le(!0),console.log("ðŸŽ‰ NFT successfully exported to Solana!",{solanaTx:A.solanaTransactionHash,icTx:A.icTransactionHash,collectionAddress:A.collectionAddress,tokenIds:A.tokenIds})):console.error("âŒ Solana Export failed:",A.error)},P=A=>{console.log("Solana Burn completed:",A),E(A),A.success?(L(!0),console.log("ðŸŽ‰ NFT successfully burned and returned to IC!",{solanaTx:A.solanaSignature,icTx:A.icTransactionHash,canisterId:A.ckNFTCanisterId,tokenId:A.tokenId})):console.error("âŒ Solana Burn failed:",A.error)},z=A=>{console.log("Solana Return completed:",A),Y(A),A.success?(re(!0),console.log("â†©ï¸ ckNFT successfully returned to Solana!",{solanaTx:A.solanaSignature,ckNFTCanisterId:A.ckNFTCanisterId,tokenId:A.tokenId})):console.error("âŒ Solana Return failed:",A.error)};return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8",children:s.jsxs("div",{className:"max-w-4xl mx-auto",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"ICRC-99 NFT Bridge"}),s.jsx("p",{className:"text-xl text-gray-300 mb-2",children:"Complete bidirectional NFT bridging between EVM chains, Solana, and the Internet Computer"}),s.jsx("p",{className:"text-lg text-gray-400",children:"Import â€¢ Export â€¢ Burn â€¢ Return"})]}),s.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 mb-8",children:[s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”µ"}),s.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"EVM Import"}),s.jsx("p",{className:"text-blue-200 text-sm mb-4",children:"EVM â†’ IC"})]}),s.jsx("p",{className:"text-gray-300 text-sm mb-6",children:"Lock your NFTs on EVM chains and mint corresponding ckNFTs on IC."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>w("import"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Start Import"}),s.jsx("button",{onClick:()=>t(!0),className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Import (Modal)"})]})]}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"text-3xl mb-2",children:"ðŸŸ¢"}),s.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"EVM Export"}),s.jsx("p",{className:"text-green-200 text-sm mb-4",children:"IC â†’ EVM (New Collection)"})]}),s.jsx("p",{className:"text-gray-300 text-sm mb-6",children:"Lock ckNFTs and deploy new EVM contracts with fresh deployments."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>w("export"),className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Start Export"}),s.jsx("button",{onClick:()=>r(!0),className:"w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Export (Modal)"})]})]}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”´"}),s.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"EVM Burn"}),s.jsx("p",{className:"text-red-200 text-sm mb-4",children:"EVM Burn â†’ IC"})]}),s.jsx("p",{className:"text-gray-300 text-sm mb-6",children:"Permanently burn EVM NFTs and mint corresponding ckNFTs on IC."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>w("burn"),className:"w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Start Burn"}),s.jsx("button",{onClick:()=>o(!0),className:"w-full bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Burn (Modal)"})]})]}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"text-3xl mb-2",children:"ðŸŸ£"}),s.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"EVM Return"}),s.jsx("p",{className:"text-purple-200 text-sm mb-4",children:"IC â†’ EVM (Source)"})]}),s.jsxs("p",{className:"text-gray-300 text-sm mb-6",children:["Burn ckNFTs and return NFTs to their original EVM chains.",s.jsx("br",{}),s.jsx("br",{})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>w("return"),className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Start Return"}),s.jsx("button",{onClick:()=>c(!0),className:"w-full bg-purple-500 hover:bg-purple-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Return (Modal)"})]})]}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"text-3xl mb-2",children:"â—Ž"}),s.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Solana Import"}),s.jsx("p",{className:"text-cyan-200 text-sm mb-4",children:"Solana â†’ IC"})]}),s.jsx("p",{className:"text-gray-300 text-sm mb-6",children:"Bridge your Solana NFTs to Internet Computer with Metaplex support."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>w("solana-import"),className:"w-full bg-cyan-600 hover:bg-cyan-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Start Solana Import"}),s.jsx("button",{onClick:()=>u(!0),className:"w-full bg-cyan-500 hover:bg-cyan-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Solana Import (Modal)"})]})]}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"text-3xl mb-2",children:"â—Ž"}),s.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Solana Export"}),s.jsx("p",{className:"text-cyan-200 text-sm mb-4",children:"IC â†’ Solana(New Collection)"})]}),s.jsx("p",{className:"text-gray-300 text-sm mb-6",children:"Export your ckNFTs to Solana blockchain with collection deployment."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>w("solana-export"),className:"w-full bg-cyan-600 hover:bg-cyan-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Start Solana Export"}),s.jsx("button",{onClick:()=>m(!0),className:"w-full bg-cyan-500 hover:bg-cyan-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Solana Export (Modal)"})]})]}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"text-3xl mb-2",children:"ðŸ”¥"}),s.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Solana Burn"}),s.jsx("p",{className:"text-orange-200 text-sm mb-4",children:"Solana â†’ IC"})]}),s.jsx("p",{className:"text-gray-300 text-sm mb-6",children:"Return your Solana NFTs back to the Internet Computer as ckNFTs."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>w("solana-burn"),className:"w-full bg-orange-600 hover:bg-orange-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Start Solana Burn"}),s.jsx("button",{onClick:()=>g(!0),className:"w-full bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Solana Burn (Modal)"})]})]}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"text-3xl mb-2",children:"â†©ï¸"}),s.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Solana Return"}),s.jsx("p",{className:"text-purple-200 text-sm mb-4",children:"IC â†’ Solana(Source)"})]}),s.jsx("p",{className:"text-gray-300 text-sm mb-6",children:"Return your ckNFTs back to their original Solana addresses."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>w("solana-return"),className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Start Solana Return"}),s.jsx("button",{onClick:()=>h(!0),className:"w-full bg-purple-500 hover:bg-purple-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors",children:"Solana Return (Modal)"})]})]})]}),p&&B&&!B.success&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Import Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There was an issue importing your NFT. Please try again."}),B.error&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Error Details:"}),s.jsx("p",{className:"text-sm text-red-700",children:B.error})]}),s.jsx("button",{onClick:()=>{O(!1),j(null)},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Try Again"})]})})}),p&&(B==null?void 0:B.success)&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Import Successful!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your NFT has been successfully imported to the Internet Computer."}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Transaction Details:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[B.evmTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"EVM Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:B.evmTransactionHash})]}),B.icTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"IC Reference:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:B.icTransactionHash})]}),B.canisterAddress&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Canister:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:B.canisterAddress})]}),B.tokenId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Token ID:"}),s.jsx("div",{className:"font-mono text-xs",children:B.tokenId})]})]})]}),s.jsx("button",{onClick:()=>{O(!1),j(null)},className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Continue"})]})})}),R&&Q&&!Q.success&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Export Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There was an issue exporting your NFT. Please try again."}),Q.error&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Error Details:"}),s.jsx("p",{className:"text-sm text-red-700",children:Q.error})]}),s.jsx("button",{onClick:()=>{q(!1),F(null)},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Try Again"})]})})}),R&&(Q==null?void 0:Q.success)&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Export Successful!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your NFT has been successfully exported to the EVM blockchain."}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Transaction Details:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[Q.evmTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"EVM Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:Q.evmTransactionHash})]}),Q.icTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"IC Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:Q.icTransactionHash})]}),Q.remoteContractAddress&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Contract Address:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:Q.remoteContractAddress})]}),Q.tokenId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Token ID:"}),s.jsx("div",{className:"font-mono text-xs",children:Q.tokenId})]})]})]}),s.jsx("button",{onClick:()=>{q(!1),F(null)},className:"w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Continue"})]})})}),v&&_&&!_.success&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Burn Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There was an issue burning your NFT. Please try again."}),_.error&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Error Details:"}),s.jsx("p",{className:"text-sm text-red-700",children:_.error})]}),s.jsx("button",{onClick:()=>{U(!1),M(null)},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Try Again"})]})})}),v&&(_==null?void 0:_.success)&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Burn Successful!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your EVM NFT has been burned and a ckNFT has been minted on the Internet Computer."}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Transaction Details:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[_.icTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"IC Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:_.icTransactionHash})]}),_.ckNFTCanisterId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"ckNFT Canister:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:_.ckNFTCanisterId})]}),_.tokenId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Token ID:"}),s.jsx("div",{className:"font-mono text-xs",children:_.tokenId})]})]})]}),s.jsx("button",{onClick:()=>{U(!1),M(null)},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Continue"})]})})}),S&&k&&!k.success&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Return Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There was an issue returning your ckNFT. Please try again."}),k.error&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Error Details:"}),s.jsx("p",{className:"text-sm text-red-700",children:k.error})]}),s.jsx("button",{onClick:()=>{H(!1),K(null)},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Try Again"})]})})}),S&&(k==null?void 0:k.success)&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Return Successful!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your ckNFT has been returned to the EVM blockchain."}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Transaction Details:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[k.evmTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"EVM Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:k.evmTransactionHash})]}),k.targetChainId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Target Chain:"}),s.jsxs("div",{className:"font-mono text-xs",children:["Chain ",k.targetChainId]})]}),k.targetContractAddress&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Contract Address:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:k.targetContractAddress})]}),k.tokenId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Token ID:"}),s.jsx("div",{className:"font-mono text-xs",children:k.tokenId})]})]})]}),s.jsx("button",{onClick:()=>{H(!1),K(null)},className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Continue"})]})})}),he&&V&&!V.success&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Solana Import Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There was an issue importing your Solana NFT. Please try again."}),V.error&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Error Details:"}),s.jsx("p",{className:"text-sm text-red-700",children:V.error})]}),s.jsx("button",{onClick:()=>{$(!1),T(null)},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Try Again"})]})})}),he&&(V==null?void 0:V.success)&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-cyan-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-cyan-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Solana Import Successful!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your Solana NFT has been successfully imported to Internet Computer."}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Transaction Details:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[V.solanaTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Solana Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:V.solanaTransactionHash})]}),V.icTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"IC Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:V.icTransactionHash})]}),V.canisterAddress&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Canister:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:V.canisterAddress})]}),V.tokenId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Token ID:"}),s.jsx("div",{className:"font-mono text-xs",children:V.tokenId})]})]})]}),s.jsx("button",{onClick:()=>{$(!1),T(null)},className:"w-full bg-cyan-600 hover:bg-cyan-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Continue"})]})})}),W&&ee&&!ee.success&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Solana Export Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There was an issue exporting your NFT to Solana. Please try again."}),ee.error&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Error Details:"}),s.jsx("p",{className:"text-sm text-red-700",children:ee.error})]}),s.jsx("button",{onClick:()=>{le(!1),J(null)},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Try Again"})]})})}),W&&(ee==null?void 0:ee.success)&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-cyan-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-cyan-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Export to Solana Successful!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your NFT has been successfully exported to the Solana blockchain."}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Transaction Details:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[ee.solanaTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Solana Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:ee.solanaTransactionHash})]}),ee.icTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"IC Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:ee.icTransactionHash})]}),ee.collectionAddress&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Collection Address:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:ee.collectionAddress})]}),ee.tokenIds&&ee.tokenIds.length>0&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Token IDs:"}),s.jsx("div",{className:"font-mono text-xs",children:ee.tokenIds.join(", ")})]})]})]}),s.jsx("button",{onClick:()=>{le(!1),J(null)},className:"w-full bg-cyan-600 hover:bg-cyan-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Continue"})]})})}),ce&&pe&&!pe.success&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Burn Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There was an issue burning your Solana NFT. Please try again."}),pe.error&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Error Details:"}),s.jsx("p",{className:"text-sm text-red-700",children:pe.error})]}),s.jsx("button",{onClick:()=>{L(!1),E(null)},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Try Again"})]})})}),ce&&(pe==null?void 0:pe.success)&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Burn & Return Successful!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your Solana NFT has been returned to the Internet Computer as a ckNFT."}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Transaction Details:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[pe.solanaSignature&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Solana Signature:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:pe.solanaSignature})]}),pe.icTransactionHash&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"IC Transaction:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:pe.icTransactionHash})]}),pe.ckNFTCanisterId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"ckNFT Canister:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:pe.ckNFTCanisterId})]})]})]}),s.jsx("button",{onClick:()=>{L(!1),E(null)},className:"w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Continue"})]})})}),ue&&b&&!b.success&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Return Failed"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There was an issue returning your ckNFT to Solana. Please try again."}),b.error&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Error Details:"}),s.jsx("p",{className:"text-sm text-red-700",children:b.error})]}),s.jsx("button",{onClick:()=>{re(!1),Y(null)},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Try Again"})]})})}),ue&&(b==null?void 0:b.success)&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full p-8 text-center",children:s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Return Successful!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your ckNFT has been successfully returned to its original Solana address."}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-left mb-6",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Transaction Details:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[b.solanaSignature&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Solana Signature:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:b.solanaSignature})]}),b.ckNFTCanisterId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"ckNFT Canister:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:b.ckNFTCanisterId})]}),b.tokenId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Token ID:"}),s.jsx("div",{className:"font-mono text-xs break-all",children:b.tokenId})]})]})]}),s.jsx("button",{onClick:()=>{re(!1),Y(null)},className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Continue"})]})})}),C==="import"&&s.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-xl font-semibold text-white",children:"Import from EVM"}),s.jsx("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx(f0,{canisterId:"umunu-kh777-77774-qaaca-cai",supportedNetworks:["ethereum","polygon","bsc","optimism","base","arbitrum","hardhat","hardhat-2"],onComplete:se,onCancel:()=>w(null)})]}),C==="export"&&s.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-xl font-semibold text-white",children:"Export to EVM"}),s.jsx("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx(p0,{sourceCanisterId:"umunu-kh777-77774-qaaca-cai",supportedNetworks:["ethereum","polygon","bsc","optimism","base","arbitrum","hardhat","hardhat-2"],onComplete:Ne,onCancel:()=>w(null)})]}),C==="burn"&&s.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-xl font-semibold text-white",children:"Burn EVM NFT"}),s.jsx("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx(g0,{onComplete:ge,onCancel:()=>w(null),modal:!1})]}),C==="return"&&s.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-xl font-semibold text-white",children:"Return ckNFT"}),s.jsx("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx(b0,{onComplete:ne,onCancel:()=>w(null),modal:!1})]}),C==="solana-import"&&s.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-xl font-semibold text-white",children:"Import from Solana"}),s.jsx("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx(C0,{onComplete:ye,onCancel:()=>w(null),mode:"inline"})]}),C==="solana-export"&&s.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-xl font-semibold text-white",children:"Export to Solana"}),s.jsx("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx(A0,{onComplete:G,onCancel:()=>w(null),modal:!1})]}),C==="solana-burn"&&s.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-xl font-semibold text-white",children:"Burn & Return to IC"}),s.jsx("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx(S0,{onComplete:P,onCancel:()=>w(null),modal:!1})]}),C==="solana-return"&&s.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-xl font-semibold text-white",children:"Return to Solana"}),s.jsx("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx(F0,{onComplete:z,onCancel:()=>w(null),modal:!1})]}),e&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:s.jsx(f0,{canisterId:"rrkah-fqaaa-aaaaa-aaaaq-cai",supportedNetworks:["ethereum","polygon","bsc","optimism","base","arbitrum","hardhat","hardhat-2"],modal:!0,onComplete:A=>{se(A),t(!1)},onCancel:()=>t(!1)})})}),n&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:s.jsx(p0,{sourceCanisterId:"rrkah-fqaaa-aaaaa-aaaaq-cai",supportedNetworks:["ethereum","polygon","bsc","optimism","base","arbitrum","hardhat","hardhat-2"],modal:!0,onComplete:A=>{Ne(A),r(!1)},onCancel:()=>r(!1)})})}),a&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:s.jsx(g0,{modal:!0,onComplete:A=>{ge(A),o(!1)},onCancel:()=>o(!1)})})}),i&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:s.jsx(b0,{modal:!0,onComplete:A=>{ne(A),c(!1)},onCancel:()=>c(!1)})})}),l&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:s.jsx(C0,{mode:"modal",onComplete:A=>{ye(A),u(!1)},onCancel:()=>u(!1)})})}),d&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:s.jsx(A0,{modal:!0,onComplete:A=>{G(A),m(!1)},onCancel:()=>m(!1)})})}),f&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:s.jsx(S0,{modal:!0,onComplete:A=>{P(A),g(!1)},onCancel:()=>g(!1)})})}),N&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:s.jsx(F0,{modal:!0,onComplete:A=>{z(A),h(!1)},onCancel:()=>h(!1)})})}),(B||Q||_||k||V||ee)&&s.jsxs("div",{className:"mt-8 space-y-4",children:[B&&s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Last Import Result:"}),s.jsx("pre",{className:"bg-black/30 rounded-lg p-4 text-sm text-green-300 overflow-auto",children:JSON.stringify(B,null,2)})]}),Q&&s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Last Export Result:"}),s.jsx("pre",{className:"bg-black/30 rounded-lg p-4 text-sm text-green-300 overflow-auto",children:JSON.stringify(Q,null,2)})]}),_&&s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Last Burn Result:"}),s.jsx("pre",{className:"bg-black/30 rounded-lg p-4 text-sm text-red-300 overflow-auto",children:JSON.stringify(_,null,2)})]}),k&&s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Last Return Result:"}),s.jsx("pre",{className:"bg-black/30 rounded-lg p-4 text-sm text-purple-300 overflow-auto",children:JSON.stringify(k,null,2)})]}),V&&s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Last Solana Import Result:"}),s.jsx("pre",{className:"bg-black/30 rounded-lg p-4 text-sm text-cyan-300 overflow-auto",children:JSON.stringify(V,null,2)})]}),ee&&s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[s.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Last Solana Export Result:"}),s.jsx("pre",{className:"bg-black/30 rounded-lg p-4 text-sm text-cyan-300 overflow-auto",children:JSON.stringify(ee,null,2)})]})]})]})})}const E6=Object.freeze(Object.defineProperty({__proto__:null,component:l6},Symbol.toStringTag,{value:"Module"}));export{Kh as $,ux as A,tc as B,$e as C,Gl as D,Gh as E,rN as F,we as G,dy as H,lc as I,QN as J,Sn as K,Jt as L,PN as M,en as N,Ps as O,ia as P,Ut as Q,ai as R,bm as S,nc as T,Tn as U,Mo as V,qN as W,Jh as X,pt as Y,Be as Z,Je as _,b6 as a,gx as a$,dt as a0,Cy as a1,dc as a2,Zt as a3,ni as a4,Kr as a5,Ni as a6,dx as a7,Kt as a8,ix as a9,nr as aA,jN as aB,sc as aC,Zr as aD,Ls as aE,Uc as aF,Xu as aG,dl as aH,ji as aI,Y1 as aJ,mN as aK,_c as aL,$t as aM,yo as aN,rs as aO,Jr as aP,Z1 as aQ,Bh as aR,oi as aS,qt as aT,Oh as aU,Nx as aV,ko as aW,wu as aX,L0 as aY,Xm as aZ,x6 as a_,yt as aa,Lo as ab,rr as ac,Ac as ad,md as ae,p6 as af,m0 as ag,px as ah,L1 as ai,Ot as aj,kn as ak,sN as al,tN as am,Sd as an,_h as ao,$c as ap,mc as aq,X1 as ar,ts as as,Xs as at,Ed as au,sm as av,mn as aw,e0 as ax,a0 as ay,Ax as az,Hx as b,wi as b0,T1 as b1,xx as b2,A1 as b3,et as b4,Px as b5,Di as b6,C6 as b7,j6 as b8,kc as b9,k6 as ba,Jm as bb,ud as bc,A6 as bd,Nr as be,Il as bf,cu as bg,Mx as bh,f6 as bi,mx as bj,g6 as bk,T6 as bl,E6 as bm,y6 as c,Wx as d,Bo as e,bd as f,We as g,Se as h,Ms as i,D as j,kt as k,wt as l,ar as m,Qr as n,nt as o,N6 as p,Lm as q,w6 as r,Ec as s,St as t,_x as u,tn as v,pd as w,tm as x,Ca as y,En as z};
