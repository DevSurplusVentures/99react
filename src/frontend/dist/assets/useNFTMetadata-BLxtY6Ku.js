var Ye=Object.defineProperty;var Ne=e=>{throw TypeError(e)};var Ze=(e,t,s)=>t in e?Ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var U=(e,t,s)=>Ze(e,typeof t!="symbol"?t+"":t,s),fe=(e,t,s)=>t.has(e)||Ne("Cannot "+s);var r=(e,t,s)=>(fe(e,t,"read from private field"),s?s.call(e):t.get(e)),b=(e,t,s)=>t.has(e)?Ne("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),m=(e,t,s,n)=>(fe(e,t,"write to private field"),n?n.call(e,s):t.set(e,s),s),y=(e,t,s)=>(fe(e,t,"access private method"),s);import{i as Ve,p as ke,k as x,s as re,l as X,n as ne,m as ge,o as qe,t as Ie,q as ee,v as De,w as Le,x as Qe,y as oe,z as Ue,B as et,r as v,C as Je,e as Oe,D as tt,F as He,A as Q,u as ce,f as st}from"./index-CstboGu2.js";import{i as We}from"./index-3JlJGJwM.js";var S,f,Y,R,P,j,F,N,Z,V,J,B,K,k,H,g,z,me,ye,be,ve,we,Re,Se,Ge,$e,rt=($e=class extends Ve{constructor(t,s){super();b(this,g);b(this,S);b(this,f);b(this,Y);b(this,R);b(this,P);b(this,j);b(this,F);b(this,N);b(this,Z);b(this,V);b(this,J);b(this,B);b(this,K);b(this,k);b(this,H,new Set);this.options=s,m(this,S,t),m(this,N,null),m(this,F,ke()),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,f).addObserver(this),Pe(r(this,f),this.options)?y(this,g,z).call(this):this.updateResult(),y(this,g,ve).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return _e(r(this,f),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return _e(r(this,f),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,y(this,g,we).call(this),y(this,g,Re).call(this),r(this,f).removeObserver(this)}setOptions(t){const s=this.options,n=r(this,f);if(this.options=r(this,S).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof x(this.options.enabled,r(this,f))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");y(this,g,Se).call(this),r(this,f).setOptions(this.options),s._defaulted&&!re(this.options,s)&&r(this,S).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,f),observer:this});const i=this.hasListeners();i&&Be(r(this,f),n,this.options,s)&&y(this,g,z).call(this),this.updateResult(),i&&(r(this,f)!==n||x(this.options.enabled,r(this,f))!==x(s.enabled,r(this,f))||X(this.options.staleTime,r(this,f))!==X(s.staleTime,r(this,f)))&&y(this,g,me).call(this);const o=y(this,g,ye).call(this);i&&(r(this,f)!==n||x(this.options.enabled,r(this,f))!==x(s.enabled,r(this,f))||o!==r(this,k))&&y(this,g,be).call(this,o)}getOptimisticResult(t){const s=r(this,S).getQueryCache().build(r(this,S),t),n=this.createResult(s,t);return it(this,n)&&(m(this,R,n),m(this,j,this.options),m(this,P,r(this,f).state)),n}getCurrentResult(){return r(this,R)}trackResult(t,s){return new Proxy(t,{get:(n,i)=>(this.trackProp(i),s==null||s(i),i==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&r(this,F).status==="pending"&&r(this,F).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,i))})}trackProp(t){r(this,H).add(t)}getCurrentQuery(){return r(this,f)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=r(this,S).defaultQueryOptions(t),n=r(this,S).getQueryCache().build(r(this,S),s);return n.fetch().then(()=>this.createResult(n,s))}fetch(t){return y(this,g,z).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,R)))}createResult(t,s){var Me;const n=r(this,f),i=this.options,o=r(this,R),a=r(this,P),l=r(this,j),c=t!==n?t.state:r(this,Y),{state:p}=t;let h={...p},w=!1,d;if(s._optimisticResults){const A=this.hasListeners(),D=!A&&Pe(t,s),$=A&&Be(t,n,s,i);(D||$)&&(h={...h,...Le(p.data,t.options)}),s._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:W,errorUpdatedAt:G,status:E}=h;d=h.data;let I=!1;if(s.placeholderData!==void 0&&d===void 0&&E==="pending"){let A;o!=null&&o.isPlaceholderData&&s.placeholderData===(l==null?void 0:l.placeholderData)?(A=o.data,I=!0):A=typeof s.placeholderData=="function"?s.placeholderData((Me=r(this,J))==null?void 0:Me.state.data,r(this,J)):s.placeholderData,A!==void 0&&(E="success",d=Qe(o==null?void 0:o.data,A,s),w=!0)}if(s.select&&d!==void 0&&!I)if(o&&d===(a==null?void 0:a.data)&&s.select===r(this,Z))d=r(this,V);else try{m(this,Z,s.select),d=s.select(d),d=Qe(o==null?void 0:o.data,d,s),m(this,V,d),m(this,N,null)}catch(A){m(this,N,A)}r(this,N)&&(W=r(this,N),d=r(this,V),G=Date.now(),E="error");const ue=h.fetchStatus==="fetching",le=E==="pending",he=E==="error",Ce=le&&ue,Te=d!==void 0,O={status:E,fetchStatus:h.fetchStatus,isPending:le,isSuccess:E==="success",isError:he,isInitialLoading:Ce,isLoading:Ce,data:d,dataUpdatedAt:h.dataUpdatedAt,error:W,errorUpdatedAt:G,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>c.dataUpdateCount||h.errorUpdateCount>c.errorUpdateCount,isFetching:ue,isRefetching:ue&&!le,isLoadingError:he&&!Te,isPaused:h.fetchStatus==="paused",isPlaceholderData:w,isRefetchError:he&&Te,isStale:Fe(t,s),refetch:this.refetch,promise:r(this,F),isEnabled:x(s.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const A=L=>{O.status==="error"?L.reject(O.error):O.data!==void 0&&L.resolve(O.data)},D=()=>{const L=m(this,F,O.promise=ke());A(L)},$=r(this,F);switch($.status){case"pending":t.queryHash===n.queryHash&&A($);break;case"fulfilled":(O.status==="error"||O.data!==$.value)&&D();break;case"rejected":(O.status!=="error"||O.error!==$.reason)&&D();break}}return O}updateResult(){const t=r(this,R),s=this.createResult(r(this,f),this.options);if(m(this,P,r(this,f).state),m(this,j,this.options),r(this,P).data!==void 0&&m(this,J,r(this,f)),re(s,t))return;m(this,R,s);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:i}=this.options,o=typeof i=="function"?i():i;if(o==="all"||!o&&!r(this,H).size)return!0;const a=new Set(o??r(this,H));return this.options.throwOnError&&a.add("error"),Object.keys(r(this,R)).some(l=>{const u=l;return r(this,R)[u]!==t[u]&&a.has(u)})};y(this,g,Ge).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&y(this,g,ve).call(this)}},S=new WeakMap,f=new WeakMap,Y=new WeakMap,R=new WeakMap,P=new WeakMap,j=new WeakMap,F=new WeakMap,N=new WeakMap,Z=new WeakMap,V=new WeakMap,J=new WeakMap,B=new WeakMap,K=new WeakMap,k=new WeakMap,H=new WeakMap,g=new WeakSet,z=function(t){y(this,g,Se).call(this);let s=r(this,f).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(ne)),s},me=function(){y(this,g,we).call(this);const t=X(this.options.staleTime,r(this,f));if(ge||r(this,R).isStale||!qe(t))return;const n=Ie(r(this,R).dataUpdatedAt,t)+1;m(this,B,ee.setTimeout(()=>{r(this,R).isStale||this.updateResult()},n))},ye=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,f)):this.options.refetchInterval)??!1},be=function(t){y(this,g,Re).call(this),m(this,k,t),!(ge||x(this.options.enabled,r(this,f))===!1||!qe(r(this,k))||r(this,k)===0)&&m(this,K,ee.setInterval(()=>{(this.options.refetchIntervalInBackground||De.isFocused())&&y(this,g,z).call(this)},r(this,k)))},ve=function(){y(this,g,me).call(this),y(this,g,be).call(this,y(this,g,ye).call(this))},we=function(){r(this,B)&&(ee.clearTimeout(r(this,B)),m(this,B,void 0))},Re=function(){r(this,K)&&(ee.clearInterval(r(this,K)),m(this,K,void 0))},Se=function(){const t=r(this,S).getQueryCache().build(r(this,S),this.options);if(t===r(this,f))return;const s=r(this,f);m(this,f,t),m(this,Y,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},Ge=function(t){oe.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(r(this,R))}),r(this,S).getQueryCache().notify({query:r(this,f),type:"observerResultsUpdated"})})},$e);function nt(e,t){return x(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function Pe(e,t){return nt(e,t)||e.state.data!==void 0&&_e(e,t,t.refetchOnMount)}function _e(e,t,s){if(x(t.enabled,e)!==!1&&X(t.staleTime,e)!=="static"){const n=typeof s=="function"?s(e):s;return n==="always"||n!==!1&&Fe(e,t)}return!1}function Be(e,t,s,n){return(e!==t||x(n.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&Fe(e,s)}function Fe(e,t){return x(t.enabled,e)!==!1&&e.isStaleByTime(X(t.staleTime,e))}function it(e,t){return!re(e.getCurrentResult(),t)}var C,q,_,T,M,se,Ee,je,at=(je=class extends Ve{constructor(t,s){super();b(this,M);b(this,C);b(this,q);b(this,_);b(this,T);m(this,C,t),this.setOptions(s),this.bindMethods(),y(this,M,se).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var n;const s=this.options;this.options=r(this,C).defaultMutationOptions(t),re(this.options,s)||r(this,C).getMutationCache().notify({type:"observerOptionsUpdated",mutation:r(this,_),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&Ue(s.mutationKey)!==Ue(this.options.mutationKey)?this.reset():((n=r(this,_))==null?void 0:n.state.status)==="pending"&&r(this,_).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=r(this,_))==null||t.removeObserver(this)}onMutationUpdate(t){y(this,M,se).call(this),y(this,M,Ee).call(this,t)}getCurrentResult(){return r(this,q)}reset(){var t;(t=r(this,_))==null||t.removeObserver(this),m(this,_,void 0),y(this,M,se).call(this),y(this,M,Ee).call(this)}mutate(t,s){var n;return m(this,T,s),(n=r(this,_))==null||n.removeObserver(this),m(this,_,r(this,C).getMutationCache().build(r(this,C),this.options)),r(this,_).addObserver(this),r(this,_).execute(t)}},C=new WeakMap,q=new WeakMap,_=new WeakMap,T=new WeakMap,M=new WeakSet,se=function(){var s;const t=((s=r(this,_))==null?void 0:s.state)??et();m(this,q,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},Ee=function(t){oe.batch(()=>{var s,n,i,o,a,l,u,c;if(r(this,T)&&this.hasListeners()){const p=r(this,q).variables,h=r(this,q).context,w={client:r(this,C),meta:this.options.meta,mutationKey:this.options.mutationKey};(t==null?void 0:t.type)==="success"?((n=(s=r(this,T)).onSuccess)==null||n.call(s,t.data,p,h,w),(o=(i=r(this,T)).onSettled)==null||o.call(i,t.data,null,p,h,w)):(t==null?void 0:t.type)==="error"&&((l=(a=r(this,T)).onError)==null||l.call(a,t.error,p,h,w),(c=(u=r(this,T)).onSettled)==null||c.call(u,void 0,t.error,p,h,w))}this.listeners.forEach(p=>{p(r(this,q))})})},je),ze=v.createContext(!1),ot=()=>v.useContext(ze);ze.Provider;function ct(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var ut=v.createContext(ct()),lt=()=>v.useContext(ut),ht=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},ft=e=>{v.useEffect(()=>{e.clearReset()},[e])},dt=({result:e,errorResetBoundary:t,throwOnError:s,query:n,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(i&&e.data===void 0||Je(s,[e.error,n])),pt=e=>{if(e.suspense){const s=i=>i==="static"?i:Math.max(i??1e3,1e3),n=e.staleTime;e.staleTime=typeof n=="function"?(...i)=>s(n(...i)):s(n),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},gt=(e,t)=>e.isLoading&&e.isFetching&&!t,mt=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,Ke=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function yt(e,t,s){var h,w,d,W,G;const n=ot(),i=lt(),o=Oe(),a=o.defaultQueryOptions(e);(w=(h=o.getDefaultOptions().queries)==null?void 0:h._experimental_beforeQuery)==null||w.call(h,a),a._optimisticResults=n?"isRestoring":"optimistic",pt(a),ht(a,i),ft(i);const l=!o.getQueryCache().get(a.queryHash),[u]=v.useState(()=>new t(o,a)),c=u.getOptimisticResult(a),p=!n&&e.subscribed!==!1;if(v.useSyncExternalStore(v.useCallback(E=>{const I=p?u.subscribe(oe.batchCalls(E)):ne;return u.updateResult(),I},[u,p]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),v.useEffect(()=>{u.setOptions(a)},[a,u]),mt(a,c))throw Ke(a,u,i);if(dt({result:c,errorResetBoundary:i,throwOnError:a.throwOnError,query:o.getQueryCache().get(a.queryHash),suspense:a.suspense}))throw c.error;if((W=(d=o.getDefaultOptions().queries)==null?void 0:d._experimental_afterQuery)==null||W.call(d,a,c),a.experimental_prefetchInRender&&!ge&&gt(c,n)){const E=l?Ke(a,u,i):(G=o.getQueryCache().get(a.queryHash))==null?void 0:G.promise;E==null||E.catch(ne).finally(()=>{u.updateResult()})}return a.notifyOnChangeProps?c:u.trackResult(c)}function de(e,t){return yt(e,rt)}function bt(e,t){const s=Oe(),[n]=v.useState(()=>new at(s,e));v.useEffect(()=>{n.setOptions(e)},[n,e]);const i=v.useSyncExternalStore(v.useCallback(a=>n.subscribe(oe.batchCalls(a)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),o=v.useCallback((a,l)=>{n.mutate(a,l).catch(ne)},[n]);if(i.error&&Je(n.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}function Xe(){return tt()}function Ft(){const{user:e}=Xe();return!!e}function Ct(e,t){const s=ce();return Q.createActor(t,{agent:s,canisterId:e})}function Tt(e,t){const s=He();return Q.createActor(t,{agent:s,canisterId:e})}const te=({IDL:e})=>{const t=e.Record({owner:e.Principal,subaccount:e.Opt(e.Vec(e.Nat8))}),s=e.Record({account:t,spender:t}),n=e.Record({allowance:e.Nat,expires_at:e.Opt(e.Nat64)}),i=e.Record({fee:e.Opt(e.Nat),memo:e.Opt(e.Vec(e.Nat8)),from_subaccount:e.Opt(e.Vec(e.Nat8)),created_at_time:e.Opt(e.Nat64),amount:e.Nat,expected_allowance:e.Opt(e.Nat),expires_at:e.Opt(e.Nat64),spender:t}),o=e.Variant({Ok:e.Nat,Err:e.Variant({BadFee:e.Record({expected_fee:e.Nat}),InsufficientFunds:e.Record({balance:e.Nat}),AllowanceChanged:e.Record({current_allowance:e.Nat}),Expired:e.Record({ledger_time:e.Nat64}),TooOld:e.Null,CreatedInFuture:e.Record({ledger_time:e.Nat64}),Duplicate:e.Record({duplicate_of:e.Nat}),TemporarilyUnavailable:e.Null,GenericError:e.Record({error_code:e.Nat,message:e.Text})})});return e.Service({icrc1_symbol:e.Func([],[e.Text],["query"]),icrc1_decimals:e.Func([],[e.Nat8],["query"]),icrc1_fee:e.Func([],[e.Nat],["query"]),icrc1_name:e.Func([],[e.Text],["query"]),icrc1_balance_of:e.Func([t],[e.Nat],["query"]),icrc2_allowance:e.Func([s],[n],["query"]),icrc2_approve:e.Func([i],[o],[])})},Mt=e=>{const{user:t}=Xe(),s=ce(),n=Oe(),i=typeof e=="string"?st.fromText(e):e,o=de({queryKey:["fungible-token",i.toString()],queryFn:async()=>{if(!s)throw new Error("Agent not available");const c=Q.createActor(te,{agent:s,canisterId:i}),[p,h,w,d]=await Promise.all([c.icrc1_symbol(),c.icrc1_decimals(),c.icrc1_fee(),c.icrc1_name()]);return{symbol:p,decimals:Number(h),fee:w,name:d}},enabled:!!s}),a=c=>de({queryKey:["fungible-token-balance",i.toString(),c==null?void 0:c.owner.toString(),c==null?void 0:c.subaccount],queryFn:async()=>!c||!s?BigInt(0):await Q.createActor(te,{agent:s,canisterId:i}).icrc1_balance_of(c),enabled:!!c&&!!s}),l=c=>de({queryKey:["fungible-token-allowance",i.toString(),c==null?void 0:c.account.owner.toString(),c==null?void 0:c.spender.owner.toString()],queryFn:async()=>{if(!c||!s)throw new Error("Allowance args and agent required");return await Q.createActor(te,{agent:s,canisterId:i}).icrc2_allowance(c)},enabled:!!c&&!!s}),u=()=>{const c=He();return bt({mutationFn:async p=>{if(!(t!=null&&t.principal))throw new Error("Must be authenticated to approve");const w=await Q.createActor(te,{agent:c,canisterId:i}).icrc2_approve(p);if("Err"in w){const d=w.Err;throw"BadFee"in d?new Error(`Bad fee: expected ${d.BadFee.expected_fee}`):"InsufficientFunds"in d?new Error(`Insufficient funds: balance ${d.InsufficientFunds.balance}`):"AllowanceChanged"in d?new Error(`Allowance changed: current ${d.AllowanceChanged.current_allowance}`):"GenericError"in d?new Error(`Generic error: ${d.GenericError.message}`):new Error(`Approval failed: ${JSON.stringify(d)}`)}},onSuccess:()=>{n.invalidateQueries({queryKey:["fungible-token-allowance",i.toString()]}),n.invalidateQueries({queryKey:["fungible-token-balance",i.toString()]})}})};return{data:o.data,isLoading:o.isLoading,error:o.error,refetch:o.refetch,useBalance:a,useAllowance:l,useApprove:u}};v.createContext(null);function vt(e,t){const s=[];for(let n=0;n<e.length;n+=t)s.push(e.slice(n,n+t));return s}const ie=class ie{constructor(){U(this,"queues",new Map);U(this,"timer",null)}static get instance(){return this._instance||(this._instance=new ie),this._instance}request(t,s,n){let i=this.queues.get(t);i||(i={fetcher:s,tokenMap:new Map},this.queues.set(t,i));let o=i.tokenMap.get(n);if(!o){let a,l;o={promise:new Promise((c,p)=>{a=c,l=p}),resolve:a,reject:l},i.tokenMap.set(n,o)}return this.scheduleFlush(),o.promise}scheduleFlush(){this.timer||(this.timer=setTimeout(()=>{this.flush(),this.timer=null},10))}async flush(){for(const[t,{fetcher:s,tokenMap:n}]of this.queues.entries()){const i=Array.from(n.keys()),o=vt(i,25);try{for(const a of o)(await s(a)).forEach((u,c)=>{const p=a[c];n.get(p).resolve(u)})}catch(a){n.forEach(l=>l.reject(a))}this.queues.delete(t)}}};U(ie,"_instance");let Ae=ie;const wt=Ae.instance;function Rt(e,t){const s=[];for(let n=0;n<e.length;n+=t)s.push(e.slice(n,n+t));return s}const ae=class ae{constructor(){U(this,"queues",new Map);U(this,"timer",null)}static get instance(){return this._instance||(this._instance=new ae),this._instance}request(t,s,n){let i=this.queues.get(t);i||(i={fetcher:s,tokenMap:new Map},this.queues.set(t,i));let o=i.tokenMap.get(n);if(!o){let a,l;o={promise:new Promise((c,p)=>{a=c,l=p}),resolve:a,reject:l},i.tokenMap.set(n,o)}return this.scheduleFlush(),o.promise}scheduleFlush(){this.timer||(this.timer=setTimeout(()=>{this.flush(),this.timer=null},10))}async flush(){for(const[t,{fetcher:s,tokenMap:n}]of this.queues.entries()){console.debug(`Flushing NFTOwnerBatcher for queue: ${t}`);const i=Array.from(n.keys()),o=Rt(i,25);console.debug(`Processing ${o.length} batches for queue: ${t}`);try{for(const a of o){const l=await s(a);console.debug(`Fetched results for batch: ${a.join(", ")}`,l),l.forEach((u,c)=>{const p=a[c],h=n.get(p);console.log(`Resolving owner for tokenId ${p}:`,u),u&&u[0]&&u[0].owner?h.resolve({owner:typeof u[0].owner=="string"?u[0].owner:u[0].owner.toString(),subaccount:Array.isArray(u[0].subaccount)&&u[0].subaccount.length>0?new Uint8Array(u[0].subaccount[0]):void 0}):h.resolve(null)})}}catch(a){console.error(`Error flushing NFTOwnerBatcher for queue ${t}:`,a),n.forEach(l=>l.reject(a))}this.queues.delete(t)}}};U(ae,"_instance");let xe=ae;const St=xe.instance;function Nt(e){const t=ce(),s=v.useCallback(i=>Q.createActor(We,{agent:t,canisterId:e}).icrc7_owner_of(i),[t,e]);return{request:v.useCallback(i=>St.request(e,s,i),[e,s])}}function pe(e){console.log("parseJSON called with json:",e);try{const t=JSON.parse(e);return{icrc97raw:e,icrc97:{name:t.name||"",description:t.description||"",image:t.image||"",animation_url:t.animation_url||"",external_url:t.external_url||"",attributes:t.attributes||[]}}}catch(t){return console.error("Failed to parse JSON in parseJSON:",t),{icrc97raw:e,icrc97:{name:"",description:"",image:"",animation_url:"",external_url:"",attributes:[]}}}}async function _t(e,t){console.log("parseNFTMetadata called with tokenId:",e,"metadata:",t);const s=t;let n={icrc97raw:"",icrc97:{name:"",description:"",image:"",animation_url:"",external_url:"",attributes:[]}};for(const i of s){console.log("Processing metadata entry:",i,"structure:",{isArray:Array.isArray(i),length:i==null?void 0:i.length,firstElement:i==null?void 0:i[0],secondElement:i==null?void 0:i[1],entryType:typeof(i==null?void 0:i[0]),entryValue:typeof(i==null?void 0:i[1])});const o=Array.isArray(i)&&i.length>0?i[0]:i,a=Array.isArray(i)&&i.length>1?i[1]:void 0;if(console.log("Extracted key:",o,"value:",a),o==="icrc97:metadata"||o==="icrc97:metadata_v1"||o==="icrc97:external_metadata")if(console.log("Parsing metadata for tokenId:",e,"key:",o,"value:",a),typeof a=="object"&&a!==null&&"Array"in a&&Array.isArray(a.Array)){console.log("Found Array in value:",a.Array);for(const l of a.Array)if("Text"in l){if(console.log("Found Text value in Array:",l.Text),l.Text.startsWith("data:text/json")){const u=JSON.parse(l.Text.substring(l.Text.indexOf(";")+1));n=pe(u);break}if(l.Text.startsWith("https://")||l.Text.startsWith("http://")){let u=await fetch(l.Text);if(console.log("Fetched URL response:",u),u.ok){const c=await u.text();console.log("Fetched URL text:",c),n=pe(c);break}else console.error("Failed to fetch URL:",l.Text),n={icrc97raw:l.Text,icrc97:{name:"",description:"",image:"",animation_url:"",external_url:"",attributes:[]}};n=pe(l.Text);break}}}else typeof a=="string"?n.icrc97raw=a:n.icrc97raw=JSON.stringify(a)}return{allMetadata:s,parsedMetadata:n,tokenId:e}}function kt(e,t,s){const[n,i]=v.useState(null),[o,a]=v.useState(!0),[l,u]=v.useState(null),c=ce(),p=v.useCallback(h=>Q.createActor(We,{agent:c,canisterId:e}).icrc7_token_metadata(h),[c,e]);return v.useEffect(()=>{!e||t==null||(a(!0),wt.request(e,p,t).then(async h=>{console.log("Fetched NFT metadata:",h);let w=await _t(t,h)||null;console.log("Fetched NFT metadata after parsing:",w),i(w),u(null)}).catch(h=>u(h)).finally(()=>a(!1)))},[e,t,s==null?void 0:s.override,s==null?void 0:s.queryArgs,p]),{metadata:n,loading:o,error:l}}export{Tt as a,bt as b,Nt as c,Xe as d,Mt as e,kt as f,Ct as g,de as h,Ft as u};
