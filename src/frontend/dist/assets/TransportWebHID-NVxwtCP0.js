var ft=Object.defineProperty;var ht=(n,i,e)=>i in n?ft(n,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[i]=e;var A=(n,i,e)=>ht(n,typeof i!="symbol"?i+"":i,e);import{G as dt,I as pt,J as nr,K as M,M as ir,N as Et,O as mt,Q as ar,R as or,U as Rt,W as vt}from"./index-CstboGu2.js";const It="transport";class X{constructor({context:i,logType:e}={}){A(this,"exchangeTimeout",3e4);A(this,"unresponsiveTimeout",15e3);A(this,"deviceModel",null);A(this,"tracer");A(this,"_events",new pt);A(this,"send",async(i,e,t,s,u=Buffer.alloc(0),c=[nr.OK],{abortTimeoutMs:l}={})=>{const a=this.tracer.withUpdatedContext({function:"send"});if(u.length>=256)throw a.trace("data.length exceeded 256 bytes limit",{dataLength:u.length}),new M("data.length exceed 256 bytes limit. Got: "+u.length,"DataLengthTooBig");a.trace("Starting an exchange",{abortTimeoutMs:l});const o=await this.exchange(Buffer.concat([Buffer.from([i,e,t,s]),Buffer.from([u.length]),u]),{abortTimeoutMs:l});a.trace("Received response from exchange");const r=o.readUInt16BE(o.length-2);if(!c.some(f=>f===r))throw new ir(r);return o});A(this,"exchangeBusyPromise");A(this,"_appAPIlock",null);this.tracer=new dt(e??It,i)}exchange(i,{abortTimeoutMs:e}={}){throw new Error("exchange not implemented")}exchangeBulk(i,e){let t=!1;const s=()=>{t=!0};return(async()=>{if(!t)for(const c of i){const l=await this.exchange(c);if(t)return;const a=l.readUInt16BE(l.length-2);if(a!==nr.OK)throw new ir(a);e.next(l)}})().then(()=>!t&&e.complete(),c=>!t&&e.error(c)),{unsubscribe:s}}setScrambleKey(i){}close(){return Promise.resolve()}on(i,e){this._events.on(i,e)}off(i,e){this._events.removeListener(i,e)}emit(i,...e){this._events.emit(i,...e)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(i){this.exchangeTimeout=i}setExchangeUnresponsiveTimeout(i){this.unresponsiveTimeout=i}static create(i=3e3,e){return new Promise((t,s)=>{let u=!1;const c=this.listen({next:a=>{u=!0,c&&c.unsubscribe(),l&&clearTimeout(l),this.open(a.descriptor,i).then(t,s)},error:a=>{l&&clearTimeout(l),s(a)},complete:()=>{l&&clearTimeout(l),u||s(new M(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),l=e?setTimeout(()=>{c.unsubscribe(),s(new M(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},e):null})}async exchangeAtomicImpl(i){const e=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw e.trace("Atomic exchange is already busy"),new Et("An action was already pending on the Ledger device. Please deny or reconnect.");let t;const s=new Promise(l=>{t=l});this.exchangeBusyPromise=s;let u=!1;const c=setTimeout(()=>{e.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),u=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const l=await i();return u&&(e.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),l}finally{e.trace("Finalize, clearing busy guard"),clearTimeout(c),t&&t(),this.exchangeBusyPromise=null}}decorateAppAPIMethods(i,e,t){for(const s of e)i[s]=this.decorateAppAPIMethod(s,i[s],i,t)}decorateAppAPIMethod(i,e,t,s){return async(...u)=>{const{_appAPIlock:c}=this;if(c)return Promise.reject(new M("Ledger Device is busy (lock "+c+")","TransportLocked"));try{return this._appAPIlock=i,this.setScrambleKey(s),await e.apply(t,u)}finally{this._appAPIlock=null}}}setTraceContext(i){this.tracer=this.tracer.withContext(i)}updateTraceContext(i){this.tracer.updateContext(i)}getTraceContext(){return this.tracer.getContext()}}A(X,"isSupported"),A(X,"list"),A(X,"listen"),A(X,"open"),A(X,"ErrorMessage_ListenTimeout","No Ledger device found (timeout)"),A(X,"ErrorMessage_NoDeviceFound","No Ledger device found");const cr=5;function gt(n){const i=Buffer.alloc(2);return i.writeUInt16BE(n,0),i}const $t={data:Buffer.alloc(0),dataLength:0,sequence:0},Lt=(n,i)=>({makeBlocks(e){let t=Buffer.concat([gt(e.length),e]);const s=i-5,u=Math.ceil(t.length/s);t=Buffer.concat([t,Buffer.alloc(u*s-t.length+1).fill(0)]);const c=[];for(let l=0;l<u;l++){const a=Buffer.alloc(5);a.writeUInt16BE(n,0),a.writeUInt8(cr,2),a.writeUInt16BE(l,3);const o=t.slice(l*s,(l+1)*s);c.push(Buffer.concat([a,o]))}return c},reduceResponse(e,t){let{data:s,dataLength:u,sequence:c}=e||$t;if(t.readUInt16BE(0)!==n)throw new M("Invalid channel","InvalidChannel");if(t.readUInt8(2)!==cr)throw new M("Invalid tag","InvalidTag");if(t.readUInt16BE(3)!==c)throw new M("Invalid sequence","InvalidSequence");e||(u=t.readUInt16BE(5)),c++;const l=t.slice(e?5:7);return s=Buffer.concat([s,l]),s.length>u&&(s=s.slice(0,u)),{data:s,dataLength:u,sequence:c}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}});var W={exports:{}},ae,ur;function Z(){if(ur)return ae;ur=1;const n="2.0.0",i=256,e=Number.MAX_SAFE_INTEGER||9007199254740991,t=16,s=i-6;return ae={MAX_LENGTH:i,MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:e,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:n,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},ae}var oe,lr;function J(){if(lr)return oe;lr=1;var n={};return oe=typeof process=="object"&&n&&n.NODE_DEBUG&&/\bsemver\b/i.test(n.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},oe}var fr;function Y(){return fr||(fr=1,(function(n,i){const{MAX_SAFE_COMPONENT_LENGTH:e,MAX_SAFE_BUILD_LENGTH:t,MAX_LENGTH:s}=Z(),u=J();i=n.exports={};const c=i.re=[],l=i.safeRe=[],a=i.src=[],o=i.safeSrc=[],r=i.t={};let f=0;const h="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",s],[h,t]],N=w=>{for(const[T,D]of m)w=w.split(`${T}*`).join(`${T}{0,${D}}`).split(`${T}+`).join(`${T}{1,${D}}`);return w},p=(w,T,D)=>{const y=N(T),b=f++;u(w,b,T),r[w]=b,a[b]=T,o[b]=y,c[b]=new RegExp(T,D?"g":void 0),l[b]=new RegExp(y,D?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),p("MAINVERSION",`(${a[r.NUMERICIDENTIFIER]})\\.(${a[r.NUMERICIDENTIFIER]})\\.(${a[r.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${a[r.NUMERICIDENTIFIERLOOSE]})\\.(${a[r.NUMERICIDENTIFIERLOOSE]})\\.(${a[r.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${a[r.NONNUMERICIDENTIFIER]}|${a[r.NUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${a[r.NONNUMERICIDENTIFIER]}|${a[r.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASE",`(?:-(${a[r.PRERELEASEIDENTIFIER]}(?:\\.${a[r.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${a[r.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${a[r.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${h}+`),p("BUILD",`(?:\\+(${a[r.BUILDIDENTIFIER]}(?:\\.${a[r.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${a[r.MAINVERSION]}${a[r.PRERELEASE]}?${a[r.BUILD]}?`),p("FULL",`^${a[r.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${a[r.MAINVERSIONLOOSE]}${a[r.PRERELEASELOOSE]}?${a[r.BUILD]}?`),p("LOOSE",`^${a[r.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${a[r.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${a[r.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${a[r.XRANGEIDENTIFIER]})(?:\\.(${a[r.XRANGEIDENTIFIER]})(?:\\.(${a[r.XRANGEIDENTIFIER]})(?:${a[r.PRERELEASE]})?${a[r.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${a[r.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[r.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[r.XRANGEIDENTIFIERLOOSE]})(?:${a[r.PRERELEASELOOSE]})?${a[r.BUILD]}?)?)?`),p("XRANGE",`^${a[r.GTLT]}\\s*${a[r.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${a[r.GTLT]}\\s*${a[r.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?`),p("COERCE",`${a[r.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",a[r.COERCEPLAIN]+`(?:${a[r.PRERELEASE]})?(?:${a[r.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",a[r.COERCE],!0),p("COERCERTLFULL",a[r.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${a[r.LONETILDE]}\\s+`,!0),i.tildeTrimReplace="$1~",p("TILDE",`^${a[r.LONETILDE]}${a[r.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${a[r.LONETILDE]}${a[r.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${a[r.LONECARET]}\\s+`,!0),i.caretTrimReplace="$1^",p("CARET",`^${a[r.LONECARET]}${a[r.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${a[r.LONECARET]}${a[r.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${a[r.GTLT]}\\s*(${a[r.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${a[r.GTLT]}\\s*(${a[r.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${a[r.GTLT]}\\s*(${a[r.LOOSEPLAIN]}|${a[r.XRANGEPLAIN]})`,!0),i.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${a[r.XRANGEPLAIN]})\\s+-\\s+(${a[r.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${a[r.XRANGEPLAINLOOSE]})\\s+-\\s+(${a[r.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(W,W.exports)),W.exports}var ce,hr;function Je(){if(hr)return ce;hr=1;const n=Object.freeze({loose:!0}),i=Object.freeze({});return ce=t=>t?typeof t!="object"?n:t:i,ce}var ue,dr;function it(){if(dr)return ue;dr=1;const n=/^[0-9]+$/,i=(t,s)=>{if(typeof t=="number"&&typeof s=="number")return t===s?0:t<s?-1:1;const u=n.test(t),c=n.test(s);return u&&c&&(t=+t,s=+s),t===s?0:u&&!c?-1:c&&!u?1:t<s?-1:1};return ue={compareIdentifiers:i,rcompareIdentifiers:(t,s)=>i(s,t)},ue}var le,pr;function G(){if(pr)return le;pr=1;const n=J(),{MAX_LENGTH:i,MAX_SAFE_INTEGER:e}=Z(),{safeRe:t,t:s}=Y(),u=Je(),{compareIdentifiers:c}=it();class l{constructor(o,r){if(r=u(r),o instanceof l){if(o.loose===!!r.loose&&o.includePrerelease===!!r.includePrerelease)return o;o=o.version}else if(typeof o!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof o}".`);if(o.length>i)throw new TypeError(`version is longer than ${i} characters`);n("SemVer",o,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;const f=o.trim().match(r.loose?t[s.LOOSE]:t[s.FULL]);if(!f)throw new TypeError(`Invalid Version: ${o}`);if(this.raw=o,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>e||this.major<0)throw new TypeError("Invalid major version");if(this.minor>e||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>e||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const m=+h;if(m>=0&&m<e)return m}return h}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(o){if(n("SemVer.compare",this.version,this.options,o),!(o instanceof l)){if(typeof o=="string"&&o===this.version)return 0;o=new l(o,this.options)}return o.version===this.version?0:this.compareMain(o)||this.comparePre(o)}compareMain(o){return o instanceof l||(o=new l(o,this.options)),this.major<o.major?-1:this.major>o.major?1:this.minor<o.minor?-1:this.minor>o.minor?1:this.patch<o.patch?-1:this.patch>o.patch?1:0}comparePre(o){if(o instanceof l||(o=new l(o,this.options)),this.prerelease.length&&!o.prerelease.length)return-1;if(!this.prerelease.length&&o.prerelease.length)return 1;if(!this.prerelease.length&&!o.prerelease.length)return 0;let r=0;do{const f=this.prerelease[r],h=o.prerelease[r];if(n("prerelease compare",r,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return c(f,h)}while(++r)}compareBuild(o){o instanceof l||(o=new l(o,this.options));let r=0;do{const f=this.build[r],h=o.build[r];if(n("build compare",r,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return c(f,h)}while(++r)}inc(o,r,f){if(o.startsWith("pre")){if(!r&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(r){const h=`-${r}`.match(this.options.loose?t[s.PRERELEASELOOSE]:t[s.PRERELEASE]);if(!h||h[1]!==r)throw new Error(`invalid identifier: ${r}`)}}switch(o){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,f),this.inc("pre",r,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,f),this.inc("pre",r,f);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(f)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let m=this.prerelease.length;for(;--m>=0;)typeof this.prerelease[m]=="number"&&(this.prerelease[m]++,m=-2);if(m===-1){if(r===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(r){let m=[r,h];f===!1&&(m=[r]),c(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=m):this.prerelease=m}break}default:throw new Error(`invalid increment argument: ${o}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return le=l,le}var fe,Er;function V(){if(Er)return fe;Er=1;const n=G();return fe=(e,t,s=!1)=>{if(e instanceof n)return e;try{return new n(e,t)}catch(u){if(!s)return null;throw u}},fe}var he,mr;function St(){if(mr)return he;mr=1;const n=V();return he=(e,t)=>{const s=n(e,t);return s?s.version:null},he}var de,Rr;function wt(){if(Rr)return de;Rr=1;const n=V();return de=(e,t)=>{const s=n(e.trim().replace(/^[=v]+/,""),t);return s?s.version:null},de}var pe,vr;function Nt(){if(vr)return pe;vr=1;const n=G();return pe=(e,t,s,u,c)=>{typeof s=="string"&&(c=u,u=s,s=void 0);try{return new n(e instanceof n?e.version:e,s).inc(t,u,c).version}catch{return null}},pe}var Ee,Ir;function Ot(){if(Ir)return Ee;Ir=1;const n=V();return Ee=(e,t)=>{const s=n(e,null,!0),u=n(t,null,!0),c=s.compare(u);if(c===0)return null;const l=c>0,a=l?s:u,o=l?u:s,r=!!a.prerelease.length;if(!!o.prerelease.length&&!r){if(!o.patch&&!o.minor)return"major";if(o.compareMain(a)===0)return o.minor&&!o.patch?"minor":"patch"}const h=r?"pre":"";return s.major!==u.major?h+"major":s.minor!==u.minor?h+"minor":s.patch!==u.patch?h+"patch":"prerelease"},Ee}var me,gr;function Tt(){if(gr)return me;gr=1;const n=G();return me=(e,t)=>new n(e,t).major,me}var Re,$r;function At(){if($r)return Re;$r=1;const n=G();return Re=(e,t)=>new n(e,t).minor,Re}var ve,Lr;function yt(){if(Lr)return ve;Lr=1;const n=G();return ve=(e,t)=>new n(e,t).patch,ve}var Ie,Sr;function Pt(){if(Sr)return Ie;Sr=1;const n=V();return Ie=(e,t)=>{const s=n(e,t);return s&&s.prerelease.length?s.prerelease:null},Ie}var ge,wr;function B(){if(wr)return ge;wr=1;const n=G();return ge=(e,t,s)=>new n(e,s).compare(new n(t,s)),ge}var $e,Nr;function Ct(){if(Nr)return $e;Nr=1;const n=B();return $e=(e,t,s)=>n(t,e,s),$e}var Le,Or;function qt(){if(Or)return Le;Or=1;const n=B();return Le=(e,t)=>n(e,t,!0),Le}var Se,Tr;function Qe(){if(Tr)return Se;Tr=1;const n=G();return Se=(e,t,s)=>{const u=new n(e,s),c=new n(t,s);return u.compare(c)||u.compareBuild(c)},Se}var we,Ar;function xt(){if(Ar)return we;Ar=1;const n=Qe();return we=(e,t)=>e.sort((s,u)=>n(s,u,t)),we}var Ne,yr;function Ut(){if(yr)return Ne;yr=1;const n=Qe();return Ne=(e,t)=>e.sort((s,u)=>n(u,s,t)),Ne}var Oe,Pr;function Q(){if(Pr)return Oe;Pr=1;const n=B();return Oe=(e,t,s)=>n(e,t,s)>0,Oe}var Te,Cr;function er(){if(Cr)return Te;Cr=1;const n=B();return Te=(e,t,s)=>n(e,t,s)<0,Te}var Ae,qr;function at(){if(qr)return Ae;qr=1;const n=B();return Ae=(e,t,s)=>n(e,t,s)===0,Ae}var ye,xr;function ot(){if(xr)return ye;xr=1;const n=B();return ye=(e,t,s)=>n(e,t,s)!==0,ye}var Pe,Ur;function rr(){if(Ur)return Pe;Ur=1;const n=B();return Pe=(e,t,s)=>n(e,t,s)>=0,Pe}var Ce,Dr;function tr(){if(Dr)return Ce;Dr=1;const n=B();return Ce=(e,t,s)=>n(e,t,s)<=0,Ce}var qe,br;function ct(){if(br)return qe;br=1;const n=at(),i=ot(),e=Q(),t=rr(),s=er(),u=tr();return qe=(l,a,o,r)=>{switch(a){case"===":return typeof l=="object"&&(l=l.version),typeof o=="object"&&(o=o.version),l===o;case"!==":return typeof l=="object"&&(l=l.version),typeof o=="object"&&(o=o.version),l!==o;case"":case"=":case"==":return n(l,o,r);case"!=":return i(l,o,r);case">":return e(l,o,r);case">=":return t(l,o,r);case"<":return s(l,o,r);case"<=":return u(l,o,r);default:throw new TypeError(`Invalid operator: ${a}`)}},qe}var xe,_r;function Dt(){if(_r)return xe;_r=1;const n=G(),i=V(),{safeRe:e,t}=Y();return xe=(u,c)=>{if(u instanceof n)return u;if(typeof u=="number"&&(u=String(u)),typeof u!="string")return null;c=c||{};let l=null;if(!c.rtl)l=u.match(c.includePrerelease?e[t.COERCEFULL]:e[t.COERCE]);else{const m=c.includePrerelease?e[t.COERCERTLFULL]:e[t.COERCERTL];let N;for(;(N=m.exec(u))&&(!l||l.index+l[0].length!==u.length);)(!l||N.index+N[0].length!==l.index+l[0].length)&&(l=N),m.lastIndex=N.index+N[1].length+N[2].length;m.lastIndex=-1}if(l===null)return null;const a=l[2],o=l[3]||"0",r=l[4]||"0",f=c.includePrerelease&&l[5]?`-${l[5]}`:"",h=c.includePrerelease&&l[6]?`+${l[6]}`:"";return i(`${a}.${o}.${r}${f}${h}`,c)},xe}var Ue,Gr;function bt(){if(Gr)return Ue;Gr=1;class n{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){const u=this.map.keys().next().value;this.delete(u)}this.map.set(e,t)}return this}}return Ue=n,Ue}var De,Fr;function j(){if(Fr)return De;Fr=1;const n=/\s+/g;class i{constructor(d,I){if(I=s(I),d instanceof i)return d.loose===!!I.loose&&d.includePrerelease===!!I.includePrerelease?d:new i(d.raw,I);if(d instanceof u)return this.raw=d.value,this.set=[[d]],this.formatted=void 0,this;if(this.options=I,this.loose=!!I.loose,this.includePrerelease=!!I.includePrerelease,this.raw=d.trim().replace(n," "),this.set=this.raw.split("||").map(R=>this.parseRange(R.trim())).filter(R=>R.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const R=this.set[0];if(this.set=this.set.filter(g=>!p(g[0])),this.set.length===0)this.set=[R];else if(this.set.length>1){for(const g of this.set)if(g.length===1&&w(g[0])){this.set=[g];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let d=0;d<this.set.length;d++){d>0&&(this.formatted+="||");const I=this.set[d];for(let R=0;R<I.length;R++)R>0&&(this.formatted+=" "),this.formatted+=I[R].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(d){const R=((this.options.includePrerelease&&m)|(this.options.loose&&N))+":"+d,g=t.get(R);if(g)return g;const v=this.options.loose,$=v?a[o.HYPHENRANGELOOSE]:a[o.HYPHENRANGE];d=d.replace($,ne(this.options.includePrerelease)),c("hyphen replace",d),d=d.replace(a[o.COMPARATORTRIM],r),c("comparator trim",d),d=d.replace(a[o.TILDETRIM],f),c("tilde trim",d),d=d.replace(a[o.CARETTRIM],h),c("caret trim",d);let O=d.split(" ").map(x=>D(x,this.options)).join(" ").split(/\s+/).map(x=>se(x,this.options));v&&(O=O.filter(x=>(c("loose invalid filter",x,this.options),!!x.match(a[o.COMPARATORLOOSE])))),c("range list",O);const S=new Map,P=O.map(x=>new u(x,this.options));for(const x of P){if(p(x))return[x];S.set(x.value,x)}S.size>1&&S.has("")&&S.delete("");const _=[...S.values()];return t.set(R,_),_}intersects(d,I){if(!(d instanceof i))throw new TypeError("a Range is required");return this.set.some(R=>T(R,I)&&d.set.some(g=>T(g,I)&&R.every(v=>g.every($=>v.intersects($,I)))))}test(d){if(!d)return!1;if(typeof d=="string")try{d=new l(d,this.options)}catch{return!1}for(let I=0;I<this.set.length;I++)if(ie(this.set[I],d,this.options))return!0;return!1}}De=i;const e=bt(),t=new e,s=Je(),u=ee(),c=J(),l=G(),{safeRe:a,t:o,comparatorTrimReplace:r,tildeTrimReplace:f,caretTrimReplace:h}=Y(),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:N}=Z(),p=E=>E.value==="<0.0.0-0",w=E=>E.value==="",T=(E,d)=>{let I=!0;const R=E.slice();let g=R.pop();for(;I&&R.length;)I=R.every(v=>g.intersects(v,d)),g=R.pop();return I},D=(E,d)=>(E=E.replace(a[o.BUILD],""),c("comp",E,d),E=C(E,d),c("caret",E),E=b(E,d),c("tildes",E),E=L(E,d),c("xrange",E),E=te(E,d),c("stars",E),E),y=E=>!E||E.toLowerCase()==="x"||E==="*",b=(E,d)=>E.trim().split(/\s+/).map(I=>F(I,d)).join(" "),F=(E,d)=>{const I=d.loose?a[o.TILDELOOSE]:a[o.TILDE];return E.replace(I,(R,g,v,$,O)=>{c("tilde",E,R,g,v,$,O);let S;return y(g)?S="":y(v)?S=`>=${g}.0.0 <${+g+1}.0.0-0`:y($)?S=`>=${g}.${v}.0 <${g}.${+v+1}.0-0`:O?(c("replaceTilde pr",O),S=`>=${g}.${v}.${$}-${O} <${g}.${+v+1}.0-0`):S=`>=${g}.${v}.${$} <${g}.${+v+1}.0-0`,c("tilde return",S),S})},C=(E,d)=>E.trim().split(/\s+/).map(I=>U(I,d)).join(" "),U=(E,d)=>{c("caret",E,d);const I=d.loose?a[o.CARETLOOSE]:a[o.CARET],R=d.includePrerelease?"-0":"";return E.replace(I,(g,v,$,O,S)=>{c("caret",E,g,v,$,O,S);let P;return y(v)?P="":y($)?P=`>=${v}.0.0${R} <${+v+1}.0.0-0`:y(O)?v==="0"?P=`>=${v}.${$}.0${R} <${v}.${+$+1}.0-0`:P=`>=${v}.${$}.0${R} <${+v+1}.0.0-0`:S?(c("replaceCaret pr",S),v==="0"?$==="0"?P=`>=${v}.${$}.${O}-${S} <${v}.${$}.${+O+1}-0`:P=`>=${v}.${$}.${O}-${S} <${v}.${+$+1}.0-0`:P=`>=${v}.${$}.${O}-${S} <${+v+1}.0.0-0`):(c("no pr"),v==="0"?$==="0"?P=`>=${v}.${$}.${O}${R} <${v}.${$}.${+O+1}-0`:P=`>=${v}.${$}.${O}${R} <${v}.${+$+1}.0-0`:P=`>=${v}.${$}.${O} <${+v+1}.0.0-0`),c("caret return",P),P})},L=(E,d)=>(c("replaceXRanges",E,d),E.split(/\s+/).map(I=>z(I,d)).join(" ")),z=(E,d)=>{E=E.trim();const I=d.loose?a[o.XRANGELOOSE]:a[o.XRANGE];return E.replace(I,(R,g,v,$,O,S)=>{c("xRange",E,R,g,v,$,O,S);const P=y(v),_=P||y($),x=_||y(O),H=x;return g==="="&&H&&(g=""),S=d.includePrerelease?"-0":"",P?g===">"||g==="<"?R="<0.0.0-0":R="*":g&&H?(_&&($=0),O=0,g===">"?(g=">=",_?(v=+v+1,$=0,O=0):($=+$+1,O=0)):g==="<="&&(g="<",_?v=+v+1:$=+$+1),g==="<"&&(S="-0"),R=`${g+v}.${$}.${O}${S}`):_?R=`>=${v}.0.0${S} <${+v+1}.0.0-0`:x&&(R=`>=${v}.${$}.0${S} <${v}.${+$+1}.0-0`),c("xRange return",R),R})},te=(E,d)=>(c("replaceStars",E,d),E.trim().replace(a[o.STAR],"")),se=(E,d)=>(c("replaceGTE0",E,d),E.trim().replace(a[d.includePrerelease?o.GTE0PRE:o.GTE0],"")),ne=E=>(d,I,R,g,v,$,O,S,P,_,x,H)=>(y(R)?I="":y(g)?I=`>=${R}.0.0${E?"-0":""}`:y(v)?I=`>=${R}.${g}.0${E?"-0":""}`:$?I=`>=${I}`:I=`>=${I}${E?"-0":""}`,y(P)?S="":y(_)?S=`<${+P+1}.0.0-0`:y(x)?S=`<${P}.${+_+1}.0-0`:H?S=`<=${P}.${_}.${x}-${H}`:E?S=`<${P}.${_}.${+x+1}-0`:S=`<=${S}`,`${I} ${S}`.trim()),ie=(E,d,I)=>{for(let R=0;R<E.length;R++)if(!E[R].test(d))return!1;if(d.prerelease.length&&!I.includePrerelease){for(let R=0;R<E.length;R++)if(c(E[R].semver),E[R].semver!==u.ANY&&E[R].semver.prerelease.length>0){const g=E[R].semver;if(g.major===d.major&&g.minor===d.minor&&g.patch===d.patch)return!0}return!1}return!0};return De}var be,Br;function ee(){if(Br)return be;Br=1;const n=Symbol("SemVer ANY");class i{static get ANY(){return n}constructor(r,f){if(f=e(f),r instanceof i){if(r.loose===!!f.loose)return r;r=r.value}r=r.trim().split(/\s+/).join(" "),c("comparator",r,f),this.options=f,this.loose=!!f.loose,this.parse(r),this.semver===n?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(r){const f=this.options.loose?t[s.COMPARATORLOOSE]:t[s.COMPARATOR],h=r.match(f);if(!h)throw new TypeError(`Invalid comparator: ${r}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new l(h[2],this.options.loose):this.semver=n}toString(){return this.value}test(r){if(c("Comparator.test",r,this.options.loose),this.semver===n||r===n)return!0;if(typeof r=="string")try{r=new l(r,this.options)}catch{return!1}return u(r,this.operator,this.semver,this.options)}intersects(r,f){if(!(r instanceof i))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new a(r.value,f).test(this.value):r.operator===""?r.value===""?!0:new a(this.value,f).test(r.semver):(f=e(f),f.includePrerelease&&(this.value==="<0.0.0-0"||r.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||r.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&r.operator.startsWith(">")||this.operator.startsWith("<")&&r.operator.startsWith("<")||this.semver.version===r.semver.version&&this.operator.includes("=")&&r.operator.includes("=")||u(this.semver,"<",r.semver,f)&&this.operator.startsWith(">")&&r.operator.startsWith("<")||u(this.semver,">",r.semver,f)&&this.operator.startsWith("<")&&r.operator.startsWith(">")))}}be=i;const e=Je(),{safeRe:t,t:s}=Y(),u=ct(),c=J(),l=G(),a=j();return be}var _e,jr;function re(){if(jr)return _e;jr=1;const n=j();return _e=(e,t,s)=>{try{t=new n(t,s)}catch{return!1}return t.test(e)},_e}var Ge,Mr;function _t(){if(Mr)return Ge;Mr=1;const n=j();return Ge=(e,t)=>new n(e,t).set.map(s=>s.map(u=>u.value).join(" ").trim().split(" ")),Ge}var Fe,kr;function Gt(){if(kr)return Fe;kr=1;const n=G(),i=j();return Fe=(t,s,u)=>{let c=null,l=null,a=null;try{a=new i(s,u)}catch{return null}return t.forEach(o=>{a.test(o)&&(!c||l.compare(o)===-1)&&(c=o,l=new n(c,u))}),c},Fe}var Be,Xr;function Ft(){if(Xr)return Be;Xr=1;const n=G(),i=j();return Be=(t,s,u)=>{let c=null,l=null,a=null;try{a=new i(s,u)}catch{return null}return t.forEach(o=>{a.test(o)&&(!c||l.compare(o)===1)&&(c=o,l=new n(c,u))}),c},Be}var je,Vr;function Bt(){if(Vr)return je;Vr=1;const n=G(),i=j(),e=Q();return je=(s,u)=>{s=new i(s,u);let c=new n("0.0.0");if(s.test(c)||(c=new n("0.0.0-0"),s.test(c)))return c;c=null;for(let l=0;l<s.set.length;++l){const a=s.set[l];let o=null;a.forEach(r=>{const f=new n(r.semver.version);switch(r.operator){case">":f.prerelease.length===0?f.patch++:f.prerelease.push(0),f.raw=f.format();case"":case">=":(!o||e(f,o))&&(o=f);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${r.operator}`)}}),o&&(!c||e(c,o))&&(c=o)}return c&&s.test(c)?c:null},je}var Me,zr;function jt(){if(zr)return Me;zr=1;const n=j();return Me=(e,t)=>{try{return new n(e,t).range||"*"}catch{return null}},Me}var ke,Hr;function sr(){if(Hr)return ke;Hr=1;const n=G(),i=ee(),{ANY:e}=i,t=j(),s=re(),u=Q(),c=er(),l=tr(),a=rr();return ke=(r,f,h,m)=>{r=new n(r,m),f=new t(f,m);let N,p,w,T,D;switch(h){case">":N=u,p=l,w=c,T=">",D=">=";break;case"<":N=c,p=a,w=u,T="<",D="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(r,f,m))return!1;for(let y=0;y<f.set.length;++y){const b=f.set[y];let F=null,C=null;if(b.forEach(U=>{U.semver===e&&(U=new i(">=0.0.0")),F=F||U,C=C||U,N(U.semver,F.semver,m)?F=U:w(U.semver,C.semver,m)&&(C=U)}),F.operator===T||F.operator===D||(!C.operator||C.operator===T)&&p(r,C.semver))return!1;if(C.operator===D&&w(r,C.semver))return!1}return!0},ke}var Xe,Yr;function Mt(){if(Yr)return Xe;Yr=1;const n=sr();return Xe=(e,t,s)=>n(e,t,">",s),Xe}var Ve,Wr;function kt(){if(Wr)return Ve;Wr=1;const n=sr();return Ve=(e,t,s)=>n(e,t,"<",s),Ve}var ze,Kr;function Xt(){if(Kr)return ze;Kr=1;const n=j();return ze=(e,t,s)=>(e=new n(e,s),t=new n(t,s),e.intersects(t,s)),ze}var He,Zr;function Vt(){if(Zr)return He;Zr=1;const n=re(),i=B();return He=(e,t,s)=>{const u=[];let c=null,l=null;const a=e.sort((h,m)=>i(h,m,s));for(const h of a)n(h,t,s)?(l=h,c||(c=h)):(l&&u.push([c,l]),l=null,c=null);c&&u.push([c,null]);const o=[];for(const[h,m]of u)h===m?o.push(h):!m&&h===a[0]?o.push("*"):m?h===a[0]?o.push(`<=${m}`):o.push(`${h} - ${m}`):o.push(`>=${h}`);const r=o.join(" || "),f=typeof t.raw=="string"?t.raw:String(t);return r.length<f.length?r:t},He}var Ye,Jr;function zt(){if(Jr)return Ye;Jr=1;const n=j(),i=ee(),{ANY:e}=i,t=re(),s=B(),u=(f,h,m={})=>{if(f===h)return!0;f=new n(f,m),h=new n(h,m);let N=!1;e:for(const p of f.set){for(const w of h.set){const T=a(p,w,m);if(N=N||T!==null,T)continue e}if(N)return!1}return!0},c=[new i(">=0.0.0-0")],l=[new i(">=0.0.0")],a=(f,h,m)=>{if(f===h)return!0;if(f.length===1&&f[0].semver===e){if(h.length===1&&h[0].semver===e)return!0;m.includePrerelease?f=c:f=l}if(h.length===1&&h[0].semver===e){if(m.includePrerelease)return!0;h=l}const N=new Set;let p,w;for(const L of f)L.operator===">"||L.operator===">="?p=o(p,L,m):L.operator==="<"||L.operator==="<="?w=r(w,L,m):N.add(L.semver);if(N.size>1)return null;let T;if(p&&w){if(T=s(p.semver,w.semver,m),T>0)return null;if(T===0&&(p.operator!==">="||w.operator!=="<="))return null}for(const L of N){if(p&&!t(L,String(p),m)||w&&!t(L,String(w),m))return null;for(const z of h)if(!t(L,String(z),m))return!1;return!0}let D,y,b,F,C=w&&!m.includePrerelease&&w.semver.prerelease.length?w.semver:!1,U=p&&!m.includePrerelease&&p.semver.prerelease.length?p.semver:!1;C&&C.prerelease.length===1&&w.operator==="<"&&C.prerelease[0]===0&&(C=!1);for(const L of h){if(F=F||L.operator===">"||L.operator===">=",b=b||L.operator==="<"||L.operator==="<=",p){if(U&&L.semver.prerelease&&L.semver.prerelease.length&&L.semver.major===U.major&&L.semver.minor===U.minor&&L.semver.patch===U.patch&&(U=!1),L.operator===">"||L.operator===">="){if(D=o(p,L,m),D===L&&D!==p)return!1}else if(p.operator===">="&&!t(p.semver,String(L),m))return!1}if(w){if(C&&L.semver.prerelease&&L.semver.prerelease.length&&L.semver.major===C.major&&L.semver.minor===C.minor&&L.semver.patch===C.patch&&(C=!1),L.operator==="<"||L.operator==="<="){if(y=r(w,L,m),y===L&&y!==w)return!1}else if(w.operator==="<="&&!t(w.semver,String(L),m))return!1}if(!L.operator&&(w||p)&&T!==0)return!1}return!(p&&b&&!w&&T!==0||w&&F&&!p&&T!==0||U||C)},o=(f,h,m)=>{if(!f)return h;const N=s(f.semver,h.semver,m);return N>0?f:N<0||h.operator===">"&&f.operator===">="?h:f},r=(f,h,m)=>{if(!f)return h;const N=s(f.semver,h.semver,m);return N<0?f:N>0||h.operator==="<"&&f.operator==="<="?h:f};return Ye=u,Ye}var We,Qr;function Ht(){if(Qr)return We;Qr=1;const n=Y(),i=Z(),e=G(),t=it(),s=V(),u=St(),c=wt(),l=Nt(),a=Ot(),o=Tt(),r=At(),f=yt(),h=Pt(),m=B(),N=Ct(),p=qt(),w=Qe(),T=xt(),D=Ut(),y=Q(),b=er(),F=at(),C=ot(),U=rr(),L=tr(),z=ct(),te=Dt(),se=ee(),ne=j(),ie=re(),E=_t(),d=Gt(),I=Ft(),R=Bt(),g=jt(),v=sr(),$=Mt(),O=kt(),S=Xt(),P=Vt(),_=zt();return We={parse:s,valid:u,clean:c,inc:l,diff:a,major:o,minor:r,patch:f,prerelease:h,compare:m,rcompare:N,compareLoose:p,compareBuild:w,sort:T,rsort:D,gt:y,lt:b,eq:F,neq:C,gte:U,lte:L,cmp:z,coerce:te,Comparator:se,Range:ne,satisfies:ie,toComparators:E,maxSatisfying:d,minSatisfying:I,minVersion:R,validRange:g,outside:v,gtr:$,ltr:O,intersects:S,simplifyRange:P,subset:_,SemVer:e,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:i.SEMVER_SPEC_VERSION,RELEASE_TYPES:i.RELEASE_TYPES,compareIdentifiers:t.compareIdentifiers,rcompareIdentifiers:t.rcompareIdentifiers},We}var Yt=Ht();const et=mt(Yt);var q;(function(n){n.blue="blue",n.nanoS="nanoS",n.nanoSP="nanoSP",n.nanoX="nanoX",n.stax="stax",n.europa="europa",n.apex="apex"})(q||(q={}));const Ke={[q.blue]:{id:q.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:n=>4*1024},[q.nanoS]:{id:q.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:n=>et.lt(et.coerce(n)??"","2.0.0")?4*1024:2*1024},[q.nanoX]:{id:q.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:n=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[q.nanoSP]:{id:q.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:n=>32},[q.apex]:{id:q.apex,productName:"Ledger Apex",productIdMM:128,legacyUsbProductId:8,usbOnly:!1,memorySize:1533*1024,masks:[859832320],getBlockSize:n=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-8004-0000-4c6564676572",notifyUuid:"13d63400-2c97-8004-0001-4c6564676572",writeUuid:"13d63400-2c97-8004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-8004-0003-4c6564676572"}]},[q.stax]:{id:q.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1533*1024,masks:[857735168],getBlockSize:n=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[q.europa]:{id:q.europa,productName:"Ledger Flex",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1533*1024,masks:[858783744],getBlockSize:n=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}};q.blue,q.nanoS,q.nanoSP,q.nanoX,q.stax,q.europa;const rt=Object.values(Ke),ut=11415,tt=n=>{const i=rt.find(s=>s.legacyUsbProductId===n);if(i)return i;const e=n>>8;return rt.find(s=>s.productIdMM===e)},Wt=[],st={};for(const n in Ke){const i=Ke[n],{bluetoothSpec:e}=i;if(e)for(let t=0;t<e.length;t++){const s=e[t];Wt.push(s.serviceUuid),st[s.serviceUuid]=st[s.serviceUuid.replace(/-/g,"")]={deviceModel:i,...s}}}const Kt=[{vendorId:ut}],Zt=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),K=()=>{const{hid:n}=navigator;if(!n)throw new M("navigator.hid is not supported","HIDNotSupported");return n};async function lt(){const n=await K().requestDevice({filters:Kt});return Array.isArray(n)?n:[n]}async function Ze(){return(await K().getDevices()).filter(i=>i.vendorId===ut)}async function Jt(){const n=await Ze();return n.length>0?n[0]:(await lt())[0]}const k=class k extends X{constructor(e){super();A(this,"device");A(this,"deviceModel");A(this,"channel",Math.floor(Math.random()*65535));A(this,"packetSize",64);A(this,"inputs",[]);A(this,"inputCallback");A(this,"read",()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(e=>{this.inputCallback=e}));A(this,"onInputReport",e=>{const t=Buffer.from(e.data.buffer);this.inputCallback?(this.inputCallback(t),this.inputCallback=null):this.inputs.push(t)});A(this,"_disconnectEmitted",!1);A(this,"_emitDisconnect",e=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",e))});A(this,"exchange",async e=>await this.exchangeAtomicImpl(async()=>{const{channel:s,packetSize:u}=this;or("apdu","=> "+e.toString("hex"));const c=Lt(s,u),l=c.makeBlocks(e);for(let r=0;r<l.length;r++)await this.device.sendReport(0,l[r]);let a,o;for(;!(a=c.getReducedResult(o));)try{const r=await this.read();o=c.reduceResponse(o,r)}catch(r){if(r instanceof M&&r.id==="InvalidChannel")continue;throw r}return or("apdu","<= "+a.toString("hex")),a}).catch(s=>{throw s&&s.message&&s.message.includes("write")?(this._emitDisconnect(s),new Rt(s.message)):s}));this.device=e,this.deviceModel=typeof e.productId=="number"?tt(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static async request(){const[e]=await lt();return k.open(e)}static async openConnected(){const e=await Ze();return e.length===0?null:k.open(e[0])}static async open(e){await e.open();const t=new k(e),s=u=>{e===u.device&&(K().removeEventListener("disconnect",s),t._emitDisconnect(new vt))};return K().addEventListener("disconnect",s),t}async close(){await this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),await this.device.close()}setScrambleKey(){}};A(k,"isSupported",Zt),A(k,"list",Ze),A(k,"listen",e=>{let t=!1;Jt().then(u=>{if(!u)e.error(new ar("Access denied to use Ledger device"));else if(!t){const c=typeof u.productId=="number"?tt(u.productId):void 0;e.next({type:"add",descriptor:u,deviceModel:c}),e.complete()}},u=>{e.error(new ar(u.message))});function s(){t=!0}return{unsubscribe:s}});let nt=k;export{nt as default};
